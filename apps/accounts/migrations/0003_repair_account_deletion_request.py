# Generated by migration integrity repair on 2026-01-14
# Repairs missing AccountDeletionRequest table from accounts.0002

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ("accounts", "0002_phase3b_account_deletion"),
    ]

    operations = [
        migrations.RunSQL(
            sql="""
            CREATE TABLE IF NOT EXISTS accounts_accountdeletionrequest (
                id bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
                status varchar(20) NOT NULL,
                requested_at timestamp with time zone NOT NULL,
                scheduled_for timestamp with time zone NOT NULL,
                canceled_at timestamp with time zone NULL,
                completed_at timestamp with time zone NULL,
                reason text NOT NULL,
                confirmation_phrase varchar(100) NOT NULL,
                last_ip inet NULL,
                last_user_agent text NOT NULL,
                user_id bigint NOT NULL UNIQUE,
                CONSTRAINT accounts_accountdele_user_id_6a166c52_fk_accounts_
                    FOREIGN KEY (user_id) 
                    REFERENCES accounts_user (id) 
                    DEFERRABLE INITIALLY DEFERRED
            );
            
            CREATE INDEX IF NOT EXISTS accounts_accountdeletionrequest_status_dd6e1b25 
                ON accounts_accountdeletionrequest (status);
            CREATE INDEX IF NOT EXISTS accounts_accountdeletionrequest_status_dd6e1b25_like 
                ON accounts_accountdeletionrequest (status varchar_pattern_ops);
            CREATE INDEX IF NOT EXISTS accounts_ac_status_b163ed_idx 
                ON accounts_accountdeletionrequest (status, scheduled_for);
            """,
            reverse_sql="-- DROP TABLE IF EXISTS accounts_accountdeletionrequest;",
        ),
    ]
