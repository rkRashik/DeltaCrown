# Generated by migration integrity repair on 2026-01-14
# Repairs missing tables from migrations 0031, 0034, 0035, 0036
# All tables marked as created but missing from database schema

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ("user_profile", "0056_repair_publicidcounter_table"),
    ]

    operations = [
        # ProfileShowcase (from 0031)
        migrations.RunSQL(
            sql="""
            CREATE TABLE IF NOT EXISTS user_profile_showcase (
                id bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
                enabled_sections jsonb NOT NULL,
                featured_team_id integer NULL,
                featured_team_role varchar(50) NOT NULL,
                featured_passport_id integer NULL,
                highlights jsonb NOT NULL,
                section_order jsonb NOT NULL,
                created_at timestamp with time zone NOT NULL,
                updated_at timestamp with time zone NOT NULL,
                user_profile_id bigint NOT NULL UNIQUE,
                CONSTRAINT user_profile_showcas_user_profile_id_5137489b_fk_user_prof
                    FOREIGN KEY (user_profile_id) 
                    REFERENCES user_profile_userprofile (id) 
                    DEFERRABLE INITIALLY DEFERRED
            );
            """,
            reverse_sql="-- DROP TABLE IF EXISTS user_profile_showcase;",
        ),
        
        # GameConfig (from 0034 - p0_media_models actually creates loadout models)
        migrations.RunSQL(
            sql="""
            CREATE TABLE IF NOT EXISTS user_profile_game_config (
                id bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
                settings jsonb NOT NULL,
                is_public boolean NOT NULL,
                notes text NOT NULL,
                created_at timestamp with time zone NOT NULL,
                updated_at timestamp with time zone NOT NULL,
                game_id bigint NOT NULL,
                user_id bigint NOT NULL,
                CONSTRAINT unique_game_config_per_user_per_game UNIQUE (user_id, game_id),
                CONSTRAINT user_profile_game_config_game_id_dd470204_fk_games_game_id
                    FOREIGN KEY (game_id) REFERENCES games_game (id) DEFERRABLE INITIALLY DEFERRED,
                CONSTRAINT user_profile_game_config_user_id_df11026b_fk_accounts_user_id
                    FOREIGN KEY (user_id) REFERENCES accounts_user (id) DEFERRABLE INITIALLY DEFERRED
            );
            
            CREATE INDEX IF NOT EXISTS user_profile_game_config_game_id_dd470204 
                ON user_profile_game_config (game_id);
            CREATE INDEX IF NOT EXISTS user_profile_game_config_user_id_df11026b 
                ON user_profile_game_config (user_id);
            CREATE INDEX IF NOT EXISTS user_profil_user_id_37aa2b_idx 
                ON user_profile_game_config (user_id, game_id);
            CREATE INDEX IF NOT EXISTS user_profil_game_id_458c33_idx 
                ON user_profile_game_config (game_id, is_public);
            CREATE INDEX IF NOT EXISTS user_profil_user_id_2786f2_idx 
                ON user_profile_game_config (user_id, is_public);
            """,
            reverse_sql="-- DROP TABLE IF EXISTS user_profile_game_config;",
        ),
        
        # HardwareGear (from 0034)
        migrations.RunSQL(
            sql="""
            CREATE TABLE IF NOT EXISTS user_profile_hardware_gear (
                id bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
                category varchar(20) NOT NULL,
                brand varchar(100) NOT NULL,
                model varchar(200) NOT NULL,
                specs jsonb NOT NULL,
                purchase_url varchar(500) NOT NULL,
                is_public boolean NOT NULL,
                created_at timestamp with time zone NOT NULL,
                updated_at timestamp with time zone NOT NULL,
                user_id bigint NOT NULL,
                CONSTRAINT unique_hardware_per_category_per_user UNIQUE (user_id, category),
                CONSTRAINT user_profile_hardware_gear_user_id_ecfa0eca_fk_accounts_user_id
                    FOREIGN KEY (user_id) REFERENCES accounts_user (id) DEFERRABLE INITIALLY DEFERRED
            );
            
            CREATE INDEX IF NOT EXISTS user_profile_hardware_gear_user_id_ecfa0eca 
                ON user_profile_hardware_gear (user_id);
            CREATE INDEX IF NOT EXISTS user_profil_user_id_d9c6d8_idx 
                ON user_profile_hardware_gear (user_id, category);
            CREATE INDEX IF NOT EXISTS user_profil_brand_27f9b7_idx 
                ON user_profile_hardware_gear (brand, model);
            CREATE INDEX IF NOT EXISTS user_profil_categor_e82a23_idx 
                ON user_profile_hardware_gear (category, is_public);
            """,
            reverse_sql="-- DROP TABLE IF EXISTS user_profile_hardware_gear;",
        ),
        
        # TrophyShowcaseConfig (from 0036)
        migrations.RunSQL(
            sql="""
            CREATE TABLE IF NOT EXISTS user_profile_trophy_showcase (
                id bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
                border varchar(20) NOT NULL,
                frame varchar(20) NOT NULL,
                pinned_badge_ids jsonb NOT NULL,
                created_at timestamp with time zone NOT NULL,
                updated_at timestamp with time zone NOT NULL,
                user_id bigint NOT NULL UNIQUE,
                CONSTRAINT user_profile_trophy__user_id_07d589ad_fk_accounts_
                    FOREIGN KEY (user_id) REFERENCES accounts_user (id) DEFERRABLE INITIALLY DEFERRED
            );
            """,
            reverse_sql="-- DROP TABLE IF EXISTS user_profile_trophy_showcase;",
        ),
    ]
