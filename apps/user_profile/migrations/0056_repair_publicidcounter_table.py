# Generated by migration integrity repair on 2026-01-14
# Repairs missing PublicIDCounter table that was deleted by migrations 0014/0017/0018
# but should exist based on migration 0016/0020 and model in services/public_id.py

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ("user_profile", "0055_phase4_add_about_fields_and_hardware_loadout"),
    ]

    operations = [
        migrations.RunSQL(
            sql="""
            -- Create PublicIDCounter table if it doesn't exist
            CREATE TABLE IF NOT EXISTS user_profile_publicidcounter (
                id bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
                year integer NOT NULL UNIQUE,
                counter integer NOT NULL DEFAULT 0,
                created_at timestamp with time zone NOT NULL,
                updated_at timestamp with time zone NOT NULL
            );
            
            -- Create index if it doesn't exist
            CREATE INDEX IF NOT EXISTS idx_publicid_year 
            ON user_profile_publicidcounter (year);
            """,
            reverse_sql="""
            -- Do not drop table on reverse - preserve data
            -- DROP TABLE IF EXISTS user_profile_publicidcounter;
            """,
        ),
    ]
