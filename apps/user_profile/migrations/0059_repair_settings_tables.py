# Generated by Django - Repair migration for missing settings tables
# Created: 2026-01-14 for MIGRATION INTEGRITY REPAIR
# Purpose: Restore user_profile_notification_preferences and user_profile_wallet_settings tables
#          These were created by migration 0030 but missing from database

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('user_profile', '0058_repair_missing_profile_tables_batch2'),
    ]

    operations = [
        migrations.RunSQL(
            sql="""
            -- Repair: NotificationPreferences table (from migration 0030)
            CREATE TABLE IF NOT EXISTS user_profile_notification_preferences (
                id bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
                email_tournament_reminders boolean NOT NULL DEFAULT false,
                email_match_results boolean NOT NULL DEFAULT false,
                email_team_invites boolean NOT NULL DEFAULT false,
                email_achievements boolean NOT NULL DEFAULT false,
                email_platform_updates boolean NOT NULL DEFAULT false,
                notify_tournament_start boolean NOT NULL DEFAULT true,
                notify_team_messages boolean NOT NULL DEFAULT true,
                notify_follows boolean NOT NULL DEFAULT true,
                notify_achievements boolean NOT NULL DEFAULT true,
                created_at timestamp with time zone NOT NULL DEFAULT NOW(),
                updated_at timestamp with time zone NOT NULL DEFAULT NOW(),
                user_profile_id bigint NOT NULL UNIQUE,
                CONSTRAINT user_profile_notific_user_profile_id_9dd4eccb_fk_user_prof
                    FOREIGN KEY (user_profile_id)
                    REFERENCES user_profile_userprofile (id)
                    DEFERRABLE INITIALLY DEFERRED
            );
            
            -- Repair: WalletSettings table (from migration 0030)
            CREATE TABLE IF NOT EXISTS user_profile_wallet_settings (
                id bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
                bkash_enabled boolean NOT NULL DEFAULT false,
                bkash_account varchar(20) NOT NULL DEFAULT '',
                nagad_enabled boolean NOT NULL DEFAULT false,
                nagad_account varchar(20) NOT NULL DEFAULT '',
                rocket_enabled boolean NOT NULL DEFAULT false,
                rocket_account varchar(20) NOT NULL DEFAULT '',
                auto_withdrawal_threshold integer NOT NULL DEFAULT 1000,
                auto_convert_to_usd boolean NOT NULL DEFAULT false,
                created_at timestamp with time zone NOT NULL DEFAULT NOW(),
                updated_at timestamp with time zone NOT NULL DEFAULT NOW(),
                user_profile_id bigint NOT NULL UNIQUE,
                CONSTRAINT user_profile_wallet__user_profile_id_3a7d7c5d_fk_user_prof
                    FOREIGN KEY (user_profile_id)
                    REFERENCES user_profile_userprofile (id)
                    DEFERRABLE INITIALLY DEFERRED
            );
            """,
            reverse_sql="-- No reverse operation needed (idempotent)",
        ),
    ]
