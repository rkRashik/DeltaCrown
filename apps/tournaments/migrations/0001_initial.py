# Generated by Django 5.2.8 on 2026-01-23 17:57

import django.contrib.postgres.fields
import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ("teams", "0001_initial"),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name="Bracket",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "format",
                    models.CharField(
                        choices=[
                            ("single-elimination", "Single Elimination"),
                            ("double-elimination", "Double Elimination"),
                            ("round-robin", "Round Robin"),
                            ("swiss", "Swiss System"),
                            ("group-stage", "Group Stage"),
                        ],
                        default="single-elimination",
                        help_text="Type of bracket structure",
                        max_length=50,
                        verbose_name="Bracket Format",
                    ),
                ),
                (
                    "total_rounds",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Total number of rounds in bracket",
                        verbose_name="Total Rounds",
                    ),
                ),
                (
                    "total_matches",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Total number of matches in bracket",
                        verbose_name="Total Matches",
                    ),
                ),
                (
                    "bracket_structure",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="JSONB tree structure metadata for bracket visualization",
                        verbose_name="Bracket Structure",
                    ),
                ),
                (
                    "seeding_method",
                    models.CharField(
                        choices=[
                            ("slot-order", "Slot Order (First-Come-First-Served)"),
                            ("random", "Random Seeding"),
                            ("ranked", "Ranked Seeding"),
                            ("manual", "Manual Seeding"),
                        ],
                        default="slot-order",
                        help_text="How participants are seeded into bracket",
                        max_length=30,
                        verbose_name="Seeding Method",
                    ),
                ),
                (
                    "is_finalized",
                    models.BooleanField(
                        default=False,
                        help_text="Whether bracket is locked and cannot be regenerated",
                        verbose_name="Is Finalized",
                    ),
                ),
                (
                    "generated_at",
                    models.DateTimeField(
                        auto_now_add=True,
                        help_text="When bracket was initially generated",
                        null=True,
                        verbose_name="Generated At",
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Last update timestamp", verbose_name="Updated At"
                    ),
                ),
            ],
            options={
                "verbose_name": "Bracket",
                "verbose_name_plural": "Brackets",
                "db_table": "tournament_engine_bracket_bracket",
            },
        ),
        migrations.CreateModel(
            name="Group",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        help_text='e.g., "Group A", "Group B", or custom name',
                        max_length=100,
                        verbose_name="Group Name",
                    ),
                ),
                (
                    "display_order",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Order in which groups are displayed (0 = first)",
                        verbose_name="Display Order",
                    ),
                ),
                (
                    "max_participants",
                    models.PositiveIntegerField(
                        help_text="Maximum number of participants in this group",
                        validators=[django.core.validators.MinValueValidator(2)],
                        verbose_name="Max Participants",
                    ),
                ),
                (
                    "advancement_count",
                    models.PositiveIntegerField(
                        default=2,
                        help_text="Number of top teams/players that advance to next phase",
                        validators=[django.core.validators.MinValueValidator(1)],
                        verbose_name="Advancement Count",
                    ),
                ),
                (
                    "config",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="JSON config: points_system, tiebreaker_rules, match_format",
                        verbose_name="Group Configuration",
                    ),
                ),
                (
                    "is_finalized",
                    models.BooleanField(
                        default=False,
                        help_text="Whether group assignments are finalized (can no longer edit)",
                        verbose_name="Is Finalized",
                    ),
                ),
                (
                    "draw_seed",
                    models.CharField(
                        blank=True,
                        help_text="Random seed used for provable draw (transparency)",
                        max_length=64,
                        verbose_name="Draw Seed",
                    ),
                ),
                (
                    "is_deleted",
                    models.BooleanField(
                        default=False, help_text="Soft delete flag", verbose_name="Is Deleted"
                    ),
                ),
            ],
            options={
                "verbose_name": "Group",
                "verbose_name_plural": "Groups",
                "db_table": "tournament_groups",
                "ordering": ["tournament", "display_order", "name"],
            },
        ),
        migrations.CreateModel(
            name="StaffRole",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        help_text="Display name of the role (e.g., 'Tournament Referee')",
                        max_length=100,
                        unique=True,
                    ),
                ),
                (
                    "code",
                    models.CharField(
                        db_index=True,
                        help_text="Short identifier (e.g., 'referee', 'admin')",
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "description",
                    models.TextField(blank=True, help_text="Description of role responsibilities"),
                ),
                (
                    "capabilities",
                    models.JSONField(
                        default=dict,
                        help_text="Capability flags as JSON (e.g., {'can_schedule': true, 'can_resolve_disputes': true})",
                    ),
                ),
                (
                    "is_referee_role",
                    models.BooleanField(
                        default=False,
                        help_text="True if this role can be assigned to referee matches",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Staff Role",
                "verbose_name_plural": "Staff Roles",
                "db_table": "tournament_staff_roles",
                "ordering": ["name"],
            },
        ),
        migrations.CreateModel(
            name="TournamentTeamInvitation",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("PENDING", "Pending Response"),
                            ("ACCEPTED", "Accepted"),
                            ("DECLINED", "Declined"),
                            ("EXPIRED", "Expired"),
                            ("CANCELLED", "Cancelled by Organizer"),
                        ],
                        db_index=True,
                        default="PENDING",
                        max_length=16,
                    ),
                ),
                (
                    "message",
                    models.TextField(
                        blank=True, help_text="Optional message from organizer to team"
                    ),
                ),
                (
                    "invited_at",
                    models.DateTimeField(db_index=True, default=django.utils.timezone.now),
                ),
                (
                    "expires_at",
                    models.DateTimeField(
                        blank=True, help_text="When the invitation expires (if set)", null=True
                    ),
                ),
                (
                    "responded_at",
                    models.DateTimeField(
                        blank=True, help_text="When team responded (accepted/declined)", null=True
                    ),
                ),
                (
                    "response_message",
                    models.TextField(
                        blank=True, help_text="Optional message from team when responding"
                    ),
                ),
                (
                    "auto_register_on_accept",
                    models.BooleanField(
                        default=True,
                        help_text="Automatically create tournament registration when invitation is accepted",
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament Team Invitation",
                "verbose_name_plural": "Tournament Team Invitations",
                "ordering": ["-invited_at"],
            },
        ),
        migrations.CreateModel(
            name="TournamentTemplate",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "is_deleted",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Flag indicating if this record has been soft-deleted",
                    ),
                ),
                (
                    "deleted_at",
                    models.DateTimeField(
                        blank=True, help_text="Timestamp when this record was deleted", null=True
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        help_text='Template name (e.g., "5v5 Valorant Tournament")', max_length=200
                    ),
                ),
                (
                    "slug",
                    models.SlugField(
                        help_text="URL-friendly slug (auto-generated from name)",
                        max_length=250,
                        unique=True,
                    ),
                ),
                (
                    "description",
                    models.TextField(blank=True, help_text="Template description and notes"),
                ),
                (
                    "visibility",
                    models.CharField(
                        choices=[
                            ("private", "Private (Creator Only)"),
                            ("org", "Organization"),
                            ("global", "Global (Public)"),
                        ],
                        db_index=True,
                        default="private",
                        help_text="Who can see and use this template",
                        max_length=20,
                    ),
                ),
                (
                    "organization_id",
                    models.PositiveIntegerField(
                        blank=True,
                        db_index=True,
                        help_text="Organization ID from DeltaCrown organizations app (no ForeignKey)",
                        null=True,
                    ),
                ),
                (
                    "template_config",
                    models.JSONField(
                        default=dict,
                        help_text='Tournament configuration template (JSONB). Structure:\n        {\n            "format": "single_elimination",\n            "participation_type": "team",\n            "max_participants": 16,\n            "min_participants": 4,\n            "has_entry_fee": true,\n            "entry_fee_amount": "500.00",\n            "entry_fee_currency": "BDT",\n            "entry_fee_deltacoin": 0,\n            "payment_methods": ["bkash", "nagad", "deltacoin"],\n            "prize_pool": "10000.00",\n            "prize_currency": "BDT",\n            "prize_deltacoin": 0,\n            "prize_distribution": {"1": "50%", "2": "30%", "3": "20%"},\n            "enable_check_in": true,\n            "check_in_minutes_before": 15,\n            "enable_dynamic_seeding": false,\n            "enable_live_updates": true,\n            "enable_certificates": true,\n            "enable_fee_waiver": false,\n            "fee_waiver_top_n_teams": 0,\n            "custom_fields": [\n                {\n                    "field_name": "Discord Server",\n                    "field_type": "url",\n                    "is_required": true,\n                    "field_config": {"pattern": "^https://discord\\.gg/"}\n                }\n            ],\n            "match_settings": {\n                "default_best_of": 1,\n                "auto_schedule_matches": false,\n                "match_duration_minutes": 60\n            }\n        }\n        ',
                    ),
                ),
                (
                    "usage_count",
                    models.PositiveIntegerField(
                        default=0, help_text="Number of times this template has been applied"
                    ),
                ),
                (
                    "last_used_at",
                    models.DateTimeField(
                        blank=True, help_text="When this template was last used", null=True
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        db_index=True,
                        default=True,
                        help_text="Whether this template is active (can be used)",
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament Template",
                "verbose_name_plural": "Tournament Templates",
                "db_table": "tournaments_tournamenttemplate",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="TournamentVersion",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "version_number",
                    models.PositiveIntegerField(help_text="Sequential version number"),
                ),
                (
                    "version_data",
                    models.JSONField(help_text="Complete tournament configuration at this version"),
                ),
                ("change_summary", models.TextField(help_text="Human-readable summary of changes")),
                (
                    "changed_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="When this version was created"
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True, help_text="Whether this version is the active one"
                    ),
                ),
                (
                    "rolled_back_at",
                    models.DateTimeField(
                        blank=True, help_text="When this version was rolled back to", null=True
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament Version",
                "verbose_name_plural": "Tournament Versions",
                "ordering": ["-version_number"],
            },
        ),
        migrations.CreateModel(
            name="WebhookDelivery",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("event", models.CharField(max_length=50)),
                ("payload", models.JSONField()),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("success", "Success"),
                            ("failed", "Failed"),
                        ],
                        default="pending",
                        max_length=20,
                    ),
                ),
                ("status_code", models.IntegerField(blank=True, null=True)),
                ("response_body", models.TextField(blank=True)),
                ("error_message", models.TextField(blank=True)),
                ("attempts", models.IntegerField(default=0)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("delivered_at", models.DateTimeField(blank=True, null=True)),
            ],
            options={
                "db_table": "tournaments_webhook_delivery",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="AuditLog",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "action",
                    models.CharField(
                        db_index=True,
                        help_text="Action type (e.g., payment_verify, bracket_regenerate)",
                        max_length=50,
                    ),
                ),
                (
                    "timestamp",
                    models.DateTimeField(
                        auto_now_add=True, db_index=True, help_text="When the action occurred"
                    ),
                ),
                (
                    "metadata",
                    models.JSONField(
                        default=dict,
                        help_text="Action-specific data (tournament_id, payment_id, etc.)",
                    ),
                ),
                (
                    "ip_address",
                    models.GenericIPAddressField(
                        blank=True, help_text="IP address of user", null=True
                    ),
                ),
                (
                    "user_agent",
                    models.TextField(
                        blank=True, help_text="User agent string from request", null=True
                    ),
                ),
                (
                    "tournament_id",
                    models.IntegerField(
                        blank=True,
                        db_index=True,
                        help_text="Tournament ID for tournament-scoped actions (Epic 7.5)",
                        null=True,
                    ),
                ),
                (
                    "match_id",
                    models.IntegerField(
                        blank=True,
                        db_index=True,
                        help_text="Match ID for match-scoped actions (Epic 7.5)",
                        null=True,
                    ),
                ),
                (
                    "before_state",
                    models.JSONField(
                        blank=True,
                        help_text="State before action (for change tracking, Epic 7.5)",
                        null=True,
                    ),
                ),
                (
                    "after_state",
                    models.JSONField(
                        blank=True,
                        help_text="State after action (for change tracking, Epic 7.5)",
                        null=True,
                    ),
                ),
                (
                    "correlation_id",
                    models.CharField(
                        blank=True,
                        db_index=True,
                        help_text="Request correlation ID for distributed tracing (Epic 7.5)",
                        max_length=100,
                        null=True,
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who performed the action (null if system action)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="audit_logs",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Audit Log Entry",
                "verbose_name_plural": "Audit Log Entries",
                "ordering": ["-timestamp"],
            },
        ),
        migrations.CreateModel(
            name="BracketEditLog",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "stage_id",
                    models.IntegerField(
                        blank=True,
                        help_text="TournamentStage ID (nullable for cross-stage operations)",
                        null=True,
                    ),
                ),
                (
                    "operation",
                    models.CharField(
                        choices=[
                            ("swap", "Swap Participants"),
                            ("move", "Move Participant"),
                            ("remove", "Remove Participant"),
                            ("repair", "Repair Bracket"),
                            ("validate", "Validate Bracket"),
                        ],
                        help_text="Type of bracket edit operation",
                        max_length=20,
                    ),
                ),
                (
                    "match_ids",
                    models.JSONField(default=list, help_text="List of affected match IDs"),
                ),
                (
                    "participant_ids",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="List of affected participant IDs (optional)",
                    ),
                ),
                ("old_data", models.JSONField(default=dict, help_text="State before edit (JSON)")),
                ("new_data", models.JSONField(default=dict, help_text="State after edit (JSON)")),
                (
                    "user_id",
                    models.IntegerField(
                        blank=True,
                        help_text="User who performed edit (nullable for system edits)",
                        null=True,
                    ),
                ),
                (
                    "timestamp",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="When edit was performed",
                    ),
                ),
            ],
            options={
                "verbose_name": "Bracket Edit Log",
                "verbose_name_plural": "Bracket Edit Logs",
                "db_table": "tournament_bracket_edit_log",
                "ordering": ["-timestamp"],
                "indexes": [
                    models.Index(
                        fields=["stage_id", "-timestamp"], name="tournament__stage_i_8883ca_idx"
                    ),
                    models.Index(
                        fields=["operation", "-timestamp"], name="tournament__operati_90aadd_idx"
                    ),
                    models.Index(
                        fields=["user_id", "-timestamp"], name="tournament__user_id_c12f89_idx"
                    ),
                ],
            },
        ),
        migrations.CreateModel(
            name="DisputeRecord",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("open", "Open"),
                            ("under_review", "Under Review"),
                            ("resolved_for_submitter", "Resolved - Submitter Wins"),
                            ("resolved_for_opponent", "Resolved - Opponent Wins"),
                            ("cancelled", "Cancelled"),
                            ("escalated", "Escalated"),
                        ],
                        db_index=True,
                        default="open",
                        help_text="Current dispute status",
                        max_length=32,
                    ),
                ),
                (
                    "reason_code",
                    models.CharField(
                        choices=[
                            ("score_mismatch", "Score Mismatch"),
                            ("wrong_winner", "Wrong Winner Declared"),
                            ("cheating_suspicion", "Cheating Suspicion"),
                            ("incorrect_map", "Incorrect Map/Details"),
                            ("match_not_played", "Match Not Played"),
                            ("other", "Other"),
                        ],
                        default="other",
                        help_text="Categorized reason for dispute",
                        max_length=32,
                    ),
                ),
                (
                    "description",
                    models.TextField(help_text="Detailed description of the dispute from opponent"),
                ),
                (
                    "resolution_notes",
                    models.TextField(
                        blank=True,
                        default="",
                        help_text="Internal notes explaining the resolution decision",
                    ),
                ),
                (
                    "opened_at",
                    models.DateTimeField(
                        auto_now_add=True, db_index=True, help_text="When the dispute was opened"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(auto_now=True, help_text="Last update timestamp"),
                ),
                (
                    "resolved_at",
                    models.DateTimeField(
                        blank=True,
                        db_index=True,
                        help_text="When the dispute was resolved",
                        null=True,
                    ),
                ),
                (
                    "escalated_at",
                    models.DateTimeField(
                        blank=True, help_text="When the dispute was escalated", null=True
                    ),
                ),
                (
                    "opened_by_team",
                    models.ForeignKey(
                        blank=True,
                        help_text="Team representing the disputer (if team tournament)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="disputes",
                        to="teams.team",
                    ),
                ),
                (
                    "opened_by_user",
                    models.ForeignKey(
                        help_text="User who opened the dispute",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="opened_disputes",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "resolved_by_user",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who made the final resolution decision",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="resolved_disputes",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "db_table": "tournaments_dispute_record",
                "ordering": ["-opened_at"],
            },
        ),
        migrations.CreateModel(
            name="DisputeEvidence",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "evidence_type",
                    models.CharField(
                        choices=[
                            ("screenshot", "Screenshot"),
                            ("video", "Video Recording"),
                            ("chat_log", "Chat Log"),
                            ("other", "Other"),
                        ],
                        default="screenshot",
                        help_text="Type of evidence",
                        max_length=32,
                    ),
                ),
                (
                    "url",
                    models.URLField(
                        help_text="URL to external resource (imgur, Discord CDN, S3, etc.)",
                        max_length=500,
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True,
                        default="",
                        help_text="Additional context or notes about this evidence",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="When the evidence was uploaded"
                    ),
                ),
                (
                    "uploaded_by",
                    models.ForeignKey(
                        help_text="User who uploaded the evidence",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="uploaded_dispute_evidence",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "dispute",
                    models.ForeignKey(
                        help_text="The dispute this evidence belongs to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="evidence",
                        to="tournaments.disputerecord",
                    ),
                ),
            ],
            options={
                "db_table": "tournaments_dispute_evidence",
                "ordering": ["created_at"],
            },
        ),
        migrations.CreateModel(
            name="Game",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("name", models.CharField(max_length=100, unique=True)),
                ("slug", models.SlugField(max_length=120, unique=True)),
                (
                    "icon",
                    models.ImageField(help_text="Game icon/logo image", upload_to="games/icons/"),
                ),
                (
                    "default_team_size",
                    models.PositiveIntegerField(
                        choices=[
                            (1, "1v1"),
                            (2, "2v2"),
                            (3, "3v3"),
                            (4, "4v4"),
                            (5, "5v5"),
                            (0, "Variable"),
                        ],
                        default=5,
                        help_text="Default team size for this game",
                    ),
                ),
                (
                    "profile_id_field",
                    models.CharField(
                        help_text="Field name in UserProfile (e.g., 'riot_id', 'steam_id')",
                        max_length=50,
                    ),
                ),
                (
                    "default_result_type",
                    models.CharField(
                        choices=[
                            ("map_score", "Map Score (e.g., 13-11)"),
                            ("best_of", "Best of X"),
                            ("point_based", "Point Based"),
                        ],
                        default="map_score",
                        help_text="How match results are recorded",
                        max_length=20,
                    ),
                ),
                (
                    "game_config",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Game configuration schema and settings (JSONB)",
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        db_index=True,
                        default=True,
                        help_text="Whether this game is actively supported",
                    ),
                ),
                (
                    "description",
                    models.TextField(blank=True, help_text="Game description and notes"),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "banner",
                    models.ImageField(
                        blank=True,
                        help_text="Game banner image",
                        null=True,
                        upload_to="games/banners/",
                    ),
                ),
                (
                    "card_image",
                    models.ImageField(
                        blank=True,
                        help_text="Game card/thumbnail image",
                        null=True,
                        upload_to="games/cards/",
                    ),
                ),
                (
                    "logo",
                    models.ImageField(
                        blank=True, help_text="Game logo image", null=True, upload_to="games/logos/"
                    ),
                ),
                (
                    "primary_color",
                    models.CharField(
                        blank=True, help_text="Primary brand color (hex)", max_length=20, null=True
                    ),
                ),
                (
                    "secondary_color",
                    models.CharField(
                        blank=True,
                        help_text="Secondary brand color (hex)",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "category",
                    models.CharField(
                        blank=True,
                        help_text="Game category (MOBA, FPS, etc.)",
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "platform",
                    models.CharField(
                        blank=True,
                        help_text="Platform (PC, Mobile, Console)",
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "min_team_size",
                    models.PositiveIntegerField(default=1, help_text="Minimum team size"),
                ),
                (
                    "max_team_size",
                    models.PositiveIntegerField(default=5, help_text="Maximum team size"),
                ),
                (
                    "roster_rules",
                    models.JSONField(
                        blank=True, default=dict, help_text="Roster rules and structure (JSONB)"
                    ),
                ),
                (
                    "roles",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="Available roles for this game (JSONB array)",
                    ),
                ),
                (
                    "result_logic",
                    models.JSONField(
                        blank=True, default=dict, help_text="Result calculation logic (JSONB)"
                    ),
                ),
            ],
            options={
                "verbose_name": "Game",
                "verbose_name_plural": "Games",
                "ordering": ["name"],
                "indexes": [
                    models.Index(fields=["slug"], name="tournaments_slug_d1de23_idx"),
                    models.Index(
                        fields=["is_active", "name"], name="tournaments_is_acti_b1f275_idx"
                    ),
                ],
            },
        ),
        migrations.CreateModel(
            name="GroupStanding",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "rank",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Current rank in group (1 = first place)",
                        verbose_name="Rank",
                    ),
                ),
                (
                    "matches_played",
                    models.PositiveIntegerField(default=0, verbose_name="Matches Played"),
                ),
                ("matches_won", models.PositiveIntegerField(default=0, verbose_name="Matches Won")),
                (
                    "matches_drawn",
                    models.PositiveIntegerField(default=0, verbose_name="Matches Drawn"),
                ),
                (
                    "matches_lost",
                    models.PositiveIntegerField(default=0, verbose_name="Matches Lost"),
                ),
                (
                    "points",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Total points according to points system",
                        max_digits=10,
                        verbose_name="Points",
                    ),
                ),
                (
                    "goals_for",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Total goals scored (eFootball, FC Mobile, FIFA)",
                        verbose_name="Goals For",
                    ),
                ),
                (
                    "goals_against",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Total goals conceded (eFootball, FC Mobile, FIFA)",
                        verbose_name="Goals Against",
                    ),
                ),
                (
                    "goal_difference",
                    models.IntegerField(
                        default=0,
                        help_text="Goals For - Goals Against",
                        verbose_name="Goal Difference",
                    ),
                ),
                (
                    "rounds_won",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Total rounds won (Valorant, CS2)",
                        verbose_name="Rounds Won",
                    ),
                ),
                (
                    "rounds_lost",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Total rounds lost (Valorant, CS2)",
                        verbose_name="Rounds Lost",
                    ),
                ),
                (
                    "round_difference",
                    models.IntegerField(
                        default=0,
                        help_text="Rounds Won - Rounds Lost",
                        verbose_name="Round Difference",
                    ),
                ),
                (
                    "total_kills",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Total kills (PUBG Mobile, Free Fire, Mobile Legends, COD Mobile)",
                        verbose_name="Total Kills",
                    ),
                ),
                (
                    "total_deaths",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Total deaths (Mobile Legends, COD Mobile)",
                        verbose_name="Total Deaths",
                    ),
                ),
                (
                    "placement_points",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Points from match placements (PUBG Mobile, Free Fire)",
                        max_digits=10,
                        verbose_name="Placement Points",
                    ),
                ),
                (
                    "average_placement",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Average finishing position (PUBG Mobile, Free Fire)",
                        max_digits=5,
                        verbose_name="Average Placement",
                    ),
                ),
                (
                    "total_assists",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Total assists (Mobile Legends)",
                        verbose_name="Total Assists",
                    ),
                ),
                (
                    "kda_ratio",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="(Kills + Assists) / Deaths (Mobile Legends)",
                        max_digits=6,
                        verbose_name="KDA Ratio",
                    ),
                ),
                (
                    "total_score",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Total match score (COD Mobile)",
                        verbose_name="Total Score",
                    ),
                ),
                (
                    "game_stats",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Additional game-specific statistics",
                        verbose_name="Game-Specific Stats",
                    ),
                ),
                (
                    "is_advancing",
                    models.BooleanField(
                        default=False,
                        help_text="Whether this participant advances to next phase",
                        verbose_name="Is Advancing",
                    ),
                ),
                (
                    "is_eliminated",
                    models.BooleanField(
                        default=False,
                        help_text="Whether this participant is eliminated",
                        verbose_name="Is Eliminated",
                    ),
                ),
                ("is_deleted", models.BooleanField(default=False, verbose_name="Is Deleted")),
                (
                    "group",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="standings",
                        to="tournaments.group",
                        verbose_name="Group",
                    ),
                ),
                (
                    "team",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="group_standings",
                        to="teams.team",
                        verbose_name="Team",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="group_standings",
                        to=settings.AUTH_USER_MODEL,
                        verbose_name="User",
                    ),
                ),
            ],
            options={
                "verbose_name": "Group Standing",
                "verbose_name_plural": "Group Standings",
                "db_table": "tournament_group_standings",
                "ordering": ["group", "rank", "-points", "-goal_difference", "-goals_for"],
            },
        ),
        migrations.CreateModel(
            name="Match",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "is_deleted",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Flag indicating if this record has been soft-deleted",
                    ),
                ),
                (
                    "deleted_at",
                    models.DateTimeField(
                        blank=True, help_text="Timestamp when this record was deleted", null=True
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "round_number",
                    models.PositiveIntegerField(
                        help_text="Round number in bracket (1 = first round)",
                        validators=[django.core.validators.MinValueValidator(1)],
                        verbose_name="Round Number",
                    ),
                ),
                (
                    "match_number",
                    models.PositiveIntegerField(
                        help_text="Match number within round",
                        validators=[django.core.validators.MinValueValidator(1)],
                        verbose_name="Match Number",
                    ),
                ),
                (
                    "participant1_id",
                    models.PositiveIntegerField(
                        blank=True,
                        help_text="Team ID or User ID for participant 1",
                        null=True,
                        verbose_name="Participant 1 ID",
                    ),
                ),
                (
                    "participant1_name",
                    models.CharField(
                        blank=True,
                        help_text="Denormalized name for display",
                        max_length=100,
                        verbose_name="Participant 1 Name",
                    ),
                ),
                (
                    "participant2_id",
                    models.PositiveIntegerField(
                        blank=True,
                        help_text="Team ID or User ID for participant 2",
                        null=True,
                        verbose_name="Participant 2 ID",
                    ),
                ),
                (
                    "participant2_name",
                    models.CharField(
                        blank=True,
                        help_text="Denormalized name for display",
                        max_length=100,
                        verbose_name="Participant 2 Name",
                    ),
                ),
                (
                    "state",
                    models.CharField(
                        choices=[
                            ("scheduled", "Scheduled"),
                            ("check_in", "Check-in Open"),
                            ("ready", "Ready to Start"),
                            ("live", "Live/In Progress"),
                            ("pending_result", "Pending Result"),
                            ("completed", "Completed"),
                            ("disputed", "Disputed"),
                            ("forfeit", "Forfeit"),
                            ("cancelled", "Cancelled"),
                        ],
                        db_index=True,
                        default="scheduled",
                        help_text="Current state in match lifecycle",
                        max_length=20,
                        verbose_name="State",
                    ),
                ),
                (
                    "participant1_score",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Score for participant 1",
                        validators=[django.core.validators.MinValueValidator(0)],
                        verbose_name="Participant 1 Score",
                    ),
                ),
                (
                    "participant2_score",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Score for participant 2",
                        validators=[django.core.validators.MinValueValidator(0)],
                        verbose_name="Participant 2 Score",
                    ),
                ),
                (
                    "winner_id",
                    models.PositiveIntegerField(
                        blank=True,
                        db_index=True,
                        help_text="Team ID or User ID of winner (set when match completed)",
                        null=True,
                        verbose_name="Winner ID",
                    ),
                ),
                (
                    "loser_id",
                    models.PositiveIntegerField(
                        blank=True,
                        help_text="Team ID or User ID of loser (set when match completed)",
                        null=True,
                        verbose_name="Loser ID",
                    ),
                ),
                (
                    "lobby_info",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text='Game lobby details (map, server, lobby code, password, etc.). Example: {"game_mode": "Competitive", "map": "Haven", "lobby_code": "ABC123"}',
                        verbose_name="Lobby Info",
                    ),
                ),
                (
                    "stream_url",
                    models.URLField(
                        blank=True,
                        help_text="Twitch/YouTube stream URL for spectators",
                        verbose_name="Stream URL",
                    ),
                ),
                (
                    "scheduled_time",
                    models.DateTimeField(
                        blank=True,
                        db_index=True,
                        help_text="When match is scheduled to start",
                        null=True,
                        verbose_name="Scheduled Time",
                    ),
                ),
                (
                    "check_in_deadline",
                    models.DateTimeField(
                        blank=True,
                        help_text="Deadline for participants to check in",
                        null=True,
                        verbose_name="Check-in Deadline",
                    ),
                ),
                (
                    "participant1_checked_in",
                    models.BooleanField(
                        default=False,
                        help_text="Whether participant 1 has checked in",
                        verbose_name="Participant 1 Checked In",
                    ),
                ),
                (
                    "participant2_checked_in",
                    models.BooleanField(
                        default=False,
                        help_text="Whether participant 2 has checked in",
                        verbose_name="Participant 2 Checked In",
                    ),
                ),
                (
                    "started_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When match actually started (state  LIVE)",
                        null=True,
                        verbose_name="Started At",
                    ),
                ),
                (
                    "completed_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When match was completed (state  COMPLETED)",
                        null=True,
                        verbose_name="Completed At",
                    ),
                ),
                (
                    "bracket",
                    models.ForeignKey(
                        blank=True,
                        help_text="Bracket this match belongs to (null for group stage)",
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="matches",
                        to="tournaments.bracket",
                        verbose_name="Bracket",
                    ),
                ),
                (
                    "deleted_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who deleted this record",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="%(class)s_deletions",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Match",
                "verbose_name_plural": "Matches",
                "db_table": "tournament_engine_match_match",
                "ordering": ["tournament", "round_number", "match_number"],
            },
        ),
        migrations.CreateModel(
            name="Dispute",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "initiated_by_id",
                    models.PositiveIntegerField(
                        help_text="User ID who initiated the dispute",
                        verbose_name="Initiated By ID",
                    ),
                ),
                (
                    "reason",
                    models.CharField(
                        choices=[
                            ("score_mismatch", "Score Mismatch"),
                            ("no_show", "No Show"),
                            ("cheating", "Cheating Accusation"),
                            ("technical_issue", "Technical Issue"),
                            ("other", "Other"),
                        ],
                        help_text="Reason for dispute",
                        max_length=30,
                        verbose_name="Reason",
                    ),
                ),
                (
                    "description",
                    models.TextField(
                        help_text="Detailed description of the dispute", verbose_name="Description"
                    ),
                ),
                (
                    "evidence_screenshot",
                    models.ImageField(
                        blank=True,
                        help_text="Screenshot evidence for dispute",
                        null=True,
                        upload_to="disputes/evidence/",
                        verbose_name="Evidence Screenshot",
                    ),
                ),
                (
                    "evidence_video_url",
                    models.URLField(
                        blank=True,
                        help_text="YouTube/Twitch URL with video evidence",
                        verbose_name="Evidence Video URL",
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("open", "Open"),
                            ("under_review", "Under Review"),
                            ("resolved", "Resolved"),
                            ("escalated", "Escalated to Admin"),
                        ],
                        db_index=True,
                        default="open",
                        help_text="Current dispute status",
                        max_length=20,
                        verbose_name="Status",
                    ),
                ),
                (
                    "resolved_by_id",
                    models.PositiveIntegerField(
                        blank=True,
                        help_text="User ID who resolved the dispute (organizer or admin)",
                        null=True,
                        verbose_name="Resolved By ID",
                    ),
                ),
                (
                    "resolution_notes",
                    models.TextField(
                        blank=True,
                        help_text="Organizer/admin notes on resolution",
                        verbose_name="Resolution Notes",
                    ),
                ),
                (
                    "final_participant1_score",
                    models.PositiveIntegerField(
                        blank=True,
                        help_text="Final score for participant 1 after resolution",
                        null=True,
                        validators=[django.core.validators.MinValueValidator(0)],
                        verbose_name="Final Participant 1 Score",
                    ),
                ),
                (
                    "final_participant2_score",
                    models.PositiveIntegerField(
                        blank=True,
                        help_text="Final score for participant 2 after resolution",
                        null=True,
                        validators=[django.core.validators.MinValueValidator(0)],
                        verbose_name="Final Participant 2 Score",
                    ),
                ),
                (
                    "resolved_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When dispute was resolved",
                        null=True,
                        verbose_name="Resolved At",
                    ),
                ),
                (
                    "match",
                    models.ForeignKey(
                        help_text="Match this dispute is about",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="disputes",
                        to="tournaments.match",
                        verbose_name="Match",
                    ),
                ),
            ],
            options={
                "verbose_name": "Dispute",
                "verbose_name_plural": "Disputes",
                "db_table": "tournament_engine_match_dispute",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="BracketNode",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "position",
                    models.PositiveIntegerField(
                        help_text="Sequential position in bracket (1-indexed)",
                        verbose_name="Position",
                    ),
                ),
                (
                    "round_number",
                    models.PositiveIntegerField(
                        help_text="Round number (1 = first round)", verbose_name="Round Number"
                    ),
                ),
                (
                    "match_number_in_round",
                    models.PositiveIntegerField(
                        help_text="Match number within this round (1-indexed)",
                        verbose_name="Match Number in Round",
                    ),
                ),
                (
                    "participant1_id",
                    models.IntegerField(
                        blank=True,
                        help_text="Team or User ID for participant 1",
                        null=True,
                        verbose_name="Participant 1 ID",
                    ),
                ),
                (
                    "participant1_name",
                    models.CharField(
                        blank=True,
                        help_text="Cached name for participant 1",
                        max_length=100,
                        verbose_name="Participant 1 Name",
                    ),
                ),
                (
                    "participant2_id",
                    models.IntegerField(
                        blank=True,
                        help_text="Team or User ID for participant 2",
                        null=True,
                        verbose_name="Participant 2 ID",
                    ),
                ),
                (
                    "participant2_name",
                    models.CharField(
                        blank=True,
                        help_text="Cached name for participant 2",
                        max_length=100,
                        verbose_name="Participant 2 Name",
                    ),
                ),
                (
                    "winner_id",
                    models.IntegerField(
                        blank=True,
                        help_text="Team or User ID of winner",
                        null=True,
                        verbose_name="Winner ID",
                    ),
                ),
                (
                    "parent_slot",
                    models.PositiveSmallIntegerField(
                        blank=True,
                        help_text="Which participant slot in parent match (1 or 2)",
                        null=True,
                        verbose_name="Parent Slot",
                    ),
                ),
                (
                    "is_bye",
                    models.BooleanField(
                        default=False,
                        help_text="Whether this is a bye match (participant advances without playing)",
                        verbose_name="Is Bye",
                    ),
                ),
                (
                    "bracket_type",
                    models.CharField(
                        default="main",
                        help_text="Bracket type (main, losers, third-place, or group-N)",
                        max_length=50,
                        verbose_name="Bracket Type",
                    ),
                ),
                (
                    "bracket",
                    models.ForeignKey(
                        help_text="Bracket this node belongs to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="nodes",
                        to="tournaments.bracket",
                        verbose_name="Bracket",
                    ),
                ),
                (
                    "child1_node",
                    models.ForeignKey(
                        blank=True,
                        help_text="Previous match for participant 1",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="+",
                        to="tournaments.bracketnode",
                        verbose_name="Child 1 Node",
                    ),
                ),
                (
                    "child2_node",
                    models.ForeignKey(
                        blank=True,
                        help_text="Previous match for participant 2",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="+",
                        to="tournaments.bracketnode",
                        verbose_name="Child 2 Node",
                    ),
                ),
                (
                    "parent_node",
                    models.ForeignKey(
                        blank=True,
                        help_text="Next match where winner advances",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="children",
                        to="tournaments.bracketnode",
                        verbose_name="Parent Node",
                    ),
                ),
                (
                    "match",
                    models.OneToOneField(
                        blank=True,
                        help_text="Associated match for this bracket position",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="bracket_node",
                        to="tournaments.match",
                        verbose_name="Match",
                    ),
                ),
            ],
            options={
                "verbose_name": "Bracket Node",
                "verbose_name_plural": "Bracket Nodes",
                "db_table": "tournament_engine_bracket_bracketnode",
            },
        ),
        migrations.CreateModel(
            name="MatchModeratorNote",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "author_user_id",
                    models.IntegerField(help_text="User ID of staff/referee who wrote the note"),
                ),
                ("content", models.TextField(help_text="Note content")),
                (
                    "created_at",
                    models.DateTimeField(auto_now_add=True, help_text="When the note was created"),
                ),
                (
                    "match",
                    models.ForeignKey(
                        help_text="Match this note applies to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="moderator_notes",
                        to="tournaments.match",
                    ),
                ),
            ],
            options={
                "db_table": "match_moderator_notes",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="MatchOperationLog",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "operator_user_id",
                    models.IntegerField(
                        help_text="User ID of staff/referee who performed the operation"
                    ),
                ),
                (
                    "operation_type",
                    models.CharField(
                        choices=[
                            ("LIVE", "Match Marked Live"),
                            ("PAUSED", "Match Paused"),
                            ("RESUMED", "Match Resumed"),
                            ("FORCE_COMPLETED", "Match Force Completed"),
                            ("NOTE_ADDED", "Moderator Note Added"),
                            ("OVERRIDE_RESULT", "Result Overridden"),
                            ("OVERRIDE_REFEREE", "Referee Assignment Overridden"),
                        ],
                        help_text="Type of operation performed",
                        max_length=50,
                    ),
                ),
                (
                    "payload",
                    models.JSONField(
                        blank=True,
                        help_text="Additional metadata about the operation (previous state, overrides, etc.)",
                        null=True,
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="When the operation was performed"
                    ),
                ),
                (
                    "match",
                    models.ForeignKey(
                        help_text="Match this operation was performed on",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="operation_logs",
                        to="tournaments.match",
                    ),
                ),
            ],
            options={
                "db_table": "match_operation_logs",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="MatchResultSubmission",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "raw_result_payload",
                    models.JSONField(
                        help_text="Raw result data from frontend (game-specific structure)"
                    ),
                ),
                (
                    "proof_screenshot_url",
                    models.CharField(
                        blank=True,
                        default="",
                        help_text="URL to proof screenshot (Discord, Imgur, S3, etc.)",
                        max_length=500,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending Opponent Confirmation"),
                            ("confirmed", "Confirmed by Opponent"),
                            ("disputed", "Disputed by Opponent"),
                            ("auto_confirmed", "Auto-Confirmed (24h timeout)"),
                            ("finalized", "Finalized by Organizer"),
                            ("rejected", "Rejected by Organizer"),
                        ],
                        db_index=True,
                        default="pending",
                        help_text="Current submission status",
                        max_length=20,
                    ),
                ),
                (
                    "submitted_at",
                    models.DateTimeField(auto_now_add=True, help_text="When result was submitted"),
                ),
                (
                    "confirmed_at",
                    models.DateTimeField(
                        blank=True, help_text="When opponent confirmed result", null=True
                    ),
                ),
                (
                    "finalized_at",
                    models.DateTimeField(
                        blank=True, help_text="When organizer finalized result", null=True
                    ),
                ),
                (
                    "auto_confirm_deadline",
                    models.DateTimeField(
                        help_text="Deadline for opponent to respond (submitted_at + 24h)"
                    ),
                ),
                (
                    "submitter_notes",
                    models.TextField(
                        blank=True, default="", help_text="Notes from submitter about the result"
                    ),
                ),
                (
                    "organizer_notes",
                    models.TextField(
                        blank=True, default="", help_text="Notes from organizer during review"
                    ),
                ),
                (
                    "confirmed_by_user",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who confirmed/disputed the result",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="confirmed_submissions",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "match",
                    models.ForeignKey(
                        help_text="Match this result is for",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="result_submissions",
                        to="tournaments.match",
                    ),
                ),
                (
                    "submitted_by_team",
                    models.ForeignKey(
                        blank=True,
                        help_text="Team the submitter represents (if team tournament)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="submitted_results",
                        to="teams.team",
                    ),
                ),
                (
                    "submitted_by_user",
                    models.ForeignKey(
                        help_text="User who submitted the result",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="submitted_results",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Match Result Submission",
                "verbose_name_plural": "Match Result Submissions",
                "db_table": "tournaments_match_result_submission",
                "ordering": ["-submitted_at"],
            },
        ),
        migrations.AddField(
            model_name="disputerecord",
            name="submission",
            field=models.ForeignKey(
                help_text="The result submission being disputed",
                on_delete=django.db.models.deletion.CASCADE,
                related_name="disputes",
                to="tournaments.matchresultsubmission",
            ),
        ),
        migrations.CreateModel(
            name="Registration",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "is_deleted",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Flag indicating if this record has been soft-deleted",
                    ),
                ),
                (
                    "deleted_at",
                    models.DateTimeField(
                        blank=True, help_text="Timestamp when this record was deleted", null=True
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "team_id",
                    models.IntegerField(
                        blank=True,
                        db_index=True,
                        help_text="Team ID reference (for team tournaments, IntegerField to avoid circular dependency)",
                        null=True,
                    ),
                ),
                (
                    "registration_data",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="JSON storage for participant data (game IDs, contact info, custom fields)",
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("draft", "Draft"),
                            ("submitted", "Submitted"),
                            ("pending", "Pending"),
                            ("auto_approved", "Auto Approved"),
                            ("needs_review", "Needs Review"),
                            ("payment_submitted", "Payment Submitted"),
                            ("confirmed", "Confirmed"),
                            ("rejected", "Rejected"),
                            ("cancelled", "Cancelled"),
                            ("waitlisted", "Waitlisted"),
                            ("no_show", "No Show"),
                        ],
                        db_index=True,
                        default="pending",
                        help_text="Current registration status",
                        max_length=20,
                    ),
                ),
                (
                    "completion_percentage",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Registration form completion progress (0-100%)",
                        max_digits=5,
                    ),
                ),
                (
                    "current_step",
                    models.PositiveIntegerField(
                        default=1, help_text="Current step in the registration wizard (1-3)"
                    ),
                ),
                (
                    "time_spent_seconds",
                    models.IntegerField(
                        default=0, help_text="Time spent on registration process in seconds"
                    ),
                ),
                (
                    "registered_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="When registration was submitted", null=True
                    ),
                ),
                (
                    "checked_in",
                    models.BooleanField(
                        default=False,
                        help_text="Whether participant has checked in on tournament day",
                    ),
                ),
                (
                    "checked_in_at",
                    models.DateTimeField(
                        blank=True, help_text="When participant checked in", null=True
                    ),
                ),
                (
                    "slot_number",
                    models.IntegerField(
                        blank=True,
                        help_text="Bracket slot number (1-based index for bracket position)",
                        null=True,
                    ),
                ),
                (
                    "seed",
                    models.IntegerField(
                        blank=True,
                        help_text="Seeding number for bracket generation (lower = higher seed)",
                        null=True,
                    ),
                ),
                (
                    "waitlist_position",
                    models.IntegerField(
                        blank=True, help_text="Position in waitlist queue (FIFO order)", null=True
                    ),
                ),
                (
                    "checked_in_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who performed the check-in (owner, captain, or organizer)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="checked_in_registrations",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "deleted_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who deleted this record",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="%(class)s_deletions",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who registered (for solo tournaments or team captain)",
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="tournament_registrations",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Registration",
                "verbose_name_plural": "Registrations",
                "db_table": "tournaments_registration",
            },
        ),
        migrations.CreateModel(
            name="PaymentVerification",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "method",
                    models.CharField(
                        choices=[
                            ("bkash", "bKash"),
                            ("nagad", "Nagad"),
                            ("rocket", "Rocket"),
                            ("bank", "Bank Transfer"),
                            ("other", "Other"),
                        ],
                        default="bkash",
                        max_length=16,
                    ),
                ),
                (
                    "payer_account_number",
                    models.CharField(
                        blank=True,
                        help_text="Your bKash/Nagad/Rocket account number (payer)",
                        max_length=32,
                    ),
                ),
                (
                    "transaction_id",
                    models.CharField(
                        blank=True,
                        help_text="Transaction ID from bKash/Nagad/Rocket",
                        max_length=64,
                    ),
                ),
                (
                    "reference_number",
                    models.CharField(
                        blank=True,
                        help_text="Internal reference number for payment tracking",
                        max_length=64,
                        null=True,
                    ),
                ),
                ("amount_bdt", models.PositiveIntegerField(blank=True, null=True)),
                ("note", models.CharField(blank=True, max_length=255)),
                (
                    "proof_image",
                    models.ImageField(blank=True, null=True, upload_to="payments/proofs/"),
                ),
                ("notes", models.JSONField(blank=True, default=dict)),
                (
                    "idempotency_key",
                    models.CharField(blank=True, max_length=255, null=True, unique=True),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("verified", "Verified"),
                            ("rejected", "Rejected"),
                            ("refunded", "Refunded"),
                        ],
                        default="pending",
                        max_length=16,
                    ),
                ),
                ("verified_at", models.DateTimeField(blank=True, null=True)),
                ("rejected_at", models.DateTimeField(blank=True, null=True)),
                ("refunded_at", models.DateTimeField(blank=True, null=True)),
                ("reject_reason", models.TextField(blank=True)),
                ("last_action_reason", models.CharField(blank=True, max_length=200)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "refunded_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="payments_refunded",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "rejected_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="payments_rejected",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "verified_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="payments_verified",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "registration",
                    models.OneToOneField(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="payment_verification",
                        to="tournaments.registration",
                    ),
                ),
            ],
            options={
                "verbose_name": "Payment Verification",
                "verbose_name_plural": "Payment Verifications",
                "db_table": "tournaments_paymentverification",
            },
        ),
        migrations.CreateModel(
            name="Payment",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "payment_method",
                    models.CharField(
                        choices=[
                            ("bkash", "bKash"),
                            ("nagad", "Nagad"),
                            ("rocket", "Rocket"),
                            ("bank", "Bank Transfer"),
                            ("deltacoin", "DeltaCoin"),
                        ],
                        help_text="Payment method used",
                        max_length=20,
                    ),
                ),
                (
                    "amount",
                    models.DecimalField(
                        decimal_places=2, help_text="Payment amount in BDT", max_digits=10
                    ),
                ),
                (
                    "transaction_id",
                    models.CharField(
                        blank=True,
                        default="",
                        help_text="Transaction ID from payment provider",
                        max_length=200,
                    ),
                ),
                (
                    "payment_proof",
                    models.FileField(
                        blank=True,
                        help_text="Payment proof file upload (image or PDF, max 5MB)",
                        null=True,
                        upload_to="payment_proofs/%Y/%m/",
                    ),
                ),
                (
                    "file_type",
                    models.CharField(
                        blank=True,
                        choices=[("IMAGE", "Image"), ("PDF", "PDF Document")],
                        default="",
                        help_text="Type of uploaded proof file",
                        max_length=10,
                    ),
                ),
                (
                    "reference_number",
                    models.CharField(
                        blank=True,
                        default="",
                        help_text="Payment reference number from receipt",
                        max_length=100,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("submitted", "Submitted"),
                            ("verified", "Verified"),
                            ("rejected", "Rejected"),
                            ("refunded", "Refunded"),
                            ("waived", "Fee Waived"),
                        ],
                        db_index=True,
                        default="pending",
                        help_text="Current payment status",
                        max_length=20,
                    ),
                ),
                (
                    "admin_notes",
                    models.TextField(
                        blank=True, default="", help_text="Admin notes for verification/rejection"
                    ),
                ),
                (
                    "verified_at",
                    models.DateTimeField(
                        blank=True, help_text="When payment was verified/rejected", null=True
                    ),
                ),
                (
                    "waived",
                    models.BooleanField(
                        default=False,
                        help_text="Fee waived by organizer (for top teams, sponsors, etc.)",
                    ),
                ),
                (
                    "waive_reason",
                    models.TextField(
                        blank=True,
                        default="",
                        help_text="Reason for fee waiver (e.g., 'Top-ranked team', 'Sponsor invitation')",
                    ),
                ),
                (
                    "resubmission_count",
                    models.IntegerField(
                        default=0,
                        help_text="Number of times payment was resubmitted after rejection",
                    ),
                ),
                (
                    "submitted_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="When payment proof was submitted"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(auto_now=True, help_text="Last update timestamp"),
                ),
                (
                    "verified_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="Admin who verified/rejected the payment",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="verified_payments",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "registration",
                    models.OneToOneField(
                        help_text="Associated registration",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="payment",
                        to="tournaments.registration",
                    ),
                ),
            ],
            options={
                "verbose_name": "Payment",
                "verbose_name_plural": "Payments",
                "db_table": "tournaments_payment",
            },
        ),
        migrations.CreateModel(
            name="RegistrationFormTemplate",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        help_text="Template name (e.g., 'Valorant Solo Registration')",
                        max_length=200,
                    ),
                ),
                (
                    "slug",
                    models.SlugField(
                        help_text="URL-friendly identifier", max_length=220, unique=True
                    ),
                ),
                (
                    "description",
                    models.TextField(blank=True, help_text="What makes this template special?"),
                ),
                (
                    "participation_type",
                    models.CharField(
                        choices=[("solo", "Solo Player"), ("team", "Team"), ("duo", "Duo/Squad")],
                        db_index=True,
                        help_text="Type of registration this template supports",
                        max_length=20,
                    ),
                ),
                (
                    "form_schema",
                    models.JSONField(
                        default=dict,
                        help_text="Complete form configuration including sections, fields, validation",
                    ),
                ),
                (
                    "icon",
                    models.CharField(
                        blank=True,
                        help_text="Emoji or icon class (e.g., '' or 'fa-gamepad')",
                        max_length=50,
                    ),
                ),
                (
                    "thumbnail",
                    models.ImageField(
                        blank=True,
                        help_text="Preview image for template selection",
                        null=True,
                        upload_to="form_templates/thumbnails/",
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        db_index=True,
                        default=True,
                        help_text="Is this template visible to organizers?",
                    ),
                ),
                (
                    "is_system_template",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Created by DeltaCrown staff (cannot be edited)",
                    ),
                ),
                (
                    "is_featured",
                    models.BooleanField(
                        db_index=True, default=False, help_text="Show in featured templates section"
                    ),
                ),
                (
                    "usage_count",
                    models.IntegerField(
                        default=0,
                        help_text="Number of tournaments using this template",
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "average_completion_rate",
                    models.DecimalField(
                        decimal_places=2,
                        default=0.0,
                        help_text="Average % of users who complete registration",
                        max_digits=5,
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(100),
                        ],
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "tags",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="Tags for search/filtering (e.g., ['valorant', 'apac', 'ranked'])",
                    ),
                ),
                (
                    "created_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who created this template",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="created_form_templates",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "game",
                    models.ForeignKey(
                        blank=True,
                        help_text="Specific game this template is designed for",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="form_templates",
                        to="tournaments.game",
                    ),
                ),
            ],
            options={
                "verbose_name": "Registration Form Template",
                "verbose_name_plural": "Registration Form Templates",
                "db_table": "tournaments_registration_form_template",
                "ordering": ["-is_featured", "-usage_count", "name"],
            },
        ),
        migrations.CreateModel(
            name="RegistrationQuestion",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "slug",
                    models.SlugField(
                        help_text="Machine-readable key: rank, region, discord_username",
                        max_length=100,
                    ),
                ),
                ("text", models.TextField(help_text="Question label shown to user")),
                (
                    "help_text",
                    models.TextField(blank=True, help_text="Additional help text for users"),
                ),
                (
                    "type",
                    models.CharField(
                        choices=[
                            ("text", "Text Input"),
                            ("select", "Single Select"),
                            ("multi_select", "Multi Select"),
                            ("boolean", "Yes/No"),
                            ("number", "Number"),
                            ("file", "File Upload"),
                            ("date", "Date"),
                        ],
                        default="text",
                        max_length=20,
                    ),
                ),
                (
                    "scope",
                    models.CharField(
                        choices=[("team", "Team Level"), ("player", "Player Level")],
                        default="player",
                        max_length=10,
                    ),
                ),
                (
                    "is_required",
                    models.BooleanField(default=False, help_text="Question must be answered"),
                ),
                (
                    "config",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text='Question configuration: {options: [], min: 0, max: 100, regex: "pattern", ...}',
                    ),
                ),
                (
                    "order",
                    models.PositiveIntegerField(
                        default=0, help_text="Display order (lower = first)"
                    ),
                ),
                (
                    "show_if",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text='Conditional display: {tournament_type: "team", age: {"gte": 18}}',
                    ),
                ),
                (
                    "is_built_in",
                    models.BooleanField(
                        default=False, help_text="System-provided question (cannot be deleted)"
                    ),
                ),
                ("is_active", models.BooleanField(default=True)),
                (
                    "game",
                    models.ForeignKey(
                        blank=True,
                        help_text="Game-specific question (null for global)",
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="registration_questions",
                        to="tournaments.game",
                    ),
                ),
            ],
            options={
                "ordering": ["order", "id"],
            },
        ),
        migrations.CreateModel(
            name="RegistrationAnswer",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "value",
                    models.JSONField(
                        help_text="Answer value: string, number, boolean, list, or dict"
                    ),
                ),
                (
                    "normalized_value",
                    models.TextField(blank=True, help_text="Normalized value for search/filtering"),
                ),
                (
                    "registration",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="answers",
                        to="tournaments.registration",
                    ),
                ),
                (
                    "question",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="answers",
                        to="tournaments.registrationquestion",
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="ResultVerificationLog",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "step",
                    models.CharField(
                        choices=[
                            ("schema_validation", "Schema Validation"),
                            ("scoring_calculation", "Scoring Calculation"),
                            ("organizer_review", "Organizer Review"),
                            ("finalization", "Finalization"),
                            ("opponent_confirm", "Opponent Confirmation"),
                            ("opponent_dispute", "Opponent Dispute"),
                            ("dispute_escalated", "Dispute Escalated"),
                            ("dispute_resolved", "Dispute Resolved"),
                        ],
                        help_text="Verification step performed",
                        max_length=30,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[("success", "Success"), ("failure", "Failure")],
                        help_text="Step result (success/failure)",
                        max_length=10,
                    ),
                ),
                (
                    "details",
                    models.JSONField(
                        default=dict, help_text="Step details (errors, warnings, metadata)"
                    ),
                ),
                (
                    "performed_at",
                    models.DateTimeField(auto_now_add=True, help_text="When step was performed"),
                ),
                (
                    "performed_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who performed this step (if applicable)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "submission",
                    models.ForeignKey(
                        help_text="Submission being verified",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="verification_logs",
                        to="tournaments.matchresultsubmission",
                    ),
                ),
            ],
            options={
                "verbose_name": "Result Verification Log",
                "verbose_name_plural": "Result Verification Logs",
                "db_table": "tournaments_result_verification_log",
                "ordering": ["-performed_at"],
            },
        ),
        migrations.CreateModel(
            name="Tournament",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "is_deleted",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Flag indicating if this record has been soft-deleted",
                    ),
                ),
                (
                    "deleted_at",
                    models.DateTimeField(
                        blank=True, help_text="Timestamp when this record was deleted", null=True
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                ("name", models.CharField(help_text="Tournament name", max_length=200)),
                ("slug", models.SlugField(max_length=250, unique=True)),
                ("description", models.TextField(help_text="Tournament description and overview")),
                (
                    "is_official",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Whether this is an official DeltaCrown tournament",
                    ),
                ),
                (
                    "is_featured",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Whether this tournament is featured on the homepage",
                    ),
                ),
                (
                    "format",
                    models.CharField(
                        choices=[
                            ("single_elimination", "Single Elimination"),
                            ("double_elimination", "Double Elimination"),
                            ("round_robin", "Round Robin"),
                            ("swiss", "Swiss"),
                            ("group_playoff", "Group Stage + Playoff"),
                        ],
                        default="single_elimination",
                        help_text="Bracket format for the tournament",
                        max_length=50,
                    ),
                ),
                (
                    "participation_type",
                    models.CharField(
                        choices=[("team", "Team"), ("solo", "Solo/Individual")],
                        default="team",
                        help_text="Whether teams or individuals participate",
                        max_length=20,
                    ),
                ),
                (
                    "platform",
                    models.CharField(
                        choices=[
                            ("pc", "PC"),
                            ("mobile", "Mobile"),
                            ("ps5", "PlayStation 5"),
                            ("xbox", "Xbox Series X/S"),
                            ("switch", "Nintendo Switch"),
                        ],
                        db_index=True,
                        default="pc",
                        help_text="Gaming platform for this tournament",
                        max_length=20,
                    ),
                ),
                (
                    "mode",
                    models.CharField(
                        choices=[
                            ("online", "Online"),
                            ("lan", "LAN"),
                            ("hybrid", "Hybrid (Online + LAN Finals)"),
                        ],
                        db_index=True,
                        default="online",
                        help_text="Tournament mode - affects location requirements",
                        max_length=10,
                    ),
                ),
                (
                    "venue_name",
                    models.CharField(
                        blank=True,
                        default="",
                        help_text="Venue name for LAN tournaments",
                        max_length=200,
                    ),
                ),
                (
                    "venue_address",
                    models.TextField(
                        blank=True,
                        default="",
                        help_text="Complete venue address for LAN tournaments",
                    ),
                ),
                (
                    "venue_city",
                    models.CharField(
                        blank=True,
                        default="",
                        help_text="City where LAN event is held",
                        max_length=100,
                    ),
                ),
                (
                    "venue_map_url",
                    models.URLField(blank=True, default="", help_text="Google Maps link to venue"),
                ),
                (
                    "max_participants",
                    models.PositiveIntegerField(
                        help_text="Maximum number of participants/teams",
                        validators=[
                            django.core.validators.MinValueValidator(2),
                            django.core.validators.MaxValueValidator(256),
                        ],
                    ),
                ),
                (
                    "min_participants",
                    models.PositiveIntegerField(
                        default=2,
                        help_text="Minimum participants needed to start",
                        validators=[django.core.validators.MinValueValidator(2)],
                    ),
                ),
                ("registration_start", models.DateTimeField(help_text="When registration opens")),
                ("registration_end", models.DateTimeField(help_text="When registration closes")),
                (
                    "registration_form_overrides",
                    models.JSONField(
                        default=dict,
                        help_text="Form configuration overrides for this tournament (JSONB)",
                    ),
                ),
                ("tournament_start", models.DateTimeField(help_text="When tournament begins")),
                (
                    "tournament_end",
                    models.DateTimeField(
                        blank=True, help_text="When tournament ends (set automatically)", null=True
                    ),
                ),
                (
                    "prize_pool",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Total prize pool amount",
                        max_digits=10,
                        validators=[django.core.validators.MinValueValidator(Decimal("0.00"))],
                    ),
                ),
                (
                    "prize_currency",
                    models.CharField(
                        default="BDT",
                        help_text="Currency for prize pool (BDT, USD, etc.)",
                        max_length=10,
                    ),
                ),
                (
                    "prize_deltacoin",
                    models.PositiveIntegerField(default=0, help_text="Prize pool in DeltaCoins"),
                ),
                (
                    "prize_distribution",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text='Prize distribution by placement (JSONB): {"1": "50%", "2": "30%", "3": "20%"}',
                    ),
                ),
                (
                    "has_entry_fee",
                    models.BooleanField(
                        default=False, help_text="Whether tournament has an entry fee"
                    ),
                ),
                (
                    "entry_fee_amount",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("0.00"),
                        help_text="Entry fee amount",
                        max_digits=10,
                        validators=[django.core.validators.MinValueValidator(Decimal("0.00"))],
                    ),
                ),
                (
                    "entry_fee_currency",
                    models.CharField(
                        default="BDT", help_text="Currency for entry fee", max_length=10
                    ),
                ),
                (
                    "entry_fee_deltacoin",
                    models.PositiveIntegerField(default=0, help_text="Entry fee in DeltaCoins"),
                ),
                (
                    "payment_methods",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.CharField(
                            choices=[
                                ("deltacoin", "DeltaCoin"),
                                ("bkash", "bKash"),
                                ("nagad", "Nagad"),
                                ("rocket", "Rocket"),
                                ("bank_transfer", "Bank Transfer"),
                            ],
                            max_length=20,
                        ),
                        blank=True,
                        default=list,
                        help_text="Accepted payment methods",
                        size=None,
                    ),
                ),
                (
                    "enable_fee_waiver",
                    models.BooleanField(
                        default=False, help_text="Enable automatic fee waiver for top teams"
                    ),
                ),
                (
                    "fee_waiver_top_n_teams",
                    models.PositiveIntegerField(
                        default=0, help_text="Number of top teams eligible for fee waiver"
                    ),
                ),
                (
                    "banner_image",
                    models.ImageField(
                        blank=True,
                        help_text="Tournament banner image",
                        null=True,
                        upload_to="tournaments/banners/",
                    ),
                ),
                (
                    "thumbnail_image",
                    models.ImageField(
                        blank=True,
                        help_text="Tournament thumbnail for listings",
                        null=True,
                        upload_to="tournaments/thumbnails/",
                    ),
                ),
                (
                    "rules_pdf",
                    models.FileField(
                        blank=True,
                        help_text="Tournament rules PDF file",
                        null=True,
                        upload_to="tournaments/rules/",
                    ),
                ),
                (
                    "promo_video_url",
                    models.URLField(blank=True, help_text="YouTube/Vimeo promo video URL"),
                ),
                (
                    "stream_youtube_url",
                    models.URLField(blank=True, help_text="Official YouTube stream URL"),
                ),
                (
                    "stream_twitch_url",
                    models.URLField(blank=True, help_text="Official Twitch stream URL"),
                ),
                (
                    "enable_check_in",
                    models.BooleanField(
                        default=True, help_text="Require participants to check in before matches"
                    ),
                ),
                (
                    "check_in_minutes_before",
                    models.PositiveIntegerField(
                        default=15, help_text="Check-in window duration in minutes"
                    ),
                ),
                (
                    "check_in_closes_minutes_before",
                    models.PositiveIntegerField(
                        default=10,
                        help_text="Check-in closes this many minutes before tournament start",
                    ),
                ),
                (
                    "enable_dynamic_seeding",
                    models.BooleanField(
                        default=False,
                        help_text="Use team rankings for seeding instead of registration order",
                    ),
                ),
                (
                    "enable_live_updates",
                    models.BooleanField(
                        default=True, help_text="Enable WebSocket live updates for spectators"
                    ),
                ),
                (
                    "enable_certificates",
                    models.BooleanField(
                        default=True, help_text="Generate certificates for winners"
                    ),
                ),
                (
                    "enable_challenges",
                    models.BooleanField(
                        default=False, help_text="Enable bonus challenges during tournament"
                    ),
                ),
                (
                    "enable_fan_voting",
                    models.BooleanField(
                        default=False, help_text="Enable spectator voting/predictions"
                    ),
                ),
                (
                    "rules_text",
                    models.TextField(blank=True, help_text="Tournament rules in text format"),
                ),
                (
                    "terms_and_conditions",
                    models.TextField(
                        blank=True,
                        help_text="Terms and conditions that all participants must agree to",
                    ),
                ),
                (
                    "terms_pdf",
                    models.FileField(
                        blank=True,
                        help_text="Terms & Conditions PDF document (optional)",
                        null=True,
                        upload_to="tournaments/terms/",
                    ),
                ),
                (
                    "require_terms_acceptance",
                    models.BooleanField(
                        default=True,
                        help_text="Require participants to explicitly accept terms during registration",
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("draft", "Draft"),
                            ("pending_approval", "Pending Approval"),
                            ("published", "Published"),
                            ("registration_open", "Registration Open"),
                            ("registration_closed", "Registration Closed"),
                            ("live", "Live"),
                            ("completed", "Completed"),
                            ("cancelled", "Cancelled"),
                            ("archived", "Archived"),
                        ],
                        db_index=True,
                        default="draft",
                        help_text="Current tournament status",
                        max_length=30,
                    ),
                ),
                (
                    "published_at",
                    models.DateTimeField(
                        blank=True, help_text="When tournament was published", null=True
                    ),
                ),
                (
                    "total_registrations",
                    models.PositiveIntegerField(
                        default=0, help_text="Total number of registrations"
                    ),
                ),
                (
                    "total_matches",
                    models.PositiveIntegerField(default=0, help_text="Total number of matches"),
                ),
                (
                    "completed_matches",
                    models.PositiveIntegerField(default=0, help_text="Number of completed matches"),
                ),
                (
                    "meta_description",
                    models.TextField(blank=True, help_text="Meta description for SEO"),
                ),
                (
                    "meta_keywords",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.CharField(max_length=50),
                        blank=True,
                        default=list,
                        help_text="SEO keywords",
                        size=None,
                    ),
                ),
                (
                    "config",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Advanced tournament configuration and feature flags (JSONB)",
                    ),
                ),
                (
                    "deleted_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who deleted this record",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="%(class)s_deletions",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "game",
                    models.ForeignKey(
                        help_text="Game being played in this tournament",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="tournaments",
                        to="tournaments.game",
                    ),
                ),
                (
                    "organizer",
                    models.ForeignKey(
                        help_text="User who created this tournament",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="organized_tournaments",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament",
                "verbose_name_plural": "Tournaments",
                "ordering": ["-tournament_start"],
            },
        ),
        migrations.CreateModel(
            name="TeamRegistrationPermissionRequest",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("approved", "Approved"),
                            ("rejected", "Rejected"),
                            ("cancelled", "Cancelled"),
                        ],
                        default="pending",
                        help_text="Current status of the request",
                        max_length=20,
                    ),
                ),
                (
                    "message",
                    models.TextField(
                        blank=True, help_text="Optional message from requester to captain"
                    ),
                ),
                (
                    "response_message",
                    models.TextField(blank=True, help_text="Response from captain/manager"),
                ),
                (
                    "responded_at",
                    models.DateTimeField(
                        blank=True, help_text="When the request was approved/rejected", null=True
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "requester",
                    models.ForeignKey(
                        help_text="Team member requesting permission",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="registration_permission_requests",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "responded_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="Captain/manager who responded to the request",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="permission_requests_responded",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "team",
                    models.ForeignKey(
                        help_text="Team for which permission is requested",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="registration_permission_requests",
                        to="teams.team",
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        help_text="Tournament the member wants to register for",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="permission_requests",
                        to="tournaments.tournament",
                    ),
                ),
            ],
            options={
                "verbose_name": "Team Registration Permission Request",
                "verbose_name_plural": "Team Registration Permission Requests",
                "db_table": "tournaments_team_permission_request",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="RegistrationRule",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        help_text='Rule description: "Auto-approve verified Immortal+ players"',
                        max_length=200,
                    ),
                ),
                (
                    "rule_type",
                    models.CharField(
                        choices=[
                            ("auto_approve", "Auto Approve"),
                            ("auto_reject", "Auto Reject"),
                            ("flag_for_review", "Flag for Review"),
                        ],
                        max_length=20,
                    ),
                ),
                (
                    "condition",
                    models.JSONField(
                        help_text='Condition expression: {"rank": {"in": ["Immortal", "Radiant"]}, "email_verified": true}'
                    ),
                ),
                (
                    "priority",
                    models.PositiveIntegerField(
                        default=0, help_text="Lower = higher priority (evaluated first)"
                    ),
                ),
                ("is_active", models.BooleanField(default=True)),
                (
                    "reason_template",
                    models.TextField(
                        blank=True,
                        help_text='Reason shown to user if rule triggers: "Registration auto-approved (verified Immortal player)"',
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="registration_rules",
                        to="tournaments.tournament",
                    ),
                ),
            ],
            options={
                "ordering": ["priority", "id"],
            },
        ),
        migrations.AddField(
            model_name="registrationquestion",
            name="tournament",
            field=models.ForeignKey(
                blank=True,
                help_text="Tournament-specific question (null for global)",
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="registration_questions",
                to="tournaments.tournament",
            ),
        ),
        migrations.CreateModel(
            name="RegistrationDraft",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "uuid",
                    models.UUIDField(
                        db_index=True,
                        default=uuid.uuid4,
                        help_text="Universal draft ID for cross-device resume",
                        unique=True,
                    ),
                ),
                (
                    "registration_number",
                    models.CharField(
                        help_text="Human-readable: VCT-2025-001234", max_length=20, unique=True
                    ),
                ),
                (
                    "team_id",
                    models.IntegerField(
                        blank=True,
                        db_index=True,
                        help_text="Team ID (IntegerField to avoid circular dependency)",
                        null=True,
                    ),
                ),
                (
                    "form_data",
                    models.JSONField(
                        default=dict,
                        help_text="All form fields: {riot_id, discord, phone, answers: {...}}",
                    ),
                ),
                (
                    "auto_filled_fields",
                    models.JSONField(
                        default=list, help_text='Fields auto-filled: ["riot_id", "email"]'
                    ),
                ),
                (
                    "locked_fields",
                    models.JSONField(
                        default=list, help_text='Fields locked (verified): ["email", "riot_id"]'
                    ),
                ),
                (
                    "current_step",
                    models.CharField(
                        choices=[
                            ("player_info", "Player Information"),
                            ("team_info", "Team Information"),
                            ("questions", "Additional Questions"),
                            ("review", "Review & Confirm"),
                            ("payment", "Payment"),
                        ],
                        default="player_info",
                        max_length=20,
                    ),
                ),
                (
                    "completion_percentage",
                    models.PositiveIntegerField(default=0, help_text="0-100"),
                ),
                (
                    "submitted",
                    models.BooleanField(default=False, help_text="Draft converted to registration"),
                ),
                (
                    "last_saved_at",
                    models.DateTimeField(
                        auto_now=True,
                        help_text="Auto-updated on every save (for auto-save tracking)",
                    ),
                ),
                (
                    "expires_at",
                    models.DateTimeField(help_text="Draft expires 7 days after creation"),
                ),
                (
                    "registration",
                    models.OneToOneField(
                        blank=True,
                        help_text="Created after draft submission",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        to="tournaments.registration",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="registration_drafts",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="registration_drafts",
                        to="tournaments.tournament",
                    ),
                ),
            ],
        ),
        migrations.AddField(
            model_name="registration",
            name="tournament",
            field=models.ForeignKey(
                help_text="Tournament being registered for",
                on_delete=django.db.models.deletion.CASCADE,
                related_name="registrations",
                to="tournaments.tournament",
            ),
        ),
        migrations.CreateModel(
            name="PrizeTransaction",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "placement",
                    models.CharField(
                        choices=[
                            ("1st", "1st Place"),
                            ("2nd", "2nd Place"),
                            ("3rd", "3rd Place"),
                            ("participation", "Participation Reward"),
                        ],
                        help_text="Placement earned by participant",
                        max_length=20,
                    ),
                ),
                (
                    "amount",
                    models.DecimalField(
                        decimal_places=2, help_text="Prize amount in Delta Coins", max_digits=10
                    ),
                ),
                (
                    "coin_transaction_id",
                    models.IntegerField(
                        blank=True,
                        db_index=True,
                        help_text="ID of DeltaCrownTransaction in apps.economy (reference only, not FK)",
                        null=True,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("completed", "Completed"),
                            ("failed", "Failed"),
                            ("refunded", "Refunded"),
                        ],
                        default="pending",
                        help_text="Current status of this prize transaction",
                        max_length=20,
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True,
                        help_text="Optional notes for manual adjustments or reconciliation",
                    ),
                ),
                (
                    "processed_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who triggered the payout",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="processed_prize_transactions",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "participant",
                    models.ForeignKey(
                        help_text="Registration receiving this prize",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="prize_transactions",
                        to="tournaments.registration",
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        help_text="Tournament awarding this prize",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="prize_transactions",
                        to="tournaments.tournament",
                    ),
                ),
            ],
            options={
                "verbose_name": "Prize Transaction",
                "verbose_name_plural": "Prize Transactions",
                "db_table": "tournament_engine_prize_prizetransaction",
                "ordering": ["-created_at", "-id"],
            },
        ),
        migrations.AddField(
            model_name="match",
            name="tournament",
            field=models.ForeignKey(
                help_text="Tournament this match belongs to",
                on_delete=django.db.models.deletion.CASCADE,
                related_name="matches",
                to="tournaments.tournament",
                verbose_name="Tournament",
            ),
        ),
        migrations.CreateModel(
            name="GroupStage",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        default="Group Stage",
                        help_text="Name of this group stage phase",
                        max_length=100,
                        verbose_name="Stage Name",
                    ),
                ),
                (
                    "num_groups",
                    models.PositiveIntegerField(
                        help_text="Total number of groups in this stage",
                        validators=[django.core.validators.MinValueValidator(1)],
                        verbose_name="Number of Groups",
                    ),
                ),
                (
                    "group_size",
                    models.PositiveIntegerField(
                        help_text="Number of participants per group",
                        validators=[django.core.validators.MinValueValidator(2)],
                        verbose_name="Group Size",
                    ),
                ),
                (
                    "format",
                    models.CharField(
                        choices=[
                            ("round_robin", "Round Robin"),
                            ("double_round_robin", "Double Round Robin"),
                        ],
                        default="round_robin",
                        help_text="Match format within groups",
                        max_length=20,
                        verbose_name="Format",
                    ),
                ),
                (
                    "state",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("active", "Active"),
                            ("completed", "Completed"),
                        ],
                        default="pending",
                        help_text="Current state of the group stage",
                        max_length=20,
                        verbose_name="State",
                    ),
                ),
                (
                    "advancement_count_per_group",
                    models.PositiveIntegerField(
                        default=2,
                        help_text="Number of teams that advance from each group",
                        validators=[django.core.validators.MinValueValidator(1)],
                        verbose_name="Teams Advancing Per Group",
                    ),
                ),
                (
                    "config",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="JSON config: points_system, tiebreaker_rules, seeding_method",
                        verbose_name="Configuration",
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        help_text="Tournament this group stage belongs to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="group_stages",
                        to="tournaments.tournament",
                        verbose_name="Tournament",
                    ),
                ),
            ],
            options={
                "verbose_name": "Group Stage",
                "verbose_name_plural": "Group Stages",
                "db_table": "tournament_group_stages",
                "ordering": ["tournament", "-created_at"],
            },
        ),
        migrations.AddField(
            model_name="group",
            name="tournament",
            field=models.ForeignKey(
                help_text="Tournament this group belongs to",
                on_delete=django.db.models.deletion.CASCADE,
                related_name="groups",
                to="tournaments.tournament",
                verbose_name="Tournament",
            ),
        ),
        migrations.CreateModel(
            name="CustomField",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "field_name",
                    models.CharField(help_text="Display name of the field", max_length=100),
                ),
                (
                    "field_key",
                    models.SlugField(help_text="Unique key for form field name", max_length=120),
                ),
                (
                    "field_type",
                    models.CharField(
                        choices=[
                            ("text", "Text"),
                            ("number", "Number"),
                            ("media", "Media Upload"),
                            ("toggle", "Toggle (Yes/No)"),
                            ("date", "Date"),
                            ("url", "URL"),
                            ("dropdown", "Dropdown"),
                        ],
                        default="text",
                        help_text="Type of field (text, number, etc.)",
                        max_length=20,
                    ),
                ),
                (
                    "field_config",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Field configuration (min_length, max_length, options, etc.)",
                    ),
                ),
                (
                    "field_value",
                    models.JSONField(
                        blank=True, default=dict, help_text="Actual field value storage"
                    ),
                ),
                (
                    "order",
                    models.PositiveIntegerField(
                        default=0, help_text="Display order (lower numbers first)"
                    ),
                ),
                (
                    "is_required",
                    models.BooleanField(default=False, help_text="Whether this field is required"),
                ),
                (
                    "help_text",
                    models.CharField(
                        blank=True, help_text="Help text shown to users", max_length=200
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        help_text="Tournament this field belongs to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="custom_fields",
                        to="tournaments.tournament",
                    ),
                ),
            ],
            options={
                "verbose_name": "Custom Field",
                "verbose_name_plural": "Custom Fields",
                "ordering": ["order", "field_name"],
            },
        ),
        migrations.CreateModel(
            name="CheckIn",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "is_checked_in",
                    models.BooleanField(
                        default=False,
                        help_text="Whether participant has checked in",
                        verbose_name="Is Checked In",
                    ),
                ),
                (
                    "checked_in_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="Timestamp of check-in",
                        null=True,
                        verbose_name="Checked In At",
                    ),
                ),
                (
                    "is_forfeited",
                    models.BooleanField(
                        default=False,
                        help_text="Whether participant was forfeited for not checking in",
                        verbose_name="Is Forfeited",
                    ),
                ),
                (
                    "forfeited_at",
                    models.DateTimeField(blank=True, null=True, verbose_name="Forfeited At"),
                ),
                (
                    "forfeit_reason",
                    models.CharField(
                        blank=True,
                        help_text="Why participant was forfeited",
                        max_length=255,
                        verbose_name="Forfeit Reason",
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True, help_text="Admin notes about check-in", verbose_name="Notes"
                    ),
                ),
                ("is_deleted", models.BooleanField(default=False, verbose_name="Is Deleted")),
                (
                    "checked_in_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who performed check-in (may be captain for teams)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="+",
                        to=settings.AUTH_USER_MODEL,
                        verbose_name="Checked In By",
                    ),
                ),
                (
                    "team",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="tournament_check_ins",
                        to="teams.team",
                        verbose_name="Team",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="tournament_check_ins",
                        to=settings.AUTH_USER_MODEL,
                        verbose_name="User",
                    ),
                ),
                (
                    "registration",
                    models.OneToOneField(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="check_in",
                        to="tournaments.registration",
                        verbose_name="Registration",
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="check_ins",
                        to="tournaments.tournament",
                        verbose_name="Tournament",
                    ),
                ),
            ],
            options={
                "verbose_name": "Check-In",
                "verbose_name_plural": "Check-Ins",
                "db_table": "tournament_check_ins",
            },
        ),
        migrations.CreateModel(
            name="Certificate",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "certificate_type",
                    models.CharField(
                        choices=[
                            ("winner", "Winner Certificate"),
                            ("runner_up", "Runner-up Certificate"),
                            ("third_place", "Third Place Certificate"),
                            ("participant", "Participation Certificate"),
                        ],
                        help_text="Type of certificate (winner, runner-up, etc.)",
                        max_length=20,
                    ),
                ),
                (
                    "placement",
                    models.CharField(
                        blank=True,
                        default="",
                        help_text="Placement string (e.g., '1st', '2nd', '3rd') for display",
                        max_length=20,
                    ),
                ),
                (
                    "file_pdf",
                    models.FileField(
                        blank=True,
                        help_text="Generated PDF certificate file",
                        null=True,
                        upload_to="certificates/pdf/%Y/%m/",
                    ),
                ),
                (
                    "file_image",
                    models.ImageField(
                        blank=True,
                        help_text="Generated PNG/JPEG certificate image",
                        null=True,
                        upload_to="certificates/images/%Y/%m/",
                    ),
                ),
                (
                    "verification_code",
                    models.UUIDField(
                        db_index=True,
                        default=uuid.uuid4,
                        editable=False,
                        help_text="Unique verification code (UUID4) for public verification",
                        unique=True,
                    ),
                ),
                (
                    "certificate_hash",
                    models.CharField(
                        help_text="SHA-256 hash of PDF file for tamper detection (64 hex characters)",
                        max_length=64,
                    ),
                ),
                (
                    "generated_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="When certificate was generated"
                    ),
                ),
                (
                    "downloaded_at",
                    models.DateTimeField(
                        blank=True, help_text="First download timestamp", null=True
                    ),
                ),
                (
                    "download_count",
                    models.PositiveIntegerField(
                        default=0, help_text="Number of times certificate has been downloaded"
                    ),
                ),
                (
                    "revoked_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When certificate was revoked (if applicable)",
                        null=True,
                    ),
                ),
                (
                    "revoked_reason",
                    models.TextField(
                        blank=True,
                        default="",
                        help_text="Reason for revocation (e.g., 'Result disputed and changed', 'Regenerated with corrections')",
                    ),
                ),
                (
                    "migrated_to_s3_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When certificate files were migrated to S3 (backfill tracking)",
                        null=True,
                    ),
                ),
                (
                    "participant",
                    models.ForeignKey(
                        help_text="Participant who received this certificate (via Registration)",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="certificates",
                        to="tournaments.registration",
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        help_text="Tournament this certificate was awarded for",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="certificates",
                        to="tournaments.tournament",
                    ),
                ),
            ],
            options={
                "verbose_name": "Certificate",
                "verbose_name_plural": "Certificates",
                "db_table": "tournament_engine_certificate_certificate",
                "ordering": ["-generated_at"],
            },
        ),
        migrations.AddField(
            model_name="bracket",
            name="tournament",
            field=models.OneToOneField(
                help_text="Tournament this bracket belongs to",
                on_delete=django.db.models.deletion.CASCADE,
                related_name="bracket",
                to="tournaments.tournament",
                verbose_name="Tournament",
            ),
        ),
        migrations.CreateModel(
            name="TournamentAnnouncement",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("title", models.CharField(max_length=200, verbose_name="Title")),
                ("message", models.TextField(verbose_name="Message")),
                ("created_at", models.DateTimeField(auto_now_add=True, verbose_name="Created At")),
                ("updated_at", models.DateTimeField(auto_now=True, verbose_name="Updated At")),
                (
                    "is_pinned",
                    models.BooleanField(
                        default=False,
                        help_text="Pinned announcements appear at the top",
                        verbose_name="Pinned",
                    ),
                ),
                (
                    "is_important",
                    models.BooleanField(
                        default=False,
                        help_text="Important announcements are highlighted",
                        verbose_name="Important",
                    ),
                ),
                (
                    "created_by",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="tournament_announcements_created",
                        to=settings.AUTH_USER_MODEL,
                        verbose_name="Created By",
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="announcements",
                        to="tournaments.tournament",
                        verbose_name="Tournament",
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament Announcement",
                "verbose_name_plural": "Tournament Announcements",
                "db_table": "tournament_announcements",
                "ordering": ["-is_pinned", "-created_at"],
            },
        ),
        migrations.CreateModel(
            name="TournamentFormConfiguration",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "form_type",
                    models.CharField(
                        choices=[
                            ("default_solo", "Default Solo Registration"),
                            ("default_team", "Default Team Registration"),
                            ("custom", "Custom Registration Form"),
                        ],
                        default="default_solo",
                        help_text="Type of registration form to use",
                        max_length=20,
                    ),
                ),
                (
                    "enable_age_field",
                    models.BooleanField(
                        default=False, help_text="Ask for participant age (13+ validation)"
                    ),
                ),
                (
                    "enable_country_field",
                    models.BooleanField(
                        default=False, help_text="Ask for country/region selection"
                    ),
                ),
                (
                    "enable_platform_field",
                    models.BooleanField(
                        default=False, help_text="Ask for platform/server (e.g., APAC, NA, EU)"
                    ),
                ),
                (
                    "enable_rank_field",
                    models.BooleanField(
                        default=False, help_text="Ask for current game rank (optional)"
                    ),
                ),
                (
                    "enable_phone_field",
                    models.BooleanField(default=False, help_text="Ask for WhatsApp/phone number"),
                ),
                (
                    "enable_discord_field",
                    models.BooleanField(default=False, help_text="Ask for Discord username"),
                ),
                (
                    "enable_preferred_contact_field",
                    models.BooleanField(
                        default=False, help_text="Ask for preferred contact method"
                    ),
                ),
                (
                    "enable_team_logo_field",
                    models.BooleanField(default=False, help_text="Allow team logo upload"),
                ),
                (
                    "enable_team_region_field",
                    models.BooleanField(default=False, help_text="Ask for team region"),
                ),
                (
                    "enable_captain_display_name_field",
                    models.BooleanField(
                        default=False, help_text="Ask for captain nickname/display name"
                    ),
                ),
                (
                    "enable_captain_whatsapp_field",
                    models.BooleanField(default=False, help_text="Ask for captain WhatsApp number"),
                ),
                (
                    "enable_captain_phone_field",
                    models.BooleanField(default=False, help_text="Ask for captain phone number"),
                ),
                (
                    "enable_captain_discord_field",
                    models.BooleanField(
                        default=False, help_text="Ask for captain Discord username"
                    ),
                ),
                (
                    "enable_roster_display_names",
                    models.BooleanField(
                        default=False, help_text="Ask for display names for all team members"
                    ),
                ),
                (
                    "enable_roster_emails",
                    models.BooleanField(
                        default=False, help_text="Ask for email addresses for all team members"
                    ),
                ),
                (
                    "enable_payment_mobile_number_field",
                    models.BooleanField(
                        default=False, help_text="Ask for mobile number used for payment"
                    ),
                ),
                (
                    "enable_payment_screenshot_field",
                    models.BooleanField(default=True, help_text="Allow payment screenshot upload"),
                ),
                (
                    "enable_payment_notes_field",
                    models.BooleanField(default=False, help_text="Allow optional payment notes"),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "custom_form",
                    models.ForeignKey(
                        blank=True,
                        help_text="Custom form template (if form_type is custom)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="tournament_configurations",
                        to="tournaments.registrationformtemplate",
                    ),
                ),
                (
                    "tournament",
                    models.OneToOneField(
                        help_text="Tournament this form configuration belongs to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="form_configuration",
                        to="tournaments.tournament",
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament Form Configuration",
                "verbose_name_plural": "Tournament Form Configurations",
                "db_table": "tournaments_form_configuration",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="TournamentLobby",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "check_in_opens_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When check-in becomes available",
                        null=True,
                        verbose_name="Check-In Opens At",
                    ),
                ),
                (
                    "check_in_closes_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="Check-in deadline (typically tournament start time)",
                        null=True,
                        verbose_name="Check-In Closes At",
                    ),
                ),
                (
                    "check_in_required",
                    models.BooleanField(
                        default=True,
                        help_text="Whether participants must check in to compete",
                        verbose_name="Check-In Required",
                    ),
                ),
                (
                    "auto_forfeit_no_show",
                    models.BooleanField(
                        default=True,
                        help_text="Automatically forfeit participants who don't check in",
                        verbose_name="Auto-Forfeit No-Shows",
                    ),
                ),
                (
                    "lobby_message",
                    models.TextField(
                        blank=True,
                        help_text="Welcome message shown to participants in lobby",
                        verbose_name="Lobby Message",
                    ),
                ),
                (
                    "bracket_visibility",
                    models.CharField(
                        choices=[
                            ("hidden", "Hidden"),
                            ("seeded_only", "Seeded Only"),
                            ("full", "Full Bracket"),
                        ],
                        default="seeded_only",
                        help_text="What participants can see before tournament starts",
                        max_length=20,
                        verbose_name="Bracket Visibility",
                    ),
                ),
                (
                    "roster_visibility",
                    models.CharField(
                        choices=[
                            ("hidden", "Hidden"),
                            ("count_only", "Count Only"),
                            ("full", "Full Roster"),
                        ],
                        default="full",
                        help_text="Whether participants can see full roster",
                        max_length=20,
                        verbose_name="Roster Visibility",
                    ),
                ),
                (
                    "rules_url",
                    models.URLField(
                        blank=True,
                        help_text="Link to detailed rules document",
                        verbose_name="Rules URL",
                    ),
                ),
                (
                    "discord_server_url",
                    models.URLField(
                        blank=True,
                        help_text="Optional Discord server for communication",
                        verbose_name="Discord Server",
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True,
                        help_text="Whether lobby is currently accessible",
                        verbose_name="Is Active",
                    ),
                ),
                (
                    "config",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Additional lobby settings",
                        verbose_name="Lobby Configuration",
                    ),
                ),
                (
                    "tournament",
                    models.OneToOneField(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="lobby",
                        to="tournaments.tournament",
                        verbose_name="Tournament",
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament Lobby",
                "verbose_name_plural": "Tournament Lobbies",
                "db_table": "tournament_lobbies",
            },
        ),
        migrations.CreateModel(
            name="LobbyAnnouncement",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                ("title", models.CharField(max_length=200, verbose_name="Title")),
                ("message", models.TextField(verbose_name="Message")),
                (
                    "announcement_type",
                    models.CharField(
                        choices=[
                            ("info", "Information"),
                            ("warning", "Warning"),
                            ("urgent", "Urgent"),
                            ("success", "Success"),
                        ],
                        default="info",
                        max_length=20,
                        verbose_name="Type",
                    ),
                ),
                (
                    "is_pinned",
                    models.BooleanField(
                        default=False,
                        help_text="Pinned announcements appear at top",
                        verbose_name="Is Pinned",
                    ),
                ),
                (
                    "display_until",
                    models.DateTimeField(
                        blank=True,
                        help_text="Auto-hide after this time (optional)",
                        null=True,
                        verbose_name="Display Until",
                    ),
                ),
                ("is_visible", models.BooleanField(default=True, verbose_name="Is Visible")),
                ("is_deleted", models.BooleanField(default=False, verbose_name="Is Deleted")),
                (
                    "posted_by",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="+",
                        to=settings.AUTH_USER_MODEL,
                        verbose_name="Posted By",
                    ),
                ),
                (
                    "lobby",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="announcements",
                        to="tournaments.tournamentlobby",
                        verbose_name="Lobby",
                    ),
                ),
            ],
            options={
                "verbose_name": "Lobby Announcement",
                "verbose_name_plural": "Lobby Announcements",
                "db_table": "tournament_lobby_announcements",
                "ordering": ["-is_pinned", "-created_at"],
            },
        ),
        migrations.CreateModel(
            name="TournamentPaymentMethod",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "method",
                    models.CharField(
                        choices=[
                            ("deltacoin", "DeltaCoin"),
                            ("bkash", "bKash"),
                            ("nagad", "Nagad"),
                            ("rocket", "Rocket"),
                            ("bank_transfer", "Bank Transfer"),
                        ],
                        help_text="Payment method type",
                        max_length=20,
                    ),
                ),
                (
                    "is_enabled",
                    models.BooleanField(
                        default=True, help_text="Whether this payment method is currently active"
                    ),
                ),
                (
                    "display_order",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Display order in payment options (lower = higher priority)",
                    ),
                ),
                (
                    "bkash_account_number",
                    models.CharField(
                        blank=True,
                        help_text="bKash account/merchant number (e.g., 01712345678)",
                        max_length=20,
                    ),
                ),
                (
                    "bkash_account_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("personal", "Personal Account"),
                            ("merchant", "Merchant Account"),
                            ("agent", "Agent Account"),
                        ],
                        default="personal",
                        help_text="Type of bKash account",
                        max_length=20,
                    ),
                ),
                (
                    "bkash_account_name",
                    models.CharField(
                        blank=True,
                        help_text="Name on bKash account (for verification)",
                        max_length=100,
                    ),
                ),
                (
                    "bkash_instructions",
                    models.TextField(
                        blank=True,
                        help_text="Step-by-step payment instructions for participants (supports Markdown)",
                    ),
                ),
                (
                    "bkash_reference_required",
                    models.BooleanField(
                        default=True,
                        help_text="Require participants to provide bKash transaction ID",
                    ),
                ),
                (
                    "nagad_account_number",
                    models.CharField(
                        blank=True, help_text="Nagad account/merchant number", max_length=20
                    ),
                ),
                (
                    "nagad_account_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("personal", "Personal Account"),
                            ("merchant", "Merchant Account"),
                            ("agent", "Agent Account"),
                        ],
                        default="personal",
                        help_text="Type of Nagad account",
                        max_length=20,
                    ),
                ),
                (
                    "nagad_account_name",
                    models.CharField(blank=True, help_text="Name on Nagad account", max_length=100),
                ),
                (
                    "nagad_instructions",
                    models.TextField(
                        blank=True, help_text="Step-by-step payment instructions for participants"
                    ),
                ),
                (
                    "nagad_reference_required",
                    models.BooleanField(
                        default=True,
                        help_text="Require participants to provide Nagad transaction ID",
                    ),
                ),
                (
                    "rocket_account_number",
                    models.CharField(blank=True, help_text="Rocket account number", max_length=20),
                ),
                (
                    "rocket_account_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("personal", "Personal Account"),
                            ("merchant", "Merchant Account"),
                            ("agent", "Agent Account"),
                        ],
                        default="personal",
                        help_text="Type of Rocket account",
                        max_length=20,
                    ),
                ),
                (
                    "rocket_account_name",
                    models.CharField(
                        blank=True, help_text="Name on Rocket account", max_length=100
                    ),
                ),
                (
                    "rocket_instructions",
                    models.TextField(
                        blank=True, help_text="Step-by-step payment instructions for participants"
                    ),
                ),
                (
                    "rocket_reference_required",
                    models.BooleanField(
                        default=True,
                        help_text="Require participants to provide Rocket transaction ID",
                    ),
                ),
                (
                    "bank_name",
                    models.CharField(
                        blank=True,
                        help_text="Bank name (e.g., Dutch Bangla Bank Limited)",
                        max_length=100,
                    ),
                ),
                (
                    "bank_branch",
                    models.CharField(
                        blank=True, help_text="Bank branch name/location", max_length=100
                    ),
                ),
                (
                    "bank_account_number",
                    models.CharField(blank=True, help_text="Bank account number", max_length=50),
                ),
                (
                    "bank_account_name",
                    models.CharField(blank=True, help_text="Account holder name", max_length=100),
                ),
                (
                    "bank_routing_number",
                    models.CharField(
                        blank=True, help_text="Bank routing number (if applicable)", max_length=50
                    ),
                ),
                (
                    "bank_swift_code",
                    models.CharField(
                        blank=True,
                        help_text="SWIFT/BIC code for international transfers",
                        max_length=20,
                    ),
                ),
                (
                    "bank_instructions",
                    models.TextField(
                        blank=True, help_text="Step-by-step bank transfer instructions"
                    ),
                ),
                (
                    "bank_reference_required",
                    models.BooleanField(
                        default=True,
                        help_text="Require participants to provide bank reference/transaction ID",
                    ),
                ),
                (
                    "deltacoin_instructions",
                    models.TextField(
                        blank=True, help_text="Custom instructions for DeltaCoin payment (optional)"
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "tournament",
                    models.ForeignKey(
                        help_text="Tournament this payment method belongs to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="payment_configurations",
                        to="tournaments.tournament",
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament Payment Method",
                "verbose_name_plural": "Tournament Payment Methods",
                "db_table": "tournaments_tournament_payment_method",
                "ordering": ["display_order", "method"],
            },
        ),
        migrations.CreateModel(
            name="TournamentRegistrationForm",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "form_schema",
                    models.JSONField(
                        default=dict,
                        help_text="Complete form configuration (editable copy from template)",
                    ),
                ),
                (
                    "enable_multi_step",
                    models.BooleanField(
                        default=True, help_text="Split form into multiple steps/pages"
                    ),
                ),
                (
                    "enable_autosave",
                    models.BooleanField(
                        default=True, help_text="Auto-save draft responses in browser"
                    ),
                ),
                (
                    "enable_progress_bar",
                    models.BooleanField(
                        default=True, help_text="Show progress indicator during registration"
                    ),
                ),
                (
                    "allow_edits_after_submit",
                    models.BooleanField(
                        default=False,
                        help_text="Let users edit their registration after submission",
                    ),
                ),
                (
                    "require_email_verification",
                    models.BooleanField(
                        default=False,
                        help_text="Send verification email before accepting registration",
                    ),
                ),
                (
                    "enable_captcha",
                    models.BooleanField(default=True, help_text="Require CAPTCHA on submission"),
                ),
                (
                    "rate_limit_per_ip",
                    models.IntegerField(
                        default=5,
                        help_text="Max submissions per IP per hour",
                        validators=[
                            django.core.validators.MinValueValidator(1),
                            django.core.validators.MaxValueValidator(100),
                        ],
                    ),
                ),
                (
                    "success_message",
                    models.TextField(
                        blank=True, help_text="Custom success message after registration"
                    ),
                ),
                (
                    "redirect_url",
                    models.URLField(
                        blank=True, help_text="Redirect to external URL after success (optional)"
                    ),
                ),
                (
                    "send_confirmation_email",
                    models.BooleanField(
                        default=True, help_text="Send email confirmation to participant"
                    ),
                ),
                (
                    "conditional_rules",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Show/hide fields based on other field values",
                    ),
                ),
                (
                    "validation_rules",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Custom validation rules beyond field-level validation",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "total_views",
                    models.IntegerField(
                        default=0,
                        help_text="Number of times form was loaded",
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "total_starts",
                    models.IntegerField(
                        default=0,
                        help_text="Number of users who started filling the form",
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "total_completions",
                    models.IntegerField(
                        default=0,
                        help_text="Number of submitted registrations",
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "based_on_template",
                    models.ForeignKey(
                        blank=True,
                        help_text="Template this form was created from (if any)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="tournament_forms",
                        to="tournaments.registrationformtemplate",
                    ),
                ),
                (
                    "tournament",
                    models.OneToOneField(
                        help_text="Tournament this form belongs to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="registration_form",
                        to="tournaments.tournament",
                    ),
                ),
                (
                    "updated_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="Last user who edited this form",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="updated_tournament_forms",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament Registration Form",
                "verbose_name_plural": "Tournament Registration Forms",
                "db_table": "tournaments_registration_form",
            },
        ),
        migrations.CreateModel(
            name="FormWebhook",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("url", models.URLField(help_text="External URL to send webhook POST requests")),
                (
                    "secret",
                    models.CharField(
                        blank=True,
                        help_text="Secret key for HMAC signature verification",
                        max_length=255,
                    ),
                ),
                (
                    "events",
                    models.JSONField(
                        default=list, help_text="List of events to trigger this webhook"
                    ),
                ),
                ("is_active", models.BooleanField(default=True)),
                (
                    "custom_headers",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Custom HTTP headers to send with requests",
                    ),
                ),
                (
                    "retry_count",
                    models.IntegerField(
                        default=3, help_text="Number of retry attempts for failed deliveries"
                    ),
                ),
                (
                    "timeout",
                    models.IntegerField(default=10, help_text="Request timeout in seconds"),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "tournament_form",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="webhooks",
                        to="tournaments.tournamentregistrationform",
                    ),
                ),
            ],
            options={
                "db_table": "tournaments_form_webhook",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="FormResponse",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "response_data",
                    models.JSONField(default=dict, help_text="Complete form responses as JSON"),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("draft", "Draft"),
                            ("submitted", "Submitted"),
                            ("under_review", "Under Review"),
                            ("approved", "Approved"),
                            ("rejected", "Rejected"),
                            ("cancelled", "Cancelled"),
                        ],
                        db_index=True,
                        default="draft",
                        help_text="Current registration status",
                        max_length=20,
                    ),
                ),
                ("has_paid", models.BooleanField(db_index=True, default=False)),
                ("payment_verified", models.BooleanField(db_index=True, default=False)),
                (
                    "payment_amount",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Amount paid (if entry fee exists)",
                        max_digits=10,
                        null=True,
                    ),
                ),
                ("payment_method", models.CharField(blank=True, max_length=50)),
                ("payment_transaction_id", models.CharField(blank=True, max_length=200)),
                (
                    "payment_proof",
                    models.FileField(
                        blank=True,
                        help_text="Screenshot of payment",
                        null=True,
                        upload_to="registration_payments/",
                    ),
                ),
                ("payment_verified_at", models.DateTimeField(blank=True, null=True)),
                (
                    "admin_notes",
                    models.TextField(
                        blank=True, help_text="Internal notes (not visible to participant)"
                    ),
                ),
                (
                    "rejection_reason",
                    models.TextField(
                        blank=True, help_text="Reason for rejection (visible to participant)"
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("submitted_at", models.DateTimeField(blank=True, null=True)),
                ("approved_at", models.DateTimeField(blank=True, null=True)),
                ("ip_address", models.GenericIPAddressField(blank=True, null=True)),
                ("user_agent", models.TextField(blank=True)),
                (
                    "submission_duration",
                    models.IntegerField(
                        blank=True, help_text="Time taken to complete form (seconds)", null=True
                    ),
                ),
                (
                    "payment_verified_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="Admin who verified payment",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="form_verified_payments",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "team",
                    models.ForeignKey(
                        blank=True,
                        help_text="Team (if team tournament)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="form_tournament_registrations",
                        to="teams.team",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        help_text="User who submitted the registration",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="form_responses",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        help_text="Tournament this registration is for",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="form_responses",
                        to="tournaments.tournament",
                    ),
                ),
                (
                    "registration_form",
                    models.ForeignKey(
                        help_text="Form version used for this registration",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="responses",
                        to="tournaments.tournamentregistrationform",
                    ),
                ),
            ],
            options={
                "verbose_name": "Form Response",
                "verbose_name_plural": "Form Responses",
                "db_table": "tournaments_form_response",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="TournamentResult",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "is_deleted",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Flag indicating if this record has been soft-deleted",
                    ),
                ),
                (
                    "deleted_at",
                    models.DateTimeField(
                        blank=True, help_text="Timestamp when this record was deleted", null=True
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "determination_method",
                    models.CharField(
                        choices=[
                            ("normal", "Normal Bracket Resolution"),
                            ("tiebreaker", "Tie-Breaking Rules Applied"),
                            ("forfeit_chain", "Forfeit Chain Winner"),
                            ("manual", "Manual Organizer Selection"),
                        ],
                        default="normal",
                        help_text="Method used to determine winner",
                        max_length=20,
                    ),
                ),
                (
                    "rules_applied",
                    models.JSONField(
                        default=dict,
                        help_text="JSONB audit trail of determination logic. Contains ordered list of rules applied, intermediate scores, and reasoning for winner selection.",
                    ),
                ),
                (
                    "requires_review",
                    models.BooleanField(
                        default=False,
                        help_text="Flag indicating organizer review needed (e.g., forfeit chain, tie-breaking failures)",
                    ),
                ),
                (
                    "is_override",
                    models.BooleanField(
                        default=False,
                        help_text="Whether this placement was manually overridden by staff",
                    ),
                ),
                (
                    "override_reason",
                    models.TextField(
                        blank=True,
                        help_text="Reason for manual override (required if is_override=True)",
                    ),
                ),
                (
                    "override_timestamp",
                    models.DateTimeField(
                        blank=True, help_text="When the override was applied", null=True
                    ),
                ),
                (
                    "total_kills",
                    models.IntegerField(
                        default=0, help_text="Total kills across all matches (BR games)"
                    ),
                ),
                (
                    "best_placement",
                    models.IntegerField(
                        blank=True,
                        help_text="Best placement achieved (BR games, 1=1st place)",
                        null=True,
                    ),
                ),
                (
                    "avg_placement",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Average placement (BR games)",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "matches_played",
                    models.IntegerField(default=0, help_text="Number of matches played"),
                ),
                (
                    "series_score",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text='Series score breakdown. Example: {"team-123": 2, "team-456": 1} for Best-of-3',
                    ),
                ),
                (
                    "game_results",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text='Individual game results in series. Example: [{"match_id": 1, "winner_id": "team-123", "score": {...}}, ...]',
                    ),
                ),
                (
                    "created_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who triggered determination (or verified manually)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="created_tournament_results",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "deleted_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who deleted this record",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="%(class)s_deletions",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "final_bracket",
                    models.ForeignKey(
                        blank=True,
                        help_text="Bracket used for determination",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        to="tournaments.bracket",
                    ),
                ),
                (
                    "override_actor",
                    models.ForeignKey(
                        blank=True,
                        help_text="Staff member who performed the override",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="tournament_result_overrides",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "runner_up",
                    models.ForeignKey(
                        blank=True,
                        help_text="Second place participant",
                        null=True,
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="runner_up_tournaments",
                        to="tournaments.registration",
                    ),
                ),
                (
                    "third_place",
                    models.ForeignKey(
                        blank=True,
                        help_text="Third place participant (if applicable)",
                        null=True,
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="third_place_tournaments",
                        to="tournaments.registration",
                    ),
                ),
                (
                    "tournament",
                    models.OneToOneField(
                        help_text="Tournament this result belongs to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="result",
                        to="tournaments.tournament",
                    ),
                ),
                (
                    "winner",
                    models.ForeignKey(
                        help_text="Winner participant (Registration record)",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="won_tournaments",
                        to="tournaments.registration",
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament Result",
                "verbose_name_plural": "Tournament Results",
                "db_table": "tournament_engine_result_tournamentresult",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="TournamentStaffAssignment",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True, help_text="False if assignment has been revoked"
                    ),
                ),
                ("assigned_at", models.DateTimeField(auto_now_add=True)),
                (
                    "notes",
                    models.TextField(blank=True, help_text="Optional notes about this assignment"),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "assigned_by",
                    models.ForeignKey(
                        help_text="Organizer who made this assignment",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="epic73_staff_assignments_made",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "role",
                    models.ForeignKey(
                        help_text="Staff role assigned",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="assignments",
                        to="tournaments.staffrole",
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        help_text="Tournament this assignment belongs to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="epic73_staff_assignments",
                        to="tournaments.tournament",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        help_text="User assigned to staff role",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="epic73_tournament_staff_assignments",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament Staff Assignment",
                "verbose_name_plural": "Tournament Staff Assignments",
                "db_table": "tournament_staff_assignments",
                "ordering": ["-assigned_at"],
            },
        ),
        migrations.CreateModel(
            name="MatchRefereeAssignment",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "is_primary",
                    models.BooleanField(
                        default=True,
                        help_text="True for primary referee, False for backup/secondary",
                    ),
                ),
                ("assigned_at", models.DateTimeField(auto_now_add=True)),
                (
                    "notes",
                    models.TextField(
                        blank=True, help_text="Optional notes about this referee assignment"
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "assigned_by",
                    models.ForeignKey(
                        help_text="Organizer who assigned this referee",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="epic73_referee_assignments_made",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "match",
                    models.ForeignKey(
                        help_text="Match being refereed",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="epic73_referee_assignments",
                        to="tournaments.match",
                    ),
                ),
                (
                    "staff_assignment",
                    models.ForeignKey(
                        help_text="Staff assignment (must have referee role)",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="epic73_match_assignments",
                        to="tournaments.tournamentstaffassignment",
                    ),
                ),
            ],
            options={
                "verbose_name": "Match Referee Assignment",
                "verbose_name_plural": "Match Referee Assignments",
                "db_table": "match_referee_assignments",
                "ordering": ["-is_primary", "-assigned_at"],
            },
        ),
        migrations.CreateModel(
            name="TournamentStaffRole",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        help_text='Role name (e.g., "Participant Reviewer")',
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "slug",
                    models.SlugField(help_text="URL-safe identifier", max_length=60, unique=True),
                ),
                (
                    "description",
                    models.TextField(
                        help_text="Detailed description of this role and its responsibilities"
                    ),
                ),
                (
                    "can_review_participants",
                    models.BooleanField(
                        default=False,
                        help_text="Can review and approve/reject participant registrations",
                    ),
                ),
                (
                    "can_verify_payments",
                    models.BooleanField(
                        default=False,
                        help_text="Can verify payment proofs and mark payments as confirmed",
                    ),
                ),
                (
                    "can_manage_brackets",
                    models.BooleanField(
                        default=False, help_text="Can create, edit, and manage tournament brackets"
                    ),
                ),
                (
                    "can_manage_matches",
                    models.BooleanField(
                        default=False, help_text="Can schedule, reschedule, and configure matches"
                    ),
                ),
                (
                    "can_enter_scores",
                    models.BooleanField(
                        default=False, help_text="Can enter and verify match scores and results"
                    ),
                ),
                (
                    "can_handle_disputes",
                    models.BooleanField(
                        default=False, help_text="Can view, investigate, and resolve match disputes"
                    ),
                ),
                (
                    "can_send_notifications",
                    models.BooleanField(
                        default=False,
                        help_text="Can send notifications and announcements to participants",
                    ),
                ),
                (
                    "can_manage_social_media",
                    models.BooleanField(
                        default=False,
                        help_text="Can post updates and manage tournament social media",
                    ),
                ),
                (
                    "can_access_support",
                    models.BooleanField(
                        default=False,
                        help_text="Can access support tickets and communicate with participants",
                    ),
                ),
                (
                    "can_modify_tournament",
                    models.BooleanField(
                        default=False,
                        help_text="Can edit tournament settings and configuration (admin only)",
                    ),
                ),
                (
                    "can_view_pii",
                    models.BooleanField(
                        default=False,
                        help_text="Can view personally identifiable information (names, emails, phone numbers)",
                    ),
                ),
                (
                    "can_view_payment_proofs",
                    models.BooleanField(
                        default=False,
                        help_text="Can view uploaded payment proof images and bank details",
                    ),
                ),
                (
                    "can_export_data",
                    models.BooleanField(
                        default=False, help_text="Can export participant data to CSV/Excel"
                    ),
                ),
                (
                    "is_system_role",
                    models.BooleanField(
                        default=False,
                        help_text="System-defined role (cannot be deleted or significantly modified)",
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True, help_text="Whether this role is available for assignment"
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Tournament Staff Role",
                "verbose_name_plural": "Tournament Staff Roles",
                "db_table": "tournaments_staff_role",
                "ordering": ["name"],
                "indexes": [
                    models.Index(fields=["slug"], name="tournaments_slug_e11e8a_idx"),
                    models.Index(fields=["is_active"], name="tournaments_is_acti_880e08_idx"),
                ],
            },
        ),
        migrations.CreateModel(
            name="TournamentStaff",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        db_index=True,
                        default=True,
                        help_text="Whether this staff assignment is currently active",
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True,
                        help_text="Internal notes about this staff assignment (not visible to staff member)",
                    ),
                ),
                (
                    "assigned_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="When this staff member was assigned"
                    ),
                ),
                (
                    "deactivated_at",
                    models.DateTimeField(
                        blank=True, help_text="When this assignment was deactivated", null=True
                    ),
                ),
                (
                    "assigned_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="Organizer who assigned this staff member",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="staff_assignments_made",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "deactivated_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="Who deactivated this assignment",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="staff_assignments_deactivated",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        help_text="Tournament this staff member is assigned to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="staff_assignments",
                        to="tournaments.tournament",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        help_text="User assigned as staff",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="tournament_staff_roles",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "role",
                    models.ForeignKey(
                        help_text="Role and permissions for this staff member",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="staff_assignments",
                        to="tournaments.tournamentstaffrole",
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament Staff Assignment",
                "verbose_name_plural": "Tournament Staff Assignments",
                "db_table": "tournaments_staff_assignment",
                "ordering": ["tournament", "role__name", "user__username"],
            },
        ),
        migrations.CreateModel(
            name="TournamentStage",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="Timestamp when this record was created"
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="Timestamp when this record was last updated"
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        help_text='Name of this stage (e.g., "Group Stage", "Playoffs", "Grand Finals")',
                        max_length=100,
                        verbose_name="Stage Name",
                    ),
                ),
                (
                    "order",
                    models.PositiveIntegerField(
                        help_text="Sequential order of this stage (1 = first stage, 2 = second, etc.)",
                        validators=[django.core.validators.MinValueValidator(1)],
                        verbose_name="Order",
                    ),
                ),
                (
                    "format",
                    models.CharField(
                        choices=[
                            ("round_robin", "Round Robin"),
                            ("single_elim", "Single Elimination"),
                            ("double_elim", "Double Elimination"),
                            ("swiss", "Swiss System"),
                        ],
                        help_text="Tournament format for this stage",
                        max_length=20,
                        verbose_name="Format",
                    ),
                ),
                (
                    "start_date",
                    models.DateTimeField(
                        blank=True,
                        help_text="Scheduled start date/time for this stage",
                        null=True,
                        verbose_name="Start Date",
                    ),
                ),
                (
                    "end_date",
                    models.DateTimeField(
                        blank=True,
                        help_text="Scheduled or actual end date/time for this stage",
                        null=True,
                        verbose_name="End Date",
                    ),
                ),
                (
                    "advancement_count",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Number of participants advancing to next stage (0 = final stage)",
                        verbose_name="Advancement Count",
                    ),
                ),
                (
                    "advancement_criteria",
                    models.CharField(
                        choices=[
                            ("top_n", "Top N Overall"),
                            ("top_n_per_group", "Top N Per Group"),
                            ("all", "All Participants"),
                        ],
                        default="top_n",
                        help_text="How participants advance to next stage",
                        max_length=20,
                        verbose_name="Advancement Criteria",
                    ),
                ),
                (
                    "state",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("active", "Active"),
                            ("completed", "Completed"),
                        ],
                        default="pending",
                        help_text="Current state of this stage",
                        max_length=20,
                        verbose_name="State",
                    ),
                ),
                (
                    "config",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="JSON config: seeding_rules, tiebreakers, bracket_options",
                        verbose_name="Configuration",
                    ),
                ),
                (
                    "group_stage",
                    models.OneToOneField(
                        blank=True,
                        help_text="Link to GroupStage if this stage uses group format",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="tournament_stage",
                        to="tournaments.groupstage",
                        verbose_name="Group Stage",
                    ),
                ),
                (
                    "tournament",
                    models.ForeignKey(
                        help_text="Tournament this stage belongs to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="stages",
                        to="tournaments.tournament",
                        verbose_name="Tournament",
                    ),
                ),
            ],
            options={
                "verbose_name": "Tournament Stage",
                "verbose_name_plural": "Tournament Stages",
                "db_table": "tournament_stages",
                "ordering": ["tournament", "order"],
            },
        ),
        migrations.AddField(
            model_name="tournamentstaffassignment",
            name="stage",
            field=models.ForeignKey(
                blank=True,
                help_text="Optional: limit assignment to specific stage",
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="epic73_staff_assignments",
                to="tournaments.tournamentstage",
            ),
        ),
    ]
