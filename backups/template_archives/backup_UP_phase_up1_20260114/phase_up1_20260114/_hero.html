{% load static %}
{% load profile_tags %}

<!-- HERO HEADER -->
<header class="relative w-full h-[650px] mt-4 group/hero overflow-hidden">
    <!-- Background -->
    <div class="absolute inset-0 z-0">
        {% if profile.banner_url %}
        <img src="{{ profile.banner_url }}" class="w-full h-full object-cover opacity-60 group-hover/hero:opacity-100 transition duration-700" alt="Cover">
        {% else %}
        <div class="w-full h-full bg-gradient-to-br from-purple-900/20 to-cyan-900/20"></div>
        {% endif %}
        <div class="absolute inset-0 bg-gradient-to-t from-[var(--z-bg)] via-[var(--z-bg)]/90 to-transparent"></div>
        <div class="absolute inset-0 bg-gradient-to-r from-[var(--z-bg)] via-[var(--z-bg)]/80 to-transparent"></div>
    </div>

    <!-- Profile Content -->
    <div class="absolute bottom-0 left-0 w-full max-w-[1800px] mx-auto px-6 pb-12 z-20 flex flex-col xl:flex-row items-end justify-between gap-10">
        <div class="flex flex-col md:flex-row items-end gap-10 w-full">
            <!-- Avatar -->
            <div class="relative shrink-0 group/avatar mx-auto md:mx-0">
                <div class="w-48 h-48 md:w-56 md:h-56 relative flex items-center justify-center">
                    <div class="holo-ring"></div>
                    <img src="{{ profile.avatar_url|default:'/static/images/default-avatar.png' }}" class="holo-img w-full h-full object-cover shadow-2xl" alt="{{ profile.display_name }}" id="avatarPreview">

                    <!-- Online Status -->
                    <div class="absolute bottom-3 right-3 z-20 w-6 h-6 bg-[var(--z-bg)] rounded-full flex items-center justify-center border border-white/10" title="Online">
                        <div class="w-3 h-3 bg-[var(--z-green)] rounded-full animate-pulse shadow-[0_0_10px_var(--z-green)]"></div>
                    </div>
                </div>

                <!-- Verified Badge -->
                {% if profile.is_verified %}
                <div class="absolute -bottom-4 left-1/2 transform -translate-x-1/2 z-20 bg-white text-black px-4 py-1.5 rounded-full shadow-[0_0_20px_rgba(255,255,255,0.3)] flex items-center gap-2 uppercase tracking-wider font-bold text-[10px] border-2 border-[var(--z-bg)] whitespace-nowrap">
                    <i class="fa-solid fa-circle-check" style="color: var(--z-cyan);"></i> Verified Pro
                </div>
                {% endif %}
            </div>

            <!-- Profile Info -->
            <div class="mb-2 flex-1 text-center md:text-left w-full">
                <div class="flex flex-wrap items-center justify-center md:justify-start gap-4 mb-2">
                    <h1 class="text-6xl md:text-8xl font-display font-black text-white tracking-tighter leading-none drop-shadow-2xl">
                        {{ profile.display_name|upper }}
                    </h1>
                </div>

                <div class="flex flex-wrap items-center justify-center md:justify-start gap-3 mb-5">
                    <div class="px-3 py-1 bg-white/5 rounded-md border border-white/10 flex items-center gap-2 text-xs font-mono text-gray-300 hover:bg-white/10 transition cursor-pointer group/id">
                        <span>@{{ profile.username }}</span>
                        <i class="fa-regular fa-copy opacity-50 group-hover/id:opacity-100"></i>
                    </div>
                    <div class="px-3 py-1 bg-[var(--z-gold)]/10 rounded-md border border-[var(--z-gold)]/20 text-xs font-bold text-[var(--z-gold)] uppercase tracking-wider flex items-center gap-2">
                        <i class="fa-solid fa-star"></i> Level {{ profile.level|default:1 }}
                    </div>
                    {% if user_teams %}
                    <div class="px-3 py-1 bg-[var(--z-purple)]/10 rounded-md border border-[var(--z-purple)]/20 text-xs font-bold text-[var(--z-purple)] uppercase tracking-wider">
                        {{ user_teams.0.name }}
                    </div>
                    {% endif %}
                </div>

                <p class="text-gray-300 text-lg font-light max-w-2xl leading-relaxed mb-4 mx-auto md:mx-0">
                    {{ profile.bio|default:"Building the future of South Asian Esports." }}
                </p>
                
                {% if is_owner %}
                <div class="mb-8 max-w-2xl mx-auto md:mx-0">
                    <a href="{% url 'user_profile:profile_settings' %}" class="inline-flex items-center gap-2 text-xs text-[var(--z-cyan)] hover:text-white transition group">
                        <i class="fa-solid fa-gear group-hover:rotate-90 transition-transform"></i>
                        <span>To edit your profile, go to Settings</span>
                        <i class="fa-solid fa-arrow-right opacity-0 group-hover:opacity-100 transition"></i>
                    </a>
                </div>
                {% endif %}

                <!-- Stats Bar -->
                <div class="z-card p-4 inline-flex flex-wrap items-center justify-center md:justify-start gap-8 bg-black/40 backdrop-blur-md border-white/5">
                    <div class="text-center md:text-left group cursor-pointer" onclick="openFollowersModal()">
                        {% if privacy.show_followers_count or is_owner %}
                        <div class="text-2xl font-display font-bold text-white group-hover:text-[var(--z-cyan)] transition">{{ follower_count|default:0|floatformat:"-1" }}{% if follower_count > 1000 %}K{% endif %}</div>
                        {% else %}
                        <div class="text-2xl font-display font-bold text-gray-500"><i class="fa-solid fa-lock text-sm"></i></div>
                        {% endif %}
                        <div class="text-[10px] text-gray-500 uppercase tracking-[0.2em] font-bold">Followers</div>
                    </div>
                    <div class="w-px h-8 bg-white/10 hidden md:block"></div>
                    <div class="text-center md:text-left group cursor-pointer" onclick="openFollowingModal()">
                        {% if privacy.show_following_count or is_owner %}
                        <div class="text-2xl font-display font-bold text-white group-hover:text-[var(--z-purple)] transition">{{ following_count|default:0 }}</div>
                        {% else %}
                        <div class="text-2xl font-display font-bold text-gray-500"><i class="fa-solid fa-lock text-sm"></i></div>
                        {% endif %}
                        <div class="text-[10px] text-gray-500 uppercase tracking-[0.2em] font-bold">Following</div>
                    </div>
                    <div class="w-px h-8 bg-white/10 hidden md:block"></div>
                    <div class="text-center md:text-left group cursor-pointer">
                        <div class="text-2xl font-display font-bold text-[var(--z-gold)]">{{ user_teams|length|default:0 }}</div>
                        <div class="text-[10px] text-gray-500 uppercase tracking-[0.2em] font-bold">Teams</div>
                    </div>
                    
                    {% if reputation %}
                    <div class="w-px h-8 bg-white/10 hidden md:block"></div>
                    <div class="text-center md:text-left group cursor-pointer" title="Reputation Score: {{ reputation.reputation_score }}/100">
                        <div class="text-2xl font-display font-bold {% if reputation.reputation_tier == 'Legend' %}text-[var(--z-gold)]{% elif reputation.reputation_tier == 'Veteran' %}text-[var(--z-cyan)]{% elif reputation.reputation_tier == 'Rising Star' %}text-[var(--z-purple)]{% else %}text-gray-400{% endif %}">
                            {{ reputation.reputation_score }}
                        </div>
                        <div class="text-[10px] text-gray-500 uppercase tracking-[0.2em] font-bold">
                            {% if reputation.reputation_tier == 'Legend' %}üèÜ Legend
                            {% elif reputation.reputation_tier == 'Veteran' %}‚≠ê Veteran
                            {% elif reputation.reputation_tier == 'Rising Star' %}‚ú® Rising Star
                            {% else %}üå± Rookie
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="w-px h-8 bg-white/10 hidden md:block"></div>

                    <!-- Social Links -->
                    <div class="flex gap-2">
                        {% if social_links %}
                            {% for link in social_links %}
                                <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer" 
                                   class="w-10 h-10 rounded-lg bg-white/5 hover:bg-blue-500 hover:text-white text-gray-400 flex items-center justify-center transition transform hover:-translate-y-1"
                                   title="{{ link.get_platform_display }}">
                                    <i class="fa-brands fa-{{ link.platform }} text-lg"></i>
                                </a>
                            {% endfor %}
                        {% endif %}
                        {% if is_owner %}
                        <button onclick="openSocialLinksModal()" class="w-10 h-10 rounded-lg border border-white/10 text-gray-500 hover:text-white hover:border-white transition flex items-center justify-center" title="Edit Social Links">
                            <i class="fa-solid fa-pen text-sm"></i>
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row items-center gap-3 w-full xl:w-auto justify-center xl:justify-end">
            {% if not is_owner %}
            <button class="w-full sm:w-auto px-8 py-4 bg-white text-black font-display font-black text-sm uppercase tracking-widest rounded-xl hover:bg-[var(--z-cyan)] transition shadow-[0_0_20px_rgba(255,255,255,0.2)] flex items-center justify-center gap-2 transform hover:-translate-y-1 group">
                <i class="fa-solid fa-bolt text-[var(--z-gold)] group-hover:text-black transition"></i> Scout Player
            </button>
            <div class="flex gap-3 w-full sm:w-auto">
                <button class="flex-1 sm:flex-none px-6 py-4 bg-white/5 border border-white/10 rounded-xl text-white font-bold uppercase tracking-wider text-xs hover:bg-white/10 transition flex items-center justify-center gap-2 backdrop-blur-md">
                    <i class="fa-solid fa-user-plus text-[var(--z-cyan)]"></i> {% if is_following %}Following{% else %}Follow{% endif %}
                </button>
                <button class="px-5 py-4 bg-white/5 border border-white/10 rounded-xl text-white hover:bg-white/10 transition flex items-center justify-center backdrop-blur-md">
                    <i class="fa-regular fa-envelope text-lg"></i>
                </button>
                <button class="px-5 py-4 bg-white/5 border border-white/10 rounded-xl text-white hover:bg-white/10 transition flex items-center justify-center backdrop-blur-md">
                    <i class="fa-solid fa-ellipsis text-lg"></i>
                </button>
            </div>
            {% else %}
            <a href="{% url 'user_profile:profile_settings' %}" class="w-full sm:w-auto px-8 py-4 bg-white/5 border border-white/10 rounded-xl text-white font-bold uppercase tracking-wider text-xs hover:bg-white/10 transition flex items-center justify-center gap-2 backdrop-blur-md">
                <i class="fa-solid fa-cog"></i> Edit Profile
            </a>
            {% endif %}
        </div>
    </div>
</header>
