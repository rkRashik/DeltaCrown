{% load static %}

<!-- 
PHASE 4C: Redesigned Overview Dashboard
- Modern hierarchy with primary/secondary content
- Profile completeness widget
- Preview cards (max 2 items each) with navigation
- No duplicates (About is primary, sidebar has mini-cards)
- Empty states with CTAs
-->

<!-- OVERVIEW TAB (Dashboard Summary) -->
<div id="tab-overview" class="tab-content active space-y-8" data-tab-panel="overview">
    
    <!-- Top Row: Profile Completeness Widget -->
    {% if is_owner %}
    <div class="z-card p-6 bg-gradient-to-r from-[var(--z-cyan)]/10 to-transparent border-[var(--z-cyan)]/20">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="w-16 h-16 rounded-full bg-[var(--z-cyan)]/20 flex items-center justify-center">
                    <div class="relative w-12 h-12">
                        <svg class="transform -rotate-90" viewBox="0 0 36 36">
                            <circle cx="18" cy="18" r="16" fill="none" stroke="currentColor" stroke-width="3" class="text-white/10"></circle>
                            <circle cx="18" cy="18" r="16" fill="none" stroke="currentColor" stroke-width="3" stroke-dasharray="{{ profile_completeness }}, 100" stroke-linecap="round" class="text-[var(--z-cyan)]"></circle>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white">{{ profile_completeness }}%</div>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white mb-1">Profile Completeness</h3>
                    <p class="text-sm text-gray-400">{{ profile_completeness_filled }} of {{ profile_completeness_total }} fields complete</p>
                </div>
            </div>
            {% if profile_completeness < 100 %}
            <a href="/me/settings/" class="px-6 py-3 bg-[var(--z-cyan)] hover:bg-white text-black font-bold text-sm rounded-xl transition flex items-center gap-2">
                <i class="fa-solid fa-plus-circle"></i> Complete Profile
            </a>
            {% else %}
            <div class="flex items-center gap-2 text-[var(--z-green)]">
                <i class="fa-solid fa-check-circle text-2xl"></i>
                <span class="font-bold">Complete!</span>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <!-- Primary Content: About Section -->
    {% include 'user_profile/profile/_about_section.html' %}
    
    <!-- Secondary Content: Preview Cards Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        
        <!-- Teams Preview -->
        <div role="button" tabindex="0" data-tab-button="career" class="z-card p-6 cursor-pointer hover:border-[var(--z-cyan)]/50 transition-all transform hover:-translate-y-1 group">
            <div class="flex items-start justify-between mb-4">
                <div class="w-12 h-12 rounded-xl bg-[var(--z-cyan)]/10 flex items-center justify-center text-[var(--z-cyan)] text-2xl group-hover:scale-110 transition">
                    <i class="fa-solid fa-users"></i>
                </div>
                <i class="fa-solid fa-arrow-right text-gray-600 group-hover:text-[var(--z-cyan)] transition"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2 group-hover:text-[var(--z-cyan)] transition">Teams</h3>
            {% if user_teams %}
                <p class="text-sm text-gray-400 mb-3">Active on <span class="text-white font-bold">{{ user_teams|length }}</span> team{{ user_teams|length|pluralize }}</p>
                <div class="space-y-2">
                    {% for team in user_teams|slice:":2" %}
                    <div class="flex items-center gap-2 p-2 rounded-lg bg-white/[0.02] border border-white/5">
                        {% if team.logo_url %}
                        <img src="{{ team.logo_url }}" alt="{{ team.name }}" class="w-8 h-8 rounded object-cover">
                        {% else %}
                        <div class="w-8 h-8 rounded bg-[var(--z-purple)]/20 flex items-center justify-center text-[var(--z-purple)] text-xs font-bold">{{ team.tag|default:team.name|slice:":2"|upper }}</div>
                        {% endif %}
                        <div class="flex-1 min-w-0">
                            <div class="text-xs font-bold text-white truncate">{{ team.name }}</div>
                            <div class="text-[10px] text-gray-500 truncate">{{ team.role }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% if user_teams|length > 2 %}
                <p class="text-xs text-[var(--z-cyan)] mt-3 font-semibold">+ {{ user_teams|length|add:"-2" }} more</p>
                {% endif %}
            {% elif is_owner %}
                <div class="text-center py-6 border-2 border-dashed border-white/10 rounded-lg">
                    <i class="fa-solid fa-users-slash text-2xl text-gray-600 mb-2"></i>
                    <p class="text-xs text-gray-500 mb-3">Not on any teams yet</p>
                    <a href="/teams/" class="text-xs text-[var(--z-cyan)] hover:text-white transition font-semibold">Browse Teams â†’</a>
                </div>
            {% else %}
                <p class="text-sm text-gray-500">No team history</p>
            {% endif %}
        </div>
        
        <!-- Game IDs Preview -->
        <div role="button" tabindex="0" data-tab-button="career" class="z-card p-6 cursor-pointer hover:border-[var(--z-gold)]/50 transition-all transform hover:-translate-y-1 group">
            <div class="flex items-start justify-between mb-4">
                <div class="w-12 h-12 rounded-xl bg-[var(--z-gold)]/10 flex items-center justify-center text-[var(--z-gold)] text-2xl group-hover:scale-110 transition">
                    <i class="fa-solid fa-id-card"></i>
                </div>
                <i class="fa-solid fa-arrow-right text-gray-600 group-hover:text-[var(--z-gold)] transition"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2 group-hover:text-[var(--z-gold)] transition">Game IDs</h3>
            {% if pinned_passports or unpinned_passports %}
                {% with all_passports=pinned_passports|add:unpinned_passports %}
                <p class="text-sm text-gray-400 mb-3"><span class="text-white font-bold">{{ all_passports|length }}</span> game{{ all_passports|length|pluralize }} linked</p>
                <div class="space-y-2">
                    {% for passport in all_passports|slice:":2" %}
                    <div class="flex items-center gap-2 p-2 rounded-lg bg-white/[0.02] border border-white/5">
                        <div class="w-8 h-8 rounded bg-[var(--z-purple)]/20 flex items-center justify-center text-xs font-bold text-[var(--z-purple)]">{{ passport.game|upper|slice:":2" }}</div>
                        <div class="flex-1 min-w-0">
                            <div class="text-xs font-bold text-white truncate">{{ passport.in_game_name|default:"Not set" }}</div>
                            <div class="text-[10px] text-gray-500 truncate">{{ passport.game|upper }}</div>
                        </div>
                        {% if passport.is_pinned %}
                        <i class="fa-solid fa-star text-[var(--z-gold)] text-xs"></i>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% if all_passports|length > 2 %}
                <p class="text-xs text-[var(--z-gold)] mt-3 font-semibold">+ {{ all_passports|length|add:"-2" }} more</p>
                {% endif %}
                {% endwith %}
            {% elif is_owner %}
                <div class="text-center py-6 border-2 border-dashed border-white/10 rounded-lg">
                    <i class="fa-solid fa-gamepad text-2xl text-gray-600 mb-2"></i>
                    <p class="text-xs text-gray-500 mb-3">No game IDs added yet</p>
                    <a href="/me/settings/#game-ids" class="text-xs text-[var(--z-gold)] hover:text-white transition font-semibold">Add Game IDs â†’</a>
                </div>
            {% else %}
                <p class="text-sm text-gray-500">No game IDs added</p>
            {% endif %}
        </div>
        
        <!-- Loadout Preview -->
        <div role="button" tabindex="0" data-tab-button="loadout" class="z-card p-6 cursor-pointer hover:border-[var(--z-green)]/50 transition-all transform hover:-translate-y-1 group">
            <div class="flex items-start justify-between mb-4">
                <div class="w-12 h-12 rounded-xl bg-[var(--z-green)]/10 flex items-center justify-center text-[var(--z-green)] text-2xl group-hover:scale-110 transition">
                    <i class="fa-solid fa-computer-mouse"></i>
                </div>
                <i class="fa-solid fa-arrow-right text-gray-600 group-hover:text-[var(--z-green)] transition"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2 group-hover:text-[var(--z-green)] transition">Hardware Loadout</h3>
            {% if hardware_loadout.is_complete %}
                <p class="text-sm text-gray-400 mb-3">Gear configured</p>
                <div class="space-y-2 text-xs">
                    {% if hardware_loadout.mouse_brand %}
                    <div class="flex items-center gap-2 text-gray-400">
                        <i class="fa-solid fa-computer-mouse text-[var(--z-green)] w-4"></i>
                        <span class="text-white font-semibold truncate">{{ hardware_loadout.mouse_brand|truncatechars:20 }}</span>
                    </div>
                    {% endif %}
                    {% if hardware_loadout.keyboard_brand %}
                    <div class="flex items-center gap-2 text-gray-400">
                        <i class="fa-solid fa-keyboard text-[var(--z-green)] w-4"></i>
                        <span class="text-white font-semibold truncate">{{ hardware_loadout.keyboard_brand|truncatechars:20 }}</span>
                    </div>
                    {% endif %}
                </div>
            {% elif is_owner %}
                <div class="text-center py-6 border-2 border-dashed border-white/10 rounded-lg">
                    <i class="fa-solid fa-mouse text-2xl text-gray-600 mb-2"></i>
                    <p class="text-xs text-gray-500 mb-3">No hardware configured</p>
                    <a href="/me/settings/#loadout" class="text-xs text-[var(--z-green)] hover:text-white transition font-semibold">Add Loadout â†’</a>
                </div>
            {% else %}
                <p class="text-sm text-gray-500">No hardware configured</p>
            {% endif %}
        </div>
        
        <!-- Stats Preview -->
        <div role="button" tabindex="0" data-tab-button="stats" class="z-card p-6 cursor-pointer hover:border-[var(--z-purple)]/50 transition-all transform hover:-translate-y-1 group">
            <div class="flex items-start justify-between mb-4">
                <div class="w-12 h-12 rounded-xl bg-[var(--z-purple)]/10 flex items-center justify-center text-[var(--z-purple)] text-2xl group-hover:scale-110 transition">
                    <i class="fa-solid fa-chart-line"></i>
                </div>
                <i class="fa-solid fa-arrow-right text-gray-600 group-hover:text-[var(--z-purple)] transition"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2 group-hover:text-[var(--z-purple)] transition">Stats</h3>
            <div class="grid grid-cols-2 gap-3 text-sm">
                <div>
                    <div class="text-2xl font-bold text-[var(--z-green)]">{{ user_stats.total_wins|default:0 }}</div>
                    <div class="text-xs text-gray-500">Wins</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-white">{{ user_stats.win_rate|default:0 }}%</div>
                    <div class="text-xs text-gray-500">Win Rate</div>
                </div>
            </div>
        </div>
        
        <!-- Highlights Preview -->
        <div role="button" tabindex="0" data-tab-button="highlights" class="z-card p-6 cursor-pointer hover:border-[var(--z-red)]/50 transition-all transform hover:-translate-y-1 group">
            <div class="flex items-start justify-between mb-4">
                <div class="w-12 h-12 rounded-xl bg-[var(--z-red)]/10 flex items-center justify-center text-[var(--z-red)] text-2xl group-hover:scale-110 transition">
                    <i class="fa-solid fa-video"></i>
                </div>
                <i class="fa-solid fa-arrow-right text-gray-600 group-hover:text-[var(--z-red)] transition"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2 group-hover:text-[var(--z-red)] transition">Highlights</h3>
            {% if highlight_clips %}
                <p class="text-sm text-gray-400 mb-3"><span class="text-white font-bold">{{ highlight_clips|length }}</span> clip{{ highlight_clips|length|pluralize }} uploaded</p>
                <div class="aspect-video rounded-lg overflow-hidden bg-black/30 border border-white/5 hover:border-[var(--z-red)]/50 transition group/thumb cursor-pointer" onclick="openVideoModal('{{ highlight_clips.0.embed_url|escapejs }}', '{{ highlight_clips.0.title|escapejs }}', '{{ highlight_clips.0.url|escapejs }}')">
                    {% if highlight_clips.0.thumbnail_url %}
                    <img src="{{ highlight_clips.0.thumbnail_url }}" class="w-full h-full object-cover opacity-60 group-hover/thumb:opacity-100 transition" alt="{{ highlight_clips.0.title }}">
                    {% else %}
                    <div class="w-full h-full flex items-center justify-center">
                        <i class="fa-solid fa-play text-3xl text-[var(--z-red)]/30"></i>
                    </div>
                    {% endif %}
                    <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover/thumb:opacity-100 transition">
                        <div class="w-10 h-10 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
                            <i class="fa-solid fa-play text-white"></i>
                        </div>
                    </div>
                </div>
            {% elif is_owner %}
                <div class="text-center py-6 border-2 border-dashed border-white/10 rounded-lg">
                    <i class="fa-solid fa-video-slash text-2xl text-gray-600 mb-2"></i>
                    <p class="text-xs text-gray-500 mb-3">No highlights yet</p>
                    <button type="button" data-tab-button="highlights" class="text-xs text-[var(--z-red)] hover:text-white transition font-semibold">Upload Highlights â†’</button>
                </div>
            {% else %}
                <p class="text-sm text-gray-500">No highlights uploaded</p>
            {% endif %}
        </div>
        
        <!-- Bounties Preview -->
        <div role="button" tabindex="0" data-tab-button="bounties" class="z-card p-6 cursor-pointer hover:border-[var(--z-pink)]/50 transition-all transform hover:-translate-y-1 group">
            <div class="flex items-start justify-between mb-4">
                <div class="w-12 h-12 rounded-xl bg-[var(--z-pink)]/10 flex items-center justify-center text-[var(--z-pink)] text-2xl group-hover:scale-110 transition">
                    <i class="fa-solid fa-crosshairs"></i>
                </div>
                <i class="fa-solid fa-arrow-right text-gray-600 group-hover:text-[var(--z-pink)] transition"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2 group-hover:text-[var(--z-pink)] transition">Bounties</h3>
            {% if bounties.stats.open_count or bounties.stats.in_progress_count %}
                <div class="grid grid-cols-2 gap-3 text-sm">
                    <div>
                        <div class="text-2xl font-bold text-[var(--z-gold)]">{{ bounties.stats.open_count|default:0 }}</div>
                        <div class="text-xs text-gray-500">Open</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-[var(--z-cyan)]">{{ bounties.stats.in_progress_count|default:0 }}</div>
                        <div class="text-xs text-gray-500">Active</div>
                    </div>
                </div>
            {% elif is_owner %}
                <div class="text-center py-6 border-2 border-dashed border-white/10 rounded-lg">
                    <i class="fa-solid fa-bullseye text-2xl text-gray-600 mb-2"></i>
                    <p class="text-xs text-gray-500 mb-3">No bounties yet</p>
                    <button type="button" data-tab-button="bounties" class="text-xs text-[var(--z-pink)] hover:text-white transition font-semibold">Create Bounty â†’</button>
                </div>
            {% else %}
                <p class="text-sm text-gray-500">No active bounties</p>
            {% endif %}
        </div>
        
    </div>
    
    <!-- Completely Empty State (Owner Only, New Profile) -->
    {% if is_owner and not user_teams and not pinned_passports and not unpinned_passports and not hardware_loadout.is_complete and not highlight_clips and profile_completeness < 50 %}
    <div class="z-card p-12 border-2 border-dashed border-white/10 bg-gradient-to-br from-[var(--z-cyan)]/5 to-transparent text-center space-y-6">
        <div class="text-6xl">ðŸš€</div>
        <div class="space-y-2">
            <h3 class="text-2xl font-display font-bold text-white">Welcome to Your Esports Profile!</h3>
            <p class="text-gray-400 max-w-xl mx-auto">
                Your profile is your esports identity. Complete your About section, add game IDs, join teams, and showcase your highlights to stand out in the community.
            </p>
        </div>
        <div class="flex flex-wrap justify-center gap-4">
            <a href="/me/settings/" class="px-6 py-3 bg-[var(--z-cyan)] hover:bg-white text-black font-bold text-sm rounded-xl transition">
                <i class="fa-solid fa-user-plus mr-2"></i> Complete Profile
            </a>
            <a href="/teams/" class="px-6 py-3 bg-white/5 hover:bg-white/10 border border-white/10 text-white font-bold text-sm rounded-xl transition">
                <i class="fa-solid fa-users mr-2"></i> Browse Teams
            </a>
        </div>
    </div>
    {% endif %}
</div>
