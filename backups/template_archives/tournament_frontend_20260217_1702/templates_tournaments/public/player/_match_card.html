{% load static %}
{# Match card for player matches view - shows opponent, tournament, time, and score #}
<article class="glass p-4 rounded-xl hover:bg-white/5 transition-colors">
  <div class="flex items-center justify-between gap-4">
    <!-- Match Info -->
    <div class="flex-1 min-w-0">
      <!-- Tournament Name & Game -->
      <div class="flex items-center gap-2 mb-2">
        <a href="{% url 'tournaments:detail' match.tournament.slug %}" class="text-sm font-medium link-nav hover:text-primary transition truncate">
          {{ match.tournament.name }}
        </a>
        {% if match.tournament.game %}
          <span class="text-xs px-2 py-0.5 rounded bg-primary/10 text-primary flex-shrink-0">
            {{ match.tournament.game.name }}
          </span>
        {% endif %}
      </div>

      <!-- Match Details -->
      <div class="flex items-center gap-4 text-sm">
        <!-- Round Info -->
        <div class="flex items-center gap-2">
          <i class="fas fa-layer-group text-muted"></i>
          <span class="text-muted">Round {{ match.round_number }}</span>
          <span class="text-muted/50">•</span>
          <span class="text-muted">Match {{ match.match_number }}</span>
        </div>

        <!-- Scheduled Time -->
        {% if match.scheduled_time %}
          <div class="flex items-center gap-2">
            <i class="fas fa-clock text-muted"></i>
            <span class="text-muted">{{ match.scheduled_time|date:"M d, g:i A" }}</span>
          </div>
        {% endif %}
      </div>

      <!-- Participants -->
      <div class="mt-3 flex items-center justify-between">
        <div class="flex-1 min-w-0">
          <!-- Participant 1 -->
          <div class="flex items-center gap-2 mb-1">
            <span class="font-medium {% if match.participant1_id == user.id %}text-accent{% else %}text-white{% endif %} truncate">
              {{ match.participant1_name|default:"TBD" }}
            </span>
            {% if match.participant1_id == user.id %}
              <span class="text-xs px-2 py-0.5 rounded-full bg-accent/20 text-accent flex-shrink-0">You</span>
            {% endif %}
          </div>
          
          <!-- VS Divider -->
          <div class="text-xs text-muted/50 my-1">vs</div>
          
          <!-- Participant 2 -->
          <div class="flex items-center gap-2">
            <span class="font-medium {% if match.participant2_id == user.id %}text-accent{% else %}text-white{% endif %} truncate">
              {{ match.participant2_name|default:"TBD" }}
            </span>
            {% if match.participant2_id == user.id %}
              <span class="text-xs px-2 py-0.5 rounded-full bg-accent/20 text-accent flex-shrink-0">You</span>
            {% endif %}
          </div>
        </div>

        <!-- Score (if completed) -->
        {% if match.state == 'completed' or match.state == 'forfeit' %}
          <div class="text-right ml-4">
            <div class="text-lg font-bold {% if match.winner_id == user.id %}text-green-400{% elif match.loser_id == user.id %}text-red-400{% else %}text-white{% endif %}">
              {{ match.participant1_score }}
            </div>
            <div class="text-xs text-muted my-1">—</div>
            <div class="text-lg font-bold {% if match.winner_id == user.id %}text-green-400{% elif match.loser_id == user.id %}text-red-400{% else %}text-white{% endif %}">
              {{ match.participant2_score }}
            </div>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Match Status & Actions -->
    <div class="flex-shrink-0 flex flex-col items-end gap-2">
      <!-- Status Badge -->
      <span class="px-3 py-1 rounded-full text-xs font-semibold
        {% if match.state == 'live' or match.state == 'pending_result' %}bg-red-600/20 text-red-400 animate-pulse
        {% elif match.state == 'completed' %}
          {% if match.winner_id == user.id %}bg-green-600/20 text-green-400
          {% elif match.loser_id == user.id %}bg-red-600/20 text-red-400
          {% else %}bg-gray-600/20 text-gray-400{% endif %}
        {% elif match.state == 'forfeit' %}bg-orange-600/20 text-orange-400
        {% elif match.state == 'check_in' %}bg-yellow-600/20 text-yellow-400
        {% elif match.state == 'ready' %}bg-blue-600/20 text-blue-400
        {% else %}bg-gray-600/20 text-gray-400{% endif %}">
        {% if match.state == 'scheduled' %}Scheduled
        {% elif match.state == 'check_in' %}Check-in
        {% elif match.state == 'ready' %}Ready
        {% elif match.state == 'live' %}Live
        {% elif match.state == 'pending_result' %}Pending
        {% elif match.state == 'completed' %}
          {% if match.winner_id == user.id %}Won
          {% elif match.loser_id == user.id %}Lost
          {% else %}Completed{% endif %}
        {% elif match.state == 'forfeit' %}Forfeit
        {% elif match.state == 'disputed' %}Disputed
        {% elif match.state == 'cancelled' %}Cancelled
        {% else %}{{ match.get_state_display }}{% endif %}
      </span>

      <!-- Action Button -->
      {% if match.state == 'live' or match.state == 'pending_result' %}
        {% comment %}
        <!-- Future: Match lobby/detail page -->
        <button class="btn-sm btn-primary" disabled title="Match details coming soon">
          <i class="fas fa-gamepad mr-1"></i>
          Join
        </button>
        {% endcomment %}
      {% elif match.state == 'check_in' %}
        {% comment %}
        <!-- Future: Check-in functionality -->
        <button class="btn-sm bg-yellow-600 hover:bg-yellow-700 text-white" disabled title="Check-in coming soon">
          <i class="fas fa-check mr-1"></i>
          Check In
        </button>
        {% endcomment %}
      {% endif %}
    </div>
  </div>

  <!-- Match Additional Info (if live) -->
  {% if match.state == 'live' and match.lobby_info %}
    <div class="mt-3 p-2 rounded-lg bg-primary/5 border border-primary/20">
      <p class="text-xs text-muted mb-1">Lobby Info</p>
      {% if match.lobby_info.lobby_code %}
        <p class="text-sm font-mono">Code: <span class="text-accent">{{ match.lobby_info.lobby_code }}</span></p>
      {% endif %}
      {% if match.lobby_info.map %}
        <p class="text-sm">Map: {{ match.lobby_info.map }}</p>
      {% endif %}
    </div>
  {% endif %}
</article>
