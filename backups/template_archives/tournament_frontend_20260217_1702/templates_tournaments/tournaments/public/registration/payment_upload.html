{% extends "base.html" %}
{% load static %}

{% block title %}Upload Payment Proof - {{ tournament.name }} | DeltaCrown{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-3xl">
  <!-- Header -->
  <div class="mb-8">
    <a href="{% url 'tournaments:detail' slug=tournament.slug %}" class="text-body-secondary hover:text-primary mb-4 inline-block">
      <i class="fas fa-arrow-left mr-2"></i> Back to Tournament
    </a>
    <h1 class="text-3xl font-bold mb-2">Upload Payment Proof</h1>
    <p class="text-body-secondary">{{ tournament.name }}</p>
  </div>

  <div class="bg-surface border border-line rounded-xl p-6 md:p-8">
    <!-- Entry Fee Display -->
    <div class="bg-primary/10 border border-primary rounded-lg p-6 mb-8">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-body-secondary mb-1">Entry Fee</p>
          <p class="text-3xl font-bold text-primary">à§³{{ entry_fee|floatformat:0 }}</p>
        </div>
        <i class="fas fa-receipt text-primary text-4xl opacity-20"></i>
      </div>
    </div>

    <!-- Upload Form -->
    <form method="POST" enctype="multipart/form-data" id="uploadForm">
      {% csrf_token %}
      
      <!-- Payment Proof Upload -->
      <div class="mb-6">
        <label for="payment_proof" class="block text-sm font-semibold mb-2">
          Payment Screenshot/Receipt
          <span class="text-danger">*</span>
        </label>
        <div class="relative">
          <input 
            type="file" 
            name="payment_proof" 
            id="payment_proof"
            accept="image/jpeg,image/jpg,image/png,application/pdf"
            required
            class="block w-full text-sm text-body-secondary file:mr-4 file:py-3 file:px-4 file:rounded-lg file:border-0 file:bg-primary file:text-white file:font-semibold hover:file:bg-primary-hover cursor-pointer border border-line rounded-lg bg-surface"
          >
        </div>
        <p class="text-xs text-body-secondary mt-2">
          <i class="fas fa-info-circle mr-1"></i>
          Accepted formats: JPG, PNG, PDF (max 5MB)
        </p>
        
        <!-- File Preview -->
        <div id="filePreview" class="hidden mt-4 p-4 bg-surface-hover rounded-lg border border-line">
          <div class="flex items-center gap-3">
            <i class="fas fa-file-image text-primary text-2xl"></i>
            <div class="flex-1">
              <p class="font-semibold" id="fileName"></p>
              <p class="text-xs text-body-secondary" id="fileSize"></p>
            </div>
            <button type="button" onclick="clearFile()" class="text-danger hover:text-danger-hover">
              <i class="fas fa-times-circle text-xl"></i>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Transaction ID -->
      <div class="mb-6">
        <label for="reference_number" class="block text-sm font-semibold mb-2">
          Transaction ID / Reference Number
          <span class="text-danger">*</span>
        </label>
        <input 
          type="text" 
          name="reference_number" 
          id="reference_number"
          required
          class="w-full px-4 py-3 bg-surface border border-line rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
          placeholder="e.g., BKH1234567890"
        >
        <p class="text-xs text-body-secondary mt-2">
          <i class="fas fa-info-circle mr-1"></i>
          Enter the transaction ID from your payment receipt
        </p>
      </div>
      
      <!-- Additional Notes -->
      <div class="mb-8">
        <label for="notes" class="block text-sm font-semibold mb-2">
          Additional Notes (Optional)
        </label>
        <textarea 
          name="notes" 
          id="notes"
          rows="3"
          class="w-full px-4 py-3 bg-surface border border-line rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
          placeholder="Any additional information about your payment..."
        ></textarea>
      </div>

      <!-- Instructions -->
      <div class="bg-primary/5 border border-primary/20 rounded-lg p-4 mb-8">
        <div class="flex items-start gap-3">
          <i class="fas fa-lightbulb text-primary text-xl mt-0.5"></i>
          <div class="text-sm">
            <p class="font-semibold mb-2">Tips for faster verification:</p>
            <ul class="list-disc list-inside text-body-secondary space-y-1">
              <li>Ensure the screenshot is clear and all details are visible</li>
              <li>Include the full transaction ID in the screenshot</li>
              <li>Make sure the amount matches the entry fee exactly</li>
              <li>Upload immediately after making the payment</li>
            </ul>
          </div>
        </div>
      </div>
      
      <!-- Submit Button -->
      <button 
        type="submit" 
        class="w-full py-4 bg-primary text-white rounded-lg font-semibold hover:bg-primary-hover transition-colors flex items-center justify-center gap-2"
      >
        <i class="fas fa-upload"></i>
        Submit Payment Proof
      </button>
    </form>

    <!-- Verification Timeline -->
    <div class="mt-8 pt-8 border-t border-line">
      <div class="flex items-start gap-3">
        <i class="fas fa-clock text-primary text-xl mt-0.5"></i>
        <div class="text-sm">
          <p class="font-semibold mb-1">Verification Timeline</p>
          <p class="text-body-secondary">
            We'll verify your payment within <strong>1-6 hours</strong> (up to 24 hours on weekends). 
            You'll receive an email notification once your payment is verified and your registration is confirmed.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// File upload preview
document.getElementById('payment_proof').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const preview = document.getElementById('filePreview');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    
    fileName.textContent = file.name;
    fileSize.textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';
    preview.classList.remove('hidden');
    
    // Validate file size
    if (file.size > 5 * 1024 * 1024) {
      alert('File size must be less than 5MB');
      clearFile();
    }
  }
});

function clearFile() {
  document.getElementById('payment_proof').value = '';
  document.getElementById('filePreview').classList.add('hidden');
}

// Form submission
document.getElementById('uploadForm').addEventListener('submit', function(e) {
  const submitBtn = this.querySelector('button[type="submit"]');
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Uploading...';
});
</script>
{% endblock %}
