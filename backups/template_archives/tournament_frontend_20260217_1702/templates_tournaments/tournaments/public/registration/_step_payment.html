<!-- Step 4: Payment Information -->
<div class="payment-info">
  {% if fee_waived %}
    <!-- Fee Waived Message -->
    <div class="bg-success/10 border border-success rounded-lg p-6 mb-6">
      <div class="flex items-start gap-4">
        <div class="w-16 h-16 bg-success/20 rounded-full flex items-center justify-center flex-shrink-0">
          <i class="fas fa-gift text-success text-3xl"></i>
        </div>
        <div class="flex-1">
          <h3 class="text-2xl font-bold text-success mb-2">
            <i class="fas fa-check-circle mr-2"></i>
            Entry Fee Waived!
          </h3>
          <p class="text-body mb-3">{{ waive_reason }}</p>
          <div class="bg-surface rounded-lg p-3 inline-block">
            <p class="text-sm text-body-secondary mb-1">Original Entry Fee</p>
            <p class="text-xl font-bold line-through text-body-secondary">à§³{{ original_fee|floatformat:0 }}</p>
          </div>
        </div>
      </div>
    </div>
    
    <input type="hidden" name="fee_waived" value="true">
    
    <div class="bg-primary/5 border border-primary/20 rounded-lg p-4">
      <p class="text-sm text-body-secondary">
        <i class="fas fa-info-circle text-primary mr-2"></i>
        Your registration will be confirmed immediately after you complete this step.
      </p>
    </div>
  {% else %}
    <!-- Regular Payment -->
    <div class="bg-primary/10 border border-primary rounded-lg p-6 mb-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-body-secondary mb-1">Entry Fee</p>
          <p class="text-3xl font-bold text-primary">à§³{{ tournament.entry_fee_amount|floatformat:0 }}</p>
        </div>
        <i class="fas fa-coins text-primary text-4xl opacity-20"></i>
      </div>
    </div>

    <div class="mb-6">
      <h3 class="font-semibold mb-4">Select Payment Method</h3>
    
    <div class="space-y-4">
      <!-- DeltaCoin Payment Option -->
      <label class="payment-method-card cursor-pointer block {% if 'deltacoin' == selected_payment_method %}selected{% endif %} {% if not deltacoin_can_afford %}opacity-60{% endif %}">
        <div class="border-2 {% if deltacoin_can_afford %}border-line hover:border-primary{% else %}border-line{% endif %} rounded-lg p-4 transition-all {% if deltacoin_can_afford %}bg-gradient-to-br from-yellow-500/5 to-orange-500/5{% else %}bg-surface{% endif %}">
          <input 
            type="radio" 
            name="payment_method" 
            value="deltacoin"
            {% if 'deltacoin' == selected_payment_method %}checked{% endif %}
            {% if not deltacoin_can_afford %}disabled{% endif %}
            class="sr-only"
            required
          >
          
          <div class="flex items-start gap-4">
            <div class="w-16 h-16 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-lg flex items-center justify-center flex-shrink-0 shadow-lg">
              <span class="text-3xl">ðŸª™</span>
            </div>
            
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <span class="font-semibold text-lg">DeltaCoin</span>
                <span class="bg-success/20 text-success text-xs font-bold px-2 py-1 rounded-full">
                  <i class="fas fa-bolt mr-1"></i>Instant
                </span>
                {% if deltacoin_can_afford %}
                <span class="bg-primary/20 text-primary text-xs font-bold px-2 py-1 rounded-full">
                  <i class="fas fa-check-circle mr-1"></i>Available
                </span>
                {% else %}
                <span class="bg-danger/20 text-danger text-xs font-bold px-2 py-1 rounded-full">
                  <i class="fas fa-exclamation-circle mr-1"></i>Insufficient
                </span>
                {% endif %}
              </div>
              
              <p class="text-sm text-body-secondary mb-3">
                Instant verification - payment deducted from your DeltaCoin balance
              </p>
              
              <!-- Balance Display -->
              <div class="bg-surface/80 backdrop-blur rounded-lg p-3 border border-line">
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <p class="text-xs text-body-secondary mb-1">Your Balance</p>
                    <p class="font-mono font-bold {% if deltacoin_can_afford %}text-success{% else %}text-danger{% endif %} text-lg">
                      {{ deltacoin_balance }} DC
                    </p>
                  </div>
                  <div>
                    <p class="text-xs text-body-secondary mb-1">Entry Fee</p>
                    <p class="font-mono font-bold text-primary text-lg">
                      {{ tournament.entry_fee_amount|floatformat:0 }} DC
                    </p>
                  </div>
                </div>
                
                {% if not deltacoin_can_afford %}
                <div class="mt-3 pt-3 border-t border-line">
                  <div class="flex items-center justify-between">
                    <span class="text-xs text-body-secondary">Need</span>
                    <span class="font-bold text-danger">{{ deltacoin_shortfall }} DC more</span>
                  </div>
                  <a href="{% url 'economy:wallet' %}" class="mt-2 inline-flex items-center text-xs text-primary hover:text-primary-hover font-semibold">
                    <i class="fas fa-plus-circle mr-1"></i>
                    Get DeltaCoin
                  </a>
                </div>
                {% endif %}
              </div>
              
              {% if deltacoin_can_afford %}
              <div class="mt-3 flex items-center gap-2 text-xs">
                <span class="bg-green-500/10 text-green-400 px-2 py-1 rounded flex items-center gap-1">
                  <i class="fas fa-bolt"></i> Instant
                </span>
                <span class="bg-blue-500/10 text-blue-400 px-2 py-1 rounded flex items-center gap-1">
                  <i class="fas fa-shield-alt"></i> Secure
                </span>
                <span class="bg-purple-500/10 text-purple-400 px-2 py-1 rounded flex items-center gap-1">
                  <i class="fas fa-check-double"></i> Auto-Verified
                </span>
              </div>
              {% endif %}
            </div>
            
            <div class="check-mark hidden">
              <i class="fas fa-check-circle text-primary text-2xl"></i>
            </div>
          </div>
        </div>
      </label>
      
      <!-- Other Payment Methods -->
      {% for method in payment_methods %}
        <label class="payment-method-card cursor-pointer block {% if method.value == selected_payment_method %}selected{% endif %}">
          <div class="border-2 border-line rounded-lg p-4 hover:border-primary transition-all">
            <input 
              type="radio" 
              name="payment_method" 
              value="{{ method.value }}"
              {% if method.value == selected_payment_method %}checked{% endif %}
              class="sr-only"
              required
            >
            
            <div class="flex items-start gap-4">
              <div class="w-16 h-16 bg-surface rounded-lg flex items-center justify-center flex-shrink-0">
                {% if method.logo %}
                  <img src="{% static method.logo %}" alt="{{ method.label }}" class="w-12 h-12 object-contain">
                {% else %}
                  <i class="fas fa-wallet text-primary text-2xl"></i>
                {% endif %}
              </div>
              
              <div class="flex-1">
                <span class="font-semibold text-lg block mb-2">{{ method.label }}</span>
                
                {% if method.account %}
                <div class="bg-surface-hover rounded px-3 py-2 mb-2">
                  <p class="text-xs text-body-secondary mb-1">Account Details</p>
                  <p class="font-mono font-semibold">{{ method.account }}</p>
                </div>
                {% endif %}
                
                {% if method.instructions %}
                <p class="text-sm text-body-secondary">{{ method.instructions }}</p>
                {% endif %}
              </div>
              
              <div class="check-mark hidden">
                <i class="fas fa-check-circle text-primary text-2xl"></i>
              </div>
            </div>
          </div>
        </label>
      {% endfor %}
    </div>
  </div>

    <!-- Payment Instructions -->
    <div class="bg-surface-hover border border-line rounded-lg p-4">
      <div class="flex items-start gap-3">
        <i class="fas fa-info-circle text-primary mt-1"></i>
        <div class="text-sm space-y-2">
          <p class="font-semibold">Payment Process</p>
          <ul class="list-disc list-inside text-body-secondary space-y-1">
            <li><strong>DeltaCoin:</strong> Instant payment and confirmation</li>
            <li><strong>Manual Methods:</strong> Upload payment proof for verification (1-6 hours)</li>
            <li>You'll receive email confirmation once payment is verified</li>
          </ul>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Refund Policy -->
  <div class="mt-4 text-sm text-body-secondary">
    <p>
      <i class="fas fa-exclamation-circle mr-1"></i>
      <strong>Refund Policy:</strong> Entry fees are non-refundable unless the tournament is cancelled by the organizer.
    </p>
  </div>
</div>

<style>
.payment-method-card.selected > div {
  border-color: var(--color-primary);
  background: var(--color-primary-hover);
}

.payment-method-card.selected .check-mark {
  display: block;
}
</style>
