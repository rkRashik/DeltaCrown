{# Usage with a bound Django field:
  {% include "components/form_field.html" with field=form.name help="Shown publicly" %}
#}
{% with fid=field.id_for_label|default:field.auto_id %}
{% with help_id=fid|add:"-help" error_id=fid|add:"-error" %}
<div class="form-field">
  {% if field.label %}
    <label class="label" for="{{ fid }}">{{ field.label }}</label>
  {% endif %}

  {# Add accessibility attributes defensively #}
  {% if field.errors %}
    {% if field.field.widget.attrs %}
      {% with _=field.field.widget.attrs.update({"aria-invalid":"true","aria-describedby":error_id}) %}{% endwith %}
    {% endif %}
  {% elif field.help_text or help %}
    {% if field.field.widget.attrs and not field.field.widget.attrs.aria_describedby %}
      {% with _=field.field.widget.attrs.update({"aria-describedby":help_id}) %}{% endwith %}
    {% endif %}
  {% endif %}

  {{ field }}

  {% if field.help_text or help %}
    <div id="{{ help_id }}" class="help">{{ help|default:field.help_text }}</div>
  {% endif %}

  {% if field.errors %}
    <div id="{{ error_id }}" class="error" role="alert">
      {% for e in field.errors %}{{ e }}{% if not forloop.last %}<br/>{% endif %}{% endfor %}
    </div>
  {% endif %}
</div>
{% endwith %}
{% endwith %}
