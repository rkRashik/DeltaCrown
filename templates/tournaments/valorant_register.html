{% extends "base.html" %}
{% load static %}

{% block title %}Valorant Tournament Registration - {{ title }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'siteui/css/tokens.css' %}">
<link rel="stylesheet" href="{% static 'siteui/css/valorant-tournament.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;600;700;900&display=swap" rel="stylesheet">

{% endblock %}

{% block content %}
<div class="valorant-container">
    {% if messages %}
        {% for message in messages %}
            <div class="mb-6 p-4 rounded-lg {% if message.tags == 'error' %}error-message{% elif message.tags == 'success' %}bg-green-500/10 text-green-300 border border-green-500/30{% else %}info-note{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    {# Check registration status #}
    {% if already_registered %}
        <div class="bg-green-500/10 border border-green-500/30 p-6 rounded-lg text-center mb-6">
            <h2 class="text-2xl font-bold text-green-400 mb-2">‚úì Already Registered</h2>
            <p class="text-green-300">Your team is already registered for this tournament.</p>
        </div>
    {% elif pending_request %}
        <div class="bg-yellow-500/10 border border-yellow-500/30 p-6 rounded-lg text-center mb-6">
            <h2 class="text-2xl font-bold text-yellow-400 mb-2">‚è≥ Request Pending</h2>
            <p class="text-yellow-300">You've requested your team captain to register for this tournament.</p>
            <p class="text-yellow-200 text-sm mt-2">Waiting for captain approval...</p>
        </div>
    {% elif user_team and not is_captain %}
        <div class="bg-blue-500/10 border border-blue-500/30 p-6 rounded-lg mb-6">
            <h2 class="text-2xl font-bold text-blue-400 mb-3">üéÆ Request Team Registration</h2>
            <p class="text-blue-300 mb-4">You're not the captain of {{ user_team.name }}. Request your captain to register for this tournament.</p>
            
            <form method="post" class="space-y-4">
                {% csrf_token %}
                <input type="hidden" name="action" value="request_approval">
                
                <div class="form-group">
                    <label class="form-label">Message to Captain (Optional)</label>
                    <textarea name="request_message" rows="3" class="form-input" 
                              placeholder="Add a message for your captain..."></textarea>
                </div>
                
                <button type="submit" class="submit-button w-full">
                    üì® Send Registration Request to Captain
                </button>
            </form>
        </div>
    {% endif %}

    <!-- Header Section -->
    <div class="valorant-header">
        <h1 class="valorant-title glow-text">Valorant Tournament</h1>
        <h2 class="valorant-subtitle">{{ title }}</h2>
        
        <div class="tournament-info-banner">
            <div class="flex items-center justify-center gap-6">
                <div class="text-center">
                    <div class="font-orbitron text-lg font-bold text-valorant-red">Entry Fee</div>
                    <div class="text-2xl font-bold">{% if entry_fee %}‡ß≥{{ entry_fee }}{% else %}FREE{% endif %}</div>
                </div>
                <div class="text-center">
                    <div class="font-orbitron text-lg font-bold text-valorant-red">Format</div>
                    <div class="text-2xl font-bold">5v5 Team Tournament</div>
                </div>
                <div class="text-center">
                    <div class="font-orbitron text-lg font-bold text-valorant-red">Region</div>
                    <div class="text-2xl font-bold">Bangladesh</div>
                </div>
            </div>
        </div>
    </div>

    {# Only show registration form for captains or users without a team #}
    {% if not already_registered and not pending_request %}
        {% if not user_team or is_captain %}
    <!-- Registration Form -->
    <form method="post" enctype="multipart/form-data" class="form-container">
        {% csrf_token %}
        
        <!-- Honeypot -->
        <input type="text" name="website" style="display:none;" tabindex="-1" autocomplete="off">

        <!-- Section 1: Team Information -->
        <div class="form-section">
            <div class="section-header">
                <div class="section-number">1</div>
                <h3 class="section-title">Team Information</h3>
            </div>
            
            {% if user_team %}
                <div class="info-note mb-4 bg-green-500/5 border-green-500/20">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-valorant-red">üéÆ</span>
                        <strong>Using Existing Team: {{ user_team.name }}</strong>
                    </div>
                    <div class="text-sm text-gray-300">
                        Registering with your saved team. Team details are locked to maintain consistency.
                        {% if team_members %}
                        <br><strong class="text-white">Team Members ({{ team_members|length }}):</strong> 
                        {% for member in team_members %}{{ member.name }}{% if not forloop.last %}, {% endif %}{% endfor %}
                        {% endif %}
                    </div>
                </div>
                <input type="hidden" name="use_existing_team" value="true">
                <input type="hidden" name="team_id" value="{{ user_team.id }}">
            {% else %}
                <div class="info-note mb-4 bg-blue-500/5 border-blue-500/20">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-valorant-red">‚ûï</span>
                        <strong>Create New Team</strong>
                    </div>
                    <div class="text-sm text-gray-300">
                        Create a new team for this tournament. You'll become the team captain automatically.
                    </div>
                </div>
            {% endif %}
            
            <div class="form-grid form-grid-2">
                <div class="form-group">
                    <label class="form-label">
                        Team Name <span class="required">*</span>
                    </label>
                    <input type="text" name="team_name" class="form-input" 
                           value="{% if user_team %}{{ user_team.name }}{% endif %}"
                           placeholder="Enter your team's official name" required
                           {% if user_team %}readonly title="Team name is locked for existing teams"{% endif %}>
                    {% if not user_team %}
                    <div class="info-note">
                        Choose a unique, memorable name. This will represent your team in the tournament.
                    </div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        Team Tag <span class="text-gray-400">(Optional)</span>
                    </label>
                    <input type="text" name="team_tag" class="form-input" 
                           value="{% if user_team %}{{ user_team.tag|default:'' }}{% endif %}"
                           placeholder="e.g., NGA, VLR" maxlength="5"
                           {% if user_team %}readonly title="Team tag is locked for existing teams"{% endif %}>
                    {% if not user_team %}
                    <div class="info-note">
                        Short abbreviation (max 5 characters) - e.g., "FIRE", "VLR", "PRO"
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Team Logo <span class="text-gray-400">(Optional)</span></label>
                <div class="file-upload-zone">
                    <input type="file" name="team_logo" accept="image/*" style="display: none;" id="team-logo-input"
                           {% if user_team %}disabled title="Logo cannot be changed during registration"{% endif %}>
                    <label for="team-logo-input" class="cursor-pointer">
                        {% if user_team and user_team.logo %}
                            <img src="{{ user_team.logo.url }}" alt="Current team logo" class="max-h-16 mb-2 mx-auto">
                            <div class="font-medium text-gray-400">Team logo (locked)</div>
                        {% elif user_team %}
                            <div class="text-gray-400 text-2xl mb-2">üéÆ</div>
                            <div class="font-medium text-gray-400">No logo set</div>
                        {% else %}
                            <div class="text-valorant-red text-2xl mb-2">üìÅ</div>
                            <div class="font-medium">Click to upload team logo</div>
                            <div class="text-sm text-gray-400 mt-1">PNG, JPG up to 5MB (Recommended: 512x512px)</div>
                        {% endif %}
                    </label>
                </div>
            </div>
            
            {% if not user_team %}
                <div class="checkbox-group">
                    <input type="checkbox" name="save_team" class="checkbox-input" id="save-team-check" checked>
                    <label for="save-team-check" class="text-sm cursor-pointer">
                        <span class="font-medium text-valorant-light">üíæ Save this team to my profile</span>
                        <div class="text-gray-400 mt-1">
                            Recommended: Creates a permanent team for future tournaments and easier management.
                        </div>
                    </label>
                </div>
            {% endif %}
        </div>

        <!-- Section 2: Team Captain Information -->
        <div class="form-section">
            <div class="section-header">
                <div class="section-number">2</div>
                <h3 class="section-title">Team Captain Information (You)</h3>
            </div>
            
            <div class="info-note mb-4 bg-valorant-red/5 border-valorant-red/20">
                <strong>‚ö° Auto-filled from your profile</strong> - You are registering as the team captain.
                <div class="text-sm text-gray-300 mt-1">
                    Verify your details below. Update your profile settings to change default values for future registrations.
                </div>
            </div>

            <div class="form-grid form-grid-2">
                <div class="form-group">
                    <label class="form-label">
                        Full Name <span class="required">*</span>
                    </label>
              <input type="text" name="captain_full_name" class="form-input" 
                  placeholder="Enter captain's full name" required
                  value="{{ prefill.full_name|default:'' }}">
                  <div class="text-xs text-gray-400 mt-1">Your official name for tournament records</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        Email Address <span class="required">*</span>
                    </label>
              <input type="email" name="captain_email" class="form-input" 
                  placeholder="captain@example.com" required
                  value="{{ prefill.email|default:'' }}" {% if lock_email %}readonly{% endif %}>
                  <div class="text-xs text-gray-400 mt-1">
                      {% if lock_email %}üîí Email locked - used for registration confirmation and updates{% else %}Primary contact email{% endif %}
                  </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="captain_riot_id">
                        Riot ID & Tagline <span class="required">*</span>
                    </label>
              <input type="text" 
                           name="captain_riot_id" 
                           id="captain_riot_id"
                           class="form-input" 
                           placeholder="PlayerName#TAG" 
                           required
                           pattern="^[a-zA-Z0-9\s]{3,16}#[a-zA-Z0-9]{3,5}$"
                           title="Must be in format: Username#TAG (e.g., PlayerName#NA1)"
                           aria-describedby="riot-id-help riot-id-error">
              <script>document.addEventListener('DOMContentLoaded',function(){var f=document.getElementById('captain_riot_id');if(f&&'{{ prefill.riot_id|default:'' }}'){f.value='{{ prefill.riot_id|escapejs }}';}});</script>
                    <div class="info-note" id="riot-id-help">
                        Format: <strong>Username#TAG</strong> - Exactly as shown in Valorant (e.g., Phoenix#NA1)
                    </div>
                    <div class="validation-error" id="riot-id-error" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="captain_discord">
                        Discord ID <span class="required">*</span>
                    </label>
              <input type="text" 
                           name="captain_discord" 
                           id="captain_discord"
                           class="form-input" 
                           placeholder="username or username#1234" 
                           required
                           title="Discord username (new format) or legacy format with #1234"
                           aria-describedby="discord-help discord-error">
              <script>document.addEventListener('DOMContentLoaded',function(){var f=document.getElementById('captain_discord');if(f&&'{{ prefill.discord_id|default:'' }}'){f.value='{{ prefill.discord_id|escapejs }}';}});</script>
                    <div class="info-note" id="discord-help">
                        New format: <strong>username</strong> or Legacy: <strong>Username#1234</strong> - For team communications
                    </div>
                    <div class="validation-error" id="discord-error" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        Phone Number <span class="text-gray-400">(Optional but recommended)</span>
                    </label>
                    <input type="tel" name="captain_phone" class="form-input" 
                           placeholder="+880 1XXX-XXXXXX"
                           pattern="^[\+]?[0-9\s\-\(\)]{10,}$">
                    <div class="text-xs text-gray-400 mt-1">For urgent tournament notifications (SMS)</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        Country <span class="required">*</span>
                    </label>
                    <select name="captain_country" class="form-input form-select" required>
                        <option value="">Select Country</option>
                        <option value="BD">Bangladesh</option>
                        <option value="IN">India</option>
                        <option value="PK">Pakistan</option>
                        <option value="LK">Sri Lanka</option>
                        <option value="NP">Nepal</option>
                        <option value="OTHER">Other</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Section 3: Player Roster -->
        <div class="form-section">
            <div class="section-header">
                <div class="section-number">3</div>
                <h3 class="section-title">Player Roster (5 Main + 2 Subs)</h3>
            </div>
            
            <div class="info-note mb-4 bg-purple-500/5 border-purple-500/20">
                <strong>üìã Roster Requirements:</strong>
                <ul class="text-sm text-gray-300 mt-2 ml-4 space-y-1">
                    <li>‚úì <strong>Player 1</strong> is automatically you (captain)</li>
                    <li>‚úì Minimum <strong>2 players</strong> required (you + 1 teammate)</li>
                    <li>‚úì Maximum <strong>7 players</strong> allowed (5 main + 2 substitutes)</li>
                    <li>‚úì All Riot IDs must be valid and unique</li>
                </ul>
            </div>

            <div class="player-roster" id="player-roster">
                <!-- Player 1 (Captain) - Auto-populated -->
                <div class="player-card captain-card" id="captain-card">
                    <div class="player-card-header">
                        <div class="flex items-center gap-3">
                            <span class="player-role-badge bg-valorant-red">üëë Captain</span>
                            <span class="font-medium text-lg">Player 1 - YOU (Team Captain)</span>
                        </div>
                        <span class="text-sm text-green-400">‚úì Auto-filled</span>
                    </div>
                    
                    <div class="form-grid form-grid-3">
                        <div class="form-group">
                            <label class="form-label">Full Name <span class="required">*</span></label>
                            <input type="text" name="player_1_name" class="form-input bg-gray-800/50" required readonly value="{{ prefill.full_name|default:'' }}" title="Automatically copied from captain info">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Riot ID <span class="required">*</span></label>
                            <input type="text" name="player_1_riot_id" class="form-input bg-gray-800/50" required readonly value="{{ prefill.riot_id|default:'' }}" title="Automatically copied from captain info">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Discord ID <span class="required">*</span></label>
                            <input type="text" name="player_1_discord" class="form-input bg-gray-800/50" required readonly value="{{ prefill.discord_id|default:'' }}" title="Automatically copied from captain info">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email <span class="required">*</span></label>
                            <input type="email" name="player_1_email" class="form-input" required value="{{ prefill.email|default:'' }}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone <span class="text-gray-400">(Optional)</span></label>
                            <input type="tel" name="player_1_phone" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Country <span class="required">*</span></label>
                            <select name="player_1_country" class="form-input form-select" required>
                                <option value="">Select Country</option>
                                <option value="BD">Bangladesh</option>
                                <option value="IN">India</option>
                                <option value="PK">Pakistan</option>
                                <option value="LK">Sri Lanka</option>
                                <option value="NP">Nepal</option>
                                <option value="OTHER">Other</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Player 2 -->
                <div class="player-card">
                    <div class="player-card-header">
                        <div class="flex items-center gap-3">
                            <span class="player-role-badge">Main</span>
                            <span class="font-medium">Player 2</span>
                        </div>
                        <button type="button" onclick="removePlayer(this)" class="text-red-400 hover:text-red-300">
                            ‚úï
                        </button>
                    </div>
                    
                    <div class="form-grid form-grid-3">
                        <div class="form-group">
                            <label class="form-label">Full Name <span class="required">*</span></label>
                            <input type="text" name="player_2_name" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Riot ID & Tagline <span class="required">*</span></label>
                            <input type="text" name="player_2_riot_id" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Discord ID <span class="required">*</span></label>
                            <input type="text" name="player_2_discord" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email <span class="required">*</span></label>
                            <input type="email" name="player_2_email" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone <span class="text-gray-400">(Optional)</span></label>
                            <input type="tel" name="player_2_phone" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Country <span class="required">*</span></label>
                            <select name="player_2_country" class="form-input form-select" required>
                                <option value="">Select Country</option>
                                <option value="BD">Bangladesh</option>
                                <option value="IN">India</option>
                                <option value="PK">Pakistan</option>
                                <option value="LK">Sri Lanka</option>
                                <option value="NP">Nepal</option>
                                <option value="OTHER">Other</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Players 3, 4, 5 would follow the same pattern -->
                <!-- I'll add JavaScript to dynamically generate these -->
            </div>

            <button type="button" class="add-player-btn" onclick="addPlayer()">
                <span>‚ûï</span> Add Another Player
            </button>
        </div>

        <!-- Section 4: Tournament Rules & Agreement -->
        {% if tournament_rules.has_rules %}
        <div class="form-section">
            <div class="section-header">
                <div class="section-number">4</div>
                <h3 class="section-title">Tournament Rules & Agreement</h3>
            </div>
            
            <div class="rules-section">
                {% if tournament_rules.rules_pdf_url %}
                    <div class="mb-4">
                        <a href="{{ tournament_rules.rules_pdf_url }}" target="_blank" class="rules-link">
                            üìÑ Download Tournament Rules PDF
                        </a>
                    </div>
                {% endif %}

                {% if tournament_rules.rules_text %}
                    <div class="mb-4">
                        <h5 class="font-medium text-valorant-light mb-2">Tournament Rules:</h5>
                        <div class="text-sm text-gray-300 prose prose-sm max-w-none">
                            {{ tournament_rules.rules_text|safe }}
                        </div>
                    </div>
                {% endif %}

                {% if tournament_rules.extra_rules %}
                    <div class="mb-4">
                        <h5 class="font-medium text-valorant-light mb-2">Additional Rules:</h5>
                        <div class="text-sm text-gray-300 prose prose-sm max-w-none">
                            {{ tournament_rules.extra_rules|safe }}
                        </div>
                    </div>
                {% endif %}
            </div>

            <div class="checkbox-group">
                <input type="checkbox" name="agree_rules" class="checkbox-input" required>
                <label class="text-sm">
                    <span class="font-medium text-valorant-light">I acknowledge that I have read and agree to the tournament's rules and conditions.</span>
                    <div class="text-gray-400 mt-1">
                        By checking this box, you confirm that you and all team members will abide by the tournament rules and regulations.
                    </div>
                </label>
            </div>
        </div>
        {% endif %}

        <!-- Section 5: Anti-Cheat & Verification -->
        <div class="form-section">
            <div class="section-header">
                <div class="section-number">5</div>
                <h3 class="section-title">Anti-Cheat & Account Verification</h3>
            </div>
            
            <div class="info-note mb-4">
                Some tournaments require secondary account details for anti-cheat verification. Please provide if requested by tournament organizers.
            </div>

            <div class="checkbox-group">
                <input type="checkbox" name="agree_anticheat" class="checkbox-input" required>
                <label class="text-sm">
                    <span class="font-medium text-valorant-light">I agree to anti-cheat measures and account verification if required.</span>
                    <div class="text-gray-400 mt-1">
                        This includes providing secondary account information and allowing organizers to verify player accounts.
                    </div>
                </label>
            </div>
        </div>

        <!-- Section 6: Payment Information -->
        {% if entry_fee %}
        <div class="form-section">
            <div class="section-header">
                <div class="section-number">6</div>
                <h3 class="section-title">Payment Information</h3>
            </div>
            
            <div class="tournament-info-banner mb-4">
                <div class="text-center">
                    <div class="font-orbitron text-lg font-bold text-valorant-red mb-2">Entry Fee Required</div>
                    <div class="text-2xl font-bold">‡ß≥{{ entry_fee }}</div>
                    <div class="text-sm text-gray-300 mt-2">Payment verification will be done manually by organizers</div>
                </div>
            </div>

            <div class="form-grid form-grid-2">
                <div class="form-group">
                    <label class="form-label">Payment Method <span class="required">*</span></label>
                    <select name="payment_method" class="form-input form-select" required>
                        <option value="">Select Payment Method</option>
                        {% if payment_config.bkash %}
                            <option value="bkash">bKash - {{ payment_config.bkash }}</option>
                        {% endif %}
                        {% if payment_config.nagad %}
                            <option value="nagad">Nagad - {{ payment_config.nagad }}</option>
                        {% endif %}
                        {% if payment_config.rocket %}
                            <option value="rocket">Rocket - {{ payment_config.rocket }}</option>
                        {% endif %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Your Account Number <span class="required">*</span></label>
                    <input type="text" name="payer_account_number" class="form-input" 
                           placeholder="Account number used for payment" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Transaction ID <span class="required">*</span></label>
                    <input type="text" name="payment_reference" class="form-input" 
                           placeholder="Enter transaction ID/reference" required minlength="6">
                </div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" name="agree_payment" class="checkbox-input" required>
                <label class="text-sm">
                    <span class="font-medium text-valorant-light">I agree to pay the entry fee of ‡ß≥{{ entry_fee }}.</span>
                    <div class="text-gray-400 mt-1">
                        Payment verification will be completed after registration. You'll receive confirmation within 24 hours.
                    </div>
                </label>
            </div>
        </div>
        {% endif %}

        <!-- Section 7: Privacy & Communication -->
        <div class="form-section">
            <div class="section-header">
                <div class="section-number">{% if entry_fee %}7{% else %}6{% endif %}</div>
                <h3 class="section-title">Privacy & Communication</h3>
            </div>

            <div class="space-y-4">
                <div class="checkbox-group">
                    <input type="checkbox" name="agree_visibility" class="checkbox-input" required>
                    <label class="text-sm">
                        <span class="font-medium text-valorant-light">I agree that my Riot ID and team information will be visible to other participants.</span>
                    </label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" name="agree_communication" class="checkbox-input" required>
                    <label class="text-sm">
                        <span class="font-medium text-valorant-light">I consent to receive communications regarding match details and tournament updates.</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Submit Section -->
        <div class="submit-section">
            <div class="checkbox-group mb-6">
                <input type="checkbox" name="confirm_accuracy" class="checkbox-input" required>
                <label class="text-sm">
                    <span class="font-medium text-white">I confirm that all provided information is accurate and complete.</span>
                    <div class="text-gray-200 mt-1">
                        Incorrect information may lead to disqualification. Please double-check all details before submitting.
                    </div>
                </label>
            </div>

            <button type="submit" class="submit-button">
                Submit Registration
            </button>
            
            <div class="text-sm text-gray-200 mt-4">
                After submission, you can update your registration details in your dashboard before the tournament begins.
            </div>
        </div>
    </form>
        {% endif %}
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'siteui/js/valorant-tournament.js' %}"></script>
<script>
// Load existing team member data if available
document.addEventListener('DOMContentLoaded', function() {
    // Load existing team member data if available
    {% if team_members %}
        const teamMembers = {{ team_members|safe }};
        
        console.log('Auto-filling team members:', teamMembers);
        
        // Populate existing team members
        teamMembers.forEach((member, index) => {
            if (index === 0) {
                // Captain (Player 1) - populate captain section
                if (member.name) {
                    const captainInput = document.querySelector('input[name="captain_full_name"]');
                    if (captainInput && !captainInput.value) captainInput.value = member.name;
                }
                if (member.email) {
                    const emailInput = document.querySelector('input[name="captain_email"]');
                    if (emailInput && !emailInput.value) emailInput.value = member.email;
                }
                if (member.riot_id) {
                    const riotInput = document.querySelector('input[name="captain_riot_id"]');
                    if (riotInput && !riotInput.value) riotInput.value = member.riot_id;
                }
                if (member.discord_id) {
                    const discordInput = document.querySelector('input[name="captain_discord"]');
                    if (discordInput && !discordInput.value) discordInput.value = member.discord_id;
                }
                if (member.phone) {
                    const phoneInput = document.querySelector('input[name="captain_phone"]');
                    if (phoneInput && !phoneInput.value) phoneInput.value = member.phone;
                }
                if (member.country) {
                    const countryInput = document.querySelector('select[name="captain_country"]');
                    if (countryInput) countryInput.value = member.country;
                }
            } else if (index < 7) {
                // Other players (2-7)
                const playerNum = index + 1;
                
                // Create player card if it doesn't exist (if addPlayer function is available)
                if (!document.querySelector(`input[name="player_${playerNum}_name"]`) && typeof addPlayer === 'function') {
                    addPlayer();
                }
                
                // Populate player data
                if (member.name) {
                    const nameInput = document.querySelector(`input[name="player_${playerNum}_name"]`);
                    if (nameInput && !nameInput.value) nameInput.value = member.name;
                }
                if (member.riot_id) {
                    const riotInput = document.querySelector(`input[name="player_${playerNum}_riot_id"]`);
                    if (riotInput && !riotInput.value) riotInput.value = member.riot_id;
                }
                if (member.discord_id) {
                    const discordInput = document.querySelector(`input[name="player_${playerNum}_discord"]`);
                    if (discordInput && !discordInput.value) discordInput.value = member.discord_id;
                }
                if (member.email) {
                    const emailInput = document.querySelector(`input[name="player_${playerNum}_email"]`);
                    if (emailInput && !emailInput.value) emailInput.value = member.email;
                }
                if (member.phone) {
                    const phoneInput = document.querySelector(`input[name="player_${playerNum}_phone"]`);
                    if (phoneInput && !phoneInput.value) phoneInput.value = member.phone;
                }
                if (member.country) {
                    const countryInput = document.querySelector(`select[name="player_${playerNum}_country"]`);
                    if (countryInput) countryInput.value = member.country;
                }
            }
        });
        
        console.log(`Auto-filled ${teamMembers.length} team members`);
    {% endif %}
});
</script>
{% endblock %}