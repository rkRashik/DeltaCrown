{% extends "base.html" %}
{% load static tournament_dict_utils %}

{% block title %}Play. Win. Be Seen — Tournaments | DeltaCrown{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'siteui/css/tokens.css' %}">
<link rel="stylesheet" href="{% static 'siteui/css/tournaments.css' %}">
{# Filter Orb CSS/JS will be added in later steps; the markup still works progressively. #}
{% endblock %}

{% block content %}
<section class="dc-container">

  {# ---------------- HERO ---------------- #}
  <header class="hero-2025" id="top">
    <div class="hero-bg">
      <div class="hero-noise"></div>
      <div class="hero-grid"></div>
      <div class="hero-glow hero-glow-a"></div>
      <div class="hero-glow hero-glow-b"></div>
    </div>

    <div class="hero-wrap">
      <div class="hero-left">
        <p class="eyebrow">Official Bangladesh Platform</p>
        <h1 class="hero-title">Compete. Climb. <span class="grad">Get Noticed.</span></h1>
        <p class="hero-sub">Join premium esports tournaments across Valorant, eFootball, CS2, FC, MLBB, PUBG and more. Verified prizes, fair brackets, real-time standings.</p>

        <div class="hero-ctas">
          <a class="cta-primary" href="#browse">Browse Tournaments</a>
          <a class="cta-secondary" href="#all">All Tournaments</a>
        </div>

        <ul class="hero-stats" aria-label="Platform stats">
          <li><strong>{{ stats.total_active|default:"25" }}</strong><span>Active now</span></li>
          <li><strong>{{ stats.players_this_month|default:"1,200" }}</strong><span>Players this month</span></li>
          <li><strong>৳{{ stats.prize_pool_month|default:"2,50,000" }}</strong><span>Prize pool</span></li>
        </ul>

        <div class="trust-row" aria-label="Trust markers">
          <span class="trust-badge">Fast payouts</span>
          <span class="trust-badge">Anti-smurf checks</span>
          <span class="trust-badge">Live support</span>
        </div>
      </div>

      <div class="hero-right">
        <div class="hero-card">
          <div class="hc-top"><span class="live-dot" aria-hidden="true"></span> Featured Now</div>
          <div class="hc-body">
            {% if live_tournaments %}
            {% with t=live_tournaments.0 %}
              <a class="hc-banner" href="{{ t.dc_url|default:'#' }}">
                {% if t.dc_banner_url %}
                  <img src="{{ t.dc_banner_url }}" alt="{{ t.dc_title }}">
                {% else %}<div class="hc-fallback" aria-hidden="true"></div>{% endif %}
              </a>
              <h3 class="hc-title"><a href="{{ t.dc_url|default:'#' }}">{{ t.dc_title }}</a></h3>
              <div class="hc-meta">
                {% if t.starts_at %}<span>Starts {{ t.starts_at|date:"M j, H:i" }}</span>{% endif %}
                {% if t.dc_game %}<span>{{ t.dc_game }}</span>{% endif %}
                {% if t.dc_fee_amount is not None %}
                  <span>{% if t.dc_fee_amount == 0 %}Free Entry{% else %}৳{{ t.dc_fee_amount }}{% endif %}</span>
                {% endif %}
              </div>
              <div class="hc-cta">
                <a class="cta-primary" href="{{ t.register_url }}">
                  <i class="fa-solid fa-user-plus"></i> Register
                </a>
                <a class="cta-ghost" href="{{ t.dc_url|default:'#' }}">
                  <i class="fa-solid fa-eye"></i> View
                </a>
              </div>
            {% endwith %}
            {% else %}
              <div class="hc-empty">Live events appear here when a tournament is in progress.</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </header>

  {# ---------------- BROWSE BY GAME (top under hero) ---------------- #}
  <section class="section-head" id="browse" aria-labelledby="browse-title">
    <h2 id="browse-title" class="section-title">Browse by Game</h2>
    <a class="section-link" href="#all">All tournaments</a>
  </section>
  <div class="game-grid">
    {% for g in games %}
      {% include "tournaments/partials/_game_card.html" with g=g %}
    {% endfor %}
  </div>

  {# ---------------- ALL TOURNAMENTS (Filter Orb replaces bulky panel) ---------------- #}
  <section class="section-head" id="all" aria-labelledby="all-title">
    <h2 id="all-title" class="section-title">All Tournaments</h2>
    <a class="section-link" href="{% url 'tournaments:hub' %}">See more</a>
  </section>

  {# New: compact Filter Orb (hover/tap) #}
  <div class="filter-orb-wrap" aria-label="Filters">
    {% include "tournaments/partials/_filter_orb.html" %}
  </div>

  {% if tournaments %}
    <div class="grid">
      {% for t in tournaments %}
        {% include "tournaments/partials/_tournament_card.html" with t=t state=my_reg_states|get_tournament_item:t.id %}
      {% endfor %}
    </div>
  {% else %}
    {% include "tournaments/partials/_grid_empty.html" %}
  {% endif %}

  {# ---------------- OPTIONAL ROWS ---------------- #}
  {% if starting_soon %}
  <section class="section-head" aria-labelledby="soon-title">
    <h2 id="soon-title" class="section-title">Starting Soon</h2>
    <a class="section-link" href="{% url 'tournaments:hub' %}?start=7d">Within 7 days</a>
  </section>
  <div class="carousel">
    {% for t in starting_soon %}
      <div class="carousel-item">
        {% include "tournaments/partials/_tournament_card.html" with t=t state=my_reg_states|get_tournament_item:t.id %}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  {% if new_this_week %}
  <section class="section-head" aria-labelledby="new-title">
    <h2 id="new-title" class="section-title">New This Week</h2>
    <a class="section-link" href="{% url 'tournaments:hub' %}?sort=new">Newest first</a>
  </section>
  <div class="grid">
    {% for t in new_this_week %}
      {% include "tournaments/partials/_tournament_card.html" with t=t state=my_reg_states|get_tournament_item:t.id %}
    {% endfor %}
  </div>
  {% endif %}

  {# ---------------- VALUE PROPS AT BOTTOM ---------------- #}
  <section class="vp-grid bottom-vp" aria-label="Why DeltaCrown">
    <article class="vp-card">
      <div class="vp-icon i-trophy" aria-hidden="true"></div>
      <h3>Real prizes</h3>
      <p>Verified payouts and leaderboard badges. Win more than bragging rights.</p>
    </article>
    <article class="vp-card">
      <div class="vp-icon i-bracket" aria-hidden="true"></div>
      <h3>Fair brackets</h3>
      <p>Auto-seeding, transparent rules, and public standings in real time.</p>
    </article>
    <article class="vp-card">
      <div class="vp-icon i-shield" aria-hidden="true"></div>
      <h3>Competitive integrity</h3>
      <p>Anti-smurf checks, manual verification, and match dispute support.</p>
    </article>
    <article class="vp-card">
      <div class="vp-icon i-bolt" aria-hidden="true"></div>
      <h3>Fast & simple</h3>
      <p>2-minute registration, e-wallet payments, clear status at every step.</p>
    </article>
  </section>

  {# ---------------- HOW IT WORKS ---------------- #}
  <section class="how premium-how" id="how" aria-labelledby="how-title">
    <h2 id="how-title" class="section-title">How it works</h2>
    <ol class="how-steps">
      <li>
        <span class="num">1</span>
        <h3>Pick a tournament</h3>
        <p>Use the filters, or jump into the featured rows above.</p>
      </li>
      <li>
        <span class="num">2</span>
        <h3>Register & pay</h3>
        <p>Solo or team. Pay with bKash/Nagad/Rocket. Get instant status.</p>
      </li>
      <li>
        <span class="num">3</span>
        <h3>Compete & climb</h3>
        <p>Follow your bracket, check-in, and track standings live.</p>
      </li>
    </ol>
  </section>

</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'siteui/js/tournaments-hub.js' %}"></script>
{# Later we’ll add filter-orb.js here in the CSS/JS steps. #}
{% endblock %}
