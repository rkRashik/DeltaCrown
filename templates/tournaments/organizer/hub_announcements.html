{% extends "tournaments/organizer/_hub_base.html" %}
{% load humanize %}

{# ─────────────────────────────────────────────────────────
   Organizer Hub — Announcements Tab
   Create and manage tournament announcements
   Phase 4 Frontend Rebuild
   ───────────────────────────────────────────────────────── #}

{% block hub_content %}

{# ── Header ── #}
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
  <h2 class="text-lg font-display font-bold text-white">Announcements</h2>
</div>

{# ── Create Announcement Form ── #}
{% if can_announce %}
  <div class="glass rounded-xl p-6 mb-6">
    <h3 class="text-sm font-display font-semibold text-white mb-4">
      <i data-lucide="plus-circle" class="w-4 h-4 inline mr-1 text-dc-cyan"></i>
      New Announcement
    </h3>
    <form method="post">
      {% csrf_token %}
      <div class="space-y-4">
        <div>
          <label class="block text-xs text-gray-400 mb-1.5">Title</label>
          <input type="text" name="title" required
                 placeholder="Announcement title…"
                 class="w-full px-4 py-2.5 bg-dc-surface border border-dc-border rounded-xl text-sm text-white placeholder-gray-600 focus:border-dc-cyan/40 focus:outline-none transition">
        </div>
        <div>
          <label class="block text-xs text-gray-400 mb-1.5">Message</label>
          <textarea name="message" rows="4" required
                    placeholder="Write your announcement…"
                    class="w-full px-4 py-2.5 bg-dc-surface border border-dc-border rounded-xl text-sm text-white placeholder-gray-600 focus:border-dc-cyan/40 focus:outline-none transition resize-none"></textarea>
        </div>
        <div class="flex items-center gap-6">
          <label class="flex items-center gap-2 text-sm text-gray-400 cursor-pointer">
            <input type="checkbox" name="is_pinned" class="rounded border-dc-border bg-dc-surface text-dc-cyan focus:ring-dc-cyan/40">
            <span>Pin to top</span>
          </label>
          <label class="flex items-center gap-2 text-sm text-gray-400 cursor-pointer">
            <input type="checkbox" name="is_important" class="rounded border-dc-border bg-dc-surface text-dc-cyan focus:ring-dc-cyan/40">
            <span>Mark as important</span>
          </label>
        </div>
        <div class="flex justify-end">
          <button type="submit" class="px-5 py-2.5 bg-dc-cyan text-black font-bold text-sm rounded-xl hover:bg-dc-cyan/90 transition">
            <i data-lucide="send" class="w-4 h-4 inline mr-1"></i> Post Announcement
          </button>
        </div>
      </div>
    </form>
  </div>
{% endif %}

{# ── Announcement List ── #}
{% if announcements %}
  <div class="space-y-3">
    {% for a in announcements %}
      <div class="glass rounded-xl p-5 {% if a.is_important %}border border-yellow-600/30{% endif %}">
        <div class="flex items-start gap-3">
          {# Icon #}
          <div class="w-9 h-9 rounded-lg flex items-center justify-center flex-shrink-0
            {% if a.is_important %}bg-yellow-600/10{% elif a.is_pinned %}bg-dc-cyan/10{% else %}bg-white/[0.03]{% endif %}">
            {% if a.is_pinned %}
              <i data-lucide="pin" class="w-4 h-4 text-dc-cyan"></i>
            {% elif a.is_important %}
              <i data-lucide="alert-circle" class="w-4 h-4 text-yellow-400"></i>
            {% else %}
              <i data-lucide="megaphone" class="w-4 h-4 text-gray-500"></i>
            {% endif %}
          </div>

          {# Content #}
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2 mb-1">
              <h4 class="text-sm font-semibold text-white">{{ a.title }}</h4>
              {% if a.is_pinned %}
                <span class="text-[9px] px-1.5 py-0.5 bg-dc-cyan/20 text-dc-cyan rounded font-mono">PINNED</span>
              {% endif %}
              {% if a.is_important %}
                <span class="text-[9px] px-1.5 py-0.5 bg-yellow-600/20 text-yellow-400 rounded font-mono">IMPORTANT</span>
              {% endif %}
            </div>
            <p class="text-xs text-gray-400 mb-2 whitespace-pre-line">{{ a.message }}</p>
            <div class="flex items-center gap-3 text-[10px] text-gray-600">
              <span>
                <i data-lucide="user" class="w-3 h-3 inline"></i>
                {{ a.created_by.username|default:"System" }}
              </span>
              <span>
                <i data-lucide="clock" class="w-3 h-3 inline"></i>
                {{ a.created_at|timesince }} ago
              </span>
            </div>
          </div>

          {# Actions #}
          {% if can_announce %}
            <button title="Delete" class="p-2 rounded-lg hover:bg-red-600/20 text-gray-600 hover:text-red-400 transition flex-shrink-0">
              <i data-lucide="trash-2" class="w-4 h-4"></i>
            </button>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="text-center py-16 glass rounded-xl">
    <i data-lucide="megaphone" class="w-10 h-10 text-gray-700 mx-auto mb-3"></i>
    <p class="text-gray-400 mb-1">No announcements yet</p>
    <p class="text-xs text-gray-600">Post an announcement to notify all participants.</p>
  </div>
{% endif %}

{% endblock %}
