{% extends "tournaments/organizer/_hub_base.html" %}
{% load humanize %}

{# ─────────────────────────────────────────────────────────
   Organizer Hub — Overview Tab
   Stats summary, quick actions, recent activity
   Phase 4 Frontend Rebuild
   ───────────────────────────────────────────────────────── #}

{% block hub_content %}

{# ── Stat Cards Row ── #}
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">

  {# Registrations #}
  <div class="glass rounded-xl p-5">
    <div class="flex items-center justify-between mb-3">
      <span class="text-[11px] uppercase tracking-wider text-gray-500">Registrations</span>
      <div class="w-8 h-8 rounded-lg bg-dc-cyan/10 flex items-center justify-center">
        <i data-lucide="users" class="w-4 h-4 text-dc-cyan"></i>
      </div>
    </div>
    <p class="text-2xl font-display font-bold text-white">{{ reg_stats.total|default:"0" }}</p>
    <div class="flex items-center gap-3 mt-2 text-[11px] text-gray-500">
      <span><span class="text-yellow-400 font-mono">{{ reg_stats.pending|default:"0" }}</span> pending</span>
      <span><span class="text-green-400 font-mono">{{ reg_stats.confirmed|default:"0" }}</span> confirmed</span>
    </div>
  </div>

  {# Matches #}
  <div class="glass rounded-xl p-5">
    <div class="flex items-center justify-between mb-3">
      <span class="text-[11px] uppercase tracking-wider text-gray-500">Matches</span>
      <div class="w-8 h-8 rounded-lg bg-dc-purple/10 flex items-center justify-center">
        <i data-lucide="swords" class="w-4 h-4 text-dc-purple"></i>
      </div>
    </div>
    <p class="text-2xl font-display font-bold text-white">{{ match_stats.total|default:"0" }}</p>
    <div class="flex items-center gap-3 mt-2 text-[11px] text-gray-500">
      <span><span class="text-green-400 font-mono">{{ match_stats.completed|default:"0" }}</span> done</span>
      {% if match_stats.live %}
        <span class="text-red-400 font-mono animate-pulse">{{ match_stats.live }} live</span>
      {% endif %}
    </div>
  </div>

  {# Payments #}
  <div class="glass rounded-xl p-5">
    <div class="flex items-center justify-between mb-3">
      <span class="text-[11px] uppercase tracking-wider text-gray-500">Payments</span>
      <div class="w-8 h-8 rounded-lg bg-dc-gold/10 flex items-center justify-center">
        <i data-lucide="credit-card" class="w-4 h-4 text-dc-gold"></i>
      </div>
    </div>
    <p class="text-2xl font-display font-bold text-white">{{ payment_stats.total|default:"0" }}</p>
    <div class="flex items-center gap-3 mt-2 text-[11px] text-gray-500">
      <span><span class="text-yellow-400 font-mono">{{ payment_stats.pending|default:"0" }}</span> pending</span>
      <span class="text-green-400 font-mono">৳{{ payment_stats.total_amount|default:"0"|intcomma }}</span>
    </div>
  </div>

  {# Disputes #}
  <div class="glass rounded-xl p-5">
    <div class="flex items-center justify-between mb-3">
      <span class="text-[11px] uppercase tracking-wider text-gray-500">Disputes</span>
      <div class="w-8 h-8 rounded-lg bg-red-500/10 flex items-center justify-center">
        <i data-lucide="alert-triangle" class="w-4 h-4 text-red-400"></i>
      </div>
    </div>
    <p class="text-2xl font-display font-bold text-white">{{ dispute_stats.total|default:"0" }}</p>
    <div class="flex items-center gap-3 mt-2 text-[11px] text-gray-500">
      <span><span class="text-red-400 font-mono">{{ dispute_stats.open|default:"0" }}</span> open</span>
      <span><span class="text-yellow-400 font-mono">{{ dispute_stats.under_review|default:"0" }}</span> reviewing</span>
    </div>
  </div>

</div>

{# ── Two-Column Layout: Quick Actions + Recent Activity ── #}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

  {# Quick Actions #}
  <div class="glass rounded-xl p-6">
    <h3 class="text-sm font-display font-semibold text-white mb-4">Quick Actions</h3>
    <div class="space-y-2">
      <a href="{% url 'tournaments:organizer_hub' tournament.slug 'participants' %}"
         class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/[0.03] hover:bg-white/[0.06] transition text-sm text-gray-300 hover:text-white">
        <i data-lucide="user-plus" class="w-4 h-4 text-dc-cyan"></i>
        Manage Registrations
        {% if reg_stats.pending %}
          <span class="ml-auto text-[10px] bg-yellow-600/20 text-yellow-400 px-1.5 py-0.5 rounded font-mono">{{ reg_stats.pending }}</span>
        {% endif %}
      </a>
      <a href="{% url 'tournaments:organizer_hub' tournament.slug 'payments' %}"
         class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/[0.03] hover:bg-white/[0.06] transition text-sm text-gray-300 hover:text-white">
        <i data-lucide="wallet" class="w-4 h-4 text-dc-gold"></i>
        Verify Payments
        {% if payment_stats.pending %}
          <span class="ml-auto text-[10px] bg-yellow-600/20 text-yellow-400 px-1.5 py-0.5 rounded font-mono">{{ payment_stats.pending }}</span>
        {% endif %}
      </a>
      <a href="{% url 'tournaments:organizer_hub' tournament.slug 'brackets' %}"
         class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/[0.03] hover:bg-white/[0.06] transition text-sm text-gray-300 hover:text-white">
        <i data-lucide="git-merge" class="w-4 h-4 text-dc-purple"></i>
        Bracket &amp; Matches
      </a>
      <a href="{% url 'tournaments:organizer_hub' tournament.slug 'announcements' %}"
         class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/[0.03] hover:bg-white/[0.06] transition text-sm text-gray-300 hover:text-white">
        <i data-lucide="megaphone" class="w-4 h-4 text-gray-400"></i>
        Post Announcement
      </a>
      <a href="{% url 'tournaments:detail' tournament.slug %}" target="_blank"
         class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/[0.03] hover:bg-white/[0.06] transition text-sm text-gray-300 hover:text-white">
        <i data-lucide="external-link" class="w-4 h-4 text-gray-400"></i>
        View Public Page
      </a>
    </div>
  </div>

  {# Recent Registrations #}
  <div class="lg:col-span-2 glass rounded-xl p-6">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-sm font-display font-semibold text-white">Recent Registrations</h3>
      <a href="{% url 'tournaments:organizer_hub' tournament.slug 'participants' %}" class="text-[11px] text-dc-cyan hover:underline">View all →</a>
    </div>

    {% if recent_registrations %}
      <div class="space-y-2">
        {% for reg in recent_registrations %}
          <div class="flex items-center gap-3 px-4 py-3 rounded-lg bg-white/[0.02] border border-dc-border">
            {# Avatar #}
            <div class="w-8 h-8 rounded-full bg-dc-surface flex items-center justify-center text-[11px] font-bold text-dc-cyan flex-shrink-0">
              {{ reg.user.username|first|upper }}
            </div>
            {# Info #}
            <div class="flex-1 min-w-0">
              <p class="text-sm text-white truncate">{{ reg.user.username }}</p>
              <p class="text-[10px] text-gray-500">{{ reg.created_at|timesince }} ago</p>
            </div>
            {# Status #}
            <span class="text-[10px] px-2 py-0.5 rounded-full font-mono
              {% if reg.status == 'confirmed' %}bg-green-600/20 text-green-400
              {% elif reg.status == 'pending' %}bg-yellow-600/20 text-yellow-400
              {% elif reg.status == 'rejected' %}bg-red-600/20 text-red-400
              {% elif reg.status == 'cancelled' %}bg-gray-600/20 text-gray-400
              {% else %}bg-gray-600/20 text-gray-400{% endif %}">
              {{ reg.status|title }}
            </span>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-8 text-gray-600">
        <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2"></i>
        <p class="text-sm">No registrations yet</p>
      </div>
    {% endif %}
  </div>

</div>

{% endblock %}
