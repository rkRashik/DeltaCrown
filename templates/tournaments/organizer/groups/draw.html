{% extends "tournaments/base.html" %}
{% load static humanize %}

{# ─────────────────────────────────────────────────────────
   Group Draw — FE-T-012
   Context: tournament, groups, unassigned_participants,
            is_draw_complete, draw_method
   Phase 4 Frontend Rebuild
   ───────────────────────────────────────────────────────── #}

{% block title %}Group Draw — {{ tournament.name }} | DeltaCrown{% endblock %}

{% block tournament_content %}

<div class="max-w-5xl mx-auto px-4 sm:px-6 py-8">

  {# ── Header ── #}
  <div class="mb-6">
    <a href="{% url 'tournaments:organizer_tournament_detail' tournament.slug %}" class="text-xs text-gray-500 hover:text-dc-cyan transition mb-2 inline-block">
      <i data-lucide="arrow-left" class="w-3 h-3 inline mr-1"></i> Organizer Hub
    </a>
    <h1 class="text-2xl font-display font-bold text-white">
      <i data-lucide="shuffle" class="w-6 h-6 inline mr-2 text-dc-gold"></i> Group Draw
    </h1>
    {% if unassigned_participants %}
      <p class="text-sm text-gray-400 mt-1">{{ unassigned_participants|length }} participants to assign</p>
    {% endif %}
  </div>

  {% if not is_draw_complete %}

    {# ── Draw Method Selection ── #}
    <form method="post" class="space-y-6">
      {% csrf_token %}

      <div class="glass rounded-xl p-6">
        <h3 class="text-sm font-display font-semibold text-white mb-4">
          <i data-lucide="dice-5" class="w-4 h-4 inline mr-1 text-dc-cyan"></i> Draw Method
        </h3>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <label class="relative cursor-pointer">
            <input type="radio" name="draw_method" value="random" checked class="peer sr-only">
            <div class="p-5 rounded-xl border border-dc-border bg-white/[0.02] peer-checked:border-dc-cyan peer-checked:bg-dc-cyan/5 transition">
              <i data-lucide="shuffle" class="w-6 h-6 text-dc-cyan mb-2"></i>
              <p class="text-sm font-bold text-white">Random</p>
              <p class="text-[10px] text-gray-500 mt-1">Fully random assignment</p>
            </div>
          </label>
          <label class="relative cursor-pointer">
            <input type="radio" name="draw_method" value="seeded" class="peer sr-only">
            <div class="p-5 rounded-xl border border-dc-border bg-white/[0.02] peer-checked:border-dc-cyan peer-checked:bg-dc-cyan/5 transition">
              <i data-lucide="list-ordered" class="w-6 h-6 text-dc-gold mb-2"></i>
              <p class="text-sm font-bold text-white">Seeded</p>
              <p class="text-[10px] text-gray-500 mt-1">Snake draft by seed</p>
            </div>
          </label>
          <label class="relative cursor-pointer">
            <input type="radio" name="draw_method" value="manual" class="peer sr-only">
            <div class="p-5 rounded-xl border border-dc-border bg-white/[0.02] peer-checked:border-dc-cyan peer-checked:bg-dc-cyan/5 transition">
              <i data-lucide="hand" class="w-6 h-6 text-dc-purple mb-2"></i>
              <p class="text-sm font-bold text-white">Manual</p>
              <p class="text-[10px] text-gray-500 mt-1">Drag & drop (coming soon)</p>
            </div>
          </label>
        </div>
      </div>

      <div class="flex justify-end">
        <button type="submit" class="px-6 py-3 bg-dc-gold text-dc-dark font-bold text-sm rounded-xl hover:bg-dc-gold/90 transition shadow-[0_0_20px_rgba(250,204,21,0.3)]">
          <i data-lucide="play" class="w-4 h-4 inline mr-1"></i> Perform Draw
        </button>
      </div>
    </form>

  {% endif %}

  {# ── Current Group Assignments ── #}
  {% if groups %}
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8">
      {% for group in groups %}
        <div class="glass rounded-xl overflow-hidden">
          <div class="px-5 py-3 border-b border-dc-border bg-white/[0.02]">
            <h3 class="text-sm font-display font-semibold text-white">{{ group.name }}</h3>
          </div>
          {% if group.standings.all %}
            <div class="divide-y divide-dc-border">
              {% for standing in group.standings.all %}
                <div class="flex items-center gap-3 px-5 py-2.5">
                  <span class="w-6 h-6 rounded-full bg-dc-surface flex items-center justify-center text-[10px] font-mono text-gray-500">
                    {{ forloop.counter }}
                  </span>
                  <span class="text-sm text-white">
                    {% if standing.team %}{{ standing.team.name }}{% elif standing.user %}{{ standing.user.username }}{% else %}—{% endif %}
                  </span>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="px-5 py-6 text-center">
              <p class="text-xs text-gray-600">No participants assigned</p>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    {% if is_draw_complete %}
      <div class="flex items-center justify-between mt-6">
        <form method="post">
          {% csrf_token %}
          <input type="hidden" name="action" value="reset">
          <button type="submit" class="px-4 py-2 text-xs text-red-400 border border-red-700/30 rounded-lg hover:bg-red-900/20 transition">
            <i data-lucide="rotate-ccw" class="w-3 h-3 inline mr-1"></i> Reset Draw
          </button>
        </form>
        <form method="post">
          {% csrf_token %}
          <input type="hidden" name="action" value="finalize">
          <button type="submit" class="px-6 py-3 bg-dc-cyan text-dc-dark font-bold text-sm rounded-xl hover:bg-dc-cyan/90 transition">
            <i data-lucide="lock" class="w-4 h-4 inline mr-1"></i> Finalize Groups
          </button>
        </form>
      </div>
    {% endif %}
  {% endif %}

</div>

{% endblock %}
