{% extends "base.html" %}
{% load static humanize tournament_dict_utils game_assets_tags %}

{% block title %}{{ tournament.name }} - Tournament Details | DeltaCrown{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'siteui/css/tournaments-v6-detail.css' %}?v=1">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="{% static 'js/tournaments-v6-detail.js' %}?v=1" defer></script>

<!-- Open Graph Meta -->
<meta property="og:title" content="{{ tournament.name }}">
<meta property="og:description" content="{{ tournament.short_description|striptags|truncatewords:30 }}">
{% if tournament.media.social_media_image %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ tournament.media.social_media_image.url }}">
{% elif tournament.media.banner %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ tournament.media.banner.url }}">
{% endif %}
<meta property="og:type" content="website">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
{% endblock %}

{% block body_class %}tournament-detail-v6 hide-footer{% endblock %}

{% block content %}
<!-- ============================================
     HERO SECTION WITH BANNER
     ============================================ -->
<section class="detail-v6-hero">
    <div class="hero-banner-wrap">
        {% if tournament.media.banner %}
            <img src="{{ tournament.media.banner.url }}" alt="{{ tournament.name }}" class="hero-banner-img">
        {% elif tournament.banner %}
            <img src="{{ tournament.banner.url }}" alt="{{ tournament.name }}" class="hero-banner-img">
        {% else %}
            <div class="hero-banner-placeholder"></div>
        {% endif %}
        <div class="hero-banner-overlay"></div>
    </div>
    
    <div class="container">
        <div class="hero-content">
            <!-- Breadcrumb -->
            <nav class="breadcrumb-v6">
                <a href="{% url 'tournaments:hub' %}" class="breadcrumb-link">Tournaments</a>
                <span class="breadcrumb-sep">›</span>
                <a href="{% url 'tournaments:hub' %}?game={{ tournament.game }}" class="breadcrumb-link">{{ tournament.get_game_display }}</a>
                <span class="breadcrumb-sep">›</span>
                <span class="breadcrumb-current">{{ tournament.name|truncatewords:5 }}</span>
            </nav>
            
            <!-- Status & Live Badge -->
            <div class="hero-badges">
                {% if tournament.status == 'RUNNING' %}
                    <div class="status-badge live">
                        <span class="pulse-dot"></span>
                        LIVE NOW
                    </div>
                {% elif tournament.registration_open %}
                    <div class="status-badge registration">
                        <svg width="16" height="16" fill="currentColor"><use href="#icon-check-circle"/></svg>
                        REGISTRATION OPEN
                    </div>
                {% elif tournament.status == 'COMPLETED' %}
                    <div class="status-badge completed">
                        <svg width="16" height="16" fill="currentColor"><use href="#icon-trophy"/></svg>
                        COMPLETED
                    </div>
                {% elif tournament.status == 'PUBLISHED' %}
                    <div class="status-badge upcoming">
                        <svg width="16" height="16" fill="currentColor"><use href="#icon-calendar"/></svg>
                        UPCOMING
                    </div>
                {% endif %}
                
                <!-- Game Badge -->
                <div class="game-badge">
                    <img src="{% game_icon_url tournament.game %}" alt="{{ tournament.get_game_display }}" class="game-badge-icon">
                    <span>{{ tournament.get_game_display }}</span>
                </div>
            </div>
            
            <!-- Title -->
            <h1 class="hero-title">{{ tournament.name }}</h1>
            
            <!-- Quick Meta -->
            <div class="hero-meta-grid">
                {% if tournament.schedule.start_at %}
                <div class="meta-item">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2"/>
                        <path d="M16 2v4M8 2v4M3 10h18"/>
                    </svg>
                    <span>{{ tournament.schedule.start_at|date:"M d, Y • H:i" }}</span>
                </div>
                {% endif %}
                
                {% if tournament.format %}
                <div class="meta-item">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="8" r="6"/>
                        <path d="M12 2v6l3 3"/>
                    </svg>
                    <span>{{ tournament.get_format_display }}</span>
                </div>
                {% endif %}
                
                {% if tournament.platform %}
                <div class="meta-item">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                    </svg>
                    <span>{{ tournament.get_platform_display }}</span>
                </div>
                {% endif %}
                
                {% if tournament.capacity %}
                <div class="meta-item">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <span>{{ tournament.capacity.current_teams }}/{{ tournament.capacity.max_teams }} Teams</span>
                </div>
                {% endif %}
            </div>
            
            <!-- Primary CTA -->
            <div class="hero-actions">
                {% if tournament.registration_open and request.user.is_authenticated %}
                    <a href="{{ tournament.register_url }}" class="btn-primary-cta">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="8.5" cy="7" r="4"/>
                            <path d="M20 8v6M23 11h-6"/>
                        </svg>
                        Register Now
                    </a>
                {% elif tournament.registration_open %}
                    <a href="{% url 'accounts:login' %}?next={{ request.path }}" class="btn-primary-cta">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M15 12H3"/>
                        </svg>
                        Login to Register
                    </a>
                {% elif tournament.status == 'RUNNING' %}
                    <a href="{% url 'tournaments:dashboard' tournament.slug %}" class="btn-primary-cta">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polygon points="10 8 16 12 10 16 10 8"/>
                        </svg>
                        Watch Live
                    </a>
                {% elif tournament.status == 'COMPLETED' %}
                    <a href="{% url 'tournaments:dashboard' tournament.slug %}" class="btn-primary-cta">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
                            <path d="M18 2H6v7a6 6 0 0 0 12 0V2z"/>
                        </svg>
                        View Results
                    </a>
                {% endif %}
                
                <button class="btn-secondary-cta share-btn" data-tournament="{{ tournament.name }}" data-url="{{ request.build_absolute_uri }}">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"/>
                        <circle cx="6" cy="12" r="3"/>
                        <circle cx="18" cy="19" r="3"/>
                        <path d="m8.59 13.51 6.83 3.98M15.41 6.51l-6.82 3.98"/>
                    </svg>
                    Share
                </button>
            </div>
        </div>
    </div>
</section>

<!-- ============================================
     MAIN CONTENT - TWO COLUMN LAYOUT
     ============================================ -->
<section class="detail-v6-main">
    <div class="container">
        <div class="detail-layout">
            <!-- LEFT COLUMN: Main Content -->
            <div class="detail-content">
                
                <!-- Overview -->
                {% if tournament.short_description or tournament.description %}
                <div class="content-card">
                    <h2 class="card-title">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                        </svg>
                        Tournament Overview
                    </h2>
                    <div class="card-body">
                        {% if tournament.short_description %}
                            <div class="overview-text">{{ tournament.short_description|safe }}</div>
                        {% endif %}
                        {% if tournament.description %}
                            <div class="overview-text full-description">{{ tournament.description|safe }}</div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Schedule & Timeline -->
                {% if tournament.schedule %}
                <div class="content-card">
                    <h2 class="card-title">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2"/>
                            <path d="M16 2v4M8 2v4M3 10h18"/>
                        </svg>
                        Schedule & Timeline
                    </h2>
                    <div class="card-body">
                        <div class="timeline-grid">
                            {% if tournament.schedule.reg_open_at %}
                            <div class="timeline-item">
                                <div class="timeline-icon registration">
                                    <svg width="20" height="20" fill="currentColor">
                                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                        <circle cx="8.5" cy="7" r="4"/>
                                        <path d="M20 8v6M23 11h-6"/>
                                    </svg>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-label">Registration Opens</div>
                                    <div class="timeline-value">{{ tournament.schedule.reg_open_at|date:"F d, Y • h:i A" }}</div>
                                    {% if tournament.schedule.is_registration_open %}
                                        <span class="timeline-badge active">Open Now</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if tournament.schedule.reg_close_at %}
                            <div class="timeline-item">
                                <div class="timeline-icon deadline">
                                    <svg width="20" height="20" fill="currentColor">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M12 6v6l4 2"/>
                                    </svg>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-label">Registration Closes</div>
                                    <div class="timeline-value">{{ tournament.schedule.reg_close_at|date:"F d, Y • h:i A" }}</div>
                                    {% if tournament.schedule.time_until_reg_close %}
                                        <span class="timeline-badge warning">{{ tournament.schedule.time_until_reg_close }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if tournament.schedule.start_at %}
                            <div class="timeline-item">
                                <div class="timeline-icon tournament">
                                    <svg width="20" height="20" fill="currentColor">
                                        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
                                        <path d="M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
                                        <path d="M18 2H6v7a6 6 0 0 0 12 0V2z"/>
                                    </svg>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-label">Tournament Starts</div>
                                    <div class="timeline-value">{{ tournament.schedule.start_at|date:"F d, Y • h:i A" }}</div>
                                    {% if tournament.status == 'RUNNING' %}
                                        <span class="timeline-badge live">Live Now</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if tournament.schedule.end_at %}
                            <div class="timeline-item">
                                <div class="timeline-icon end">
                                    <svg width="20" height="20" fill="currentColor">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                        <path d="M22 4L12 14.01l-3-3"/>
                                    </svg>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-label">Tournament Ends</div>
                                    <div class="timeline-value">{{ tournament.schedule.end_at|date:"F d, Y • h:i A" }}</div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Check-in Window -->
                        {% if tournament.schedule.check_in_open_mins %}
                        <div class="checkin-info">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <path d="M22 4L12 14.01l-3-3"/>
                            </svg>
                            <span>Check-in opens <strong>{{ tournament.schedule.check_in_open_mins }} minutes</strong> before start and closes <strong>{{ tournament.schedule.check_in_close_mins }} minutes</strong> before start</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Prize Pool -->
                {% if tournament.finance %}
                <div class="content-card prize-card">
                    <h2 class="card-title">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="8" cy="21" r="2"/>
                            <circle cx="20" cy="21" r="2"/>
                            <path d="M5.67 6H23l-1.68 8.39a2 2 0 0 1-2 1.61H8.75a2 2 0 0 1-2-1.74L5.23 2.74A2 2 0 0 0 3.25 1H1"/>
                        </svg>
                        Prize Pool & Rewards
                    </h2>
                    <div class="card-body">
                        <div class="prize-showcase">
                            <div class="prize-total">
                                <div class="prize-currency">৳</div>
                                <div class="prize-amount">{{ tournament.finance.prize_pool_bdt|floatformat:0|intcomma }}</div>
                                <div class="prize-label">Total Prize Pool</div>
                            </div>
                            
                            {% if tournament.finance.entry_fee_bdt and tournament.finance.entry_fee_bdt > 0 %}
                            <div class="entry-fee-info">
                                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 6v6l4 2"/>
                                </svg>
                                <span>Entry Fee: <strong>৳{{ tournament.finance.entry_fee_bdt|floatformat:0|intcomma }}</strong> per team</span>
                            </div>
                            {% else %}
                            <div class="entry-fee-info free">
                                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                    <path d="M22 4L12 14.01l-3-3"/>
                                </svg>
                                <span><strong>Free Entry</strong> - No registration fee</span>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Prize Distribution -->
                        {% if tournament.finance.prize_distribution_formatted %}
                        <div class="prize-breakdown">
                            <h3 class="breakdown-title">Prize Distribution</h3>
                            <div class="prize-positions">
                                {% for position in tournament.finance.prize_distribution_formatted %}
                                <div class="prize-position {% if forloop.first %}first{% elif forloop.counter == 2 %}second{% elif forloop.counter == 3 %}third{% endif %}">
                                    <div class="position-rank">
                                        {% if forloop.first %}
                                            🥇
                                        {% elif forloop.counter == 2 %}
                                            🥈
                                        {% elif forloop.counter == 3 %}
                                            🥉
                                        {% else %}
                                            #{{ forloop.counter }}
                                        {% endif %}
                                    </div>
                                    <div class="position-info">
                                        <span class="position-label">{{ position.position }}</span>
                                        <span class="position-prize">৳{{ position.amount|floatformat:0|intcomma }}</span>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if tournament.finance.refund_policy %}
                        <div class="refund-policy">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                            <div>
                                <strong>Refund Policy:</strong>
                                <p>{{ tournament.finance.refund_policy }}</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Rules & Regulations -->
                {% if tournament.rules %}
                <div class="content-card">
                    <h2 class="card-title">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                        </svg>
                        Rules & Regulations
                    </h2>
                    <div class="card-body">
                        <!-- Rules Tabs -->
                        <div class="rules-tabs">
                            <button class="rules-tab active" data-tab="general">General Rules</button>
                            {% if tournament.rules.has_eligibility_requirements %}
                            <button class="rules-tab" data-tab="eligibility">Eligibility</button>
                            {% endif %}
                            {% if tournament.rules.has_match_rules %}
                            <button class="rules-tab" data-tab="match">Match Rules</button>
                            {% endif %}
                            {% if tournament.rules.has_scoring_system %}
                            <button class="rules-tab" data-tab="scoring">Scoring</button>
                            {% endif %}
                            {% if tournament.rules.has_penalty_rules %}
                            <button class="rules-tab" data-tab="penalties">Penalties</button>
                            {% endif %}
                        </div>
                        
                        <!-- Rules Content -->
                        <div class="rules-content">
                            {% if tournament.rules.general_rules %}
                            <div class="rules-section active" data-content="general">
                                {{ tournament.rules.general_rules|safe }}
                            </div>
                            {% endif %}
                            
                            {% if tournament.rules.eligibility_requirements %}
                            <div class="rules-section" data-content="eligibility">
                                {{ tournament.rules.eligibility_requirements|safe }}
                            </div>
                            {% endif %}
                            
                            {% if tournament.rules.match_rules %}
                            <div class="rules-section" data-content="match">
                                {{ tournament.rules.match_rules|safe }}
                            </div>
                            {% endif %}
                            
                            {% if tournament.rules.scoring_system %}
                            <div class="rules-section" data-content="scoring">
                                {{ tournament.rules.scoring_system|safe }}
                            </div>
                            {% endif %}
                            
                            {% if tournament.rules.penalty_rules %}
                            <div class="rules-section" data-content="penalties">
                                {{ tournament.rules.penalty_rules|safe }}
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Requirements -->
                        {% if tournament.rules.require_discord or tournament.rules.require_game_id or tournament.rules.require_team_logo %}
                        <div class="requirements-box">
                            <h3 class="requirements-title">Requirements</h3>
                            <div class="requirements-list">
                                {% if tournament.rules.require_discord %}
                                <div class="requirement-item">
                                    <svg width="18" height="18" fill="currentColor" class="text-primary">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                        <path d="M22 4L12 14.01l-3-3"/>
                                    </svg>
                                    <span>Discord account required</span>
                                </div>
                                {% endif %}
                                
                                {% if tournament.rules.require_game_id %}
                                <div class="requirement-item">
                                    <svg width="18" height="18" fill="currentColor" class="text-primary">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                        <path d="M22 4L12 14.01l-3-3"/>
                                    </svg>
                                    <span>Game account ID required</span>
                                </div>
                                {% endif %}
                                
                                {% if tournament.rules.require_team_logo %}
                                <div class="requirement-item">
                                    <svg width="18" height="18" fill="currentColor" class="text-primary">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                        <path d="M22 4L12 14.01l-3-3"/>
                                    </svg>
                                    <span>Team logo required</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Restrictions -->
                        {% if tournament.rules.has_any_restrictions %}
                        <div class="restrictions-box">
                            <h3 class="restrictions-title">Restrictions</h3>
                            <div class="restrictions-list">
                                {% if tournament.rules.age_range_text %}
                                <div class="restriction-item">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                        <circle cx="12" cy="7" r="4"/>
                                    </svg>
                                    <span>Age: {{ tournament.rules.age_range_text }}</span>
                                </div>
                                {% endif %}
                                
                                {% if tournament.rules.region_restriction %}
                                <div class="restriction-item">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <line x1="2" y1="12" x2="22" y2="12"/>
                                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                                    </svg>
                                    <span>Region: {{ tournament.rules.region_restriction }}</span>
                                </div>
                                {% endif %}
                                
                                {% if tournament.rules.rank_restriction %}
                                <div class="restriction-item">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                    </svg>
                                    <span>Rank: {{ tournament.rules.rank_restriction }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Download Rules PDF -->
                        {% if tournament.media.rules_pdf %}
                        <a href="{{ tournament.media.rules_pdf.url }}" class="btn-download-rules" download>
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                            </svg>
                            Download Complete Rules (PDF)
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Media Gallery -->
                {% if tournament.media.has_promotional_images %}
                <div class="content-card">
                    <h2 class="card-title">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <path d="M21 15l-5-5L5 21"/>
                        </svg>
                        Media Gallery
                    </h2>
                    <div class="card-body">
                        <div class="media-gallery">
                            {% for image in tournament.media.get_promotional_images %}
                            <div class="gallery-item" data-image="{{ image.url }}">
                                <img src="{{ image.url }}" alt="Tournament media" loading="lazy">
                                <div class="gallery-overlay">
                                    <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"/>
                                        <path d="m21 21-4.35-4.35"/>
                                        <circle cx="11" cy="11" r="3"/>
                                    </svg>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Organizer Info -->
                {% if tournament.organizer %}
                <div class="content-card">
                    <h2 class="card-title">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        Organized By
                    </h2>
                    <div class="card-body">
                        <div class="organizer-info">
                            {% if tournament.organizer.profile_picture %}
                            <img src="{{ tournament.organizer.profile_picture.url }}" alt="{{ tournament.organizer.user.username }}" class="organizer-avatar">
                            {% else %}
                            <div class="organizer-avatar-placeholder">
                                {{ tournament.organizer.user.username|first|upper }}
                            </div>
                            {% endif %}
                            <div class="organizer-details">
                                <div class="organizer-name">{{ tournament.organizer.user.username }}</div>
                                <div class="organizer-meta">Tournament Organizer</div>
                                {% if tournament.organizer.user.email %}
                                <a href="mailto:{{ tournament.organizer.user.email }}" class="organizer-contact">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                        <path d="M22 6l-10 7L2 6"/>
                                    </svg>
                                    Contact Organizer
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
            </div>
            
            <!-- RIGHT COLUMN: Sidebar -->
            <div class="detail-sidebar">
                
                <!-- Quick Stats Card -->
                <div class="sidebar-card stats-card">
                    <h3 class="sidebar-card-title">Quick Stats</h3>
                    <div class="stats-grid">
                        {% if tournament.capacity %}
                        <div class="stat-item">
                            <div class="stat-icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                    <circle cx="9" cy="7" r="4"/>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ tournament.capacity.current_teams }}/{{ tournament.capacity.max_teams }}</div>
                                <div class="stat-label">Registered Teams</div>
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="capacity-progress">
                            <div class="progress-bar-track">
                                <div class="progress-bar-fill" style="width: {{ tournament.capacity.fill_percentage }}%"></div>
                            </div>
                            <div class="progress-label">{{ tournament.capacity.fill_percentage|floatformat:0 }}% Full</div>
                        </div>
                        {% endif %}
                        
                        {% if tournament.format %}
                        <div class="stat-item">
                            <div class="stat-icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ tournament.get_format_display }}</div>
                                <div class="stat-label">Format</div>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if tournament.tournament_type %}
                        <div class="stat-item">
                            <div class="stat-icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 6v6l4 2"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ tournament.get_tournament_type_display }}</div>
                                <div class="stat-label">Type</div>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if tournament.region %}
                        <div class="stat-item">
                            <div class="stat-icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="2" y1="12" x2="22" y2="12"/>
                                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ tournament.region }}</div>
                                <div class="stat-label">Region</div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Important Dates -->
                {% if tournament.schedule %}
                <div class="sidebar-card">
                    <h3 class="sidebar-card-title">Important Dates</h3>
                    <div class="dates-list">
                        {% if tournament.schedule.reg_open_at %}
                        <div class="date-item">
                            <div class="date-label">Registration Opens</div>
                            <div class="date-value">{{ tournament.schedule.reg_open_at|date:"M d, h:i A" }}</div>
                        </div>
                        {% endif %}
                        
                        {% if tournament.schedule.reg_close_at %}
                        <div class="date-item">
                            <div class="date-label">Registration Closes</div>
                            <div class="date-value">{{ tournament.schedule.reg_close_at|date:"M d, h:i A" }}</div>
                        </div>
                        {% endif %}
                        
                        {% if tournament.schedule.start_at %}
                        <div class="date-item highlight">
                            <div class="date-label">Tournament Starts</div>
                            <div class="date-value">{{ tournament.schedule.start_at|date:"M d, h:i A" }}</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Quick Actions -->
                <div class="sidebar-card actions-card">
                    <h3 class="sidebar-card-title">Quick Actions</h3>
                    <div class="quick-actions-list">
                        <a href="{% url 'tournaments:dashboard' tournament.slug %}" class="quick-action-btn">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"/>
                                <rect x="14" y="3" width="7" height="7"/>
                                <rect x="14" y="14" width="7" height="7"/>
                                <rect x="3" y="14" width="7" height="7"/>
                            </svg>
                            View Dashboard
                        </a>
                        
                        <a href="{% url 'tournaments:dashboard' tournament.slug %}" class="quick-action-btn">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>
                            </svg>
                            View Standings
                        </a>
                        
                        <a href="{% url 'tournaments:matches' tournament.slug %}" class="quick-action-btn">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2"/>
                                <path d="M16 2v4M8 2v4M3 10h18"/>
                            </svg>
                            View Matches
                        </a>
                        
                        {% if request.user.is_authenticated %}
                        <button class="quick-action-btn watchlist-btn" data-tournament-slug="{{ tournament.slug }}">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                            </svg>
                            Add to Watchlist
                        </button>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Share Card -->
                <div class="sidebar-card">
                    <h3 class="sidebar-card-title">Share Tournament</h3>
                    <div class="share-buttons">
                        <button class="share-btn-item facebook" data-share="facebook">
                            <svg width="20" height="20" fill="currentColor">
                                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
                            </svg>
                        </button>
                        <button class="share-btn-item twitter" data-share="twitter">
                            <svg width="20" height="20" fill="currentColor">
                                <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
                            </svg>
                        </button>
                        <button class="share-btn-item discord" data-share="discord">
                            <svg width="20" height="20" fill="currentColor">
                                <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/>
                            </svg>
                        </button>
                        <button class="share-btn-item copy" data-share="copy">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
</section>

<!-- SVG Icons Sprite -->
<svg style="display: none;">
    <defs>
        <symbol id="icon-check-circle" viewBox="0 0 24 24">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <path d="M22 4L12 14.01l-3-3"/>
        </symbol>
        <symbol id="icon-trophy" viewBox="0 0 24 24">
            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
            <path d="M18 2H6v7a6 6 0 0 0 12 0V2z"/>
        </symbol>
        <symbol id="icon-calendar" viewBox="0 0 24 24">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
        </symbol>
    </defs>
</svg>

<!-- Image Lightbox Modal -->
<div class="lightbox-modal" id="lightboxModal">
    <div class="lightbox-backdrop"></div>
    <button class="lightbox-close">×</button>
    <img src="" alt="Tournament media" class="lightbox-image">
    <button class="lightbox-prev">‹</button>
    <button class="lightbox-next">›</button>
</div>

{% endblock %}
