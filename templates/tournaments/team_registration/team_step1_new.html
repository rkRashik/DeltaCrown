{% extends "tournaments/team_registration/base.html" %}

{% block content %}
<div class="space-y-8">
    <!-- Step Header -->
    <div class="text-center">
        <h2 class="text-3xl font-bold text-white mb-2">
            <span class="text-4xl mr-2">üë•</span>
            Team Information
        </h2>
        <p class="text-gray-400">Register your team for {{ tournament.name }}</p>
    </div>

    <!-- Form -->
    <form method="POST" enctype="multipart/form-data" class="space-y-8">
        {% csrf_token %}
        <input type="hidden" name="step" value="1">

        <!-- Team Details Section -->
        <div class="gradient-border rounded-lg p-6">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                <span class="text-2xl mr-2">üèÜ</span>
                Team Details
                <span class="ml-auto text-xs bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full">From Your Team</span>
            </h3>
            
            <div class="bg-gray-800/30 border border-gray-700 rounded-lg p-4 mb-4">
                <p class="text-sm text-gray-400">
                    <i class="fas fa-info-circle mr-2"></i>
                    Team information is locked and loaded from your existing team. You cannot modify team details during registration.
                </p>
            </div>
            
            <div class="space-y-4">
                <!-- Team Name - LOCKED -->
                <div>
                    <label for="team_name" class="block text-sm font-medium text-gray-300 mb-2">
                        Team Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="team_name" name="team_name" required readonly
                        value="{{ user_team.name }}"
                        class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-gray-400 cursor-not-allowed">
                    <input type="hidden" name="team_id" value="{{ user_team.id }}">
                </div>

                <!-- Team Tag - LOCKED -->
                <div>
                    <label for="team_tag" class="block text-sm font-medium text-gray-300 mb-2">
                        Team Tag <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="team_tag" name="team_tag" required readonly
                        value="{{ user_team.tag }}"
                        class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-gray-400 cursor-not-allowed uppercase">
                </div>

                <!-- Team Region - CONDITIONAL -->
                {% if form_config.enable_team_region_field %}
                <div>
                    <label for="team_region" class="block text-sm font-medium text-gray-300 mb-2">
                        Team Region <span class="text-red-500">*</span>
                    </label>
                    <select id="team_region" name="team_region" required
                        class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white">
                        <option value="">Select your region</option>
                        <option value="South Asia">üåè South Asia</option>
                        <option value="Southeast Asia">üåè Southeast Asia</option>
                        <option value="Middle East">üåç Middle East</option>
                        <option value="Europe">üá™üá∫ Europe</option>
                        <option value="North America">üåé North America</option>
                        <option value="Other">üåç Other</option>
                    </select>
                </div>
                {% endif %}

                <!-- Team Logo - CONDITIONAL -->
                {% if form_config.enable_team_logo_field %}
                <div>
                    <label for="team_logo" class="block text-sm font-medium text-gray-300 mb-2">
                        Team Logo
                    </label>
                    <div class="text-xs text-gray-400 mb-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        Upload your team logo (optional, max 5MB, PNG/JPG)
                    </div>
                    <input type="file" id="team_logo" name="team_logo" accept="image/*"
                        class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-secondary">
                </div>
                {% endif %}

        <!-- Team Captain Section -->
        <div class="gradient-border rounded-lg p-6">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                <span class="text-2xl mr-2">‚≠ê</span>
                Team Captain (You)
            </h3>
            
            <div class="space-y-4">
                <!-- Captain Full Name - ALWAYS REQUIRED -->
                <div>
                    <label for="captain_full_name" class="block text-sm font-medium text-gray-300 mb-2">
                        Captain Full Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="captain_full_name" name="captain_full_name" required
                        value="{% if user.first_name or user.last_name %}{{ user.get_full_name }}{% endif %}"
                        placeholder="Captain's full name"
                        class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500">
                </div>

                <!-- Captain Display Name / IGN - CONDITIONAL -->
                {% if form_config.enable_captain_display_name_field %}
                <div>
                    <label for="captain_display_name" class="block text-sm font-medium text-gray-300 mb-2">
                        In-Game Name (IGN) <span class="text-red-500">*</span>
                    </label>
                    <div class="text-xs text-gray-400 mb-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        Your in-game display name or username
                    </div>
                    <input type="text" id="captain_display_name" name="captain_display_name" required
                        value="{% if user_profile and tournament.game.slug == 'valorant' %}{{ user_profile.game_id }}{% elif user_profile %}{{ user_profile.display_name }}{% endif %}"
                        placeholder="CaptainRazor"
                        class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500">
                </div>
                {% endif %}

                <!-- Captain Email - ALWAYS REQUIRED -->
                <div>
                    <label for="captain_email" class="block text-sm font-medium text-gray-300 mb-2">
                        Captain Email <span class="text-red-500">*</span>
                    </label>
                    <input type="email" id="captain_email" name="captain_email" required readonly
                        value="{{ user.email }}"
                        class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-gray-400 cursor-not-allowed">
                    <p class="text-xs text-gray-500 mt-1">Email cannot be changed during registration</p>
                </div>

                <div class="grid grid-cols-1 {% if form_config.enable_captain_phone_field or form_config.enable_captain_whatsapp_field %}md:grid-cols-2{% endif %} gap-4">
                    <!-- Captain Phone/WhatsApp - CONDITIONAL -->
                    {% if form_config.enable_captain_phone_field or form_config.enable_captain_whatsapp_field %}
                    <div>
                        <label for="captain_phone" class="block text-sm font-medium text-gray-300 mb-2">
                            {% if form_config.enable_captain_whatsapp_field %}WhatsApp Number{% else %}Phone Number{% endif %} <span class="text-red-500">*</span>
                        </label>
                        <input type="tel" id="captain_phone" name="captain_phone" required
                            value="{% if user_profile %}{{ user_profile.phone }}{% endif %}"
                            placeholder="01700000000"
                            class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500">
                    </div>
                    {% endif %}

                    <!-- Captain Discord - CONDITIONAL -->
                    {% if form_config.enable_captain_discord_field %}
                    <div>
                        <label for="captain_discord" class="block text-sm font-medium text-gray-300 mb-2">
                            Discord Username <span class="text-red-500">*</span>
                        </label>
                        <div class="text-xs text-gray-400 mb-2">
                            <i class="fas fa-info-circle mr-1"></i>
                            Format: username#1234 or new username format
                        </div>
                        <input type="text" id="captain_discord" name="captain_discord" required
                            value="{% if user_profile %}{{ user_profile.discord_id }}{% endif %}"
                            placeholder="CaptainRazor#1234"
                            class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500">
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Team Roster Section -->
        <div class="gradient-border rounded-lg p-6">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                <span class="text-2xl mr-2">üë•</span>
                Select Tournament Roster
                <span class="ml-auto text-xs bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded-full">
                    <i class="fas fa-lock mr-1"></i>
                    Selected players will be locked
                </span>
            </h3>
            
            <div class="bg-gray-800/30 border border-gray-700 rounded-lg p-4 mb-6">
                <div class="flex items-start gap-3">
                    <i class="fas fa-info-circle text-blue-400 text-xl mt-1"></i>
                    <div class="flex-1">
                        <p class="text-sm text-gray-300 font-semibold mb-2">Tournament Roster Requirements:</p>
                        <ul class="text-sm text-gray-400 space-y-1">
                            <li>‚Ä¢ <strong class="text-white">{{ tournament.game.min_team_size }}</strong> starting players required (main roster)</li>
                            <li>‚Ä¢ <strong class="text-white">{{ tournament.game.max_team_size|add:"-"|add:tournament.game.min_team_size|default:"0-2" }}</strong> substitute(s) allowed</li>
                            <li>‚Ä¢ Selected players will be <span class="text-yellow-400 font-semibold">locked</span> and cannot join other teams until tournament ends</li>
                            <li>‚Ä¢ You can only select from your current active team members</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Available Team Members Pool -->
            <div class="mb-6">
                <h4 class="text-lg font-semibold text-white mb-3 flex items-center">
                    <i class="fas fa-users mr-2 text-blue-400"></i>
                    Available Team Members
                    <span class="ml-2 text-sm text-gray-400">({{ team_members|length }} members)</span>
                </h4>
                
                <div class="grid grid-cols-1 gap-3" id="available-members">
                    {% for member in team_members %}
                    <div class="member-card bg-gray-800/50 border border-gray-700 rounded-lg p-4 cursor-pointer hover:border-blue-500 transition-all"
                         data-member-id="{{ member.id }}"
                         data-member-name="{{ member.profile.user.get_full_name|default:member.profile.user.username }}"
                         data-member-ign="{% if tournament.game.slug == 'valorant' and member.profile.game_id %}{{ member.profile.game_id }}{% else %}{{ member.profile.display_name|default:member.profile.user.username }}{% endif %}"
                         data-member-email="{{ member.profile.user.email }}"
                         data-is-captain="{% if member.role == 'OWNER' or member.role == 'CAPTAIN' %}true{% else %}false{% endif %}"
                         onclick="selectMember(this)">
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3 flex-1">
                                <!-- Member Avatar -->
                                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg">
                                    {{ member.profile.user.username.0|upper }}
                                </div>
                                
                                <!-- Member Info -->
                                <div class="flex-1">
                                    <div class="flex items-center gap-2">
                                        <span class="text-white font-semibold">{{ member.profile.user.get_full_name|default:member.profile.user.username }}</span>
                                        {% if member.role == 'OWNER' or member.role == 'CAPTAIN' %}
                                        <span class="px-2 py-0.5 bg-yellow-500/20 text-yellow-400 text-xs rounded-full font-semibold">
                                            <i class="fas fa-star mr-1"></i>Captain
                                        </span>
                                        {% endif %}
                                    </div>
                                    <div class="text-sm text-gray-400 font-mono mt-1">
                                        {% if tournament.game.slug == 'valorant' and member.profile.game_id %}
                                            {{ member.profile.game_id }}
                                        {% else %}
                                            {{ member.profile.display_name|default:member.profile.user.username }}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Select Button -->
                            <button type="button" class="select-btn px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-semibold transition-all">
                                <i class="fas fa-plus mr-1"></i>
                                Select
                            </button>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center text-gray-400 py-8">
                        <i class="fas fa-users-slash text-4xl mb-3"></i>
                        <p>No team members available</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Selected Tournament Roster -->
            <div class="bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-700/50 rounded-lg p-6">
                <h4 class="text-lg font-semibold text-white mb-4 flex items-center">
                    <i class="fas fa-clipboard-check mr-2 text-green-400"></i>
                    Selected Tournament Roster
                    <span id="roster-count-badge" class="ml-auto px-3 py-1 bg-blue-600 text-white text-sm rounded-full font-semibold">
                        0 / {{ tournament.game.min_team_size }}
                    </span>
                </h4>

                <!-- Starting Lineup -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <h5 class="font-semibold text-white">
                            <i class="fas fa-gamepad mr-2 text-blue-400"></i>
                            Starting Lineup
                        </h5>
                        <span class="text-sm text-gray-400">
                            <span id="starting-count">0</span> / {{ tournament.game.min_team_size }}
                        </span>
                    </div>
                    <div id="starting-lineup" class="space-y-2 min-h-[100px]">
                        <div class="empty-state text-center py-8 text-gray-500">
                            <i class="fas fa-hand-pointer text-3xl mb-2"></i>
                            <p>Select players from available members above</p>
                        </div>
                    </div>
                </div>

                <!-- Substitutes -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <h5 class="font-semibold text-white">
                            <i class="fas fa-exchange-alt mr-2 text-green-400"></i>
                            Substitutes
                        </h5>
                        <span class="text-sm text-gray-400">
                            <span id="substitute-count">0</span> / {{ tournament.game.max_team_size|add:"-"|add:tournament.game.min_team_size|default:"2" }}
                        </span>
                    </div>
                    <div id="substitutes-lineup" class="space-y-2 min-h-[80px]">
                        <div class="empty-state text-center py-6 text-gray-500">
                            <i class="fas fa-users text-2xl mb-2"></i>
                            <p class="text-sm">Optional: Add substitute players</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Roster Status Messages -->
            <div id="roster-status" class="mt-4 space-y-2"></div>
        </div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between items-center pt-6">
            <a href="{{ tournament.get_absolute_url }}" 
               class="px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>Cancel
            </a>
            <button type="submit" 
                    class="px-8 py-3 bg-primary hover:bg-secondary text-white rounded-lg font-semibold transition-colors">
                Next: Review & Agreements
                <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>
    </form>
</div>

<script>
// ============================================================================
// ESPORTS TOURNAMENT ROSTER SELECTION SYSTEM
// ============================================================================

const TOURNAMENT_CONFIG = {
    minStarting: {{ tournament.game.min_team_size|default:5 }},
    maxStarting: {{ tournament.game.min_team_size|default:5 }},
    minSubstitutes: 0,
    maxSubstitutes: {{ tournament.game.max_team_size|default:7 }}  - {{ tournament.game.min_team_size|default:5 }},
    enableRosterDisplayNames: {{ form_config.enable_roster_display_names_field|yesno:"true,false" }},
    enableRosterEmails: {{ form_config.enable_roster_emails_field|yesno:"true,false" }},
};

// State management
const selectedRoster = {
    starting: [],
    substitutes: []
};

// ============================================================================
// MEMBER SELECTION
// ============================================================================

function selectMember(card) {
    const memberId = card.dataset.memberId;
    const memberName = card.dataset.memberName;
    const memberIgn = card.dataset.memberIgn;
    const memberEmail = card.dataset.memberEmail;
    const isCaptain = card.dataset.isCaptain === 'true';
    
    // Check if already selected
    const alreadySelected = [...selectedRoster.starting, ...selectedRoster.substitutes]
        .some(m => m.id === memberId);
    
    if (alreadySelected) {
        showStatus('This member is already selected for the tournament roster', 'warning');
        return;
    }
    
    // Determine where to add (starting lineup or substitutes)
    if (selectedRoster.starting.length < TOURNAMENT_CONFIG.maxStarting) {
        // Add to starting lineup
        const member = {
            id: memberId,
            name: memberName,
            ign: memberIgn,
            email: memberEmail,
            isCaptain: isCaptain,
            role: isCaptain ? 'Captain' : 'Player'
        };
        
        selectedRoster.starting.push(member);
        addToStartingLineup(member);
        showStatus(`${memberName} added to starting lineup`, 'success');
    } else if (selectedRoster.substitutes.length < TOURNAMENT_CONFIG.maxSubstitutes) {
        // Add to substitutes
        const member = {
            id: memberId,
            name: memberName,
            ign: memberIgn,
            email: memberEmail,
            isCaptain: false,
            role: 'Substitute'
        };
        
        selectedRoster.substitutes.push(member);
        addToSubstitutesLineup(member);
        showStatus(`${memberName} added as substitute`, 'success');
    } else {
        showStatus('Roster is full! Remove a player to add another', 'error');
        return;
    }
    
    // Disable the card
    card.classList.add('opacity-50', 'pointer-events-none');
    card.querySelector('.select-btn').innerHTML = '<i class="fas fa-check mr-1"></i>Selected';
    card.querySelector('.select-btn').classList.remove('bg-blue-600', 'hover:bg-blue-500');
    card.querySelector('.select-btn').classList.add('bg-gray-600');
    
    updateRosterCounts();
    validateRoster();
}

function removeMember(memberId, type) {
    // Find and remove from state
    const list = type === 'starting' ? selectedRoster.starting : selectedRoster.substitutes;
    const index = list.findIndex(m => m.id === memberId);
    
    if (index === -1) return;
    
    const member = list[index];
    list.splice(index, 1);
    
    // Re-enable the card in available members
    const card = document.querySelector(`[data-member-id="${memberId}"]`);
    if (card) {
        card.classList.remove('opacity-50', 'pointer-events-none');
        card.querySelector('.select-btn').innerHTML = '<i class="fas fa-plus mr-1"></i>Select';
        card.querySelector('.select-btn').classList.remove('bg-gray-600');
        card.querySelector('.select-btn').classList.add('bg-blue-600', 'hover:bg-blue-500');
    }
    
    // Remove from UI
    document.getElementById(`${type}-${memberId}`)?.remove();
    
    // Show empty state if needed
    if (type === 'starting' && selectedRoster.starting.length === 0) {
        document.getElementById('starting-lineup').innerHTML = `
            <div class="empty-state text-center py-8 text-gray-500">
                <i class="fas fa-hand-pointer text-3xl mb-2"></i>
                <p>Select players from available members above</p>
            </div>
        `;
    }
    
    if (type === 'substitutes' && selectedRoster.substitutes.length === 0) {
        document.getElementById('substitutes-lineup').innerHTML = `
            <div class="empty-state text-center py-6 text-gray-500">
                <i class="fas fa-users text-2xl mb-2"></i>
                <p class="text-sm">Optional: Add substitute players</p>
            </div>
        `;
    }
    
    showStatus(`${member.name} removed from roster`, 'info');
    updateRosterCounts();
    validateRoster();
}

// ============================================================================
// UI RENDERING
// ============================================================================

function addToStartingLineup(member) {
    const container = document.getElementById('starting-lineup');
    
    // Remove empty state
    container.querySelector('.empty-state')?.remove();
    
    const position = selectedRoster.starting.length;
    
    const html = `
        <div id="starting-${member.id}" class="selected-member-card bg-gray-800 border-l-4 border-blue-500 rounded-lg p-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3 flex-1">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white font-bold">
                        ${position}
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-white font-semibold">${member.name}</span>
                            ${member.isCaptain ? '<span class="px-2 py-0.5 bg-yellow-500/20 text-yellow-400 text-xs rounded-full font-semibold"><i class="fas fa-star mr-1"></i>Captain</span>' : ''}
                        </div>
                        <div class="text-sm text-gray-400 font-mono">${member.ign}</div>
                    </div>
                </div>
                <button type="button" onclick="removeMember('${member.id}', 'starting')" 
                    class="px-3 py-1.5 bg-red-600/20 hover:bg-red-600 text-red-400 hover:text-white rounded transition-all">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Hidden inputs for form submission -->
            <input type="hidden" name="starting_${position}_id" value="${member.id}">
            <input type="hidden" name="starting_${position}_name" value="${member.name}">
            <input type="hidden" name="starting_${position}_ign" value="${member.ign}">
            <input type="hidden" name="starting_${position}_email" value="${member.email}">
            <input type="hidden" name="starting_${position}_role" value="${member.role}">
        </div>
    `;
    
    container.insertAdjacentHTML('beforeend', html);
}

function addToSubstitutesLineup(member) {
    const container = document.getElementById('substitutes-lineup');
    
    // Remove empty state
    container.querySelector('.empty-state')?.remove();
    
    const position = selectedRoster.substitutes.length;
    
    const html = `
        <div id="substitutes-${member.id}" class="selected-member-card bg-gray-800 border-l-4 border-green-500 rounded-lg p-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3 flex-1">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-500 to-green-700 flex items-center justify-center text-white font-bold text-sm">
                        SUB
                    </div>
                    <div class="flex-1">
                        <div class="text-white font-semibold mb-1">${member.name}</div>
                        <div class="text-sm text-gray-400 font-mono">${member.ign}</div>
                    </div>
                </div>
                <button type="button" onclick="removeMember('${member.id}', 'substitutes')" 
                    class="px-3 py-1.5 bg-red-600/20 hover:bg-red-600 text-red-400 hover:text-white rounded transition-all">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Hidden inputs for form submission -->
            <input type="hidden" name="substitute_${position}_id" value="${member.id}">
            <input type="hidden" name="substitute_${position}_name" value="${member.name}">
            <input type="hidden" name="substitute_${position}_ign" value="${member.ign}">
            <input type="hidden" name="substitute_${position}_email" value="${member.email}">
            <input type="hidden" name="substitute_${position}_role" value="Substitute">
        </div>
    `;
    
    container.insertAdjacentHTML('beforeend', html);
}

// ============================================================================
// VALIDATION & STATUS
// ============================================================================

function updateRosterCounts() {
    const totalSelected = selectedRoster.starting.length + selectedRoster.substitutes.length;
    
    document.getElementById('roster-count-badge').textContent = 
        `${totalSelected} / ${TOURNAMENT_CONFIG.maxStarting + TOURNAMENT_CONFIG.maxSubstitutes}`;
    
    document.getElementById('starting-count').textContent = selectedRoster.starting.length;
    document.getElementById('substitute-count').textContent = selectedRoster.substitutes.length;
}

function validateRoster() {
    const statusContainer = document.getElementById('roster-status');
    statusContainer.innerHTML = '';
    
    const startingCount = selectedRoster.starting.length;
    const isValid = startingCount >= TOURNAMENT_CONFIG.minStarting;
    
    if (startingCount < TOURNAMENT_CONFIG.minStarting) {
        const needed = TOURNAMENT_CONFIG.minStarting - startingCount;
        statusContainer.innerHTML = `
            <div class="flex items-center gap-2 p-3 bg-red-900/20 border border-red-700/50 rounded-lg text-red-400">
                <i class="fas fa-exclamation-triangle"></i>
                <span>You need to select <strong>${needed} more player${needed > 1 ? 's' : ''}</strong> for starting lineup</span>
            </div>
        `;
    } else if (startingCount === TOURNAMENT_CONFIG.minStarting) {
        statusContainer.innerHTML = `
            <div class="flex items-center gap-2 p-3 bg-green-900/20 border border-green-700/50 rounded-lg text-green-400">
                <i class="fas fa-check-circle"></i>
                <span>Roster is valid! You can proceed to the next step</span>
            </div>
        `;
    }
    
    return isValid;
}

function showStatus(message, type = 'info') {
    const colors = {
        success: 'bg-green-900/20 border-green-700/50 text-green-400',
        error: 'bg-red-900/20 border-red-700/50 text-red-400',
        warning: 'bg-yellow-900/20 border-yellow-700/50 text-yellow-400',
        info: 'bg-blue-900/20 border-blue-700/50 text-blue-400'
    };
    
    const icons = {
        success: 'fa-check-circle',
        error: 'fa-exclamation-circle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle'
    };
    
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 max-w-md p-4 rounded-lg border ${colors[type]} shadow-lg z-50 animate-slide-in`;
    notification.innerHTML = `
        <div class="flex items-center gap-3">
            <i class="fas ${icons[type]} text-xl"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.classList.add('animate-slide-out');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// ============================================================================
// FORM SUBMISSION
// ============================================================================

document.querySelector('form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    if (!validateRoster()) {
        showStatus('Please select all required players before continuing', 'error');
        window.scrollTo({ top: 0, behavior: 'smooth' });
        return;
    }
    
    // Form is valid, submit
    this.submit();
});

// ============================================================================
// INITIALIZATION
// ============================================================================

window.addEventListener('DOMContentLoaded', function() {
    console.log('Tournament Roster Selection initialized');
    console.log('Config:', TOURNAMENT_CONFIG);
    validateRoster();
});
</script>

<style>
@keyframes slide-in {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slide-out {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

.animate-slide-in {
    animation: slide-in 0.3s ease-out;
}

.animate-slide-out {
    animation: slide-out 0.3s ease-in;
}

.member-card {
    transition: all 0.2s ease;
}

.member-card:hover:not(.opacity-50) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.selected-member-card {
    animation: slide-in 0.3s ease-out;
}
</style>
{% endblock %}
