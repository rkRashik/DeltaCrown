{% extends "tournaments/base.html" %}
{% load static humanize %}

{# ─────────────────────────────────────────────────────────
   Group Standings — FE-T-013
   Context: tournament, groups_with_standings,
            stat_columns, stat_labels, game_name, game_slug
   Phase 4 Frontend Rebuild
   ───────────────────────────────────────────────────────── #}

{% block title %}Group Standings — {{ tournament.name }} | DeltaCrown{% endblock %}

{% block tournament_content %}

<div class="max-w-5xl mx-auto px-4 sm:px-6 py-8">

  {# ── Header ── #}
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
    <div>
      <a href="{% url 'tournaments:detail' tournament.slug %}" class="text-xs text-gray-500 hover:text-dc-cyan transition mb-2 inline-block">
        <i data-lucide="arrow-left" class="w-3 h-3 inline mr-1"></i> {{ tournament.name }}
      </a>
      <h1 class="text-2xl font-display font-bold text-white">
        <i data-lucide="layout-grid" class="w-6 h-6 inline mr-2 text-dc-purple"></i> Group Standings
      </h1>
      <p class="text-sm text-gray-400 mt-1">{{ game_name|default:"" }}</p>
    </div>
    <div class="flex items-center gap-3">
      <a href="{% url 'tournaments:bracket' tournament.slug %}" class="px-3 py-1.5 text-xs text-gray-400 bg-white/5 rounded-lg border border-dc-border hover:bg-white/10 transition">
        <i data-lucide="git-branch" class="w-3 h-3 inline mr-1"></i> Bracket
      </a>
      <a href="{% url 'tournaments:leaderboard' tournament.slug %}" class="px-3 py-1.5 text-xs text-gray-400 bg-white/5 rounded-lg border border-dc-border hover:bg-white/10 transition">
        <i data-lucide="bar-chart-3" class="w-3 h-3 inline mr-1"></i> Leaderboard
      </a>
    </div>
  </div>

  {# ── Group Tables ── #}
  {% for group_data in groups_with_standings %}
    <div class="glass rounded-xl overflow-hidden mb-6">
      <div class="px-6 py-4 border-b border-dc-border bg-white/[0.02]">
        <h3 class="text-sm font-display font-semibold text-white">
          <i data-lucide="users" class="w-4 h-4 inline mr-1 text-dc-purple"></i>
          {{ group_data.group.name|default:"Group" }}
        </h3>
      </div>

      {% if group_data.standings %}
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b border-dc-border">
                <th class="px-4 py-2.5 text-left text-[10px] uppercase tracking-wider text-gray-500 w-10">#</th>
                <th class="px-4 py-2.5 text-left text-[10px] uppercase tracking-wider text-gray-500">Team / Player</th>
                <th class="px-4 py-2.5 text-center text-[10px] uppercase tracking-wider text-gray-500">P</th>
                {% for label in stat_labels %}
                  <th class="px-4 py-2.5 text-center text-[10px] uppercase tracking-wider text-gray-500">{{ label }}</th>
                {% endfor %}
                <th class="px-4 py-2.5 text-right text-[10px] uppercase tracking-wider text-gray-500">Pts</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-dc-border">
              {% for standing in group_data.standings %}
                <tr class="hover:bg-white/[0.02] transition
                  {% if standing.rank <= 2 %}bg-green-900/[0.03]{% endif %}">
                  <td class="px-4 py-3">
                    <span class="text-sm font-mono {% if standing.rank <= 2 %}text-green-400{% else %}text-gray-500{% endif %}">
                      {{ standing.rank }}
                    </span>
                  </td>
                  <td class="px-4 py-3">
                    <div class="flex items-center gap-2">
                      {% if standing.rank <= 2 %}
                        <i data-lucide="chevron-up" class="w-3 h-3 text-green-400 flex-shrink-0"></i>
                      {% endif %}
                      <span class="text-sm text-white truncate">
                        {% if standing.team %}{{ standing.team.name }}{% elif standing.user %}{{ standing.user.username }}{% else %}—{% endif %}
                      </span>
                    </div>
                  </td>
                  <td class="px-4 py-3 text-center text-sm text-gray-400">
                    {{ standing.matches_played|default:0 }}
                  </td>
                  {% for col in stat_columns %}
                    <td class="px-4 py-3 text-center text-sm text-gray-300">
                      {% with val=standing|attr:col %}{{ val|default:0 }}{% endwith %}
                    </td>
                  {% endfor %}
                  <td class="px-4 py-3 text-right text-sm font-mono font-bold text-dc-gold">
                    {{ standing.points|default:0 }}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="px-6 py-8 text-center">
          <p class="text-xs text-gray-600">No standings data for this group yet</p>
        </div>
      {% endif %}
    </div>
  {% empty %}
    <div class="glass rounded-xl p-12 text-center">
      <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-dc-surface flex items-center justify-center">
        <i data-lucide="layout-grid" class="w-8 h-8 text-gray-600"></i>
      </div>
      <h2 class="text-lg font-display font-bold text-white mb-2">No Groups Configured</h2>
      <p class="text-sm text-gray-400">Group standings will appear once groups are set up.</p>
    </div>
  {% endfor %}

  {# Legend #}
  {% if groups_with_standings %}
    <div class="flex items-center gap-4 mt-4">
      <div class="flex items-center gap-1.5">
        <div class="w-3 h-3 rounded-sm bg-green-900/30 border border-green-700/20"></div>
        <span class="text-[10px] text-gray-500">Qualifies for next round</span>
      </div>
    </div>
  {% endif %}

</div>

{% endblock %}
