{% load humanize %}
{% load static %}
<article class="t-card glass rounded-2xl card"
         data-game="{{ tournament.get_game_display|default_if_none:'' }}"
         data-status="{{ tournament.get_status_display|default_if_none:'' }}"
         {% if tournament.start_at %}data-start="{{ tournament.start_at|date:'c' }}"
         {% elif tournament.settings and tournament.settings.start_at %}data-start="{{ tournament.settings.start_at|date:'c' }}"{% endif %}
         {% if tournament.settings and tournament.settings.prize_pool_bdt %}data-prize="{{ tournament.settings.prize_pool_bdt|floatformat:0 }}"
         {% elif tournament.prize_pool_bdt %}data-prize="{{ tournament.prize_pool_bdt|floatformat:0 }}"{% endif %}
         {% if tournament.settings and tournament.settings.entry_fee_bdt %}data-entry="{{ tournament.settings.entry_fee_bdt|floatformat:0 }}"
         {% elif tournament.entry_fee_bdt %}data-entry="{{ tournament.entry_fee_bdt|floatformat:0 }}"{% endif %}>

  <div class="t-card__media">
    {% if tournament.banner_url %}
      {% static 'siteui/svg/logo-deltacrown.svg' as dc_ph %}
      <img src="{{ tournament.banner_url }}" alt="" class="t-card__img" loading="lazy" onerror="this.onerror=null;this.src='{{ dc_ph }}'">
    {% else %}
      <div class="t-card__ph" aria-hidden="true"></div>
    {% endif %}
    <div class="t-card__scrim" aria-hidden="true"></div>
    <div class="t-card__status">
      {% include "tournaments/partials/_status_pill.html" with status=tournament.status %}
    </div>
    <div class="t-card__badge">
      {% if tournament.settings and tournament.settings.entry_fee_bdt %}
        <span class="pill">৳{{ tournament.settings.entry_fee_bdt|floatformat:0|intcomma }}</span>
      {% elif tournament.entry_fee_bdt %}
        <span class="pill">৳{{ tournament.entry_fee_bdt|floatformat:0|intcomma }}</span>
      {% else %}
        <span class="pill pill--open">Free</span>
      {% endif %}
    </div>
  </div>

  <div class="t-card__body card-body space-y-3">
    <h3 class="t-card__title card-title">{% firstof tournament.name tournament.title "Tournament" %}</h3>
    <div class="t-card__sub text-muted">
      {% if tournament.get_game_display %}{{ tournament.get_game_display }}{% else %}Esports{% endif %}
    </div>

    <dl class="t-card__meta">
      <div><dt>Start</dt><dd>
        {% if tournament.start_at %}{{ tournament.start_at|date:"M d, Y H:i" }}
        {% elif tournament.settings and tournament.settings.start_at %}{{ tournament.settings.start_at|date:"M d, Y H:i" }}
        {% else %}TBA{% endif %}
      </dd></div>
      <div><dt>Entry</dt><dd>
        {% if tournament.settings and tournament.settings.entry_fee_bdt %}
          ৳{{ tournament.settings.entry_fee_bdt|floatformat:0|intcomma }}
        {% elif tournament.entry_fee_bdt %}
          ৳{{ tournament.entry_fee_bdt|floatformat:0|intcomma }}
        {% else %}Free{% endif %}
      </dd></div>
      <div><dt>Prize</dt><dd>
        {% if tournament.settings and tournament.settings.prize_pool_bdt %}
          ৳{{ tournament.settings.prize_pool_bdt|floatformat:0|intcomma }}
        {% elif tournament.prize_pool_bdt %}
          ৳{{ tournament.prize_pool_bdt|floatformat:0|intcomma }}
        {% else %}TBA{% endif %}
      </dd></div>
    </dl>

    <div class="t-card__actions card-actions">
      {% if tournament.slug %}
        {% if tournament.registration_open %}
          <a class="btn-primary" href="{% url 'tournaments:register' slug=tournament.slug %}">Register</a>
          <a class="btn-secondary" href="{% url 'tournaments:detail' slug=tournament.slug %}">Details</a>
        {% elif tournament.is_live and tournament.settings and tournament.settings.stream_youtube_url %}
          <a class="btn-primary" href="{% url 'tournaments:watch' slug=tournament.slug %}">Watch Live</a>
          <a class="btn-secondary" href="{% url 'tournaments:detail' slug=tournament.slug %}">Details</a>
        {% elif tournament.is_live and tournament.settings and tournament.settings.stream_facebook_url %}
          <a class="btn-primary" href="{% url 'tournaments:watch' slug=tournament.slug %}">Watch Live</a>
          <a class="btn-secondary" href="{% url 'tournaments:detail' slug=tournament.slug %}">Details</a>
        {% else %}
          <a class="btn-secondary" href="{% url 'tournaments:detail' slug=tournament.slug %}">Details</a>
        {% endif %}
      {% else %}
        <a class="btn-secondary" href="{% url 'tournaments:list' %}">Details</a>
      {% endif %}
    </div>
  </div>
</article>
