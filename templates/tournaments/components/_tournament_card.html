{% comment %}
─── Tournament Card Partial ───
Usage: include "tournaments/components/_tournament_card.html" with tournament=t

Context (from parent template):
  tournament                  — Tournament model instance (with .game, .registration_count annotated)
  user_registered_tournaments — set of tournament IDs user is registered for
{% endcomment %}
{% load humanize tournament_tags %}

{% with status=tournament.status game=tournament.game %}
<a href="{% url 'tournaments:detail' tournament.slug %}"
   class="card-modern group cursor-pointer block{% if status == 'completed' %} opacity-75 hover:opacity-100 grayscale hover:grayscale-0{% endif %}{% if status == 'live' %} border-red-500/20{% endif %}">

  {# ── Card Image ── #}
  <div class="card-img-wrap">
    {% if tournament.banner_image %}
      <img src="{{ tournament.banner_image.url }}" alt="{{ tournament.name }}" class="w-full h-full object-cover" loading="lazy">
    {% elif tournament.thumbnail_image %}
      <img src="{{ tournament.thumbnail_image.url }}" alt="{{ tournament.name }}" class="w-full h-full object-cover" loading="lazy">
    {% else %}
      <div class="w-full h-full bg-gradient-to-br from-dc-dark to-dc-surface flex items-center justify-center">
        <i data-lucide="trophy" class="w-12 h-12 text-white/10"></i>
      </div>
    {% endif %}

    {# Format badge (top-left) #}
    <div class="absolute top-3 left-3 flex gap-2 z-10">
      <span class="bg-black/60 backdrop-blur border border-white/10 text-white text-[10px] font-bold px-2 py-1 rounded flex items-center gap-1">
        <i data-lucide="users" class="w-3 h-3 text-dc-cyan"></i>
        {{ tournament.get_participation_type_display }}
      </span>
    </div>

    {# Status badge (top-right) #}
    <div class="absolute top-3 right-3 z-10">
      {% include "tournaments/components/_status_badge.html" with status=status %}
    </div>
  </div>

  {# ── Card Body ── #}
  <div class="p-5{% if status == 'live' %} relative overflow-hidden{% endif %}">
    {% if status == 'live' %}
    <div class="absolute top-0 right-0 w-32 h-32 bg-red-600/10 rounded-full blur-3xl -z-10 pointer-events-none"></div>
    {% endif %}

    {# Game + Date row #}
    <div class="flex items-center justify-between mb-2">
      <span class="text-[10px] font-bold uppercase tracking-wider
        {% if game.slug == 'valorant' %}text-red-400{% elif game.slug == 'pubg-mobile' %}text-yellow-500{% elif game.slug == 'free-fire' %}text-green-500{% elif game.slug == 'cs2' %}text-orange-500{% else %}text-dc-cyan{% endif %}">
        {{ game.display_name }}
      </span>
      {% if status == 'live' %}
        <span class="text-[10px] text-red-400 flex items-center gap-1">
          <i data-lucide="eye" class="w-3 h-3"></i> Live
        </span>
      {% elif tournament.tournament_start %}
        <span class="text-[10px] text-gray-500">{{ tournament.tournament_start|date:"M j" }}</span>
      {% endif %}
    </div>

    {# Title #}
    <h3 class="font-display font-bold text-lg text-white mb-4 line-clamp-1 transition-colors
      {% if status == 'live' %}group-hover:text-red-500{% else %}group-hover:text-dc-cyan{% endif %}">
      {{ tournament.name }}
    </h3>

    {# Prize / Entry / Slots strip — or Live score placeholder #}
    {% if status == 'completed' %}
      {# Winner banner #}
      <div class="p-3 rounded-lg bg-gradient-to-r from-dc-gold/10 to-transparent border border-dc-gold/20 mb-4 flex items-center gap-3">
        <div class="w-8 h-8 rounded bg-dc-gold/20 flex items-center justify-center text-dc-gold">
          <i data-lucide="crown" class="w-4 h-4"></i>
        </div>
        <div>
          <div class="text-[10px] font-bold text-dc-gold uppercase">Completed</div>
          <div class="text-sm font-bold text-white">View Results</div>
        </div>
      </div>
    {% else %}
      <div class="flex items-center justify-between p-3 rounded-lg
        {% if status == 'live' %}bg-red-500/5 border border-red-500/10{% else %}bg-white/5 border border-white/5{% endif %} mb-4">
        <div class="text-center">
          <div class="text-[10px] text-gray-500 uppercase font-bold">Prize</div>
          <div class="text-dc-gold font-bold font-display">
            {% if tournament.prize_pool > 0 %}
              {{ tournament.prize_currency }}{{ tournament.prize_pool|floatformat:0|intcomma }}
            {% elif tournament.prize_deltacoin > 0 %}
              {{ tournament.prize_deltacoin|intcomma }} DC
            {% else %}
              —
            {% endif %}
          </div>
        </div>
        <div class="w-px h-6 bg-white/10"></div>
        <div class="text-center">
          <div class="text-[10px] text-gray-500 uppercase font-bold">Entry</div>
          <div class="text-white font-bold font-display">
            {% if tournament.has_entry_fee %}
              {{ tournament.entry_fee_currency }}{{ tournament.entry_fee_amount|floatformat:0 }}
            {% else %}
              Free
            {% endif %}
          </div>
        </div>
        <div class="w-px h-6 bg-white/10"></div>
        <div class="text-center">
          <div class="text-[10px] text-gray-500 uppercase font-bold">Slots</div>
          <div class="text-white font-bold font-display">
            {{ tournament.registration_count|default:"0" }}/{{ tournament.max_participants }}
          </div>
        </div>
      </div>
    {% endif %}

    {# CTA button #}
    {% if tournament.id|in_set:user_registered_tournaments %}
      <span class="w-full py-2.5 rounded-lg bg-dc-purple/20 border border-dc-purple/30 text-dc-purple font-bold text-sm flex items-center justify-center gap-2">
        <i data-lucide="check-circle" class="w-4 h-4"></i> Registered
      </span>
    {% elif status == 'registration_open' %}
      <span class="w-full py-2.5 rounded-lg bg-dc-cyan hover:bg-dc-cyan/90 text-black font-bold text-sm transition-all flex items-center justify-center gap-2">
        Register {{ tournament.get_participation_type_display }} <i data-lucide="arrow-right" class="w-4 h-4"></i>
      </span>
    {% elif status == 'live' %}
      <span class="w-full py-2.5 rounded-lg bg-white/5 border border-white/10 hover:bg-red-600 hover:border-red-600 hover:text-white text-gray-300 font-bold text-sm transition-all flex items-center justify-center gap-2">
        <i data-lucide="tv" class="w-4 h-4"></i> Watch Stream
      </span>
    {% elif status == 'completed' %}
      <span class="w-full py-2.5 rounded-lg bg-transparent border border-white/10 hover:bg-white/5 text-gray-400 hover:text-white font-bold text-sm transition-all flex items-center justify-center gap-2">
        View Results
      </span>
    {% elif status == 'published' %}
      <span class="w-full py-2.5 rounded-lg bg-white/5 border border-dc-purple/30 hover:bg-dc-purple/10 text-gray-300 hover:text-white font-bold text-sm transition-all flex items-center justify-center gap-2">
        <i data-lucide="bell" class="w-4 h-4"></i> Coming Soon
      </span>
    {% endif %}
  </div>
</a>
{% endwith %}
