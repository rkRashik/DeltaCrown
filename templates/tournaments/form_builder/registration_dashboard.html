{% extends "tournaments/base.html" %}
{% load static %}

{# ─────────────────────────────────────────────────────────
   User Registration Dashboard (My Registrations)
   Context: registrations, draft_count, submitted_count,
            approved_count
   Phase 4 Frontend Rebuild
   ───────────────────────────────────────────────────────── #}

{% block title %}My Registrations | DeltaCrown{% endblock %}

{% block tournament_content %}

<div class="max-w-5xl mx-auto px-4 sm:px-6 py-8">

  {# ── Header ── #}
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-2xl font-display font-black text-white">My Registrations</h1>
      <p class="text-sm text-gray-500 mt-1">Track your tournament applications</p>
    </div>
    <a href="{% url 'tournaments:list' %}" class="px-4 py-2 text-xs bg-dc-cyan text-dc-dark font-bold rounded-lg hover:bg-dc-cyan/90 transition">
      <i data-lucide="search" class="w-3.5 h-3.5 inline mr-1"></i> Browse Tournaments
    </a>
  </div>

  {# ── Quick Stats ── #}
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
    <div class="glass rounded-xl p-4 text-center">
      <p class="text-2xl font-display font-black text-amber-400">{{ draft_count|default:"0" }}</p>
      <p class="text-[10px] text-gray-500 uppercase tracking-wider mt-1">Drafts</p>
    </div>
    <div class="glass rounded-xl p-4 text-center">
      <p class="text-2xl font-display font-black text-dc-cyan">{{ submitted_count|default:"0" }}</p>
      <p class="text-[10px] text-gray-500 uppercase tracking-wider mt-1">Submitted</p>
    </div>
    <div class="glass rounded-xl p-4 text-center">
      <p class="text-2xl font-display font-black text-green-400">{{ approved_count|default:"0" }}</p>
      <p class="text-[10px] text-gray-500 uppercase tracking-wider mt-1">Approved</p>
    </div>
  </div>

  {# ── Registrations List ── #}
  {% if registrations %}
    <div class="space-y-3">
      {% for reg in registrations %}
        <div class="glass rounded-xl p-4 flex flex-col sm:flex-row sm:items-center gap-4 hover:bg-white/[0.03] transition">
          {# Tournament Info #}
          <div class="flex-1 min-w-0">
            <h3 class="text-sm font-bold text-white truncate">
              {% if reg.tournament_form and reg.tournament_form.tournament %}
                {{ reg.tournament_form.tournament.name }}
              {% else %}
                Registration #{{ reg.id }}
              {% endif %}
            </h3>
            <p class="text-[10px] text-gray-500 mt-0.5">
              Submitted {{ reg.created_at|timesince }} ago
              {% if reg.updated_at %} · Updated {{ reg.updated_at|timesince }} ago{% endif %}
            </p>
          </div>

          {# Status Badge #}
          <div class="shrink-0">
            {% if reg.status == 'draft' %}
              <span class="px-2.5 py-1 text-xs rounded-full bg-gray-700/50 text-gray-400">Draft</span>
            {% elif reg.status == 'submitted' %}
              <span class="px-2.5 py-1 text-xs rounded-full bg-dc-cyan/20 text-dc-cyan">Submitted</span>
            {% elif reg.status == 'approved' %}
              <span class="px-2.5 py-1 text-xs rounded-full bg-green-500/20 text-green-400">Approved</span>
            {% elif reg.status == 'rejected' %}
              <span class="px-2.5 py-1 text-xs rounded-full bg-red-500/20 text-red-400">Rejected</span>
            {% elif reg.status == 'waitlisted' %}
              <span class="px-2.5 py-1 text-xs rounded-full bg-amber-500/20 text-amber-400">Waitlisted</span>
            {% else %}
              <span class="px-2.5 py-1 text-xs rounded-full bg-gray-700/50 text-gray-400">{{ reg.status|title }}</span>
            {% endif %}
          </div>

          {# Actions #}
          <div class="shrink-0 flex items-center gap-2">
            {% if reg.status == 'draft' and reg.tournament_form and reg.tournament_form.tournament %}
              <a href="{% url 'tournaments:register' reg.tournament_form.tournament.slug %}?resume={{ reg.id }}"
                 class="px-3 py-1.5 text-xs bg-dc-cyan/10 text-dc-cyan rounded-lg hover:bg-dc-cyan/20 transition">
                Continue
              </a>
            {% elif reg.tournament_form and reg.tournament_form.tournament %}
              <a href="{% url 'tournaments:detail' reg.tournament_form.tournament.slug %}"
                 class="px-3 py-1.5 text-xs border border-dc-border text-gray-400 rounded-lg hover:bg-white/5 transition">
                View
              </a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    {# ── Empty State ── #}
    <div class="glass rounded-xl p-12 text-center">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-dc-surface mb-4">
        <i data-lucide="clipboard-list" class="w-8 h-8 text-gray-600"></i>
      </div>
      <h3 class="text-lg font-display font-bold text-white mb-2">No registrations yet</h3>
      <p class="text-sm text-gray-500 mb-6">Find a tournament and sign up to get started.</p>
      <a href="{% url 'tournaments:list' %}"
         class="inline-flex items-center px-6 py-3 bg-dc-cyan text-dc-dark font-bold text-sm rounded-xl hover:bg-dc-cyan/90 transition">
        <i data-lucide="search" class="w-4 h-4 mr-2"></i> Browse Tournaments
      </a>
    </div>
  {% endif %}

</div>
{% endblock %}
