{% comment %}
  Tab: Command Center (Overview)
  — Phase countdown, check-in CTA, announcements feed, squad diagnostics widget
{% endcomment %}

<div class="p-4 md:p-8 lg:p-10 max-w-[1600px] mx-auto space-y-8">
  <div class="w-full rounded-[2rem] p-1 relative overflow-hidden group">
    {% comment %}Outer glow ring{% endcomment %}
    <div class="absolute inset-0 bg-gradient-to-r
      {% if check_in_status == 'open' and not is_checked_in %}from-[#00F0FF]/20 via-transparent to-[#7000FF]/10
      {% elif is_checked_in %}from-[#00FF66]/15 via-transparent to-[#00FF66]/5
      {% else %}from-white/5 via-transparent to-white/5{% endif %}"></div>

    <div class="bg-[#08080C]/90 backdrop-blur-xl rounded-[30px] p-6 lg:p-10 relative overflow-hidden border border-white/5">
      <div class="flex flex-col lg:flex-row items-center justify-between gap-8">

        {% comment %}Left: Phase Info{% endcomment %}
        <div class="relative z-10 flex-1 w-full">
          {% if phase_event.type == 'danger' %}
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#FF2A55]/10 border border-[#FF2A55]/20 mb-4">
              <span class="w-2 h-2 rounded-full bg-[#FF2A55] animate-pulse"></span>
              <span class="text-[10px] font-bold text-[#FF2A55] uppercase tracking-widest">{{ phase_event.label }}</span>
            </div>
          {% elif phase_event.type == 'success' %}
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#00FF66]/10 border border-[#00FF66]/20 mb-4">
              <span class="w-2 h-2 rounded-full bg-[#00FF66] animate-pulse"></span>
              <span class="text-[10px] font-bold text-[#00FF66] uppercase tracking-widest">{{ phase_event.label }}</span>
            </div>
          {% else %}
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#00F0FF]/10 border border-[#00F0FF]/20 mb-4">
              <span class="w-2 h-2 rounded-full bg-[#00F0FF]"></span>
              <span class="text-[10px] font-bold text-[#00F0FF] uppercase tracking-widest">{{ phase_event.label }}</span>
            </div>
          {% endif %}

          <h1 class="font-black text-2xl lg:text-4xl text-white tracking-tight uppercase mb-2" style="font-family:Outfit,sans-serif;">
            {% if tournament.status == 'live' %}
              Tournament In Progress
            {% elif tournament.status == 'registration_open' %}
              Registration Open
            {% elif tournament.status == 'registration_closed' %}
              Awaiting Start
            {% elif tournament.status == 'completed' %}
              Tournament Complete
            {% else %}
              {{ tournament.name }}
            {% endif %}
          </h1>
          <p class="text-gray-400 font-medium flex items-center gap-2 flex-wrap">
            {% if game_name %}<span>{{ game_name }}</span><span class="w-1 h-1 rounded-full bg-gray-600"></span>{% endif %}
            <span>{{ reg_count }} participant{{ reg_count|pluralize }}</span>
            {% if tournament.format %}<span class="w-1 h-1 rounded-full bg-gray-600"></span><span>{{ tournament.get_format_display|default:tournament.format }}</span>{% endif %}
          </p>
        </div>

        {% comment %}Center: Countdown Timer{% endcomment %}
        {% if phase_event.target %}
        <div class="relative z-10 text-center shrink-0 w-full lg:w-auto border-y lg:border-y-0 lg:border-x border-white/10 py-6 lg:py-0 lg:px-12">
          <p class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3">{{ phase_event.label }} In</p>
          <div class="flex items-center justify-center gap-2 digital-clock" id="hub-countdown" data-target="{{ phase_event.target }}">
            <div class="countdown-block {% if phase_event.type == 'danger' %}danger{% endif %}">
              <span class="countdown-val" id="hub-cd-hours">--</span>
            </div>
            <span class="text-xl text-gray-600 font-bold">:</span>
            <div class="countdown-block {% if phase_event.type == 'danger' %}danger{% endif %}">
              <span class="countdown-val" id="hub-cd-minutes">--</span>
            </div>
            <span class="text-xl text-gray-600 font-bold">:</span>
            <div class="countdown-block {% if phase_event.type == 'danger' %}danger{% endif %}">
              <span class="countdown-val" id="hub-cd-seconds">--</span>
            </div>
          </div>
        </div>
        {% endif %}

        {% comment %}Right: Check-In CTA{% endcomment %}
        <div class="relative z-10 shrink-0 w-full lg:w-auto text-center lg:text-right">
          {% if check_in_status == 'open' and not is_checked_in %}
            <button id="hub-checkin-btn"
                    class="hub-checkin-btn ready clip-slant w-full lg:w-auto flex items-center justify-center gap-3"
                    onclick="HubEngine.performCheckIn()">
              <i data-lucide="check-circle" class="w-5 h-5"></i> Check In Now
            </button>
            <p class="text-[10px] text-gray-500 mt-3" style="font-family:'Space Grotesk',monospace;">
              Window closes in {{ check_in_countdown }}s
            </p>
          {% elif is_checked_in %}
            <div class="hub-checkin-btn done clip-slant w-full lg:w-auto flex items-center justify-center gap-3">
              <i data-lucide="check" class="w-5 h-5"></i> Checked In
            </div>
            <p class="text-[10px] text-[#00FF66] mt-3">You're all set. Stand by.</p>
          {% elif check_in_status == 'not_open' %}
            <div class="hub-checkin-btn disabled clip-slant w-full lg:w-auto flex items-center justify-center gap-3">
              <i data-lucide="clock" class="w-5 h-5"></i> Check-In Not Open
            </div>
          {% elif check_in_status == 'closed' %}
            <div class="hub-checkin-btn disabled clip-slant w-full lg:w-auto flex items-center justify-center gap-3">
              <i data-lucide="lock" class="w-5 h-5"></i> Check-In Closed
            </div>
          {% else %}
            <div class="hub-checkin-btn disabled clip-slant w-full lg:w-auto flex items-center justify-center gap-3">
              <i data-lucide="minus" class="w-5 h-5"></i> No Check-In Required
            </div>
          {% endif %}
        </div>

      </div>
    </div>
  </div>
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8">

    {% comment %}── Announcements Feed ───────────────────────────────────{% endcomment %}
    <div class="lg:col-span-2 hub-glass rounded-2xl flex flex-col min-h-[350px]">
      <div class="p-6 border-b border-white/5 flex items-center justify-between">
        <h3 class="text-xs font-black text-gray-400 uppercase tracking-widest flex items-center gap-2">
          <i data-lucide="radio" class="w-4 h-4 text-[#00FF66]"></i> Tournament Feed
        </h3>
        <span class="text-[10px] text-gray-500" style="font-family:'Space Grotesk',monospace;" id="hub-ann-count">
          {{ announcements|length }} update{{ announcements|length|pluralize }}
        </span>
      </div>

      <div class="flex-1 overflow-y-auto p-6 space-y-6" id="hub-announcements-feed">
        {% for ann in announcements %}
        <div class="relative pl-6 border-l border-white/5 {% if not forloop.last %}pb-6{% endif %}">
          <div class="absolute left-0 top-1.5 w-2 h-2 rounded-full -ml-[5px]
            {% if ann.type == 'urgent' %}ann-dot-urgent
            {% elif ann.type == 'warning' %}ann-dot-warning
            {% elif ann.type == 'success' %}ann-dot-success
            {% else %}ann-dot-info{% endif %}"></div>

          <div class="flex items-center gap-2 mb-1 flex-wrap">
            {% if ann.is_pinned %}
              <span class="px-1.5 py-0.5 rounded bg-[#FFB800]/20 text-[#FFB800] text-[8px] font-black uppercase">Pinned</span>
            {% endif %}
            <span class="px-1.5 py-0.5 rounded
              {% if ann.type == 'urgent' %}bg-[#FF2A55]/20 text-[#FF2A55]
              {% elif ann.type == 'warning' %}bg-[#FFB800]/20 text-[#FFB800]
              {% elif ann.type == 'success' %}bg-[#00FF66]/20 text-[#00FF66]
              {% else %}bg-white/10 text-gray-300
              {% endif %} text-[8px] font-black uppercase">
              {{ ann.type|default:"Info" }}
            </span>
            <span class="text-[10px] text-gray-500" style="font-family:'Space Grotesk',monospace;">{{ ann.time_ago }}</span>
          </div>
          {% if ann.title %}
            <p class="font-bold text-white text-sm mb-1">{{ ann.title }}</p>
          {% endif %}
          <p class="text-xs text-gray-400 leading-relaxed">{{ ann.message }}</p>
        </div>
        {% empty %}
        <div class="flex flex-col items-center justify-center py-12 text-center">
          <i data-lucide="radio" class="w-10 h-10 text-gray-700 mb-3"></i>
          <p class="text-sm text-gray-500 font-medium">No announcements yet</p>
          <p class="text-xs text-gray-600 mt-1">Organizer updates will appear here in real-time.</p>
        </div>
        {% endfor %}
      </div>
    </div>

    {% comment %}── Squad Diagnostics Widget ─────────────────────────────{% endcomment %}
    <div class="flex flex-col gap-6">

      {% if is_team %}
      <div class="hub-glass rounded-2xl p-6">
        <h3 class="text-xs font-black text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
          <i data-lucide="shield-check" class="w-4 h-4 text-white"></i> Squad Status
        </h3>

        {% comment %}Readiness indicator{% endcomment %}
        {% if squad_ready and is_checked_in %}
        <div class="bg-[#00FF66]/10 border border-[#00FF66]/20 rounded-xl p-4 flex items-center gap-3 mb-5">
          <div class="w-8 h-8 rounded-full bg-[#00FF66]/20 flex items-center justify-center text-[#00FF66] shrink-0">
            <i data-lucide="check" class="w-4 h-4"></i>
          </div>
          <div>
            <p class="text-sm font-bold text-white">Battle Ready</p>
            <p class="text-[10px] text-gray-400">All {{ starters|length }} starters verified & checked in.</p>
          </div>
        </div>
        {% elif squad_warnings %}
        <div class="bg-[#FFB800]/10 border border-[#FFB800]/20 rounded-xl p-4 flex items-center gap-3 mb-5">
          <div class="w-8 h-8 rounded-full bg-[#FFB800]/20 flex items-center justify-center text-[#FFB800] shrink-0">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
          </div>
          <div>
            <p class="text-sm font-bold text-white">Action Required</p>
            <p class="text-[10px] text-gray-400">{{ squad_warnings|length }} issue{{ squad_warnings|length|pluralize }}</p>
          </div>
        </div>
        {% else %}
        <div class="bg-white/5 border border-white/10 rounded-xl p-4 flex items-center gap-3 mb-5">
          <div class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-gray-400 shrink-0">
            <i data-lucide="users" class="w-4 h-4"></i>
          </div>
          <div>
            <p class="text-sm font-bold text-white">{{ starters|length }}/{{ min_roster }} Starters</p>
            <p class="text-[10px] text-gray-400">{{ subs|length }} sub{{ subs|length|pluralize }}</p>
          </div>
        </div>
        {% endif %}

        {% comment %}Mini roster list (starters only){% endcomment %}
        <div class="space-y-2.5">
          {% for member in starters|slice:":6" %}
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2 min-w-0">
              <img src="{{ member.avatar_url }}" class="w-6 h-6 rounded border border-gray-700" alt="{{ member.display_name }}">
              <span class="text-xs font-medium text-white truncate">
                {{ member.display_name }}
                {% if member.is_captain %}<span class="text-[#FFB800]">(C)</span>{% endif %}
              </span>
            </div>
            {% if member.has_passport %}
              <div class="w-2 h-2 bg-[#00FF66] rounded-full shadow-[0_0_5px_#00FF66]"></div>
            {% else %}
              <div class="w-2 h-2 bg-[#FF2A55] rounded-full shadow-[0_0_5px_#FF2A55]" title="Missing Game ID"></div>
            {% endif %}
          </div>
          {% endfor %}
        </div>

        <button class="w-full mt-5 py-2 text-[10px] font-bold uppercase tracking-widest border border-white/10 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition-colors"
                onclick="HubEngine.switchTab('squad')">
          Manage Squad →
        </button>
      </div>
      {% endif %}

      {% comment %}── Quick Stats ────────────────────────────────────────{% endcomment %}
      <div class="hub-glass rounded-2xl p-6">
        <h3 class="text-xs font-black text-gray-400 uppercase tracking-widest mb-4">Tournament Info</h3>
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <span class="text-xs text-gray-500">Game</span>
            <span class="text-xs font-bold text-white">{{ game_name|default:"-" }}</span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-xs text-gray-500">Participants</span>
            <span class="text-xs font-bold text-white" id="hub-reg-count">{{ reg_count }}</span>
          </div>
          {% if tournament.format %}
          <div class="flex items-center justify-between">
            <span class="text-xs text-gray-500">Format</span>
            <span class="text-xs font-bold text-white">{{ tournament.get_format_display|default:tournament.format }}</span>
          </div>
          {% endif %}
          {% if tournament.max_participants %}
          <div class="flex items-center justify-between">
            <span class="text-xs text-gray-500">Max Slots</span>
            <span class="text-xs font-bold text-white">{{ tournament.max_participants }}</span>
          </div>
          {% endif %}
        </div>
      </div>

    </div>
  </div>

</div>
