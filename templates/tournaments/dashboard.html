{% load static humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ ctx.tournament.title }} - Dashboard | DeltaCrown</title>
    
    <!-- Base Styles -->
    <link rel="stylesheet" href="{% static 'siteui/css/base.css' %}">
    
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Dashboard V8 Styles -->
    <link rel="stylesheet" href="{% static 'siteui/css/dashboard-v8.css' %}">
    
    <!-- Phase B Integration -->
    <link rel="stylesheet" href="{% static 'siteui/css/countdown-timer.css' %}">
    
    <meta name="description" content="Tournament dashboard for {{ ctx.tournament.title }}">
</head>
<body>
    <!-- Dashboard Container -->
    <div class="tournament-dashboard-v2" 
         data-tournament-slug="{{ ctx.tournament.slug }}"
         data-team-id="{{ ctx.team.id }}">
        
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="dashboard-container">
                <div class="dashboard-header-inner">
                    <div class="dashboard-tournament-info">
                        <img src="{{ ctx.tournament.icon.url }}" 
                             alt="{{ ctx.tournament.title }}" 
                             class="dashboard-tournament-icon"
                             onerror="this.src='{% static 'images/default-tournament.png' %}'">
                        
                        <div class="dashboard-tournament-details">
                            <h1>{{ ctx.tournament.title }}</h1>
                            <div class="dashboard-tournament-meta">
                                <span>{{ ctx.tournament.game_name }}</span>
                                <span>‚Ä¢</span>
                                <span>{{ ctx.tournament.format }}</span>
                                <span>‚Ä¢</span>
                                <span>{{ ctx.tournament.region }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-actions">
                        <!-- Registration Status Badge -->
                        {% if ctx.is_registered %}
                        <div class="registration-status-badge registered">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <circle cx="8" cy="8" r="8" fill="currentColor" opacity="0.2"/>
                                <path d="M11 5L6.5 10.5L4 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Registered</span>
                        </div>
                        {% endif %}
                        
                        <span class="dashboard-status-badge {{ ctx.tournament.status }}">
                            {% if ctx.tournament.status == 'live' %}
                                ‚óè LIVE
                            {% elif ctx.tournament.status == 'upcoming' %}
                                Upcoming
                            {% elif ctx.tournament.status == 'registration' %}
                                Registration Open
                            {% else %}
                                {{ ctx.tournament.status|title }}
                            {% endif %}
                        </span>
                        <a href="{% url 'tournaments:detail' ctx.tournament.slug %}" class="btn btn-secondary">
                            Tournament Details
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Grid -->
        <div class="dashboard-container">
            <div class="dashboard-grid">
                
                <!-- Sidebar: Team Info & Quick Stats -->
                <aside class="dashboard-sidebar">
                    
                    <!-- Team Card -->
                    <div class="dashboard-team-card">
                        <div class="dashboard-team-header">
                            {% if ctx.team.logo %}
                                <img src="{{ ctx.team.logo.url }}" 
                                     alt="{{ ctx.team.name }}" 
                                     class="dashboard-team-logo">
                            {% else %}
                                <div class="dashboard-team-logo-placeholder">
                                    {{ ctx.team.name|first|upper }}
                                </div>
                            {% endif %}
                            
                            <div>
                                <h2 class="dashboard-team-name">{{ ctx.team.name }}</h2>
                                <p class="dashboard-team-role">
                                    {% if ctx.is_captain %}Captain{% else %}Member{% endif %}
                                </p>
                            </div>
                        </div>
                        
                        <!-- Team Roster -->
                        <div class="dashboard-team-section">
                            <h3 class="dashboard-team-section-title">Roster</h3>
                            <ul class="dashboard-team-players">
                                {% for player in ctx.team.players %}
                                <li class="dashboard-team-player">
                                    <span class="dashboard-team-player-name">{{ player.username }}</span>
                                    {% if player.is_captain %}
                                    <span class="dashboard-team-player-badge">Captain</span>
                                    {% endif %}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        
                        <!-- Check-in Status -->
                        <div class="dashboard-team-section">
                            <h3 class="dashboard-team-section-title">Check-in Status</h3>
                            <div class="dashboard-checkin-status">
                                {% if ctx.team.checked_in %}
                                    <span class="status-badge success">‚úì Checked In</span>
                                {% else %}
                                    <span class="status-badge warning">‚ö† Not Checked In</span>
                                    {% if ctx.can_checkin %}
                                    <button class="btn btn-primary btn-sm" id="checkin-btn">
                                        Check In Now
                                    </button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="dashboard-quick-stats">
                        <h3 class="dashboard-team-section-title">Quick Stats</h3>
                        <div class="dashboard-stat-grid">
                            <div class="dashboard-stat-item">
                                <div class="dashboard-stat-value">{{ ctx.stats.wins }}</div>
                                <div class="dashboard-stat-label">Wins</div>
                            </div>
                            <div class="dashboard-stat-item">
                                <div class="dashboard-stat-value">{{ ctx.stats.losses }}</div>
                                <div class="dashboard-stat-label">Losses</div>
                            </div>
                            <div class="dashboard-stat-item">
                                <div class="dashboard-stat-value">{{ ctx.stats.rank }}</div>
                                <div class="dashboard-stat-label">Rank</div>
                            </div>
                            <div class="dashboard-stat-item">
                                <div class="dashboard-stat-value">{{ ctx.stats.points }}</div>
                                <div class="dashboard-stat-label">Points</div>
                            </div>
                        </div>
                    </div>
                    
                </aside>
                
                <!-- Main Content: Tabs -->
                <main class="dashboard-main">
                    
                    <!-- Tabs Navigation -->
                    <nav class="dashboard-tabs">
                        <button class="dashboard-tab active" data-tab="bracket">
                            üèÜ Bracket
                        </button>
                        <button class="dashboard-tab" data-tab="matches">
                            ‚öîÔ∏è Matches
                            {% if ctx.upcoming_matches_count > 0 %}
                            <span class="dashboard-tab-badge">{{ ctx.upcoming_matches_count }}</span>
                            {% endif %}
                        </button>
                        <button class="dashboard-tab" data-tab="news">
                            üì∞ News
                            {% if ctx.unread_news_count > 0 %}
                            <span class="dashboard-tab-badge">{{ ctx.unread_news_count }}</span>
                            {% endif %}
                        </button>
                        <button class="dashboard-tab" data-tab="calendar">
                            üìÖ Calendar
                        </button>
                        <button class="dashboard-tab" data-tab="stats">
                            üìä Statistics
                        </button>
                    </nav>
                    
                    <!-- Tab: Bracket -->
                    <div id="tab-bracket" class="dashboard-tab-content active">
                        <div id="bracket-content" class="bracket-container">
                            <!-- Bracket will be loaded by JavaScript -->
                            <div class="bracket-empty">
                                <div class="bracket-empty-icon">üèÜ</div>
                                <h3 class="bracket-empty-title">Loading Bracket...</h3>
                                <p class="bracket-empty-text">Please wait while we load the tournament bracket.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab: Matches -->
                    <div id="tab-matches" class="dashboard-tab-content">
                        <div id="matches-list" class="matches-list">
                            <!-- Matches will be loaded by JavaScript -->
                            <div class="loading">Loading matches...</div>
                        </div>
                    </div>
                    
                    <!-- Tab: News -->
                    <div id="tab-news" class="dashboard-tab-content">
                        <div id="news-feed" class="news-feed">
                            <!-- News will be loaded by JavaScript -->
                            <div class="loading">Loading news...</div>
                        </div>
                    </div>
                    
                    <!-- Tab: Calendar -->
                    <div id="tab-calendar" class="dashboard-tab-content">
                        <div class="calendar-container">
                            <div class="calendar-header">
                                <h2 id="calendar-title" class="calendar-title">October 2025</h2>
                                <div class="calendar-nav">
                                    <button id="calendar-prev" class="calendar-nav-btn">‚óÄ Prev</button>
                                    <button id="calendar-today" class="calendar-nav-btn">Today</button>
                                    <button id="calendar-next" class="calendar-nav-btn">Next ‚ñ∂</button>
                                </div>
                            </div>
                            <div id="calendar-grid" class="calendar-grid">
                                <!-- Calendar will be rendered by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab: Statistics -->
                    <div id="tab-stats" class="dashboard-tab-content">
                        <div id="stats-container">
                            
                            <!-- Stats Grid -->
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-card-header">
                                        <span class="stat-card-icon">üéØ</span>
                                        <h3 class="stat-card-title">Win Rate</h3>
                                    </div>
                                    <div class="stat-card-value">{{ ctx.stats.win_rate }}%</div>
                                    <div class="stat-card-change positive">+5% from last tournament</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-card-header">
                                        <span class="stat-card-icon">‚öîÔ∏è</span>
                                        <h3 class="stat-card-title">Matches Played</h3>
                                    </div>
                                    <div class="stat-card-value">{{ ctx.stats.matches_played }}</div>
                                    <div class="stat-card-change positive">+3 this week</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-card-header">
                                        <span class="stat-card-icon">üíé</span>
                                        <h3 class="stat-card-title">Avg. Score</h3>
                                    </div>
                                    <div class="stat-card-value">{{ ctx.stats.avg_score }}</div>
                                    <div class="stat-card-change negative">-2 from last week</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-card-header">
                                        <span class="stat-card-icon">üî•</span>
                                        <h3 class="stat-card-title">Win Streak</h3>
                                    </div>
                                    <div class="stat-card-value">{{ ctx.stats.win_streak }}</div>
                                    <div class="stat-card-change positive">Current streak</div>
                                </div>
                            </div>
                            
                            <!-- Performance Chart -->
                            <div class="chart-container">
                                <h3 class="chart-title">Performance Over Time</h3>
                                <div class="chart-placeholder">
                                    üìä Chart visualization will be added here
                                </div>
                            </div>
                            
                            <!-- Match History Chart -->
                            <div class="chart-container">
                                <h3 class="chart-title">Match History</h3>
                                <div class="chart-placeholder">
                                    üìà Match history chart will be added here
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                </main>
                
            </div>
        </div>
        
    </div>
    
    <!-- Scripts -->
    <script src="{% static 'js/countdown-timer.js' %}"></script>
    <script src="{% static 'siteui/js/dashboard-v8.js' %}"></script>
    
</body>
</html>
