{% extends "tournaments/base.html" %}
{% load static humanize %}

{# ─────────────────────────────────────────────────────────
   Resubmit Payment
   Context: tournament, registration, rejection_reason,
            payment_methods
   Phase 4 Frontend Rebuild
   ───────────────────────────────────────────────────────── #}

{% block title %}Resubmit Payment — {{ tournament.name }} | DeltaCrown{% endblock %}

{% block tournament_content %}

<div class="max-w-xl mx-auto px-4 sm:px-6 py-8">

  <div class="mb-6">
    <a href="{% url 'tournaments:registration_status' tournament.slug registration.id %}" class="text-xs text-gray-500 hover:text-dc-cyan transition">
      <i data-lucide="arrow-left" class="w-3 h-3 inline mr-1"></i> Back to Status
    </a>
  </div>

  {# ── Rejection Notice ── #}
  {% if rejection_reason %}
    <div class="glass rounded-xl p-4 mb-6 border border-red-700/30">
      <div class="flex items-start gap-3">
        <i data-lucide="alert-circle" class="w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"></i>
        <div>
          <p class="text-sm font-medium text-red-400">Previous payment was rejected</p>
          <p class="text-xs text-gray-400 mt-1">{{ rejection_reason }}</p>
        </div>
      </div>
    </div>
  {% endif %}

  <div class="glass rounded-xl overflow-hidden">
    <div class="px-6 py-4 border-b border-dc-border bg-dc-cyan/[0.03]">
      <h1 class="text-lg font-display font-bold text-white">
        <i data-lucide="refresh-cw" class="w-5 h-5 inline mr-2 text-dc-cyan"></i> Resubmit Payment
      </h1>
    </div>

    <form method="post" enctype="multipart/form-data" class="p-6 space-y-5">
      {% csrf_token %}

      <div>
        <label class="block text-xs text-gray-400 mb-1.5">Payment Method</label>
        <select name="payment_method" class="form-select" required>
          {% for method in payment_methods %}
            <option value="{{ method }}">{{ method|title }}</option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label class="block text-xs text-gray-400 mb-1.5">Transaction ID <span class="text-red-400">*</span></label>
        <input type="text" name="transaction_id" class="form-input font-mono" required placeholder="e.g., TXN123456789">
      </div>

      <div>
        <label class="block text-xs text-gray-400 mb-1.5">Sender Number</label>
        <input type="tel" name="sender_number" class="form-input" placeholder="+880xxxxxxxxx">
      </div>

      <div>
        <label class="block text-xs text-gray-400 mb-1.5">Payment Screenshot</label>
        <div class="border-2 border-dashed border-dc-border rounded-xl p-6 text-center hover:border-dc-cyan/30 transition cursor-pointer">
          <input type="file" name="payment_proof" accept="image/*" class="hidden" id="resubmit-proof">
          <label for="resubmit-proof" class="cursor-pointer">
            <i data-lucide="upload-cloud" class="w-8 h-8 text-gray-600 mx-auto mb-2"></i>
            <p class="text-xs text-gray-400">Click to upload proof</p>
          </label>
        </div>
      </div>

      <div class="flex items-center justify-between pt-2">
        <a href="{% url 'tournaments:registration_status' tournament.slug registration.id %}" class="text-sm text-gray-500 hover:text-white transition">Cancel</a>
        <button type="submit" class="px-6 py-3 bg-dc-cyan text-dc-dark font-bold text-sm rounded-xl hover:bg-dc-cyan/90 transition shadow-[0_0_20px_rgba(6,182,212,0.3)]">
          <i data-lucide="send" class="w-4 h-4 inline mr-1"></i> Submit Payment
        </button>
      </div>
    </form>
  </div>

</div>

{% endblock %}
