{% load humanize %}
{# Step: Payment — entry fee #}
<div data-wizard-step="payment" class="wizard-step step-hidden animate-slide-up">

    <div class="mb-6 pb-4 border-b border-white/10">
        <h2 class="font-gaming font-bold text-2xl md:text-3xl text-white mb-1">Payment</h2>
        <p class="text-sm text-gray-400">Complete the entry fee to secure your spot.</p>
    </div>

    {# Fee display #}
    <div class="mb-6 p-5 rounded-2xl border relative overflow-hidden" style="background: rgba(var(--accent-rgb), 0.05); border-color: rgba(var(--accent-rgb), 0.2);">
        <div class="absolute right-0 top-0 w-32 h-32 rounded-full blur-3xl opacity-40" style="background: rgba(var(--accent-rgb), 0.15);"></div>
        <div class="flex items-center justify-between relative z-10">
            <div>
                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Entry Fee</p>
                <p class="text-3xl font-black text-white font-display">
                    {{ tournament.entry_fee_amount|floatformat:0 }}
                    <span class="text-lg font-semibold text-gray-400">{{ tournament.entry_fee_currency|default:"BDT" }}</span>
                </p>
            </div>
            <div class="w-14 h-14 rounded-2xl flex items-center justify-center" style="background: rgba(var(--accent-rgb), 0.15);">
                <i data-lucide="credit-card" class="w-7 h-7" style="color: var(--accent);"></i>
            </div>
        </div>
    </div>

    {# Payment method selection #}
    <div class="mb-6">
        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 flex items-center gap-2">
            <i data-lucide="wallet" class="w-4 h-4" style="color: var(--accent);"></i> Choose Payment Method
        </h3>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            {# DeltaCoin option #}
            <label class="flex items-center gap-4 p-4 rounded-xl border cursor-pointer transition-all group has-[:checked]:shadow-lg {% if deltacoin_can_afford %}border-white/10 bg-black/30 hover:border-white/20 has-[:checked]:border-dc-gold has-[:checked]:bg-dc-gold/5{% else %}border-white/5 bg-black/20 opacity-50 cursor-not-allowed{% endif %}">
                <input type="radio" name="payment_method" value="deltacoin" class="appearance-none w-5 h-5 border-2 border-gray-600 rounded-full checked:border-dc-gold checked:bg-dc-gold transition-all shrink-0" {% if not deltacoin_can_afford %}disabled{% endif %} onchange="selectPaymentMethod('deltacoin')">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-0.5">
                        <i data-lucide="coins" class="w-4 h-4 text-dc-gold"></i>
                        <p class="text-sm font-bold text-white">DeltaCoin</p>
                    </div>
                    <p class="text-[10px] text-gray-500">
                        {% if deltacoin_can_afford %}
                        Balance: <strong class="text-dc-gold">{{ deltacoin_balance }} DC</strong> — instant deduction
                        {% else %}
                        Insufficient balance ({{ deltacoin_balance }} DC)
                        {% endif %}
                    </p>
                </div>
            </label>

            {# Mobile Payment option #}
            <label class="flex items-center gap-4 p-4 rounded-xl border border-white/10 bg-black/30 cursor-pointer hover:border-white/20 transition-all group has-[:checked]:border-bkash-pink has-[:checked]:bg-bkash-pink/5 has-[:checked]:shadow-lg">
                <input type="radio" name="payment_method" value="bkash" class="appearance-none w-5 h-5 border-2 border-gray-600 rounded-full checked:border-bkash-pink checked:bg-bkash-pink transition-all shrink-0" onchange="selectPaymentMethod('mobile')">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-0.5">
                        <i data-lucide="smartphone" class="w-4 h-4 text-bkash-pink"></i>
                        <p class="text-sm font-bold text-white">Mobile Payment</p>
                    </div>
                    <p class="text-[10px] text-gray-500">bKash, Nagad, or Rocket</p>
                </div>
            </label>
        </div>
    </div>

    {# DeltaCoin panel #}
    <div id="panel-deltacoin" class="step-hidden mb-6">
        <div class="p-5 rounded-2xl bg-dc-gold/5 border border-dc-gold/20">
            <div class="flex items-center gap-3 mb-3">
                <i data-lucide="zap" class="w-5 h-5 text-dc-gold"></i>
                <p class="text-sm font-bold text-white">Instant DeltaCoin Payment</p>
            </div>
            <p class="text-xs text-gray-400 mb-3">
                <strong class="text-dc-gold">{{ tournament.entry_fee_amount|floatformat:0 }} DC</strong> will be deducted from your wallet upon registration.
                Remaining balance: <strong class="text-white">{{ deltacoin_balance|add:"-"|add:tournament.entry_fee_amount|default:"—" }} DC</strong>
            </p>
            <div class="flex items-center gap-2 text-green-400 text-xs">
                <i data-lucide="check-circle" class="w-4 h-4"></i>
                <span class="font-bold">No further action needed</span>
            </div>
        </div>
    </div>

    {# Mobile payment panel #}
    <div id="panel-mobile" class="step-hidden mb-6">
        {# Sub-method tabs #}
        <div class="flex gap-2 mb-4">
            {% for method in payment_methods %}
            <button type="button" class="mobile-tab px-4 py-2 rounded-xl text-xs font-bold border transition-all {% if forloop.first %}bg-bkash-pink/10 border-bkash-pink/30 text-bkash-pink{% else %}bg-white/5 border-white/10 text-gray-400 hover:text-white{% endif %}" data-mobile-method="{{ method }}" onclick="selectMobileMethod('{{ method }}')">
                {{ method|title }}
            </button>
            {% endfor %}
        </div>

        {# Send-money instructions #}
        <div class="p-4 rounded-xl bg-bkash-pink/5 border border-bkash-pink/20 mb-4">
            <p class="text-xs font-bold text-bkash-pink mb-2 flex items-center gap-2">
                <i data-lucide="info" class="w-4 h-4"></i> Send Money Instructions
            </p>
            <ol class="text-xs text-gray-400 space-y-1 list-decimal list-inside">
                <li>Open your mobile payment app</li>
                <li>Select <strong class="text-white">Send Money</strong></li>
                <li>Send <strong class="text-white">{{ tournament.entry_fee_amount|floatformat:0 }} {{ tournament.entry_fee_currency|default:"BDT" }}</strong> to:
                    <div class="mt-2 p-3 rounded-lg bg-black/40 border border-white/10 flex items-center justify-between cursor-pointer hover:bg-black/60 transition-colors" onclick="copyNumber(this)">
                        <span class="font-mono font-bold text-white text-sm select-all tracking-wider">{{ tournament.payment_number|default:"01XXX-XXXXXX" }}</span>
                        <span class="text-[10px] font-bold text-gray-500 hover:text-white transition-colors">Copy</span>
                    </div>
                </li>
                <li>Copy the <strong class="text-white">Transaction ID</strong> and paste below</li>
            </ol>
        </div>

        {# Transaction ID #}
        <div class="space-y-1.5 mb-4">
            <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Transaction ID <span class="text-red-400">*</span></label>
            <input type="text" name="transaction_id" id="trxid" class="input-premium text-center font-mono tracking-[0.3em] text-lg py-4" placeholder="AB12CD34EF" maxlength="10" autocomplete="off" oninput="validateTrxId()">
            <div id="trx-status" class="mt-3 flex items-center justify-center gap-2 text-xs font-medium text-gray-500 h-5">
                Awaiting 10-character alphanumeric ID
            </div>
        </div>

        {# Payment mobile number (if organizer enabled) #}
        {% if form_config.enable_payment_mobile_number_field %}
        <div class="space-y-1.5 mb-4">
            <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Your Mobile Number</label>
            <input type="tel" name="payment_mobile_number" id="payment_mobile" class="input-premium" placeholder="The number you sent from" oninput="checkStep('payment')">
        </div>
        {% endif %}

        {# Payment proof upload (if organizer enabled) #}
        {% if form_config.enable_payment_screenshot_field %}
        <div class="space-y-1.5 mb-4">
            <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Payment Screenshot</label>
            <label class="drop-zone flex items-center justify-center gap-3 cursor-pointer">
                <i data-lucide="camera" class="w-5 h-5 text-gray-600"></i>
                <span class="text-sm text-gray-400" id="proof-label">Upload screenshot of transaction</span>
                <input type="file" name="payment_proof" accept="image/*" class="sr-only" onchange="this.previousElementSibling.textContent = this.files[0]?.name || 'Upload screenshot'">
            </label>
            <p class="text-[10px] text-gray-600 ml-1">Max 5MB · JPG, PNG, or WebP</p>
        </div>
        {% endif %}

        {# Payment notes (if organizer enabled) #}
        {% if form_config.enable_payment_notes_field %}
        <div class="space-y-1.5">
            <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Payment Notes</label>
            <input type="text" name="payment_notes" class="input-premium" placeholder="Any additional info about your payment">
        </div>
        {% endif %}
    </div>
</div>
