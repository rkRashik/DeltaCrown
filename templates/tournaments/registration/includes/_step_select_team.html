{% load humanize %}
{# Step 1 (Team): Select which team to register #}
<div data-wizard-step="select_team" class="wizard-step step-hidden animate-slide-up">

    <div class="mb-6 pb-4 border-b border-white/10">
        <h2 class="font-gaming font-bold text-2xl md:text-3xl text-white mb-1">Select Your Team</h2>
        <p class="text-sm text-gray-400">Choose the team you want to register for <span class="text-white font-medium">{{ tournament.name }}</span>.</p>
    </div>

    {% if team %}
    {# Single team auto-selected #}
    <div class="bg-white/5 border border-white/10 rounded-2xl p-5 md:p-6 flex flex-col sm:flex-row items-center sm:items-start gap-5 relative overflow-hidden group hover:border-[color:var(--accent)]/30 transition-colors">
        <div class="absolute right-0 top-0 w-32 h-32 rounded-full blur-3xl opacity-50 group-hover:opacity-100 transition-opacity" style="background: rgba(var(--accent-rgb), 0.1);"></div>
        <div class="w-20 h-20 rounded-2xl bg-black overflow-hidden border-2 border-white/10 relative shrink-0 shadow-lg">
            {% if team.logo %}
            <img src="{{ team.logo.url }}" class="w-full h-full object-cover" alt="{{ team.name }}">
            {% else %}
            <div class="w-full h-full flex items-center justify-center text-xl font-black text-white/50 bg-dc-card">{{ team.tag|truncatechars:3 }}</div>
            {% endif %}
        </div>
        <div class="flex-1 text-center sm:text-left z-10">
            <span class="px-2 py-0.5 text-xs font-bold uppercase tracking-widest rounded mb-2 inline-block" style="background: rgba(var(--accent-rgb), 0.2); color: var(--accent);">Selected Team</span>
            <h3 class="text-2xl font-display font-bold text-white mb-0.5">{{ team.name }}</h3>
            {% if team.tag %}<p class="text-gray-400 font-mono text-sm mb-2">{{ team.tag }}</p>{% endif %}
            <div class="flex flex-wrap gap-3 text-xs text-gray-500 justify-center sm:justify-start">
                <span class="flex items-center gap-1"><i data-lucide="users" class="w-3.5 h-3.5"></i> {{ roster_members|length }} members</span>
                <span class="flex items-center gap-1"><i data-lucide="gamepad-2" class="w-3.5 h-3.5"></i> {{ tournament.game.name }}</span>
                {% if team.region %}<span class="flex items-center gap-1"><i data-lucide="globe" class="w-3.5 h-3.5"></i> {{ team.region }}</span>{% endif %}
            </div>
            <a href="{% url 'organizations:team_manage' team_slug=team.slug %}" target="_blank" rel="noopener"
               class="inline-flex items-center gap-1.5 mt-3 px-3 py-1.5 rounded-lg text-xs font-bold border transition-all hover:bg-white/10"
               style="color: var(--accent); border-color: rgba(var(--accent-rgb), 0.3);">
                <i data-lucide="settings" class="w-3.5 h-3.5"></i> Edit Team Details
                <i data-lucide="external-link" class="w-3 h-3 opacity-60"></i>
            </a>
        </div>
        <div class="flex items-center gap-1.5 text-green-500">
            <i data-lucide="check-circle" class="w-5 h-5"></i>
            <span class="text-xs font-bold hidden sm:block">Ready</span>
        </div>
    </div>

    {% if user_teams|length > 1 %}
    <div class="mt-4 p-3 rounded-xl bg-white/5 border border-white/5 flex items-start gap-2">
        <i data-lucide="info" class="w-4 h-4 text-gray-500 shrink-0 mt-0.5"></i>
        <p class="text-xs text-gray-500">You have {{ user_teams|length }} eligible teams. To register a different team, go back and select from your Team Hub or pass <code class="text-gray-400 bg-black/30 px-1 rounded">?team_id=ID</code> in the URL.</p>
    </div>
    {% endif %}

    {% elif user_teams %}
    {# Multiple teams - pick one #}
    <div class="space-y-3">
        {% for t in user_teams %}
        <label class="flex items-center gap-4 p-4 rounded-xl border border-white/10 bg-black/30 cursor-pointer hover:border-white/20 transition-all group has-[:checked]:border-[color:var(--accent)] has-[:checked]:bg-[color:var(--accent)]/5">
            <input type="radio" name="team_id" value="{{ t.id }}" class="appearance-none w-5 h-5 border-2 border-gray-600 rounded-full checked:border-[color:var(--accent)] checked:bg-[color:var(--accent)] transition-all shrink-0" {% if forloop.first %}checked{% endif %} onchange="checkStep('select_team')">
            <div class="w-14 h-14 rounded-xl bg-dc-card overflow-hidden border border-white/10 shrink-0">
                {% if t.logo %}
                <img src="{{ t.logo.url }}" class="w-full h-full object-cover" alt="{{ t.name }}">
                {% else %}
                <div class="w-full h-full flex items-center justify-center text-sm font-black text-white/40">{{ t.tag|truncatechars:3 }}</div>
                {% endif %}
            </div>
            <div class="flex-1">
                <p class="text-sm font-bold text-white group-hover:text-[color:var(--accent)] transition-colors">{{ t.name }}</p>
                {% if t.tag %}<p class="text-xs text-gray-500 font-mono">{{ t.tag }}</p>{% endif %}
                <p class="text-xs text-gray-600 mt-1">{{ t.members_count }} member{{ t.members_count|pluralize }}</p>
            </div>
        </label>
        {% endfor %}
    </div>

    {% else %}
    <div class="bg-red-500/10 border border-red-500/20 rounded-2xl p-6 text-center">
        <i data-lucide="alert-triangle" class="w-8 h-8 text-red-400 mx-auto mb-3"></i>
        <p class="text-red-400 text-sm font-medium mb-2">No eligible team found for this tournament.</p>
        <p class="text-xs text-gray-500">You need a team for {{ tournament.game.name }} to register.</p>
    </div>
    {% endif %}

    <input type="hidden" name="full_name" value="{{ fields.full_name.value }}">
    <input type="hidden" name="display_name" value="{{ fields.display_name.value }}">
    <input type="hidden" name="email" value="{{ fields.email.value }}">
</div>
