{% extends "tournaments/base.html" %}
{% load static humanize %}

{# ─────────────────────────────────────────────────────────
   Registration Wizard — Solo Step 3: Payment
   Entry fee payment submission via bKash/Nagad/DeltaCoin
   Phase 4 Frontend Rebuild
   ───────────────────────────────────────────────────────── #}

{% block title %}Payment — {{ tournament.name }} | DeltaCrown{% endblock %}

{% block tournament_content %}

<div class="max-w-2xl mx-auto px-4 sm:px-6 py-8">

  {# ── Progress Bar ── #}
  <div class="mb-8">
    <div class="flex items-center justify-between mb-2">
      <span class="text-xs text-gray-500">Step {{ current_step }} of {{ total_steps }}</span>
      <span class="text-xs text-dc-cyan font-mono">{{ step_title }}</span>
    </div>
    <div class="h-1 bg-dc-surface rounded-full overflow-hidden">
      <div class="h-full bg-gradient-to-r from-dc-cyan to-dc-purple rounded-full transition-all duration-500"
           style="width: {% widthratio current_step total_steps 100 %}%"></div>
    </div>
  </div>

  {# ── Fee Summary ── #}
  <div class="glass rounded-xl p-6 mb-6 neon-border-gold">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs text-gray-500 uppercase tracking-wider">Entry Fee</p>
        <p class="text-3xl font-display font-bold text-dc-gold mt-1">৳{{ entry_fee|intcomma }}</p>
        <p class="text-[10px] text-gray-600 mt-1">{{ currency }}</p>
      </div>
      <div class="w-14 h-14 rounded-2xl bg-dc-gold/10 flex items-center justify-center">
        <i data-lucide="banknote" class="w-7 h-7 text-dc-gold"></i>
      </div>
    </div>
  </div>

  <form method="post" enctype="multipart/form-data" class="space-y-6">
    {% csrf_token %}
    <input type="hidden" name="step" value="3">
    <input type="hidden" name="type" value="solo">

    {# ── Payment Method Selection ── #}
    <div class="glass rounded-xl p-6">
      <h3 class="text-sm font-display font-semibold text-white mb-4">
        <i data-lucide="wallet" class="w-4 h-4 inline mr-1 text-dc-cyan"></i> Select Payment Method
      </h3>
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
        {% for method in payment_methods %}
          <label class="relative cursor-pointer">
            <input type="radio" name="payment_method" value="{{ method }}" required
                   class="peer sr-only" {% if forloop.first %}checked{% endif %}>
            <div class="p-4 rounded-xl border border-dc-border bg-white/[0.02] text-center
                        peer-checked:border-dc-cyan peer-checked:bg-dc-cyan/5 transition">
              <i data-lucide="{% if method == 'bkash' %}smartphone{% elif method == 'nagad' %}smartphone{% elif method == 'rocket' %}smartphone{% elif method == 'deltacoin' %}coins{% else %}credit-card{% endif %}"
                 class="w-6 h-6 mx-auto mb-2 text-gray-400 peer-checked:text-dc-cyan"></i>
              <p class="text-xs text-white capitalize">{{ method }}</p>
            </div>
          </label>
        {% endfor %}
      </div>
    </div>

    {# ── DeltaCoin Option ── #}
    {% if deltacoin_balance is not None %}
      <div class="glass rounded-xl p-4 border {% if deltacoin_can_afford %}border-green-600/30{% else %}border-yellow-600/30{% endif %}">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-dc-gold/10 flex items-center justify-center">
            <i data-lucide="coins" class="w-5 h-5 text-dc-gold"></i>
          </div>
          <div class="flex-1">
            <p class="text-sm text-white">DeltaCoin Balance: <span class="font-mono text-dc-gold">{{ deltacoin_balance|intcomma }}</span></p>
            {% if deltacoin_can_afford %}
              <p class="text-[10px] text-green-400">Sufficient balance to pay with DeltaCoin</p>
            {% else %}
              <p class="text-[10px] text-yellow-400">Short by {{ deltacoin_shortfall|intcomma }} DeltaCoin</p>
            {% endif %}
          </div>
        </div>
      </div>
    {% endif %}

    {# ── Payment Details (for mobile banking) ── #}
    <div id="mobile-payment-fields" class="glass rounded-xl p-6">
      <h3 class="text-sm font-display font-semibold text-white mb-4">
        <i data-lucide="receipt" class="w-4 h-4 inline mr-1 text-dc-purple"></i> Payment Details
      </h3>
      <div class="space-y-4">
        <div>
          <label class="block text-xs text-gray-400 mb-1.5">Transaction ID <span class="text-red-400">*</span></label>
          <input type="text" name="transaction_id"
                 class="form-input font-mono" placeholder="e.g., TXN123456789">
          <p class="text-[10px] text-gray-600 mt-1">Enter the transaction ID from your payment confirmation</p>
        </div>
        <div>
          <label class="block text-xs text-gray-400 mb-1.5">Sender Number</label>
          <input type="tel" name="sender_number"
                 class="form-input" placeholder="+880xxxxxxxxx">
        </div>
        <div>
          <label class="block text-xs text-gray-400 mb-1.5">Payment Screenshot (optional)</label>
          <div class="border-2 border-dashed border-dc-border rounded-xl p-6 text-center hover:border-dc-cyan/30 transition cursor-pointer">
            <input type="file" name="payment_proof" accept="image/*" class="hidden" id="payment-proof-input">
            <label for="payment-proof-input" class="cursor-pointer">
              <i data-lucide="upload-cloud" class="w-8 h-8 text-gray-600 mx-auto mb-2"></i>
              <p class="text-xs text-gray-400">Click to upload or drag & drop</p>
              <p class="text-[10px] text-gray-600 mt-1">PNG, JPG up to 5MB</p>
            </label>
          </div>
        </div>
      </div>
    </div>

    {# Navigation #}
    <div class="flex items-center justify-between pt-2">
      <a href="{{ request.path }}?type=solo&step=2" class="text-sm text-gray-500 hover:text-white transition">
        <i data-lucide="arrow-left" class="w-4 h-4 inline mr-1"></i> Back
      </a>
      <button type="submit" class="px-6 py-3 bg-dc-cyan text-black font-bold text-sm rounded-xl hover:bg-dc-cyan/90 transition-all shadow-[0_0_20px_rgba(6,182,212,0.3)]">
        <i data-lucide="check" class="w-4 h-4 inline mr-1"></i> Submit Registration
      </button>
    </div>
  </form>

</div>

{% endblock %}
