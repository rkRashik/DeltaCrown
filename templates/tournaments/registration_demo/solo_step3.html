{% extends "tournaments/registration_demo/_reg_base.html" %}
{% load static humanize %}

{% comment %}
Registration Wizard — Solo Step 3: Payment
Cinematic Dark Theme v2 — bKash/Nagad/DeltaCoin
{% endcomment %}

{% block title %}Payment — {{ tournament.name }} | DeltaCrown{% endblock %}

{% block reg_content %}

  {# ── Fee Summary ── #}
  <div class="reg-glass-strong rounded-2xl p-6 mb-6 fade-in fade-in-delay-2 relative overflow-hidden" style="border-color: rgba(250,204,21,0.12);">
    <div class="absolute top-0 right-0 w-40 h-40 rounded-full blur-[60px] pointer-events-none" style="background: rgba(250,204,21,0.06);"></div>
    <div class="flex items-center justify-between relative z-10">
      <div>
        <p class="reg-label mb-1">Entry Fee</p>
        <p class="text-3xl font-bold text-amber-400 mt-1">৳{{ entry_fee|intcomma }}</p>
        <p class="text-[10px] text-gray-600 mt-1">{{ currency }}</p>
      </div>
      <div class="w-14 h-14 rounded-2xl bg-amber-500/10 flex items-center justify-center border border-amber-500/15">
        <i data-lucide="banknote" class="w-7 h-7 text-amber-400"></i>
      </div>
    </div>
  </div>

  <form method="post" enctype="multipart/form-data" class="space-y-6 fade-in fade-in-delay-2">
    {% csrf_token %}
    <input type="hidden" name="step" value="3">
    <input type="hidden" name="type" value="solo">

    {# ── Payment Method Selection ── #}
    <div class="reg-glass-strong rounded-2xl p-6">
      <h3 class="text-sm font-bold text-white mb-5 flex items-center gap-2">
        <div class="w-7 h-7 rounded-lg flex items-center justify-center" style="background: rgba(var(--game-color-rgb), 0.1);">
          <i data-lucide="wallet" class="w-3.5 h-3.5" style="color: var(--game-color);"></i>
        </div>
        Select Payment Method
      </h3>
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
        {% for method in payment_methods %}
        <label class="relative cursor-pointer">
          <input type="radio" name="payment_method" value="{{ method }}" required
                 class="peer sr-only" {% if forloop.first %}checked{% endif %}>
          <div class="radio-card">
            <i data-lucide="{% if method == 'bkash' %}smartphone{% elif method == 'nagad' %}smartphone{% elif method == 'rocket' %}smartphone{% elif method == 'deltacoin' %}coins{% else %}credit-card{% endif %}"
               class="w-6 h-6 mx-auto mb-2 text-gray-400"></i>
            <p class="text-xs text-white capitalize font-semibold">{{ method }}</p>
          </div>
        </label>
        {% endfor %}
      </div>
    </div>

    {# ── DeltaCoin Option ── #}
    {% if deltacoin_balance is not None %}
    <div class="reg-glass rounded-2xl p-4" style="border-color: {% if deltacoin_can_afford %}rgba(16,185,129,0.2){% else %}rgba(234,179,8,0.2){% endif %};">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center">
          <i data-lucide="coins" class="w-5 h-5 text-amber-400"></i>
        </div>
        <div class="flex-1">
          <p class="text-sm text-white">DeltaCoin Balance: <span class="font-mono text-amber-400 font-bold">{{ deltacoin_balance|intcomma }}</span></p>
          {% if deltacoin_can_afford %}
          <p class="text-[10px] text-emerald-400">Sufficient balance to pay with DeltaCoin</p>
          {% else %}
          <p class="text-[10px] text-amber-400">Short by {{ deltacoin_shortfall|intcomma }} DeltaCoin</p>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}

    {# ── Payment Details (for mobile banking) ── #}
    <div id="mobile-payment-fields" class="reg-glass-strong rounded-2xl p-6">
      <h3 class="text-sm font-bold text-white mb-5 flex items-center gap-2">
        <div class="w-7 h-7 rounded-lg flex items-center justify-center bg-indigo-500/10">
          <i data-lucide="receipt" class="w-3.5 h-3.5 text-indigo-400"></i>
        </div>
        Payment Details
      </h3>
      <div class="space-y-4">
        <div>
          <label class="reg-label block mb-1.5">Transaction ID <span class="text-red-400">*</span></label>
          <input type="text" name="transaction_id"
                 class="reg-input font-mono" placeholder="e.g., TXN123456789">
          <p class="text-[10px] text-gray-600 mt-1.5">Enter the transaction ID from your payment confirmation</p>
        </div>
        <div>
          <label class="reg-label block mb-1.5">Sender Number</label>
          <input type="tel" name="sender_number"
                 class="reg-input" placeholder="+880xxxxxxxxx">
        </div>
        <div>
          <label class="reg-label block mb-1.5">Payment Screenshot (optional)</label>
          <div class="upload-zone">
            <input type="file" name="payment_proof" accept="image/*" class="hidden" id="payment-proof-input">
            <label for="payment-proof-input" class="cursor-pointer">
              <i data-lucide="upload-cloud" class="w-8 h-8 text-gray-600 mx-auto mb-2"></i>
              <p class="text-xs text-gray-400">Click to upload or drag & drop</p>
              <p class="text-[10px] text-gray-600 mt-1">PNG, JPG up to 5MB</p>
            </label>
          </div>
        </div>
      </div>
    </div>

    {# ── Navigation ── #}
    <div class="flex items-center justify-between pt-2">
      <a href="{{ request.path }}?type=solo&step=2" class="btn-back">
        <i data-lucide="arrow-left" class="w-4 h-4"></i> Back
      </a>
      <button type="submit" class="btn-primary">
        <i data-lucide="check" class="w-4 h-4"></i> Submit Registration
      </button>
    </div>
  </form>

{% endblock %}
