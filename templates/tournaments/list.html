{% extends "tournaments/base.html" %}
{% load static humanize %}

{# ─────────────────────────────────────────────────────────
   FE-T-001: Tournament List / Discovery Page
   Phase 4 — Exact replica of user's list_demo.html design
   ───────────────────────────────────────────────────────── #}

{% block title %}Tournaments | DeltaCrown{% endblock %}
{% block og_title %}Tournaments | DeltaCrown{% endblock %}

{% block tournament_css %}
<style>
    /* --- DISCOVERY PAGE AESTHETICS --- */

    /* Glassmorphism */
    .glass { background: rgba(10, 10, 10, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
    .glass-strong { background: rgba(20, 20, 20, 0.85); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }

    /* Navigation Pills */
    .nav-pill {
        display: flex; align-items: center; gap: 10px; padding: 10px 14px;
        border-radius: 12px; color: #9ca3af; transition: all 0.2s ease;
        border: 1px solid transparent; width: 100%; text-align: left; cursor: pointer;
    }
    .nav-pill:hover { background: rgba(255,255,255,0.03); color: #fff; border-color: rgba(255,255,255,0.05); }
    .nav-pill.active { background: rgba(6, 182, 212, 0.1); color: #06b6d4; border-color: rgba(6, 182, 212, 0.25); box-shadow: 0 0 15px rgba(6,182,212,0.1); }

    /* Game Icons */
    .game-icon {
        width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center;
        font-size: 10px; font-weight: 900; color: #000; flex-shrink: 0;
    }

    /* Hero Carousel */
    .hero-slide {
        position: absolute; inset: 0; opacity: 0; transition: opacity 0.8s ease-in-out;
        background-size: cover; background-position: center;
    }
    .hero-slide.active { opacity: 1; }
    .hero-overlay {
        background: linear-gradient(90deg, #050505 0%, rgba(5,5,5,0.8) 40%, rgba(5,5,5,0.2) 100%);
    }

    /* Tournament Cards */
    .card-modern {
        background: #0a0a0a; border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px; overflow: hidden; position: relative;
        transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
    }
    .card-modern:hover {
        transform: translateY(-4px);
        border-color: rgba(6, 182, 212, 0.4);
        box-shadow: 0 10px 30px -10px rgba(6, 182, 212, 0.15);
    }
    .card-img-wrap { height: 160px; position: relative; overflow: hidden; }
    .card-img-wrap img { transition: transform 0.6s ease; }
    .card-modern:hover .card-img-wrap img { transform: scale(1.08); }
    .card-img-wrap::after {
        content: ''; position: absolute; inset: 0;
        background: linear-gradient(to bottom, transparent 0%, #0a0a0a 100%);
    }

    /* Live card border glow */
    .card-modern.card-live { border-color: rgba(239, 68, 68, 0.2); }
    .card-modern.card-live:hover { border-color: rgba(239, 68, 68, 0.5); box-shadow: 0 10px 30px -10px rgba(239,68,68,0.15); }

    /* Completed card */
    .card-modern.card-ended { opacity: 0.75; filter: grayscale(0.3); }
    .card-modern.card-ended:hover { opacity: 1; filter: grayscale(0); }

    /* Scrollbar Hide */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* Thin scrollbar for sidebar */
    .scrollbar-thin::-webkit-scrollbar { width: 4px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 9999px; }
    .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }
    .scrollbar-thin { scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.1) transparent; }
</style>
{% endblock %}

{% block tournament_content %}

{# Hero Carousel #}
<div class="relative w-full h-[300px] md:h-[380px] overflow-hidden border-b border-dc-border group">
  {% for t in featured_tournaments %}
  <div class="hero-slide{% if forloop.first %} active{% endif %}"
       style="background-image: url('{% if t.banner_image %}{{ t.banner_image.url }}{% else %}https://images.unsplash.com/photo-1624138784181-dc7f5b75e52e?q=80&w=2670&auto=format&fit=crop{% endif %}');">
    <div class="absolute inset-0 hero-overlay flex items-center">
      <div class="max-w-[1600px] mx-auto px-6 w-full pt-10">
        <div class="max-w-2xl space-y-4">
          <div class="flex items-center gap-3">
            {% if t.status == 'live' %}
            <span class="px-3 py-1 rounded bg-red-600/90 text-white text-[10px] font-bold uppercase tracking-wider shadow-lg animate-pulse">Live Now</span>
            {% elif t.status == 'registration_open' %}
            <span class="px-3 py-1 rounded bg-green-600/90 text-white text-[10px] font-bold uppercase tracking-wider shadow-lg">Open</span>
            {% else %}
            <span class="px-3 py-1 rounded bg-dc-purple/90 text-white text-[10px] font-bold uppercase tracking-wider shadow-lg">Upcoming</span>
            {% endif %}
            <span class="text-xs font-bold text-gray-300 flex items-center gap-1">
              <i data-lucide="monitor" class="w-3 h-3 text-{% if t.status == 'live' %}red-500{% else %}dc-cyan{% endif %}"></i>
              {{ t.game.display_name }}
            </span>
          </div>
          <h1 class="font-display font-black text-4xl md:text-6xl text-white leading-none drop-shadow-2xl">
            {{ t.name|upper }}
          </h1>
          <p class="text-gray-300 text-sm md:text-base max-w-lg line-clamp-2">{{ t.description|striptags|truncatewords:25 }}</p>
          {% if t.description|striptags|truncatewords:25 != t.description|striptags %}
          <a href="{% url 'tournaments:detail' t.slug %}" class="inline-flex items-center gap-1 text-dc-cyan text-xs font-semibold hover:underline mt-1">
            Read more <i data-lucide="chevron-right" class="w-3 h-3"></i>
          </a>
          {% endif %}
          <div class="flex items-center gap-4 pt-2">
            <a href="{% if t.id in user_registered_tournaments and t.status == 'live' %}{% url 'tournaments:tournament_hub' t.slug %}{% else %}{% url 'tournaments:detail' t.slug %}{% endif %}"
               class="px-6 py-3 bg-white text-black font-bold rounded-xl hover:bg-gray-200 transition flex items-center gap-2">
              <i data-lucide="{% if t.status == 'live' %}play{% else %}arrow-right{% endif %}" class="w-4 h-4 fill-black"></i>
              {% if t.id in user_registered_tournaments and t.status == 'live' %}Enter Hub{% elif t.status == 'live' %}Watch Stream{% else %}View Details{% endif %}
            </a>
            {% if t.prize_pool %}
            <div class="text-sm font-medium text-white bg-black/50 px-4 py-2 rounded-lg border border-white/10">
              <span class="text-gray-400">Prize:</span>
              <span class="text-dc-gold font-bold">৳{{ t.prize_pool|floatformat:0|intcomma }}</span>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  {% empty %}
  <div class="hero-slide active" style="background: linear-gradient(135deg, #050505, #0d1117);">
    <div class="absolute inset-0 hero-overlay flex items-center">
      <div class="max-w-[1600px] mx-auto px-6 w-full pt-10">
        <div class="max-w-2xl space-y-4">
          <h1 class="font-display font-black text-4xl md:text-6xl text-white leading-none drop-shadow-2xl">
            <span class="text-dc-cyan">COMPETE</span> &amp; CONQUER
          </h1>
          <p class="text-gray-300 text-sm md:text-base max-w-lg">Browse tournaments, register your team, and climb the leaderboard.</p>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}

  {% if featured_tournaments %}
  <div class="hero-dots absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2">
    {% for t in featured_tournaments %}
    <div class="h-1 rounded-full transition-all duration-300 {% if forloop.first %}w-8 bg-white{% else %}w-2 bg-white/30{% endif %}"></div>
    {% endfor %}
  </div>
  {% endif %}
</div>

{# Main 3-Column Layout #}
<div class="max-w-[1600px] mx-auto px-4 lg:px-6 py-8 flex-1 w-full">
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

    {# ── Left Sidebar: Game + Format Filters ── #}
    <div class="hidden lg:block lg:col-span-2 space-y-8 sticky top-24 max-h-[calc(100vh-7rem)] overflow-y-auto scrollbar-thin scrollbar-thumb-dc-border scrollbar-track-transparent pr-1">

      {# Search #}
      <form method="get" class="relative group">
        {% for key, val in request.GET.items %}{% if key != 'search' and key != 'page' %}
        <input type="hidden" name="{{ key }}" value="{{ val }}">
        {% endif %}{% endfor %}
        <i data-lucide="search" class="absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500 group-focus-within:text-dc-cyan transition-colors"></i>
        <input type="text" name="search" value="{{ current_search }}" placeholder="Search events..."
               class="w-full bg-dc-card border border-dc-border rounded-xl py-2.5 pl-10 pr-4 text-sm text-white placeholder-gray-600 focus:border-dc-cyan/50 focus:ring-1 focus:ring-dc-cyan/50 outline-none transition-all shadow-sm">
      </form>

      {# Game filter #}
      <div>
        <h3 class="text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-3 px-2">Select Game</h3>
        <div class="space-y-1">
          <a href="?{% if current_status %}status={{ current_status }}{% endif %}{% if current_search %}&search={{ current_search }}{% endif %}"
             class="nav-pill{% if not current_game %} active{% endif %}">
            <div class="game-icon bg-dc-cyan/20 text-dc-cyan"><i data-lucide="layout-grid" class="w-3.5 h-3.5"></i></div>
            <span class="text-sm font-semibold">All Games</span>
          </a>
          {% for game in games %}
          <a href="?game={{ game.slug }}{% if current_status %}&status={{ current_status }}{% endif %}{% if current_search %}&search={{ current_search }}{% endif %}"
             class="nav-pill group{% if current_game == game.slug %} active{% endif %}">
            {% if game.icon %}
            <img src="{{ game.icon }}" class="w-6 h-6 rounded-md object-cover" alt="{{ game.name }}">
            {% else %}
            <div class="game-icon bg-dc-cyan text-white">{{ game.name|truncatechars:2 }}</div>
            {% endif %}
            <span class="text-sm font-medium group-hover:text-white">{{ game.name }}</span>
          </a>
          {% endfor %}
        </div>
      </div>

      {# Format filter #}
      <div>
        <h3 class="text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-3 px-2">Format</h3>
        <div class="flex flex-wrap gap-2 px-1">
          {% for opt in format_options %}
          <a href="?format={{ opt.value }}{% if current_game %}&game={{ current_game }}{% endif %}{% if current_status %}&status={{ current_status }}{% endif %}"
             class="px-3 py-1.5 rounded-lg border text-xs transition
               {% if current_format == opt.value %}bg-dc-cyan/10 border-dc-cyan/40 text-dc-cyan{% else %}border-white/10 bg-white/5 text-gray-300 hover:border-dc-cyan/40 hover:text-white{% endif %}">
            {{ opt.label }}
          </a>
          {% endfor %}
        </div>
      </div>

      {# Status filter #}
      <div>
        <h3 class="text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-3 px-2">Status</h3>
        <div class="flex flex-wrap gap-2 px-1">
          {% for opt in status_options %}
          <a href="?status={{ opt.value }}{% if current_game %}&game={{ current_game }}{% endif %}{% if current_search %}&search={{ current_search }}{% endif %}"
             class="px-3 py-1.5 rounded-lg border text-xs transition
               {% if current_status == opt.value %}bg-dc-cyan/10 border-dc-cyan/40 text-dc-cyan{% else %}border-white/10 bg-white/5 text-gray-300 hover:border-dc-cyan/40 hover:text-white{% endif %}">
            {{ opt.label }}
          </a>
          {% endfor %}
        </div>
      </div>
    </div>

    {# ── Main Content: Tournament Grid ── #}
    <div class="col-span-1 lg:col-span-7 space-y-6">

      {# Header bar #}
      <div class="flex items-center justify-between pb-4 border-b border-dc-border">
        <h2 class="font-display font-bold text-2xl text-white">Explore Tournaments</h2>
        <div class="flex items-center gap-3">
          <select onchange="window.location.search='?sort='+this.value"
                  class="bg-dc-card border border-dc-border text-xs text-gray-300 rounded-lg px-3 py-2 outline-none focus:border-dc-cyan/50">
            <option value="trending">Sort: Trending</option>
            <option value="soonest">Sort: Soonest</option>
            <option value="prize">Prize: High to Low</option>
          </select>
        </div>
      </div>

      {# Mobile game pills #}
      <div class="lg:hidden flex gap-2 overflow-x-auto pb-4 no-scrollbar">
        <a href="?{% if current_status %}status={{ current_status }}{% endif %}"
           class="px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap {% if not current_game %}bg-dc-cyan text-black{% else %}bg-dc-card border border-dc-border text-gray-400{% endif %}">All</a>
        {% for game in games %}
        <a href="?game={{ game.slug }}{% if current_status %}&status={{ current_status }}{% endif %}"
           class="px-4 py-2 rounded-lg text-xs font-medium whitespace-nowrap {% if current_game == game.slug %}bg-dc-cyan text-black{% else %}bg-dc-card border border-dc-border text-gray-400{% endif %}">{{ game.name }}</a>
        {% endfor %}
      </div>

      {# Tournament card grid #}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
        {% for t in tournament_list %}
        <a href="{% if t.id in user_registered_tournaments and t.status == 'live' %}{% url 'tournaments:tournament_hub' t.slug %}{% else %}{% url 'tournaments:detail' t.slug %}{% endif %}"
           class="card-modern group cursor-pointer {% if t.status == 'live' %}card-live{% elif t.status == 'completed' %}card-ended{% endif %}">
          <div class="card-img-wrap">
            <img src="{% if t.banner_image %}{{ t.banner_image.url }}{% elif t.game.banner %}{{ t.game.banner.url }}{% elif t.game.card_image %}{{ t.game.card_image.url }}{% else %}https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=1000&auto=format&fit=crop{% endif %}"
                 class="w-full h-full object-cover" alt="{{ t.name }}">
            {# Left badges #}
            <div class="absolute top-3 left-3 flex gap-2 z-10">
              {% if t.participation_type == 'team' %}
              <span class="bg-black/60 backdrop-blur border border-white/10 text-white text-[10px] font-bold px-2 py-1 rounded flex items-center gap-1">
                <i data-lucide="users" class="w-3 h-3 text-dc-cyan"></i> Team
              </span>
              {% else %}
              <span class="bg-black/60 backdrop-blur border border-white/10 text-white text-[10px] font-bold px-2 py-1 rounded flex items-center gap-1">
                <i data-lucide="user" class="w-3 h-3 text-dc-cyan"></i> Solo
              </span>
              {% endif %}
            </div>
            {# Right status badge #}
            <div class="absolute top-3 right-3 z-10">
              {% if t.status == 'live' %}
              <span class="bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded shadow-lg uppercase animate-pulse">● Live</span>
              {% elif t.status == 'registration_open' %}
              <span class="bg-green-500 text-black text-[10px] font-bold px-2 py-1 rounded shadow-lg uppercase">Open</span>
              {% elif t.status == 'completed' %}
              <span class="bg-gray-800 text-gray-300 text-[10px] font-bold px-2 py-1 rounded uppercase">Ended</span>
              {% else %}
              <span class="bg-dc-purple text-white text-[10px] font-bold px-2 py-1 rounded shadow-lg uppercase">{{ t.tournament_start|date:"M j" }}</span>
              {% endif %}
            </div>
          </div>

          <div class="p-5 {% if t.status == 'live' %}relative overflow-hidden{% endif %}">
            {% if t.status == 'live' %}
            <div class="absolute top-0 right-0 w-32 h-32 bg-red-600/10 rounded-full blur-3xl -z-10 pointer-events-none"></div>
            {% endif %}

            <div class="flex items-center justify-between mb-2">
              <span class="text-[10px] font-bold uppercase tracking-wider flex items-center gap-1.5
                {% if t.status == 'live' %}text-red-400{% elif t.status == 'completed' %}text-gray-500{% else %}text-dc-cyan{% endif %}">
                {% if t.game.icon %}<img src="{{ t.game.icon.url }}" alt="" class="w-4 h-4 rounded object-cover">{% endif %}
                {{ t.game.display_name }}
              </span>
              {% if t.status != 'live' %}
              <span class="text-[10px] text-gray-500">
                {% if t.status == 'completed' %}Ended{% else %}Starts {{ t.tournament_start|date:"M j" }}{% endif %}
              </span>
              {% endif %}
            </div>

            <h3 class="font-display font-bold text-lg text-white mb-4 transition-colors line-clamp-1
              {% if t.status == 'live' %}group-hover:text-red-500{% elif t.status == 'completed' %}{% else %}group-hover:text-dc-cyan{% endif %}">
              {{ t.name }}
            </h3>

            {# Stats bar #}
            <div class="flex items-center justify-between p-3 rounded-lg mb-4
              {% if t.status == 'live' %}bg-red-500/5 border border-red-500/10{% elif t.status == 'completed' %}bg-gradient-to-r from-dc-gold/10 to-transparent border border-dc-gold/20{% else %}bg-white/5 border border-white/5{% endif %}">
              {% if t.status == 'completed' %}
              <div class="flex items-center gap-3 w-full">
                <div class="w-8 h-8 rounded bg-dc-gold/20 flex items-center justify-center text-dc-gold"><i data-lucide="crown" class="w-4 h-4 fill-current"></i></div>
                <div>
                  <div class="text-[10px] font-bold text-dc-gold uppercase">Completed</div>
                  <div class="text-sm font-bold text-white">View Results</div>
                </div>
              </div>
              {% else %}
              <div class="text-center">
                <div class="text-[10px] text-gray-500 uppercase font-bold">Prize</div>
                <div class="text-dc-gold font-bold font-display">{% if t.prize_pool %}৳{{ t.prize_pool|floatformat:0|intcomma }}{% else %}TBD{% endif %}</div>
              </div>
              <div class="w-px h-6 bg-white/10"></div>
              <div class="text-center">
                <div class="text-[10px] text-gray-500 uppercase font-bold">Entry</div>
                <div class="text-white font-bold font-display">{% if t.has_entry_fee and t.entry_fee_amount %}৳{{ t.entry_fee_amount|floatformat:0|intcomma }}{% else %}Free{% endif %}</div>
              </div>
              <div class="w-px h-6 bg-white/10"></div>
              <div class="text-center">
                <div class="text-[10px] text-gray-500 uppercase font-bold">Slots</div>
                <div class="text-white font-bold font-display">{{ t.registration_count }}/{{ t.max_participants }}</div>
              </div>
              {% endif %}
            </div>

            {# Action button — registration-aware #}
            {% if t.id in user_registered_tournaments %}
              {% if t.status == 'live' %}
              <span class="w-full py-2.5 rounded-lg bg-gradient-to-r from-red-600 to-red-700 border border-red-500/50 text-white font-bold text-sm transition-all flex items-center justify-center gap-2 shadow-lg shadow-red-600/20">
                <i data-lucide="swords" class="w-4 h-4"></i> Enter Tournament Hub
              </span>
              {% elif t.status == 'completed' %}
              <span class="w-full py-2.5 rounded-lg bg-dc-gold/10 border border-dc-gold/30 text-dc-gold group-hover:bg-dc-gold/20 font-bold text-sm transition-all flex items-center justify-center gap-2">
                <i data-lucide="trophy" class="w-4 h-4"></i> View Results
              </span>
              {% else %}
              <span class="w-full py-2.5 rounded-lg bg-green-600/20 border border-green-500/30 text-green-400 group-hover:bg-green-600/30 font-bold text-sm transition-all flex items-center justify-center gap-2">
                <i data-lucide="check-circle" class="w-4 h-4"></i> Registered — View Hub
              </span>
              {% endif %}
            {% else %}
              {% if t.status == 'live' %}
              <span class="w-full py-2.5 rounded-lg bg-white/5 border border-white/10 group-hover:bg-red-600 group-hover:border-red-600 group-hover:text-white text-gray-300 font-bold text-sm transition-all flex items-center justify-center gap-2">
                <i data-lucide="tv" class="w-4 h-4"></i> Watch Stream
              </span>
              {% elif t.status == 'completed' %}
              <span class="w-full py-2.5 rounded-lg bg-transparent border border-white/10 group-hover:bg-white/5 text-gray-400 group-hover:text-white font-bold text-sm transition-all flex items-center justify-center">
                View Results
              </span>
              {% elif t.status == 'registration_open' %}
              <span class="w-full py-2.5 rounded-lg bg-dc-cyan hover:bg-dc-cyan/90 text-black font-bold text-sm transition-all flex items-center justify-center gap-2">
                Register {% if t.participation_type == 'team' %}Team{% endif %} <i data-lucide="arrow-right" class="w-4 h-4"></i>
              </span>
              {% else %}
              <span class="w-full py-2.5 rounded-lg bg-white/5 border border-white/10 group-hover:bg-dc-purple group-hover:border-dc-purple text-white font-bold text-sm transition-all flex items-center justify-center">
                Pre-Register
              </span>
              {% endif %}
            {% endif %}
          </div>
        </a>
        {% empty %}
        <div class="col-span-2 text-center py-20">
          <i data-lucide="search" class="w-12 h-12 mx-auto text-gray-600 mb-4"></i>
          <h3 class="font-display font-bold text-xl text-white mb-2">No tournaments found</h3>
          <p class="text-sm text-gray-500">Try adjusting your filters or check back later for upcoming events.</p>
          <a href="{% url 'tournaments:list' %}" class="inline-block mt-4 px-6 py-2 bg-dc-cyan text-black font-bold rounded-lg text-sm">Clear Filters</a>
        </div>
        {% endfor %}
      </div>

      {# Pagination / Load More #}
      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if current_game %}&game={{ current_game }}{% endif %}{% if current_status %}&status={{ current_status }}{% endif %}{% if current_search %}&search={{ current_search }}{% endif %}"
         class="w-full py-4 rounded-xl border border-white/5 bg-white/5 text-gray-400 hover:text-white hover:bg-white/10 transition-all font-medium flex items-center justify-center gap-2">
        Load More Events <i data-lucide="chevron-down" class="w-4 h-4"></i>
      </a>
      {% endif %}
    </div>

    {# ── Right Sidebar ── #}
    <div class="hidden lg:block lg:col-span-3 space-y-6">

      {# My Tournaments widget — powered by my_tournaments_sidebar (all user registrations) #}
      {% if user.is_authenticated and my_tournaments_sidebar %}
      <div class="bg-dc-card border border-dc-border rounded-2xl p-5 shadow-lg">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider flex items-center gap-2">
            <i data-lucide="user" class="w-3.5 h-3.5 text-dc-cyan"></i> My Tournaments
          </h3>
          <span class="text-[10px] font-bold text-dc-cyan bg-dc-cyan/10 px-2 py-0.5 rounded-full">{{ my_tournaments_sidebar|length }}</span>
        </div>
        <div class="space-y-3">
          {% for mt in my_tournaments_sidebar %}
          <a href="{% if mt.status == 'live' %}{% url 'tournaments:tournament_hub' mt.slug %}{% else %}{% url 'tournaments:detail' mt.slug %}{% endif %}"
             class="block p-3 rounded-xl cursor-pointer transition
               {% if mt.status == 'live' %}bg-gradient-to-r from-red-600/10 to-transparent border border-red-500/20 hover:border-red-500/50{% else %}bg-gradient-to-r from-dc-cyan/10 to-transparent border border-dc-cyan/20 hover:border-dc-cyan/50{% endif %}">
            <div class="flex justify-between items-start mb-1">
              <div class="flex items-center gap-2 min-w-0">
                {% if mt.game_logo %}
                <img src="{{ mt.game_logo }}" alt="" class="w-5 h-5 rounded object-cover flex-shrink-0">
                {% endif %}
                <span class="text-sm font-bold text-white truncate">{{ mt.name|truncatewords:5 }}</span>
              </div>
              {% if mt.status == 'live' %}
              <span class="relative flex h-2 w-2 flex-shrink-0 ml-2">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span>
              </span>
              {% endif %}
            </div>
            <div class="flex items-center justify-between mt-2">
              <span class="text-[10px] text-gray-400">
                {% if mt.status == 'live' %}<span class="text-red-400 font-bold">● LIVE</span>
                {% elif mt.status == 'completed' %}Ended
                {% elif mt.tournament_start %}{{ mt.tournament_start|date:"M j \a\t g:i A" }}
                {% else %}{{ mt.game_name }}{% endif %}
              </span>
              <div class="flex items-center gap-2">
                {% if mt.participation_type == 'team' %}
                <span class="text-[10px] text-gray-500"><i data-lucide="users" class="w-3 h-3 inline"></i></span>
                {% endif %}
                <span class="text-[10px] font-bold px-1.5 py-0.5 rounded
                  {% if mt.reg_status == 'confirmed' %}text-green-400 bg-green-400/10
                  {% elif mt.reg_status == 'waitlisted' %}text-yellow-400 bg-yellow-400/10
                  {% elif mt.reg_status == 'checked_in' %}text-dc-cyan bg-dc-cyan/10
                  {% else %}text-gray-400 bg-white/5{% endif %}">
                  {{ mt.reg_status|title }}
                </span>
              </div>
            </div>
          </a>
          {% endfor %}
        </div>
        {% if my_tournaments_sidebar|length >= 8 %}
        <a href="{% url 'dashboard:index' %}" class="block mt-3 text-center text-[10px] text-dc-cyan hover:underline font-semibold">View All →</a>
        {% endif %}
      </div>
      {% elif user.is_authenticated %}
      <div class="bg-dc-card border border-dc-border rounded-2xl p-5 shadow-lg text-center">
        <div class="w-10 h-10 mx-auto bg-white/5 rounded-full flex items-center justify-center mb-3">
          <i data-lucide="search" class="w-5 h-5 text-gray-500"></i>
        </div>
        <h3 class="text-sm font-bold text-white mb-1">No Tournaments Yet</h3>
        <p class="text-[10px] text-gray-500 mb-3">Register for a tournament below to get started!</p>
      </div>
      {% endif %}

      {# Host a Tournament CTA — staff/organizer only #}
      {% if user.is_staff or user.is_superuser %}
      <a href="{% url 'admin:tournaments_tournament_add' %}" class="block relative overflow-hidden rounded-2xl p-6 group cursor-pointer border border-dc-purple/30 hover:border-dc-purple/60 transition-colors">
        <div class="absolute inset-0 bg-gradient-to-br from-dc-purple/20 to-black transition opacity-80 group-hover:opacity-100"></div>
        <div class="relative z-10 text-center">
          <div class="w-12 h-12 mx-auto bg-dc-purple rounded-full flex items-center justify-center mb-3 shadow-[0_0_20px_rgba(139,92,246,0.3)] group-hover:scale-110 transition-transform">
            <i data-lucide="trophy" class="w-6 h-6 text-white"></i>
          </div>
          <h3 class="font-display font-bold text-white text-lg mb-1">Host a Tournament</h3>
          <p class="text-xs text-gray-300 mb-4 px-2">Automated brackets, payments, and scoring. Free for community events.</p>
          <span class="block w-full py-2 bg-white text-black text-xs font-bold rounded-lg group-hover:bg-gray-200 transition-colors">
            Create Now
          </span>
        </div>
      </a>
      {% endif %}

      {# Latest Winners #}
      <div class="bg-dc-card border border-dc-border rounded-2xl p-5">
        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 flex items-center gap-2">
          <i data-lucide="crown" class="w-3.5 h-3.5 text-dc-gold"></i> Latest Winners
        </h3>
        <div class="space-y-4">
          {% for w in latest_winners %}
          <a href="{% url 'tournaments:detail' w.tournament_slug %}" class="flex items-center gap-3 group cursor-pointer">
            {% if w.game_icon %}
            <img src="{{ w.game_icon }}" alt="" class="w-8 h-8 rounded object-cover">
            {% else %}
            <div class="w-8 h-8 rounded bg-dc-gold/20 flex items-center justify-center">
              <i data-lucide="trophy" class="w-4 h-4 text-dc-gold"></i>
            </div>
            {% endif %}
            <div class="flex-1 min-w-0">
              <div class="text-sm font-bold text-white truncate group-hover:text-dc-gold transition-colors">{{ w.winner_name }}</div>
              <div class="text-[10px] text-gray-500 truncate">{{ w.tournament_name|truncatewords:5 }}</div>
            </div>
            {% if w.prize_pool %}
            <div class="text-right flex-shrink-0">
              <div class="text-xs font-bold text-dc-gold">৳{{ w.prize_pool|floatformat:0|intcomma }}</div>
            </div>
            {% endif %}
          </a>
          {% if not forloop.last %}
          <div class="w-full h-px bg-white/5"></div>
          {% endif %}
          {% empty %}
          <div class="text-center py-4">
            <i data-lucide="trophy" class="w-6 h-6 mx-auto text-gray-600 mb-2"></i>
            <p class="text-[10px] text-gray-500">No completed tournaments yet.</p>
          </div>
          {% endfor %}
        </div>
      </div>

    </div>
  </div>
</div>

{# Hero Carousel Script — with touch/swipe + keyboard support #}
<script>
  (function() {
    const slides = document.querySelectorAll('.hero-slide');
    if (slides.length <= 1) return;

    let current = 0;
    let autoTimer;

    function goTo(idx) {
      slides[current].classList.remove('active');
      current = ((idx % slides.length) + slides.length) % slides.length;
      slides[current].classList.add('active');
      updateDots();
    }

    function updateDots() {
      const dots = document.querySelectorAll('.hero-dots .h-1');
      dots.forEach((d, i) => {
        d.classList.toggle('w-8', i === current);
        d.classList.toggle('bg-white', i === current);
        d.classList.toggle('w-2', i !== current);
        d.classList.toggle('bg-white/30', i !== current);
      });
    }

    function resetAuto() {
      clearInterval(autoTimer);
      autoTimer = setInterval(() => goTo(current + 1), 5000);
    }

    // Auto-advance
    resetAuto();

    // Touch/swipe support
    const heroEl = document.querySelector('.hero-slide')?.parentElement;
    if (heroEl) {
      let touchStartX = 0, touchStartY = 0, swiping = false;
      heroEl.addEventListener('touchstart', (e) => {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
        swiping = true;
      }, { passive: true });
      heroEl.addEventListener('touchmove', (e) => {
        if (!swiping) return;
        const dx = e.touches[0].clientX - touchStartX;
        const dy = e.touches[0].clientY - touchStartY;
        // If horizontal swipe is dominant, prevent vertical scroll
        if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 10) {
          e.preventDefault();
        }
      }, { passive: false });
      heroEl.addEventListener('touchend', (e) => {
        if (!swiping) return;
        swiping = false;
        const dx = e.changedTouches[0].clientX - touchStartX;
        if (Math.abs(dx) > 50) {
          dx < 0 ? goTo(current + 1) : goTo(current - 1);
          resetAuto();
        }
      }, { passive: true });
    }

    // Dot click navigation
    document.querySelectorAll('.hero-dots .h-1').forEach((dot, i) => {
      dot.style.cursor = 'pointer';
      dot.addEventListener('click', () => { goTo(i); resetAuto(); });
    });
  })();
</script>

{% endblock %}
