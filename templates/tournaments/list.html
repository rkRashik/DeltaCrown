{% extends "base.html" %}
{% load static %}

{% block title %}Tournaments — DeltaCrown{% endblock %}

{% block content %}
<section class="container py-8">
  <header class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3 mb-4">
    <div>
      <h1 class="sec-h">Tournaments</h1>
      <p class="text-muted">Compete in premium events across Valorant, eFootball, and more.</p>
    </div>
  </header>

  {# Server-driven filters (match your public view params: q, game, status, entry) #}
  <form class="filter-bar glass rounded-2xl p-4" method="get" action="">
    <div class="filter-bar__row">
      <div class="filter-field">
        <label class="filter-label">Search</label>
        <input type="search" name="q" value="{{ q }}" class="filter-input" placeholder="Search tournaments…">
      </div>

      <div class="filter-field">
        <label class="filter-label">Game</label>
        <select name="game" class="filter-select">
          <option value="" {% if not game %}selected{% endif %}>All games</option>
          <option value="valorant" {% if game == 'valorant' %}selected{% endif %}>Valorant</option>
          <option value="efootball" {% if game == 'efootball' %}selected{% endif %}>eFootball Mobile</option>
        </select>
      </div>

      <div class="filter-field">
        <label class="filter-label">Status</label>
        <select name="status" class="filter-select">
          <option value="" {% if not status %}selected{% endif %}>Any</option>
          <option value="open" {% if status == 'open' %}selected{% endif %}>Open (upcoming)</option>
          <option value="ongoing" {% if status == 'ongoing' %}selected{% endif %}>Ongoing</option>
          <option value="finished" {% if status == 'finished' %}selected{% endif %}>Finished</option>
        </select>
      </div>

      <div class="filter-field">
        <label class="filter-label">Entry</label>
        <select name="entry" class="filter-select">
          <option value="" {% if not entry %}selected{% endif %}>Any</option>
          <option value="free" {% if entry == 'free' %}selected{% endif %}>Free</option>
          <option value="paid" {% if entry == 'paid' %}selected{% endif %}>Paid</option>
        </select>
      </div>

      <div class="filter-actions">
        <button class="btn-secondary" type="submit">Apply</button>
        <a class="btn-ghost" href="{% url 'tournaments:list' %}">Reset</a>
      </div>
    </div>
  </form>

  {# Grid #}
  <div class="t-grid mt-6">
    {% if tournaments %}
      {% for t in tournaments %}
        {% include "tournaments/partials/_card.html" with tournament=t %}
      {% endfor %}
    {% else %}
      <div class="glass p-8 rounded-2xl text-center">
        <img src="{% static 'siteui/svg/empty/empty-tournaments.svg' %}" alt="No tournaments" class="mx-auto mb-3 opacity-80" width="240" height="160">
        <h3 class="text-xl font-semibold">No tournaments found</h3>
        <p class="text-muted mt-1">Try different filters.</p>
      </div>
    {% endif %}
  </div>

  {# Pagination (your view passes 'page') #}
  {% if page and page.paginator.num_pages > 1 %}
    <nav class="mt-8 flex items-center justify-center gap-2">
      {% if page.has_previous %}
        <a class="btn-ghost" href="?q={{ q }}&game={{ game }}&status={{ status }}&entry={{ entry }}&page={{ page.previous_page_number }}">← Prev</a>
      {% endif %}
      <span class="text-sm text-muted">Page {{ page.number }} of {{ page.paginator.num_pages }}</span>
      {% if page.has_next %}
        <a class="btn-ghost" href="?q={{ q }}&game={{ game }}&status={{ status }}&entry={{ entry }}&page={{ page.next_page_number }}">Next →</a>
      {% endif %}
    </nav>
  {% endif %}
</section>
{% endblock %}
