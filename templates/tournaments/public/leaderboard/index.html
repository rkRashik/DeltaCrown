{% extends "tournaments/base.html" %}
{% load static humanize %}

{# ─────────────────────────────────────────────────────────
   Leaderboard — FE-T-010
   Context: tournament, standings, user_rank, user_standing
   Phase 4 Frontend Rebuild
   ───────────────────────────────────────────────────────── #}

{% block title %}Leaderboard — {{ tournament.name }} | DeltaCrown{% endblock %}

{% block tournament_content %}

<div class="max-w-4xl mx-auto px-4 sm:px-6 py-8">

  {# ── Header ── #}
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
    <div>
      <a href="{% url 'tournaments:detail' tournament.slug %}" class="text-xs text-gray-500 hover:text-dc-cyan transition mb-2 inline-block">
        <i data-lucide="arrow-left" class="w-3 h-3 inline mr-1"></i> {{ tournament.name }}
      </a>
      <h1 class="text-2xl font-display font-bold text-white">
        <i data-lucide="bar-chart-3" class="w-6 h-6 inline mr-2 text-dc-gold"></i> Leaderboard
      </h1>
    </div>
    <div class="flex items-center gap-3">
      <a href="{% url 'tournaments:bracket' tournament.slug %}" class="px-3 py-1.5 text-xs text-gray-400 bg-white/5 rounded-lg border border-dc-border hover:bg-white/10 transition">
        <i data-lucide="git-branch" class="w-3 h-3 inline mr-1"></i> Bracket
      </a>
      <a href="{% url 'tournaments:results' tournament.slug %}" class="px-3 py-1.5 text-xs text-gray-400 bg-white/5 rounded-lg border border-dc-border hover:bg-white/10 transition">
        <i data-lucide="trophy" class="w-3 h-3 inline mr-1"></i> Results
      </a>
    </div>
  </div>

  {# ── User's Rank Card ── #}
  {% if user_standing %}
    <div class="glass rounded-xl p-5 mb-6 neon-border-cyan">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-xl bg-dc-cyan/10 flex items-center justify-center">
            <span class="text-lg font-display font-bold text-dc-cyan">#{{ user_rank }}</span>
          </div>
          <div>
            <p class="text-sm font-display font-semibold text-white">Your Position</p>
            <p class="text-xs text-gray-400">
              {{ user_standing.wins }} wins · {{ user_standing.losses }} losses · {{ user_standing.points }} pts
            </p>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  {# ── Standings Table ── #}
  {% if standings %}
    <div class="glass rounded-xl overflow-hidden overflow-x-auto">
      <table class="w-full min-w-[480px]">
        <thead>
          <tr class="border-b border-dc-border bg-white/[0.02]">
            <th class="px-4 py-3 text-left text-[10px] uppercase tracking-wider text-gray-500 w-14">#</th>
            <th class="px-4 py-3 text-left text-[10px] uppercase tracking-wider text-gray-500">Player</th>
            <th class="px-4 py-3 text-center text-[10px] uppercase tracking-wider text-gray-500 hidden sm:table-cell">GP</th>
            <th class="px-4 py-3 text-center text-[10px] uppercase tracking-wider text-gray-500">W</th>
            <th class="px-4 py-3 text-center text-[10px] uppercase tracking-wider text-gray-500">L</th>
            <th class="px-4 py-3 text-right text-[10px] uppercase tracking-wider text-gray-500">Pts</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-dc-border">
          {% for entry in standings %}
            <tr class="hover:bg-white/[0.02] transition
              {% if entry.is_current_user %}bg-dc-cyan/[0.04]{% endif %}
              {% if entry.rank <= 3 %}font-medium{% endif %}">
              <td class="px-4 py-3">
                <span class="text-sm font-mono
                  {% if entry.rank == 1 %}text-dc-gold{% elif entry.rank == 2 %}text-gray-400{% elif entry.rank == 3 %}text-amber-600{% else %}text-gray-500{% endif %}">
                  {{ entry.rank }}
                </span>
              </td>
              <td class="px-4 py-3">
                <div class="flex items-center gap-2">
                  {% if entry.rank == 1 %}
                    <i data-lucide="crown" class="w-3.5 h-3.5 text-dc-gold flex-shrink-0"></i>
                  {% endif %}
                  <span class="text-sm text-white truncate">{{ entry.participant.username|default:"Unknown" }}</span>
                  {% if entry.is_current_user %}
                    <span class="text-[9px] text-dc-cyan bg-dc-cyan/10 px-1.5 py-0.5 rounded">You</span>
                  {% endif %}
                </div>
              </td>
              <td class="px-4 py-3 text-center text-sm text-gray-400 hidden sm:table-cell">{{ entry.games_played }}</td>
              <td class="px-4 py-3 text-center text-sm text-green-400">{{ entry.wins }}</td>
              <td class="px-4 py-3 text-center text-sm text-red-400">{{ entry.losses }}</td>
              <td class="px-4 py-3 text-right text-sm font-mono text-dc-gold">{{ entry.points }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="glass rounded-xl p-12 text-center">
      <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-dc-surface flex items-center justify-center">
        <i data-lucide="bar-chart-3" class="w-8 h-8 text-gray-600"></i>
      </div>
      <h2 class="text-lg font-display font-bold text-white mb-2">No Standings Yet</h2>
      <p class="text-sm text-gray-400">Leaderboard will populate once matches are completed.</p>
    </div>
  {% endif %}

</div>

{% endblock %}
