{% extends "tournaments/base.html" %}
{% load static humanize tournament_tags %}

{# ─────────────────────────────────────────────────────────
   My Tournaments — Player dashboard
   Shows all tournaments the user has registered for
   Phase 4 Frontend Rebuild
   ───────────────────────────────────────────────────────── #}

{% block title %}My Tournaments | DeltaCrown{% endblock %}

{% block tournament_content %}

<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

  {# ── Header ── #}
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
    <div>
      <h1 class="text-2xl font-display font-bold text-white">My Tournaments</h1>
      <p class="text-sm text-gray-500 mt-1">Track your registrations and upcoming events</p>
    </div>
    <div class="flex items-center gap-3">
      <a href="{% url 'tournaments:my_matches' %}" class="text-xs px-4 py-2.5 bg-white/[0.05] text-gray-400 rounded-xl hover:text-white hover:bg-white/10 transition">
        <i data-lucide="swords" class="w-3 h-3 inline mr-1"></i> My Matches
      </a>
      <a href="{% url 'tournaments:list' %}" class="text-xs px-4 py-2.5 bg-dc-cyan/10 text-dc-cyan rounded-xl hover:bg-dc-cyan/20 transition">
        <i data-lucide="search" class="w-3 h-3 inline mr-1"></i> Browse Tournaments
      </a>
    </div>
  </div>

  {# ── Status Filter Tabs ── #}
  <div class="flex items-center gap-2 mb-6 overflow-x-auto no-scrollbar pb-1">
    <a href="?status=all"
       class="nav-pill text-xs {% if filter_status == 'all' %}active{% endif %}">
      All
    </a>
    <a href="?status=active"
       class="nav-pill text-xs {% if filter_status == 'active' %}active{% endif %}">
      Active <span class="ml-1 font-mono opacity-60">{{ active_count }}</span>
    </a>
    <a href="?status=upcoming"
       class="nav-pill text-xs {% if filter_status == 'upcoming' %}active{% endif %}">
      Upcoming <span class="ml-1 font-mono opacity-60">{{ upcoming_count }}</span>
    </a>
    <a href="?status=completed"
       class="nav-pill text-xs {% if filter_status == 'completed' %}active{% endif %}">
      Completed <span class="ml-1 font-mono opacity-60">{{ completed_count }}</span>
    </a>
  </div>

  {# ── Tournament Registration List ── #}
  {% if my_tournaments %}
    <div class="space-y-3">
      {% for reg in my_tournaments %}
        <a href="{% url 'tournaments:detail' reg.tournament.slug %}"
           class="block glass rounded-xl p-5 hover:border-dc-border/40 transition group">
          <div class="flex items-center gap-4">
            {# Thumbnail #}
            <div class="w-14 h-14 rounded-xl bg-dc-surface border border-dc-border overflow-hidden flex-shrink-0">
              {% if reg.tournament.thumbnail_image %}
                <img src="{{ reg.tournament.thumbnail_image.url }}" class="w-full h-full object-cover">
              {% else %}
                <div class="w-full h-full flex items-center justify-center">
                  <i data-lucide="trophy" class="w-6 h-6 text-gray-700"></i>
                </div>
              {% endif %}
            </div>

            {# Info #}
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 mb-1">
                <h3 class="text-sm font-semibold text-white group-hover:text-dc-cyan transition truncate">
                  {{ reg.tournament.name }}
                </h3>
                {% include "tournaments/components/_status_badge.html" with status=reg.tournament.status %}
              </div>
              <div class="flex flex-wrap items-center gap-3 text-[11px] text-gray-500">
                <span>
                  <i data-lucide="gamepad-2" class="w-3 h-3 inline"></i>
                  {{ reg.tournament.game.display_name|default:"—" }}
                </span>
                <span>
                  <i data-lucide="calendar" class="w-3 h-3 inline"></i>
                  {{ reg.tournament.tournament_start|date:"M d, Y" }}
                </span>
                {% if reg.tournament.prize_pool %}
                  <span class="text-dc-gold">
                    <i data-lucide="trophy" class="w-3 h-3 inline"></i>
                    ৳{{ reg.tournament.prize_pool|intcomma }}
                  </span>
                {% endif %}
              </div>
            </div>

            {# Registration Status #}
            <div class="text-right flex-shrink-0">
              <span class="text-[10px] px-2 py-0.5 rounded-full font-mono
                {% if reg.status == 'confirmed' %}bg-green-600/20 text-green-400
                {% elif reg.status == 'pending' %}bg-yellow-600/20 text-yellow-400
                {% elif reg.status == 'rejected' %}bg-red-600/20 text-red-400
                {% elif reg.status == 'cancelled' %}bg-gray-600/20 text-gray-400
                {% else %}bg-gray-600/20 text-gray-400{% endif %}">
                {{ reg.status|title }}
              </span>
              {% if reg.checked_in %}
                <p class="text-[10px] text-green-400 mt-1">
                  <i data-lucide="check-circle-2" class="w-3 h-3 inline"></i> Checked In
                </p>
              {% endif %}
            </div>

            {# Arrow #}
            <i data-lucide="chevron-right" class="w-4 h-4 text-gray-700 group-hover:text-dc-cyan transition flex-shrink-0"></i>
          </div>
        </a>
      {% endfor %}
    </div>

    {# Pagination #}
    {% if is_paginated %}
      <div class="mt-8">
        {% include "tournaments/components/_pagination.html" %}
      </div>
    {% endif %}

  {% else %}
    <div class="text-center py-20 glass rounded-xl">
      <i data-lucide="trophy" class="w-12 h-12 text-gray-700 mx-auto mb-4"></i>
      <h3 class="text-lg font-display font-bold text-white mb-2">No tournaments yet</h3>
      <p class="text-sm text-gray-500 mb-6">You haven't registered for any tournaments. Browse and join one!</p>
      <a href="{% url 'tournaments:list' %}" class="inline-flex items-center gap-2 px-6 py-3 bg-dc-cyan text-black font-bold text-sm rounded-xl hover:bg-dc-cyan/90 transition">
        <i data-lucide="search" class="w-4 h-4"></i> Browse Tournaments
      </a>
    </div>
  {% endif %}

</div>

{% endblock %}
