{% extends "base.html" %}
{% load static tournament_dict_utils %}

{% block title %}{{ game_meta.name }} Tournaments — DeltaCrown{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'siteui/css/tokens.css' %}">
<link rel="stylesheet" href="{% static 'siteui/css/tournaments.css' %}">
{% endblock %}

{% block content %}
<section class="dc-container" data-game="{{ game|default:game_meta.name|lower }}">
  <nav class="dc-breadcrumb" aria-label="Breadcrumb">
    <a href="{% url 'tournaments:hub' %}" class="dc-link">Tournaments</a>
    <span aria-hidden="true">/</span>
    <span aria-current="page">{{ game_meta.name }}</span>
  </nav>

  <header class="dc-gameband glass" style="--game-color: {{ game_meta.primary|default:'#7c3aed' }}">
    <div class="dc-gameband-inner">
      <div class="dc-gameband-title">
        {% if game_meta.icon_url %}
          <img src="{{ game_meta.icon_url }}" alt="" class="dc-game-icon" aria-hidden="true">
        {% endif %}
        <h1 class="dc-title">{{ game_meta.name }}</h1>
      </div>
      <div class="dc-gameband-meta">
        <span class="dc-badge">{{ total|default:0 }} active</span>
        <div class="dc-presets">
          <a class="dc-chip" href="?status=open">Open Now</a>
          <a class="dc-chip" href="?start=7d">Starting ≤ 7d</a>
          <a class="dc-chip" href="?fee=free">Free</a>
        </div>
      </div>
    </div>
  </header>

  <section class="dc-section" aria-labelledby="section-all">
    <div class="dc-row-head">
      <h2 id="section-all" class="visually-hidden">All {{ game_meta.name }} tournaments</h2>
      <div class="dc-sort">
        <a class="dc-chip {% if sort == 'relevant' or not sort %}is-active{% endif %}" href="?{% if q %}q={{ q|urlencode }}&{% endif %}sort=relevant">Most relevant</a>
        <a class="dc-chip {% if sort == 'new' %}is-active{% endif %}" href="?{% if q %}q={{ q|urlencode }}&{% endif %}sort=new">Newest</a>
        <a class="dc-chip {% if sort == 'fee_asc' %}is-active{% endif %}" href="?{% if q %}q={{ q|urlencode }}&{% endif %}sort=fee_asc">Fee: Low→High</a>
      </div>
    </div>

    {# Compact, accessible Filter Orb (hover/tap) #}
    <div class="filter-orb-wrap" aria-label="Filters">
      {% include "tournaments/partials/_filter_orb.html" %}
    </div>

    {% if tournaments %}
      <div class="dc-grid">
        {% for t in tournaments %}
          {% include "tournaments/partials/_tournament_card.html" with t=t state=my_reg_states|get_tournament_item:t.id %}
        {% endfor %}
      </div>
    {% else %}
      {% include "tournaments/partials/_grid_empty.html" %}
    {% endif %}
  </section>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'siteui/js/tournaments-hub.js' %}"></script>
{% endblock %}
