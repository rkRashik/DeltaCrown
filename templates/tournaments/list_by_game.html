{% extends "base.html" %}
{% load static dict_utils %}

{% block title %}{{ game_meta.name }} Tournaments — DeltaCrown{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'siteui/css/tokens.css' %}">
<link rel="stylesheet" href="{% static 'siteui/css/tournaments.css' %}">
{% endblock %}

{% block content %}
<section class="dc-container">
  <nav class="dc-breadcrumb">
    <a href="{% url 'tournaments:hub' %}" class="dc-link">Tournaments</a>
    <span>/</span>
    <span>{{ game_meta.name }}</span>
  </nav>

  <header class="dc-gameband glass" style="--game-color: {{ game_meta.primary|default:'#7c3aed' }}">
    <div class="dc-gameband-inner">
      <div class="dc-gameband-title">
        {% if game_meta.icon_url %}
          <img src="{{ game_meta.icon_url }}" alt="{{ game_meta.name }}" class="dc-game-icon">
        {% endif %}
        <h1 class="dc-title">{{ game_meta.name }}</h1>
      </div>
      <div class="dc-gameband-meta">
        <span class="dc-badge">{{ total }} active</span>
        <div class="dc-presets">
          <a class="dc-chip" href="?status=open">Open Now</a>
          <a class="dc-chip" href="?start=7d">Starting ≤ 7d</a>
          <a class="dc-chip" href="?fee=free">Free</a>
        </div>
      </div>
    </div>
  </header>

  <section class="dc-section">
    <div class="dc-row-head">
      <form id="game-search-form" method="get" class="dc-search-form">
        <input type="search" name="q" value="{{ q|default_if_none:'' }}" class="dc-input" placeholder="Search {{ game_meta.name }} tournaments">
        <button class="dc-btn">Search</button>
      </form>
      <div class="dc-sort">
        <a class="dc-chip {% if sort == 'relevant' or not sort %}is-active{% endif %}" href="?{% if q %}q={{ q|urlencode }}&{% endif %}sort=relevant">Most relevant</a>
        <a class="dc-chip {% if sort == 'new' %}is-active{% endif %}" href="?{% if q %}q={{ q|urlencode }}&{% endif %}sort=new">Newest</a>
        <a class="dc-chip {% if sort == 'fee_asc' %}is-active{% endif %}" href="?{% if q %}q={{ q|urlencode }}&{% endif %}sort=fee_asc">Fee: Low→High</a>
      </div>
    </div>

    {% if tournaments %}
      <div class="dc-grid">
        {% for t in tournaments %}
          {% include "tournaments/partials/_tournament_card.html" with t=t state=my_reg_states|get_item:t.id %}
        {% endfor %}
      </div>
    {% else %}
      {% include "tournaments/partials/_grid_empty.html" %}
    {% endif %}
  </section>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'siteui/js/tournaments-hub.js' %}"></script>
{% endblock %}
