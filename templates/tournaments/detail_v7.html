{% extends "base.html" %}
{% load static humanize tournament_dict_utils game_assets_tags %}

{% block title %}{{ tournament.seo_meta.title }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'siteui/css/tournaments-v7-detail.css' %}?v=1">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

<!-- SEO Meta Tags (Enhanced with Backend Properties) -->
<meta name="description" content="{{ tournament.seo_meta.description }}">
<meta name="keywords" content="{{ tournament.seo_meta.keywords }}">
<meta name="author" content="DeltaCrown">
<meta name="robots" content="index, follow">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:title" content="{{ tournament.seo_meta.title }}">
<meta property="og:description" content="{{ tournament.seo_meta.description }}">
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ tournament.seo_meta.og_image }}">
<meta property="og:site_name" content="DeltaCrown">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="{{ request.build_absolute_uri }}">
<meta name="twitter:title" content="{{ tournament.seo_meta.title }}">
<meta name="twitter:description" content="{{ tournament.seo_meta.description }}">
<meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{{ tournament.seo_meta.og_image }}">

<!-- Schema.org Structured Data (JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SportsEvent",
  "name": "{{ tournament.name }}",
  "description": "{{ tournament.short_description|striptags }}",
  {% if tournament.schedule and tournament.schedule.start_date %}
  "startDate": "{{ tournament.schedule.start_date|date:'c' }}",
  {% endif %}
  {% if tournament.schedule and tournament.schedule.end_date %}
  "endDate": "{{ tournament.schedule.end_date|date:'c' }}",
  {% endif %}
  "eventStatus": "https://schema.org/EventScheduled",
  "eventAttendanceMode": "https://schema.org/OnlineEventAttendanceMode",
  {% if tournament.organizer and tournament.organizer.username %}
  "organizer": {
    "@type": "Organization",
    "name": "{{ tournament.organizer.get_full_name|default:'DeltaCrown' }}",
    "url": "{{ request.scheme }}://{{ request.get_host }}{% url 'user_profile:profile' tournament.organizer.username %}"
  },
  {% elif tournament.organizer %}
  "organizer": {
    "@type": "Organization",
    "name": "{{ tournament.organizer.get_full_name|default:'DeltaCrown' }}"
  },
  {% endif %}
  "image": "{{ request.scheme }}://{{ request.get_host }}{{ tournament.seo_meta.og_image }}",
  "url": "{{ request.build_absolute_uri }}",
  {% if tournament.finance and tournament.finance.prize_pool %}
  "offers": {
    "@type": "AggregateOffer",
    "priceCurrency": "BDT",
    "price": "{{ tournament.finance.prize_pool }}",
    "description": "Prize Pool"
  },
  {% endif %}
  "location": {
    "@type": "VirtualLocation",
    "url": "{{ request.build_absolute_uri }}"
  },
  "sport": "{{ tournament.get_game_display }}"
}
</script>

<script src="{% static 'js/tournaments-v7-detail.js' %}?v=1" defer></script>
{% endblock %}

{% block body_class %}tournament-detail-v7{% endblock %}

{% block content %}

<!-- ============================================
     HERO SECTION - Full width banner with overlay
     ============================================ -->
<section class="hero-section" role="banner" aria-label="Tournament Hero">
    <!-- Background Banner -->
    <div class="hero-bg" role="img" aria-label="Tournament banner background">
        {% if tournament.media and tournament.media.banner %}
            <img src="{{ tournament.media.banner.url }}" alt="{{ tournament.name }}" class="hero-bg-img">
        {% elif tournament.banner %}
            <img src="{{ tournament.banner.url }}" alt="{{ tournament.name }}" class="hero-bg-img">
        {% else %}
            <div class="hero-bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
        {% endif %}
        <div class="hero-overlay"></div>
    </div>

    <div class="hero-container">
        <!-- Game Logo/Icon -->
        <div class="hero-game-badge">
            <img src="{% game_icon_url tournament.game %}" alt="{{ tournament.get_game_display }}" class="game-icon">
            <span class="game-name">{{ tournament.get_game_display }}</span>
        </div>

        <!-- Tournament Title & Subtitle -->
        <h1 class="hero-title">{{ tournament.name }}</h1>
        
        {% if tournament.short_description %}
        <p class="hero-subtitle">{{ tournament.short_description|truncatewords:20 }}</p>
        {% endif %}

        <!-- Quick Stats Strip -->
        <div class="hero-stats">
            {% if tournament.finance %}
            <div class="stat-item">
                <svg class="stat-icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
                    <path d="M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
                    <path d="M18 2H6v7a6 6 0 0 0 12 0V2z"/>
                </svg>
                <div class="stat-content">
                    <span class="stat-value">à§³{{ tournament.finance.prize_pool_bdt|floatformat:0|intcomma }}</span>
                    <span class="stat-label">Prize Pool</span>
                </div>
            </div>
            {% endif %}

            <div class="stat-item">
                <svg class="stat-icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                <div class="stat-content">
                    {% if tournament.schedule %}
                    <span class="stat-value">{{ tournament.schedule.start_date|date:"M d, Y" }}</span>
                    <span class="stat-label">Start Date</span>
                    {% else %}
                    <span class="stat-value">TBA</span>
                    <span class="stat-label">Start Date</span>
                    {% endif %}
                </div>
            </div>

            <div class="stat-item">
                <svg class="stat-icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                <div class="stat-content">
                    {% if tournament.capacity %}
                    <span class="stat-value">{{ tournament.capacity.current_participants }}/{{ tournament.capacity.max_participants }}</span>
                    <span class="stat-label">Teams Registered</span>
                    {% else %}
                    <span class="stat-value">Open</span>
                    <span class="stat-label">Registration</span>
                    {% endif %}
                </div>
            </div>

            <div class="stat-item">
                <svg class="stat-icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                </svg>
                <div class="stat-content">
                    <span class="stat-value">{{ tournament.get_format_display|default:"Standard" }}</span>
                    <span class="stat-label">Format</span>
                </div>
            </div>
        </div>

        <!-- Registration Status Badge (Enhanced with Animations) -->
        {% with badge=tournament.registration_status_badge %}
        <div class="hero-status-badge status-{{ badge.color }} 
            {% if badge.color == 'warning' or badge.color == 'danger' %}badge-pulse{% endif %}"
            data-status-badge="{{ badge.text }}">
            <span class="badge-dot"></span> 
            {{ badge.icon }} {{ badge.text }}
            {% if tournament.schedule.is_registration_closing_soon %}
                <span class="urgency-text">(Closing Soon!)</span>
            {% endif %}
        </div>
        {% endwith %}
    </div>
</section>

<!-- ============================================
     PRIMARY CTA SECTION - Sticky on desktop
     ============================================ -->
<section class="cta-section" id="ctaSection">
    <div class="cta-container">
        <div class="cta-primary">
            {% if user.is_authenticated %}
                {% if user_registered %}
                    <!-- User is registered - show dashboard button -->
                    <a href="{% url 'tournaments:dashboard' tournament.slug %}" class="btn-cta btn-primary">
                        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="9" y1="9" x2="15" y2="9"/>
                            <line x1="9" y1="15" x2="15" y2="15"/>
                        </svg>
                        Go to My Dashboard
                    </a>
                {% else %}
                    <!-- User not registered - show register button -->
                    {% if tournament.registration_open and tournament.status == 'UPCOMING' %}
                        <button class="btn-cta btn-primary" data-action="register">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="8.5" cy="7" r="4"/>
                                <line x1="20" y1="8" x2="20" y2="14"/>
                                <line x1="23" y1="11" x2="17" y2="11"/>
                            </svg>
                            Register Now
                        </button>
                    {% elif tournament.status == 'RUNNING' %}
                        <a href="{% url 'tournaments:dashboard' tournament.slug %}" class="btn-cta btn-primary">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polygon points="10 8 16 12 10 16 10 8"/>
                            </svg>
                            Watch Live
                        </a>
                    {% else %}
                        <button class="btn-cta btn-secondary" disabled>
                            Registration Closed
                        </button>
                    {% endif %}
                {% endif %}
            {% else %}
                <!-- Guest user - show login prompt -->
                <a href="/accounts/login/?next={{ request.path }}" class="btn-cta btn-primary">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                        <polyline points="10 17 15 12 10 7"/>
                        <line x1="15" y1="12" x2="3" y2="12"/>
                    </svg>
                    Login to Register
                </a>
            {% endif %}
        </div>

        <div class="cta-secondary">
            {% if tournament.finance and tournament.finance.entry_fee_bdt > 0 and user_registered and not user_payment_complete %}
            <button class="btn-cta btn-accent" data-action="payment">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                    <line x1="1" y1="10" x2="23" y2="10"/>
                </svg>
                Pay Entry Fee
            </button>
            {% endif %}

            <button class="btn-cta btn-outline" data-action="share">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="18" cy="5" r="3"/>
                    <circle cx="6" cy="12" r="3"/>
                    <circle cx="18" cy="19" r="3"/>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                </svg>
                Share
            </button>

            <button class="btn-cta btn-outline" data-action="follow">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                </svg>
                Follow
            </button>
        </div>

        <!-- Registration Timer (if open) -->
        {% if tournament.registration_open and tournament.schedule and tournament.schedule.registration_end %}
        <div class="cta-timer">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </svg>
            <span>Registration closes in <strong id="regTimer" data-end="{{ tournament.schedule.registration_end|date:'c' }}">...</strong></span>
        </div>
        {% endif %}
    </div>
</section>

<!-- ============================================
     TAB NAVIGATION - Sticky below CTA
     ============================================ -->
<nav class="tab-navigation" id="tabNav">
    <div class="tab-nav-container">
        <button class="tab-link active" data-tab="overview">Overview</button>
        <button class="tab-link" data-tab="rules">Rules</button>
        <button class="tab-link" data-tab="prizes">Prizes</button>
        <button class="tab-link" data-tab="schedule">Schedule</button>
        <button class="tab-link" data-tab="brackets">Brackets</button>
        <button class="tab-link" data-tab="participants">Participants</button>
        {% if tournament.media %}
        <button class="tab-link" data-tab="media">Media</button>
        {% endif %}
        <button class="tab-link" data-tab="faq">FAQ</button>
    </div>
</nav>

<!-- ============================================
     MAIN CONTENT AREA - Tab Panels
     ============================================ -->
<div class="content-wrapper">
    <div class="content-container">
        
        <!-- ============================================
             OVERVIEW TAB
             ============================================ -->
        <div class="tab-panel active" id="tab-overview">
            <div class="content-grid">
                
                <!-- Main Column -->
                <div class="content-main">
                    
                    <!-- Tournament Description -->
                    <div class="content-card">
                        <h2 class="card-title">About This Tournament</h2>
                        <div class="card-body">
                            <div class="tournament-description">
                                {% if tournament.description %}
                                    {{ tournament.description|safe }}
                                {% else %}
                                    <p>{{ tournament.short_description }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Quick Info Grid -->
                    <div class="info-grid">
                        <!-- Platform -->
                        <div class="info-card">
                            <div class="info-icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                                </svg>
                            </div>
                            <div class="info-content">
                                <h4>Platform</h4>
                                <p>{{ tournament.get_platform_display|default:"PC / Mobile" }}</p>
                            </div>
                        </div>

                        <!-- Format -->
                        <div class="info-card">
                            <div class="info-icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                </svg>
                            </div>
                            <div class="info-content">
                                <h4>Format</h4>
                                <p>{{ tournament.get_format_display }}</p>
                            </div>
                        </div>

                        <!-- Team Size -->
                        <div class="info-card">
                            <div class="info-icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                    <circle cx="9" cy="7" r="4"/>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                                </svg>
                            </div>
                            <div class="info-content">
                                <h4>Team Size</h4>
                                <p>{{ tournament.team_size|default:"5v5" }} Players</p>
                            </div>
                        </div>

                        <!-- Region -->
                        <div class="info-card">
                            <div class="info-icon">
                                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="2" y1="12" x2="22" y2="12"/>
                                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                                </svg>
                            </div>
                            <div class="info-content">
                                <h4>Region</h4>
                                <p>{{ tournament.get_region_display|default:"Bangladesh" }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Eligibility & Requirements -->
                    {% if tournament.rules %}
                    <div class="content-card">
                        <h2 class="card-title">
                            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            Eligibility Requirements
                        </h2>
                        <div class="card-body">
                            {% if tournament.rules.eligibility_requirements %}
                            <div class="eligibility-list">
                                {{ tournament.rules.eligibility_requirements|safe }}
                            </div>
                            {% else %}
                            <p class="text-muted">Open to all players. Check full rules for details.</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                </div>

                <!-- Sidebar Column -->
                <div class="content-sidebar">
                    
                    <!-- Registration Progress -->
                    {% if tournament.capacity %}
                    <div class="sidebar-card">
                        <h3 class="sidebar-title">Registration Status</h3>
                        <div class="registration-progress">
                            <div class="progress-stats" role="status" aria-label="Registration count">
                                <span class="stat-current" 
                                      data-counter-target="{{ tournament.capacity.current_participants }}" 
                                      data-counter-duration="2000"
                                      aria-label="Current participants">0</span>
                                <span class="stat-separator">/</span>
                                <span class="stat-max" aria-label="Maximum capacity">{{ tournament.capacity.max_participants }}</span>
                                <span class="stat-label">Teams</span>
                            </div>
                            <div class="progress-bar" 
                                 data-progress="{{ tournament.registration_progress_percentage }}"
                                 role="progressbar"
                                 aria-valuemin="0"
                                 aria-valuemax="100"
                                 aria-valuenow="{{ tournament.registration_progress_percentage|floatformat:0 }}"
                                 aria-label="Registration progress: {{ tournament.registration_progress_percentage|floatformat:0 }}% full">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <p class="progress-note" role="status">
                                {% if tournament.has_available_slots %}
                                    {% widthratio tournament.capacity.max_participants 1 1 as max %}
                                    {% widthratio tournament.capacity.current_participants 1 1 as current %}
                                    {{ max|add:"-"|add:current }} spots remaining
                                {% elif tournament.is_full %}
                                    <span class="text-danger">ð´ Tournament is full!</span>
                                {% else %}
                                    Registration status unknown
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Live Countdown Timer -->
                    {% if tournament.schedule and tournament.schedule.start_date %}
                    <div class="sidebar-card countdown-card">
                        <h3 class="sidebar-title">
                            {% if tournament.schedule.phase_status == 'upcoming' or tournament.schedule.phase_status == 'registration' %}
                                â±ï¸ Tournament Starts In
                            {% elif tournament.schedule.phase_status == 'check_in' %}
                                â±ï¸ Check-in Time
                            {% else %}
                                â±ï¸ Tournament Timer
                            {% endif %}
                        </h3>
                        <div 
                            data-countdown-target="{{ tournament.schedule.start_date|date:'c' }}"
                            data-countdown-format="full"
                            class="countdown-container"
                            role="timer"
                            aria-label="Tournament countdown timer"
                            aria-live="off"
                            aria-atomic="true"
                        >
                            <!-- JavaScript will populate this -->
                        </div>
                    </div>
                    {% endif %}

                    <!-- Important Dates -->
                    {% if tournament.schedule %}
                    <div class="sidebar-card">
                        <h3 class="sidebar-title">Important Dates</h3>
                        <div class="dates-list">
                            {% if tournament.schedule.registration_start %}
                            <div class="date-item">
                                <span class="date-label">Registration Opens</span>
                                <span class="date-value">{{ tournament.schedule.registration_start|date:"M d, Y" }}</span>
                                <span class="date-time">{{ tournament.schedule.registration_start|time:"g:i A" }}</span>
                            </div>
                            {% endif %}

                            {% if tournament.schedule.registration_end %}
                            <div class="date-item">
                                <span class="date-label">Registration Closes</span>
                                <span class="date-value">{{ tournament.schedule.registration_end|date:"M d, Y" }}</span>
                                <span class="date-time">{{ tournament.schedule.registration_end|time:"g:i A" }}</span>
                                {% if tournament.schedule.registration_countdown %}
                                <div class="date-countdown" 
                                     data-countdown-target="{{ tournament.schedule.registration_end|date:'c' }}"
                                     data-countdown-format="compact">
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}

                            {% if tournament.schedule.start_date %}
                            <div class="date-item highlighted">
                                <span class="date-label">Tournament Starts</span>
                                <span class="date-value">{{ tournament.schedule.start_date|date:"M d, Y" }}</span>
                                <span class="date-time">{{ tournament.schedule.start_date|time:"g:i A" }}</span>
                            </div>
                            {% endif %}

                            {% if tournament.schedule.end_date %}
                            <div class="date-item">
                                <span class="date-label">Finals / End Date</span>
                                <span class="date-value">{{ tournament.schedule.end_date|date:"M d, Y" }}</span>
                                <span class="date-time">{{ tournament.schedule.end_date|time:"g:i A" }}</span>
                            </div>
                            {% endif %}
                        </div>

                        {% if tournament.schedule.start_date %}
                        <a href="#" class="btn-add-calendar" data-action="add-calendar">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                            Add to Calendar
                        </a>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Organizer Info -->
                    {% if tournament.organizer %}
                    <div class="sidebar-card">
                        <h3 class="sidebar-title">Organized By</h3>
                        <div class="organizer-profile">
                            {% if tournament.organizer.avatar %}
                            <img src="{{ tournament.organizer.avatar.url }}" alt="{{ tournament.organizer.user.username }}" class="organizer-avatar">
                            {% else %}
                            <div class="organizer-avatar-placeholder">
                                {{ tournament.organizer.user.username|first|upper }}
                            </div>
                            {% endif %}
                            <div class="organizer-info">
                                <h4 class="organizer-name">{{ tournament.organizer.user.username }}</h4>
                                <p class="organizer-role">Tournament Organizer</p>
                            </div>
                        </div>
                        {% if tournament.organizer.user.email %}
                        <a href="mailto:{{ tournament.organizer.user.email }}" class="btn-contact-organizer">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                <polyline points="22 6 12 13 2 6"/>
                            </svg>
                            Contact Organizer
                        </a>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Quick Actions -->
                    <div class="sidebar-card">
                        <h3 class="sidebar-title">Quick Actions</h3>
                        <div class="quick-actions">
                            <button class="action-btn" data-action="report-issue">
                                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="12" y1="8" x2="12" y2="12"/>
                                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                                </svg>
                                Report Issue
                            </button>
                            <button class="action-btn" data-action="download-rules">
                                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Download Rules
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- ============================================
             RULES TAB
             ============================================ -->
        <div class="tab-panel" id="tab-rules">
            <div class="content-card">
                <h2 class="card-title">Tournament Rules & Regulations</h2>
                {% if tournament.rules %}
                <div class="card-body">
                    <div class="rules-content">
                        {% if tournament.rules.general_rules %}
                        <section class="rules-section">
                            <h3>General Rules</h3>
                            <div class="rules-text">
                                {{ tournament.rules.general_rules|safe }}
                            </div>
                        </section>
                        {% endif %}

                        {% if tournament.rules.gameplay_rules %}
                        <section class="rules-section">
                            <h3>Gameplay Rules</h3>
                            <div class="rules-text">
                                {{ tournament.rules.gameplay_rules|safe }}
                            </div>
                        </section>
                        {% endif %}

                        {% if tournament.rules.eligibility_requirements %}
                        <section class="rules-section">
                            <h3>Eligibility Requirements</h3>
                            <div class="rules-text">
                                {{ tournament.rules.eligibility_requirements|safe }}
                            </div>
                        </section>
                        {% endif %}

                        {% if tournament.rules.code_of_conduct %}
                        <section class="rules-section">
                            <h3>Code of Conduct</h3>
                            <div class="rules-text">
                                {{ tournament.rules.code_of_conduct|safe }}
                            </div>
                        </section>
                        {% endif %}

                        {% if tournament.rules.dispute_resolution %}
                        <section class="rules-section">
                            <h3>Dispute Resolution</h3>
                            <div class="rules-text">
                                {{ tournament.rules.dispute_resolution|safe }}
                            </div>
                        </section>
                        {% endif %}
                    </div>

                    {% if tournament.media and tournament.media.rules_pdf %}
                    <div class="rules-download">
                        <a href="{{ tournament.media.rules_pdf.url }}" class="btn-download-pdf" download>
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="12" y1="18" x2="12" y2="12"/>
                                <line x1="9" y1="15" x2="15" y2="15"/>
                            </svg>
                            Download Full Rules (PDF)
                        </a>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <div class="card-body">
                    <p class="text-muted">Rules will be announced soon. Check back later for updates.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- ============================================
             PRIZES TAB
             ============================================ -->
        <div class="tab-panel" id="tab-prizes">
            {% if tournament.finance %}
            <div class="prize-showcase-hero">
                <div class="prize-total-display">
                    <div class="prize-icon">ð</div>
                    <div class="prize-amount">à§³{{ tournament.finance.prize_pool_bdt|floatformat:0|intcomma }}</div>
                    <div class="prize-label">Total Prize Pool</div>
                </div>

                {% if tournament.finance.entry_fee_bdt > 0 %}
                <div class="entry-fee-notice">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                    <span>Entry Fee: <strong>à§³{{ tournament.finance.entry_fee_bdt|floatformat:0|intcomma }}</strong> per team</span>
                </div>
                {% else %}
                <div class="entry-fee-notice free">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                    <span><strong>Free Entry</strong> - No registration fee required</span>
                </div>
                {% endif %}
            </div>

            {% if tournament.finance.prize_distribution_formatted %}
            <div class="content-card">
                <h2 class="card-title">Prize Distribution</h2>
                <div class="card-body">
                    <div class="prize-positions-grid">
                        {% for prize in tournament.finance.prize_distribution_formatted %}
                        <div class="prize-position-card rank-{{ forloop.counter }} {{ prize.highlight }}">
                            <div class="position-rank">
                                {% if prize.highlight == 'gold' %}
                                    <div class="rank-medal gold">ð¥</div>
                                    <span class="rank-label">{{ prize.position }}</span>
                                {% elif prize.highlight == 'silver' %}
                                    <div class="rank-medal silver">ð¥</div>
                                    <span class="rank-label">{{ prize.position }}</span>
                                {% elif prize.highlight == 'bronze' %}
                                    <div class="rank-medal bronze">ð¥</div>
                                    <span class="rank-label">{{ prize.position }}</span>
                                {% else %}
                                    <div class="rank-number">#{{ forloop.counter }}</div>
                                    <span class="rank-label">{{ prize.position }}</span>
                                {% endif %}
                            </div>
                            <div class="position-prize">
                                <span class="prize-currency">à§³</span>
                                <span class="prize-value">{{ prize.amount|floatformat:0|intcomma }}</span>
                            </div>
                            <div class="position-percentage">
                                {{ prize.percentage }}% of pool
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            {% if tournament.finance.refund_policy %}
            <div class="content-card">
                <h2 class="card-title">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    Refund Policy
                </h2>
                <div class="card-body">
                    <div class="refund-policy-text">
                        {{ tournament.finance.refund_policy|safe }}
                    </div>
                </div>
            </div>
            {% endif %}
            {% else %}
            <div class="content-card">
                <div class="card-body">
                    <p class="text-muted">Prize information will be announced soon.</p>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- ============================================
             SCHEDULE TAB
             ============================================ -->
        <div class="tab-panel" id="tab-schedule">
            <div class="content-card">
                <h2 class="card-title">Tournament Schedule</h2>
                <div class="card-body">
                    {% if tournament.schedule and tournament.schedule.timeline_formatted %}
                    <div class="schedule-timeline">
                        {% for phase in tournament.schedule.timeline_formatted %}
                        <div class="timeline-item {{ phase.status }}">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <h3 class="phase-name">
                                    <span class="phase-icon">{{ phase.icon }}</span>
                                    {{ phase.phase }}
                                    <span class="phase-status-badge badge-{{ phase.status }}">{{ phase.status }}</span>
                                </h3>
                                <div class="phase-date">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                        <line x1="16" y1="2" x2="16" y2="6"/>
                                        <line x1="8" y1="2" x2="8" y2="6"/>
                                        <line x1="3" y1="10" x2="21" y2="10"/>
                                    </svg>
                                    <span>
                                        {{ phase.start_date|date:"M d, Y H:i" }}
                                        {% if phase.end_date %} - {{ phase.end_date|date:"M d, Y H:i" }}{% endif %}
                                    </span>
                                </div>
                                {% if phase.description %}
                                <p class="phase-description">{{ phase.description }}</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted">Detailed schedule will be published soon. Stay tuned!</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ============================================
             BRACKETS TAB
             ============================================ -->
        <div class="tab-panel" id="tab-brackets">
            <div class="content-card">
                <h2 class="card-title">Tournament Brackets</h2>
                <div class="card-body">
                    <div class="brackets-placeholder">
                        <svg width="64" height="64" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        </svg>
                        <h3>Brackets Coming Soon</h3>
                        <p>Tournament brackets will be available once registration closes and seeding is complete.</p>
                        {% if user_registered %}
                        <a href="{% url 'tournaments:dashboard' tournament.slug %}" class="btn-view-dashboard">
                            View My Dashboard
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================
             PARTICIPANTS TAB
             ============================================ -->
        <div class="tab-panel" id="tab-participants">
            <div class="content-card">
                <h2 class="card-title">Registered Participants</h2>
                <div class="card-body">
                    <div class="participants-header">
                        <div class="participants-count">
                            {% if tournament.capacity %}
                            <strong>{{ tournament.capacity.current_participants }}</strong> teams registered
                            {% else %}
                            <strong>0</strong> teams registered
                            {% endif %}
                        </div>
                        <div class="participants-filters">
                            <select class="filter-select" id="sortParticipants">
                                <option value="recent">Most Recent</option>
                                <option value="name">By Name</option>
                                <option value="seed">By Seed</option>
                            </select>
                        </div>
                    </div>

                    <div class="participants-grid" id="participantsList">
                        <div class="participants-placeholder">
                            <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                            <p>Participant list will be visible once registration begins.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================
             MEDIA TAB
             ============================================ -->
        {% if tournament.media %}
        <div class="tab-panel" id="tab-media">
            <div class="content-card">
                <h2 class="card-title">Tournament Media</h2>
                <div class="card-body">
                    {% if tournament.media.promotional_images %}
                    <div class="media-gallery">
                        {% for image in tournament.media.promotional_images %}
                        <div class="gallery-item">
                            <img src="{{ image.url }}" alt="Tournament media" class="gallery-image">
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted">Media content will be added soon.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- ============================================
             FAQ TAB
             ============================================ -->
        <div class="tab-panel" id="tab-faq">
            <div class="content-card">
                <h2 class="card-title">Frequently Asked Questions</h2>
                <div class="card-body">
                    <div class="faq-list">
                        <div class="faq-item">
                            <button class="faq-question">
                                <span>How do I register for the tournament?</span>
                                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </button>
                            <div class="faq-answer">
                                <p>Click the "Register Now" button at the top of this page. You'll need to be logged in and have a complete profile. Follow the registration wizard to create or join a team.</p>
                            </div>
                        </div>

                        <div class="faq-item">
                            <button class="faq-question">
                                <span>What happens if I miss a match?</span>
                                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </button>
                            <div class="faq-answer">
                                <p>Please check the full rules for forfeit policies. Generally, teams have a 15-minute grace period. Contact tournament organizers immediately if you have issues.</p>
                            </div>
                        </div>

                        <div class="faq-item">
                            <button class="faq-question">
                                <span>Can I get a refund if I can't participate?</span>
                                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </button>
                            <div class="faq-answer">
                                <p>{% if tournament.finance.refund_policy %}{{ tournament.finance.refund_policy|striptags|truncatewords:30 }}{% else %}Please check the Prizes tab for the complete refund policy.{% endif %}</p>
                            </div>
                        </div>

                        <div class="faq-item">
                            <button class="faq-question">
                                <span>How are disputes resolved?</span>
                                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </button>
                            <div class="faq-answer">
                                <p>All disputes must be reported through your tournament dashboard with evidence (screenshots/videos). Tournament admins will review and make final decisions based on the rules.</p>
                            </div>
                        </div>

                        <div class="faq-item">
                            <button class="faq-question">
                                <span>How will I receive my prize money?</span>
                                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </button>
                            <div class="faq-answer">
                                <p>Winners will be contacted by the tournament organizer after verification. Prize distribution typically occurs within 7-14 days after tournament conclusion via bank transfer or bKash.</p>
                            </div>
                        </div>
                    </div>

                    <div class="faq-contact">
                        <p>Still have questions?</p>
                        <button class="btn-contact" data-action="contact-support">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                            </svg>
                            Contact Support
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- ============================================
     MODALS
     ============================================ -->

<!-- Registration Modal -->
<div class="modal" id="registrationModal">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Register for Tournament</h2>
                <button class="modal-close" data-dismiss="modal">Ã</button>
            </div>
            <div class="modal-body">
                <p>Registration flow will be implemented here...</p>
            </div>
        </div>
    </div>
</div>

<!-- Share Modal -->
<div class="modal" id="shareModal">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Share Tournament</h3>
                <button class="modal-close" data-dismiss="modal">Ã</button>
            </div>
            <div class="modal-body">
                <div class="share-options">
                    <button class="share-btn facebook" data-share="facebook">
                        <svg width="20" height="20" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                        Facebook
                    </button>
                    <button class="share-btn twitter" data-share="twitter">
                        <svg width="20" height="20" fill="currentColor"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>
                        Twitter
                    </button>
                    <button class="share-btn discord" data-share="discord">
                        <svg width="20" height="20" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 00-4.885-1.515.074.074 0 00-.079.037c-.21.375-.444.865-.608 1.25a18.27 18.27 0 00-5.487 0 12.64 12.64 0 00-.617-1.25.077.077 0 00-.079-.037A19.736 19.736 0 003.677 4.37a.07.07 0 00-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 00.031.057 19.9 19.9 0 005.993 3.03.078.078 0 00.084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 00-.041-.106 13.107 13.107 0 01-1.872-.892.077.077 0 01-.008-.128 10.2 10.2 0 00.372-.292.074.074 0 01.077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 01.078.01c.12.098.246.198.373.292a.077.077 0 01-.006.127 12.299 12.299 0 01-1.873.892.077.077 0 00-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 00.084.028 19.839 19.839 0 006.002-3.03.077.077 0 00.032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 00-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/></svg>
                        Discord
                    </button>
                    <button class="share-btn whatsapp" data-share="whatsapp">
                        <svg width="20" height="20" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                        WhatsApp
                    </button>
                </div>
                <div class="share-link">
                    <input type="text" readonly value="{{ request.build_absolute_uri }}" id="shareLink" class="share-link-input">
                    <button class="btn-copy" data-action="copy-link">
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                        Copy
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
