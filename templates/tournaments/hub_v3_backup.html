{% extends "base.html" %}
{% load static tournament_dict_utils humanize %}

{% block title %}Tournaments - Bangladesh's Premier Esports Platform | DeltaCrown{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'siteui/css/tournaments-v3-hub.css' %}?v=4">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="{% static 'js/tournaments-v3-hub.js' %}?v=4" defer></script>
{% endblock %}

{% block body_class %}tournament-hub-v3 hide-footer{% endblock %}

{% block content %}
<!-- ============================================
     HERO SECTION
     ============================================ -->
<section class="hub-hero-section">
    <div class="hub-hero-background">
        <div class="hero-grid-pattern"></div>
        <div class="hero-glow hero-glow-red"></div>
        <div class="hero-glow hero-glow-cyan"></div>
    </div>
    
    <div class="container">
        <div class="hero-content-wrapper">
            <!-- Hero Badges -->
            <div class="hero-badges-row">
                {% if live_tournaments %}
                <span class="hero-badge hero-badge-live">
                    <span class="live-pulse"></span>
                    {{ live_tournaments|length }} LIVE NOW
                </span>
                {% endif %}
                <span class="hero-badge hero-badge-count">
                    {{ stats.total_active|default:0 }} Active Tournaments
                </span>
            </div>
            
            <!-- Hero Title -->
            <h1 class="hero-main-title">
                <span class="title-main">BANGLADESH'S PREMIER</span>
                <span class="title-accent">ESPORTS PLATFORM</span>
            </h1>
            
            <!-- Hero Description -->
            <p class="hero-description">
                Compete in elite tournaments across multiple games. Battle for glory. Claim massive prizes.
            </p>
            
            <!-- Hero Stats Cards -->
            <div class="hero-stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-content">
                        <div class="stat-value">{{ stats.total_active|default:0 }}</div>
                        <div class="stat-label">Active Events</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-content">
                        <div class="stat-value">{{ stats.players_this_month|default:0|intcomma }}+</div>
                        <div class="stat-label">Active Players</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-content">
                        <div class="stat-value">‡ß≥{{ stats.prize_pool_month|default:0|intcomma }}</div>
                        <div class="stat-label">Prize Pool</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ============================================
     MODERN SEARCH BAR
     ============================================ -->
<section class="hub-search-section">
    <div class="container">
        <div class="search-bar-modern">
            <div class="search-input-group">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M19 19L14.65 14.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <input 
                    type="text" 
                    id="hub-search-input" 
                    class="search-input-field"
                    placeholder="Search tournaments by name or game..."
                    value="{{ filters.q }}"
                    autocomplete="off"
                >
                <button id="hub-search-clear" class="search-clear-btn" aria-label="Clear search" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <button class="search-filter-btn" id="mobile-filter-toggle">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M4 6H16M6 10H14M8 14H12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>Filters</span>
            </button>
        </div>
    </div>
</section>

<!-- ============================================
     COMPACT GAME SELECTOR
     ============================================ -->
<section class="game-selector-section">
    <div class="container">
        <div class="game-selector-grid">
            <button class="game-selector-card {% if not filters.game %}active{% endif %}" 
                    data-game="all"
                    onclick="window.location.href='{% url 'tournaments:hub' %}'">
                <div class="game-card-icon">
                    <span class="game-icon-emoji">üéÆ</span>
                </div>
                <div class="game-card-content">
                    <div class="game-card-title">All Games</div>
                    <div class="game-card-count">{{ pagination.total_count }} Tournaments</div>
                </div>
            </button>
            
            {% for game in games %}
            <button class="game-selector-card {% if filters.game == game.slug %}active{% endif %}" 
                    data-game="{{ game.slug }}"
                    onclick="window.location.href='?game={{ game.slug }}'">
                <div class="game-card-icon" style="--game-color: {{ game.primary_color|default:'#00ff88' }}">
                    {% if game.icon %}
                    <img src="{% static game.icon %}" alt="{{ game.name }}" class="game-icon-img">
                    {% else %}
                    <span class="game-icon-text">{{ game.name|slice:":1"|upper }}</span>
                    {% endif %}
                </div>
                <div class="game-card-content">
                    <div class="game-card-title">{{ game.name }}</div>
                    <div class="game-card-count">{{ game.count }} Active</div>
                </div>
            </button>
            {% endfor %}
        </div>
    </div>
</section>

<!-- ============================================
     FEATURED TOURNAMENT (Modern Design)
     ============================================ -->
{% if featured.0 %}
<section class="featured-section-modern">
    <div class="container">
        {% with tournament=featured.0 %}
        <div class="featured-card-modern">
            <!-- Featured Banner with Overlay -->
            <div class="featured-banner-wrapper">
                {% if tournament.banner_image %}
                <img src="{{ tournament.banner_image.url }}" alt="{{ tournament.name }}" class="featured-banner-img" loading="lazy">
                {% else %}
                <div class="featured-banner-placeholder" style="background: linear-gradient(135deg, #FF4655 0%, #00D4FF 100%);"></div>
                {% endif %}
                <div class="featured-banner-overlay"></div>
                
                <!-- Featured Badge -->
                <div class="featured-badge-wrapper">
                    <div class="featured-badge">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M8 1L10.163 5.38L15 6.108L11.5 9.522L12.326 14.342L8 12.08L3.674 14.342L4.5 9.522L1 6.108L5.837 5.38L8 1Z" fill="currentColor"/>
                        </svg>
                        <span>Featured Tournament</span>
                    </div>
                </div>
            </div>
            
            <!-- Featured Content -->
            <div class="featured-content-modern">
                <!-- Badges Row -->
                <div class="featured-badges-row">
                    <span class="badge-pill badge-game">{{ tournament.game|upper }}</span>
                    <span class="badge-pill badge-status-{{ tournament.status|lower }}">
                        {{ tournament.get_status_display }}
                    </span>
                </div>
                
                <!-- Title -->
                <h2 class="featured-title-modern">{{ tournament.name }}</h2>
                
                <!-- Meta Grid -->
                <div class="featured-meta-modern">
                    <div class="meta-item-modern">
                        <svg class="meta-icon-svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <rect x="3" y="4" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                            <path d="M7 2V6M13 2V6M3 10H17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span class="meta-value-modern">{{ tournament.start_at|date:"M d, Y" }}</span>
                    </div>
                    
                    {% if tournament.prize_pool_bdt %}
                    <div class="meta-item-modern">
                        <svg class="meta-icon-svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                            <path d="M10 6V10L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span class="meta-value-modern meta-prize">‡ß≥{{ tournament.prize_pool_bdt|intcomma }}</span>
                    </div>
                    {% endif %}
                    
                    <div class="meta-item-modern">
                        <svg class="meta-icon-svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M13 7C13 8.65685 11.6569 10 10 10C8.34315 10 7 8.65685 7 7C7 5.34315 8.34315 4 10 4C11.6569 4 13 5.34315 13 7Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M5 17C5 14.2386 7.23858 12 10 12C12.7614 12 15 14.2386 15 17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span class="meta-value-modern">
                            {% if tournament.max_teams %}{{ tournament.registrations.count }}/{{ tournament.max_teams }} Teams{% else %}{{ tournament.registrations.count }} Registered{% endif %}
                        </span>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="featured-actions-modern">
                    <a href="{% url 'tournaments:detail' slug=tournament.slug %}" class="btn-featured btn-featured-primary">
                        <span>View Details</span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M3 8H13M13 8L9 4M13 8L9 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </a>
                    {% if tournament.is_registration_open %}
                    <a href="{% url 'tournaments:modern_register' slug=tournament.slug %}" class="btn-featured btn-featured-secondary">
                        <span>Register Now</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endwith %}
    </div>
</section>
{% endif %}

<!-- ============================================
     TOURNAMENTS GRID WITH FILTERS
     ============================================ -->
<section class="tournaments-main-section">
    <div class="container">
        <div class="tournaments-layout">
            <!-- Sidebar Filters -->
            <aside class="filter-sidebar-modern" id="filter-sidebar">
                <div class="filter-sidebar-header">
                    <h3 class="filter-sidebar-title">Filters</h3>
                    <button id="filter-close-btn" class="filter-close-btn" aria-label="Close filters">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>

                <!-- Tournament Status Filter -->
                <div class="filter-group">
                    <h4 class="filter-group-title">Tournament Status</h4>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="radio" name="status-filter" value="all" {% if not filters.status %}checked{% endif %}>
                            <span class="filter-option-label">All Tournaments</span>
                            <span class="filter-option-count">{{ pagination.total_count }}</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="status-filter" value="open" {% if filters.status == 'open' %}checked{% endif %}>
                            <span class="filter-option-label">Registration Open</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="status-filter" value="live" {% if filters.status == 'live' %}checked{% endif %}>
                            <span class="filter-option-label">Live Now</span>
                            {% if live_tournaments %}
                            <span class="filter-option-count">{{ live_tournaments|length }}</span>
                            {% endif %}
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="status-filter" value="upcoming" {% if filters.status == 'upcoming' %}checked{% endif %}>
                            <span class="filter-option-label">Starting Soon</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="status-filter" value="completed" {% if filters.status == 'completed' %}checked{% endif %}>
                            <span class="filter-option-label">Completed</span>
                        </label>
                    </div>
                </div>

                <!-- Entry Fee Filter -->
                <div class="filter-group">
                    <h4 class="filter-group-title">Entry Fee</h4>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="radio" name="fee-filter" value="all" {% if not filters.fee %}checked{% endif %}>
                            <span class="filter-option-label">All</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="fee-filter" value="free" {% if filters.fee == 'free' %}checked{% endif %}>
                            <span class="filter-option-label">Free Entry</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="fee-filter" value="paid" {% if filters.fee == 'paid' %}checked{% endif %}>
                            <span class="filter-option-label">Paid Entry</span>
                        </label>
                    </div>
                </div>

                <!-- Prize Pool Range -->
                <div class="filter-group">
                    <h4 class="filter-group-title">Prize Pool</h4>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="radio" name="prize-filter" value="all" {% if not filters.prize %}checked{% endif %}>
                            <span class="filter-option-label">All Prizes</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="prize-filter" value="high" {% if filters.prize == 'high' %}checked{% endif %}>
                            <span class="filter-option-label">‚Çπ50,000+</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="prize-filter" value="medium" {% if filters.prize == 'medium' %}checked{% endif %}>
                            <span class="filter-option-label">‚Çπ10,000 - ‚Çπ50,000</span>
                        </label>
                        <label class="filter-option">
                            <input type="radio" name="prize-filter" value="low" {% if filters.prize == 'low' %}checked{% endif %}>
                            <span class="filter-option-label">Under ‚Çπ10,000</span>
                        </label>
                    </div>
                </div>

                <!-- Team Format -->
                <div class="filter-group">
                    <h4 class="filter-group-title">Team Format</h4>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="checkbox" name="format-filter" value="solo">
                            <span class="filter-option-label">Solo (1v1)</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="format-filter" value="duo">
                            <span class="filter-option-label">Duo (2v2)</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="format-filter" value="squad">
                            <span class="filter-option-label">Squad (5v5)</span>
                        </label>
                    </div>
                </div>

                <!-- Reset Button -->
                <button class="filter-reset-btn" id="hub-filter-reset">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M14 6.5C13.5 3.5 11 1.5 8 1.5C4.5 1.5 1.5 4.5 1.5 8C1.5 11.5 4.5 14.5 8 14.5C10.5 14.5 12.5 13 13.5 11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M11 6.5H14V3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Reset All Filters</span>
                </button>
            </aside>

            <!-- Main Content -->
            <main class="tournaments-main-content">
                <!-- Header with Sort -->
                <div class="tournaments-header">
                    <div class="tournaments-count">
                        <span class="count-number">{{ pagination.total_count }}</span>
                        <span class="count-label">tournament{{ pagination.total_count|pluralize }}</span>
                    </div>
                    
                    <div class="sort-dropdown">
                        <label for="hub-sort-select" class="sort-label">Sort by</label>
                        <select id="hub-sort-select" class="sort-select">
                            <option value="newest" {% if filters.sort == 'newest' %}selected{% endif %}>Newest First</option>
                            <option value="starting_soon" {% if filters.sort == 'starting_soon' %}selected{% endif %}>Starting Soon</option>
                            <option value="prize_high" {% if filters.sort == 'prize_high' %}selected{% endif %}>Highest Prize</option>
                            <option value="prize_low" {% if filters.sort == 'prize_low' %}selected{% endif %}>Lowest Prize</option>
                            <option value="popular" {% if filters.sort == 'popular' %}selected{% endif %}>Most Popular</option>
                        </select>
                    </div>
                </div>

                <!-- Tournament Grid -->
                <div class="tournaments-grid-modern" id="tournaments-grid">
                    {% for tournament in tournaments %}
                    <article class="tournament-card-v3">
                        <!-- Card Image -->
                        <div class="tournament-card-image">
                            {% if tournament.banner_image %}
                            <img src="{{ tournament.banner_image.url }}" alt="{{ tournament.name }}" loading="lazy">
                            {% else %}
                            <div class="tournament-card-placeholder">
                                <span class="placeholder-letter">{{ tournament.game|slice:":1"|upper }}</span>
                            </div>
                            {% endif %}
                            
                            <!-- Top Badges -->
                            <div class="card-badges-overlay">
                                <span class="card-badge-game">{{ tournament.game|upper }}</span>
                                {% if tournament.status == 'RUNNING' %}
                                <span class="card-badge-live">
                                    <span class="live-dot"></span>
                                    LIVE
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Card Content -->
                        <div class="tournament-card-body">
                            <!-- Title -->
                            <h3 class="tournament-card-title">
                                <a href="{% url 'tournaments:detail' slug=tournament.slug %}">{{ tournament.name }}</a>
                            </h3>
                            
                            <!-- Meta Grid -->
                            <div class="tournament-card-meta">
                                <div class="meta-col">
                                    <span class="meta-label">Start Date</span>
                                    <span class="meta-value">{{ tournament.start_at|date:"M d" }}</span>
                                </div>
                                
                                <div class="meta-col">
                                    <span class="meta-label">Prize Pool</span>
                                    <span class="meta-value meta-prize">
                                        {% if tournament.prize_pool_bdt %}‡ß≥{{ tournament.prize_pool_bdt|intcomma }}{% else %}TBA{% endif %}
                                    </span>
                                </div>
                                
                                <div class="meta-col">
                                    <span class="meta-label">Entry</span>
                                    <span class="meta-value">
                                        {% if tournament.entry_fee_bdt %}‡ß≥{{ tournament.entry_fee_bdt }}{% else %}FREE{% endif %}
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Registration Progress -->
                            {% if tournament.max_teams %}
                            <div class="tournament-card-progress">
                                <div class="progress-header">
                                    <span class="progress-text">Registration</span>
                                    <span class="progress-count">{{ tournament.registrations.count }}/{{ tournament.max_teams }}</span>
                                </div>
                                <div class="progress-bar-bg">
                                    {% widthratio tournament.registrations.count tournament.max_teams 100 as progress %}
                                    <div class="progress-bar-fill" style="width: {{ progress }}%"></div>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Action Buttons -->
                            <div class="tournament-card-actions">
                                <a href="{% url 'tournaments:detail' slug=tournament.slug %}" class="btn-card-outline">
                                    <span>View Details</span>
                                </a>
                                {% if tournament.is_registration_open %}
                                <a href="{% url 'tournaments:modern_register' slug=tournament.slug %}" class="btn-card-primary">
                                    <span>Register</span>
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </article>
                    {% empty %}
                    <div class="empty-state-modern">
                        <div class="empty-state-icon">
                            <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                                <circle cx="32" cy="32" r="24" stroke="currentColor" stroke-width="2"/>
                                <path d="M32 20V32L40 40" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <h3 class="empty-state-title">No Tournaments Found</h3>
                        <p class="empty-state-text">Try adjusting your filters or check back later for new tournaments.</p>
                        <button class="empty-state-btn" onclick="window.location.href='{% url 'tournaments:hub' %}'">
                            View All Tournaments
                        </button>
                    </div>
                    {% endfor %}
                </div>

                <!-- Pagination -->
                {% if pagination.total_pages > 1 %}
                <div class="pagination-modern">
                    {% if pagination.has_previous %}
                    <a href="?page={{ pagination.page|add:'-1' }}{% if filters.game %}&game={{ filters.game }}{% endif %}{% if filters.status %}&status={{ filters.status }}{% endif %}" class="pagination-btn pagination-prev">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span>Previous</span>
                    </a>
                    {% endif %}
                    
                    <span class="pagination-info">
                        Page <strong>{{ pagination.page }}</strong> of <strong>{{ pagination.total_pages }}</strong>
                    </span>
                    
                    {% if pagination.has_next %}
                    <a href="?page={{ pagination.page|add:'1' }}{% if filters.game %}&game={{ filters.game }}{% endif %}{% if filters.status %}&status={{ filters.status }}{% endif %}" class="pagination-btn pagination-next">
                        <span>Next</span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </main>
        </div>
    </div>
</section>

<!-- Scroll to Top -->
<button class="scroll-to-top" id="scroll-to-top" aria-label="Scroll to top">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M10 15V5M10 5L5 10M10 5L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
</button>

{% endblock %}
