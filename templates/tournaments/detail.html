{% extends "base.html" %}
{% load static %}

{% block title %}{{ tournament.name|default:tournament.title }} â€” Tournament{% endblock %}

{% block content %}
<div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 py-8">
  <div class="relative rounded-2xl overflow-hidden border border-black/5 dark:border-white/10 bg-gradient-to-br from-slate-100 to-white dark:from-slate-900 dark:to-slate-950">
    {% if tournament.banner %}
      <img src="{{ tournament.banner.url }}" alt="" class="absolute inset-0 w-full h-40 object-cover opacity-80">
    {% else %}
      <div class="absolute inset-0 h-40 bg-[radial-gradient(ellipse_at_top,rgba(59,130,246,.35),transparent_40%)]"></div>
    {% endif %}

    <div class="relative pt-6 px-6 pb-4">
      <div class="flex items-center gap-3">
        <h1 class="text-2xl md:text-3xl font-semibold">{{ tournament.name|default:tournament.title }}</h1>
        {% if tournament.game %}<span class="px-2 py-0.5 rounded text-xs bg-slate-100 dark:bg-slate-800">{{ tournament.game|title }}</span>{% endif %}
        {% if tournament.organizer_verified %}{% include "tournaments/_organizer_badge.html" %}{% endif %}
      </div>

      <div class="mt-2 flex flex-wrap items-center gap-3 text-sm text-gray-600 dark:text-gray-300">
        {% if entry_fee %}<span>Entry: <strong>{{ entry_fee }}</strong></span>{% endif %}
        {% if prize_total %}<span>Prize: <strong>{{ prize_total }}</strong></span>{% endif %}
        {% if slots_left != None %}<span>Slots left: <strong>{{ slots_left }}</strong></span>{% endif %}
        {% if countdown_to %}<span id="countdown" data-deadline="{{ countdown_to|date:'c' }}"></span>{% endif %}
      </div>

      <div class="mt-4 flex flex-wrap gap-2">
        {% if cta == "register" %}
          <a href="{% url 'tournaments:register' tournament.slug %}" class="px-4 py-2 rounded-xl bg-blue-600 text-white hover:bg-blue-700">Register</a>
        {% elif cta == "continue" %}
          <a href="{% url 'tournaments:register' tournament.slug %}" class="px-4 py-2 rounded-xl bg-blue-600 text-white">Continue registration</a>
        {% elif cta == "view_receipt" %}
          <a href="{% url 'tournaments:registration_receipt' tournament.slug %}" class="px-4 py-2 rounded-xl bg-amber-600 text-white">View receipt (Pending)</a>
        {% elif cta == "check_in" %}
          <a href="{% url 'tournaments:check_in' tournament.slug %}" class="px-4 py-2 rounded-xl bg-emerald-600 text-white">Check-in</a>
        {% elif cta == "your_matches" %}
          <a href="{% url 'tournaments:my_matches' %}" class="px-4 py-2 rounded-xl bg-indigo-600 text-white">Your matches</a>
        {% elif cta == "registered" %}
          <span class="px-4 py-2 rounded-xl bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300">Registered</span>
        {% else %}
          <span class="px-4 py-2 rounded-xl bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300">Registration closed</span>
        {% endif %}
        <a href="#" class="px-4 py-2 rounded-xl bg-slate-100 dark:bg-slate-800" data-copy="{{ request.build_absolute_uri }}">Share</a>
        <a href="{% url 'tournaments:ics' tournament.slug %}" class="px-4 py-2 rounded-xl bg-slate-100 dark:bg-slate-800">Add to calendar</a>
      </div>
    </div>
  </div>

  <div class="mt-6">
    <div class="flex gap-2 border-b border-black/5 dark:border-white/10" data-tabs>
      <button class="px-3 py-2 rounded-t-xl text-sm bg-slate-200 dark:bg-slate-800" data-tab="overview">Overview</button>
      <button class="px-3 py-2 rounded-t-xl text-sm" data-tab="participants">Participants</button>
      <button class="px-3 py-2 rounded-t-xl text-sm" data-tab="bracket">Bracket</button>
      <button class="px-3 py-2 rounded-t-xl text-sm" data-tab="standings">Standings</button>
      <button class="px-3 py-2 rounded-t-xl text-sm" data-tab="watch">Watch</button>
    </div>

    <section id="tab-overview" class="mt-4">
      <div class="grid sm:grid-cols-2 gap-4">
        {% include "tournaments/_prize_pool.html" %}
        {% include "tournaments/_schedule_timeline.html" %}
      </div>

      {% include "tournaments/_rules_drawer.html" %}
      <div class="grid sm:grid-cols-2 gap-4 mt-4">
        <div class="rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-slate-900/60 p-4">
          <h3 class="font-semibold mb-1">Organizer</h3>
          <p class="text-sm text-gray-600 dark:text-gray-300">{{ tournament.organizer_name|default:"Organizer" }}</p>
        </div>
        <div class="rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-slate-900/60 p-4">
          <h3 class="font-semibold mb-1">FAQ & Support</h3>
          <p class="text-sm text-gray-600 dark:text-gray-300">Read rules, then contact the organizer if you still need help.</p>
        </div>
      </div>
    </section>

    <section id="tab-participants" class="mt-4 hidden" role="region" aria-label="Participants">
      {% include "tournaments/_participants_grid.html" %}
    </section>

    <section id="tab-bracket" class="mt-4 hidden" role="region" aria-label="Bracket">
      {% include "tournaments/bracket.html" %}
    </section>

    <section id="tab-standings" class="mt-4 hidden" role="region" aria-label="Standings">
      {% include "tournaments/standings.html" %}
    </section>

    <section id="tab-watch" class="mt-4 hidden" role="region" aria-label="Watch">
      {% include "tournaments/_stream_embed.html" %}
    </section>
  </div>
</div>

<script defer src="{% static 'siteui/js/tournaments-detail.js' %}"></script>
{% endblock %}
