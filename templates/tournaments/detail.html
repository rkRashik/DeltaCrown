{% extends "base.html" %}
{% load static %}
{% block title %}{{ tournament.title|default:"Tournament" }} - Tournament | DeltaCrown{% endblock %}

{% block content %}
<main id="tournament-detail" class="min-h-screen">
  <!-- Hero Banner -->
  <section class="relative overflow-hidden">
    {% if tournament.banner %}
      <div class="h-60 sm:h-72 w-full bg-cover bg-center" style="background-image: url('{{ tournament.banner.url }}');"></div>
    {% elif tournament.banner_url %}
      <div class="h-60 sm:h-72 w-full bg-cover bg-center" style="background-image: url('{{ tournament.banner_url }}');"></div>
    {% else %}
      <div class="h-60 sm:h-72 w-full bg-cover bg-center" style="background-image: url('{% static 'siteui/svg/hero/hero-grid.svg' %}');"></div>
    {% endif %}
    <div class="bg-gradient-to-b from-black/60 to-transparent h-8 -mt-8"></div>
    <div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 -mt-16 relative">
      <div class="rounded-2xl ring-1 ring-white/10 bg-white/5 p-5 backdrop-blur">
        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
          <div>
            <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight text-white">{{ tournament.name|default:tournament.slug|default:"Tournament" }}</h1>
            <div class="mt-2 flex flex-wrap items-center gap-2">
              <span class="chip">{{ tournament.game_name|default:tournament.game }}</span>
              <span class="chip">{{ tournament.status|capfirst }}</span>
              {% if tournament.format %}<span class="chip">{{ tournament.format }}</span>{% endif %}
              {% if tournament.entry_fee %}<span class="chip">Entry: {{ tournament.entry_fee }}</span>{% endif %}
              {% if tournament.reg_count %}<span class="chip">{{ tournament.reg_count }} registered</span>{% endif %}
            </div>
          </div>
          <div class="flex gap-2">
            {% if tournament.status in 'upcoming,open,registration' or can_register %}
              <a href="/tournaments/{{ tournament.slug }}/register/" class="btn btn-primary">Register</a>
            {% endif %}
            {% if tournament.bracket_url %}<a href="{{ tournament.bracket_url }}" class="btn btn-ghost">Bracket</a>{% endif %}
            <button id="btn-copy" class="btn btn-ghost">Copy link</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main content -->
  <section class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid gap-6 lg:grid-cols-3">
      <!-- Left: Overview / Schedule / Prizes -->
      <div class="lg:col-span-2 space-y-6">
        <article class="rounded-2xl ring-1 ring-white/10 bg-white/5 p-6">
          <h2 class="text-xl font-semibold text-white">Overview</h2>
          <p class="mt-2 text-white/80">{{ tournament.overview|linebreaksbr|default:"Organizer will add an overview soon." }}</p>
        </article>

        <article class="rounded-2xl ring-1 ring-white/10 bg-white/5 p-6">
          <h2 class="text-xl font-semibold text-white">Schedule</h2>
          <ul class="mt-2 list-disc pl-5 text-white/80">
            {% for item in schedule|default:'' %}
            <li>{{ item.when|date:"M j, g:i A" }} - {{ item.text }}</li>
            {% empty %}
            <li>Schedule will be published soon.</li>
            {% endfor %}
          </ul>
        </article>

        <article class="rounded-2xl ring-1 ring-white/10 bg-white/5 p-6">
          <h2 class="text-xl font-semibold text-white">Prizes</h2>
          <ul class="mt-2 list-disc pl-5 text-white/80">
            {% for p in prizes|default:'' %}
            <li>{{ p.place }} - {{ p.amount }}</li>
            {% empty %}
            <li>Prize pool TBA.</li>
            {% endfor %}
          </ul>
        </article>

        <article class="rounded-2xl ring-1 ring-white/10 bg-white/5 p-6">
          <h2 class="text-xl font-semibold text-white">Bracket</h2>
          {% if tournament.bracket_embed_html %}
            <div class="mt-3">{{ tournament.bracket_embed_html|safe }}</div>
          {% elif tournament.bracket_url %}
            <p class="mt-3"><a class="btn btn-ghost" href="{{ tournament.bracket_url }}">Open bracket</a></p>
          {% else %}
            <p class="mt-3 text-white/80">Bracket will appear when available.</p>
          {% endif %}
        </article>
      </div>

      <!-- Right: Meta / Quick info -->
      <aside class="space-y-6">
        <div class="rounded-2xl ring-1 ring-white/10 bg-white/5 p-6">
          <h3 class="text-lg font-semibold text-white">Event Info</h3>
          <dl class="mt-3 space-y-2 text-white/80">
            <div class="flex justify-between gap-6">
              <dt class="text-white/60">Starts</dt>
              <dd>{% if tournament.start_at %}{{ tournament.start_at|date:"M j, g:i A" }}{% elif tournament.settings and tournament.settings.start_at %}{{ tournament.settings.start_at|date:"M j, g:i A" }}{% else %}TBA{% endif %}</dd>
            </div>
            <div class="flex justify-between gap-6">
              <dt class="text-white/60">Location</dt>
              <dd>{{ tournament.location|default:"Online" }}</dd>
            </div>
            {% if tournament.entry_fee %}
            <div class="flex justify-between gap-6">
              <dt class="text-white/60">Entry fee</dt>
              <dd>{{ tournament.entry_fee }}</dd>
            </div>
            {% endif %}
          </dl>
        </div>

        <div class="rounded-2xl ring-1 ring-white/10 bg-white/5 p-6">
          <h3 class="text-lg font-semibold text-white">Registrations</h3>
          <div class="mt-3 overflow-x-auto">
            <table class="min-w-full text-left text-sm text-white/80">
              <thead class="text-white/70">
                <tr><th class="py-2 pr-6">Team/Player</th><th class="py-2 pr-6">Status</th><th class="py-2 pr-6">Time</th></tr>
              </thead>
              <tbody class="divide-y divide-white/10">
                {% for r in registrations|default:'' %}
                <tr>
                  <td class="py-2 pr-6">{{ r.name }}</td>
                  <td class="py-2 pr-6"><span class="chip">{{ r.status|capfirst }}</span></td>
                  <td class="py-2 pr-6">{{ r.created_at|date:"M j, g:i A" }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="3" class="py-6 text-white/70">No registrations yet.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </aside>
    </div>
  </section>
</main>

<script defer src="{% static 'siteui/js/tournaments.js' %}"></script>
{% endblock %}
