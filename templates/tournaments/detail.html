{% extends "base.html" %}
{% block title %}{{ tournament.name|default:"Tournament" }} — DeltaCrown{% endblock %}

{% block content %}
{% meta_tags
  title=tournament.name|default:"Tournament"
  description=tournament.short_description|default:tournament.description|default:"Tournament details, rules, schedule, and bracket."
%}

<section aria-labelledby="h1" data-testid="tournament-detail">
  <!-- Hero -->
  <header class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h1 id="h1" class="mb-1">{{ tournament.name|default:"Tournament" }}</h1>
      <p class="text-muted mb-0">
        {% if tournament.game_name %}{{ tournament.game_name }}{% elif tournament.game %}{{ tournament.game }}{% else %}Game: —{% endif %}
        {% if tournament.starts_at %} · Starts {{ tournament.starts_at|date:"M d, Y h:i A" }}{% endif %}
      </p>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-primary" href="/tournaments/{{ tournament.slug|urlencode }}/register/">Register</a>
      <a class="btn btn-outline" href="/tournaments/{{ tournament.slug|urlencode }}/bracket/">View Bracket</a>
    </div>
  </header>

  <!-- Key facts -->
  <div class="d-flex flex-wrap g-3">
    <article class="card p-3" style="flex:1 1 360px;min-width:280px">
      <div class="fw-medium mb-2">Key Facts</div>
      <div class="table-wrap">
        <table class="table table-compact">
          <tbody>
            <tr>
              <th>Format</th>
              <td>
                {% if tournament.format_name %}{{ tournament.format_name }}
                {% elif tournament.format_type %}{{ tournament.format_type|title }}
                {% else %}—{% endif %}
              </td>
            </tr>
            <tr>
              <th>Slots</th>
              <td>{% if tournament.slot_size %}{{ tournament.slot_size }}{% else %}—{% endif %}</td>
            </tr>
            <tr>
              <th>Entry Fee</th>
              <td>
                {% if tournament.entry_fee %}৳ {{ tournament.entry_fee }}
                {% else %}Free{% endif %}
              </td>
            </tr>
            <tr>
              <th>Prize Pool</th>
              <td>{% if tournament.prize_pool %}৳ {{ tournament.prize_pool }}{% else %}—{% endif %}</td>
            </tr>
            <tr>
              <th>Status</th>
              <td>{% if tournament.status %}{{ tournament.status|title }}{% else %}—{% endif %}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </article>

    <!-- Schedule / timeline (defensive) -->
    <article class="card p-3" style="flex:2 1 480px;min-width:320px">
      <div class="fw-medium mb-2">Schedule</div>
      {% if schedule %}
        <ul class="mb-0">
          {% for s in schedule %}
            <li class="mb-2">
              <strong>{{ s.title|default:"Event" }}</strong>
              {% if s.at %}<span class="text-muted"> · {{ s.at|date:"M d, Y h:i A" }}</span>{% endif %}
              {% if s.desc %}<div class="text-muted">{{ s.desc }}</div>{% endif %}
            </li>
          {% empty %}
            <li class="text-muted">No scheduled items yet.</li>
          {% endfor %}
        </ul>
      {% elif tournament.schedule_json %}
        {# if backend passes JSON-ish block in context #}
        {{ tournament.schedule_json|safe }}
      {% else %}
        <p class="text-muted mb-0">No schedule provided yet.</p>
      {% endif %}
    </article>
  </div>

  <!-- Rules & FAQ -->
  <article class="card p-3 mt-3">
    <div class="fw-medium mb-2">Rules & FAQ</div>
    {% if tournament.rules_html %}
      <div>{{ tournament.rules_html|safe }}</div>
    {% elif tournament.rules %}
      <pre style="white-space:pre-wrap">{{ tournament.rules }}</pre>
    {% else %}
      <p class="text-muted mb-0">Rules will be announced soon.</p>
    {% endif %}
  </article>

  <!-- Share (BD-first) -->
  <div class="mt-3">
    {% include "partials/share_block_bd.html" with title=tournament.name|default:"Tournament" %}
  </div>
</section>
{% endblock %}
