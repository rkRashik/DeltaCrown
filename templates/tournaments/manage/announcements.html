{% extends "tournaments/manage/_base.html" %}
{% load humanize %}

{% block manage_content %}

<div class="flex items-center justify-between mb-6">
  <h2 class="text-lg font-display font-bold text-white">Announcements</h2>
</div>

{% if can_announce %}
  <div class="liquid-glass rounded-2xl p-6 mb-6">
    <div class="flex items-center gap-2 mb-5">
      <i data-lucide="plus-circle" class="w-4 h-4 text-cyan-400"></i>
      <h3 class="text-sm font-display font-semibold text-white">New Announcement</h3>
    </div>
    <form method="post">
      {% csrf_token %}
      <div class="space-y-4">
        <div>
          <label class="block text-xs text-white/50 font-medium mb-1.5 uppercase tracking-wider">Title</label>
          <input type="text" name="title" required placeholder="Announcement title…" class="form-input">
        </div>
        <div>
          <label class="block text-xs text-white/50 font-medium mb-1.5 uppercase tracking-wider">Message</label>
          <textarea name="message" rows="4" required placeholder="Write your announcement…"
                    class="form-textarea resize-none"></textarea>
        </div>
        <div class="flex items-center gap-6">
          <label class="flex items-center gap-2 text-sm text-white/50 cursor-pointer hover:text-white/70 transition">
            <input type="checkbox" name="is_pinned" class="rounded accent-cyan-500 cursor-pointer">
            <span>Pin to top</span>
          </label>
          <label class="flex items-center gap-2 text-sm text-white/50 cursor-pointer hover:text-white/70 transition">
            <input type="checkbox" name="is_important" class="rounded accent-yellow-500 cursor-pointer">
            <span>Mark as important</span>
          </label>
        </div>
        <div class="flex justify-end">
          <button type="submit" class="btn-primary">
            <i data-lucide="send" class="w-4 h-4"></i>
            Post Announcement
          </button>
        </div>
      </div>
    </form>
  </div>
{% endif %}

{% if announcements %}
  <div class="space-y-3">
    {% for a in announcements %}
      <div class="liquid-glass rounded-2xl p-5 group
        {% if a.is_important %}border-l-2 border-l-yellow-400/50{% endif %}
        {% if a.is_pinned and not a.is_important %}border-l-2 border-l-cyan-400/50{% endif %}">
        <div class="flex items-start gap-3">
          <div class="w-9 h-9 rounded-lg flex items-center justify-center flex-shrink-0
            {% if a.is_important %}bg-yellow-500/10
            {% elif a.is_pinned %}bg-cyan-500/10
            {% else %}bg-white/[0.03]{% endif %}">
            {% if a.is_pinned %}
              <i data-lucide="pin" class="w-4 h-4 text-cyan-400/70"></i>
            {% elif a.is_important %}
              <i data-lucide="alert-circle" class="w-4 h-4 text-yellow-400/70"></i>
            {% else %}
              <i data-lucide="megaphone" class="w-4 h-4 text-white/25"></i>
            {% endif %}
          </div>

          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2 mb-1.5 flex-wrap">
              <h4 class="text-sm font-semibold text-white/80">{{ a.title }}</h4>
              {% if a.is_pinned %}
                <span class="badge badge-cyan">PINNED</span>
              {% endif %}
              {% if a.is_important %}
                <span class="badge badge-yellow">IMPORTANT</span>
              {% endif %}
            </div>
            <p class="text-sm text-white/45 mb-3 whitespace-pre-line leading-relaxed">{{ a.message }}</p>
            <div class="flex items-center gap-3 text-xs text-white/35">
              <span class="flex items-center gap-1">
                <i data-lucide="user" class="w-3 h-3"></i>
                {{ a.created_by.username|default:"System" }}
              </span>
              <span class="flex items-center gap-1">
                <i data-lucide="clock" class="w-3 h-3"></i>
                {{ a.created_at|timesince }} ago
              </span>
            </div>
          </div>

          {% if can_announce %}
            <button title="Delete" class="p-2 rounded-lg hover:bg-red-500/15 text-white/20 hover:text-red-400 transition flex-shrink-0 opacity-0 group-hover:opacity-100">
              <i data-lucide="trash-2" class="w-4 h-4"></i>
            </button>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="liquid-glass rounded-2xl">
    <div class="empty-state py-16">
      <i data-lucide="megaphone" class="w-12 h-12 mx-auto"></i>
      <p>No announcements yet</p>
      <p class="sub">Post an announcement to notify all participants.</p>
    </div>
  </div>
{% endif %}

{% endblock %}
