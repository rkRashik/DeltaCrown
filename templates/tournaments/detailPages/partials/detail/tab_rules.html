{# Rules Tab - Text + PDF Hybrid Viewer #}
{# Purpose: Display tournament rules in text and/or PDF format #}
{# Content: Rules text with formatting, PDF viewer, fallback message #}

<section class="detail-tab-panel td-tab-panel" data-tab="rules">
    <div class="td-rules-main">
        
        {# Header with metadata #}
        <div class="td-rules-header">
            <div class="td-rules-header-title">
                <h2 class="td-section-title">ðŸ“œ Rules & Regulations</h2>
            </div>
            <div class="td-rules-meta">
                <span class="td-meta-chip">
                    <svg class="td-meta-icon" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M6 .5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1H9v1.07a7.001 7.001 0 0 1 3.274 12.474l.601.602a.5.5 0 0 1-.707.708l-.746-.746A6.97 6.97 0 0 1 8 16a6.97 6.97 0 0 1-3.422-.892l-.746.746a.5.5 0 0 1-.707-.708l.602-.602A7.001 7.001 0 0 1 7 2.07V1h-.5A.5.5 0 0 1 6 .5zm2.5 5a.5.5 0 0 0-1 0v3.362l-1.429 2.38a.5.5 0 1 0 .858.515l1.5-2.5A.5.5 0 0 0 8.5 9V5.5zM.86 5.387A2.5 2.5 0 1 1 4.387 1.86 8.035 8.035 0 0 0 .86 5.387zM11.613 1.86a2.5 2.5 0 1 1 3.527 3.527 8.035 8.035 0 0 0-3.527-3.527z"/>
                    </svg>
                    {{ game_spec.display_name }}
                </span>
                <span class="td-meta-chip">
                    <svg class="td-meta-icon" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                    </svg>
                    {{ tournament.format|default:"Standard" }}
                </span>
                {% if tournament.updated_at %}
                <span class="td-meta-chip">
                    <svg class="td-meta-icon" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                    </svg>
                    Updated {{ tournament.updated_at|date:"M d, Y" }}
                </span>
                {% endif %}
            </div>
        </div>
        
        {# Rules Body #}
        <div class="td-rules-body">
            
            {% if tournament.rules_text or tournament.terms_pdf %}
                
                {# Text Rules Section #}
                {% if tournament.rules_text %}
                <div class="td-rules-text-section">
                    <div class="td-rules-text">
                        {{ tournament.rules_text|linebreaksbr }}
                    </div>
                </div>
                {% endif %}
                
                {# PDF Rules Section (if both exist, separate block) #}
                {% if tournament.terms_pdf %}
                <div class="td-rules-pdf-section">
                    <div class="td-rules-pdf-card">
                        <div class="td-pdf-icon-wrapper">
                            <svg class="td-pdf-icon" width="48" height="48" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                                <path d="M4.603 14.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.697 19.697 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.188-.012.396-.047.614-.084.51-.27 1.134-.52 1.794a10.954 10.954 0 0 0 .98 1.686 5.753 5.753 0 0 1 1.334.05c.364.066.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.856.856 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.712 5.712 0 0 1-.911-.95 11.651 11.651 0 0 0-1.997.406 11.307 11.307 0 0 1-1.02 1.51c-.292.35-.609.656-.927.787a.793.793 0 0 1-.58.029zm1.379-1.901c-.166.076-.32.156-.459.238-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361.01.022.02.036.026.044a.266.266 0 0 0 .035-.012c.137-.056.355-.235.635-.572a8.18 8.18 0 0 0 .45-.606zm1.64-1.33a12.71 12.71 0 0 1 1.01-.193 11.744 11.744 0 0 1-.51-.858 20.801 20.801 0 0 1-.5 1.05zm2.446.45c.15.163.296.3.435.41.24.19.407.253.498.256a.107.107 0 0 0 .07-.015.307.307 0 0 0 .094-.125.436.436 0 0 0 .059-.2.095.095 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a3.876 3.876 0 0 0-.612-.053zM8.078 7.8a6.7 6.7 0 0 0 .2-.828c.031-.188.043-.343.038-.465a.613.613 0 0 0-.032-.198.517.517 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822.024.111.054.227.09.346z"/>
                            </svg>
                        </div>
                        <div class="td-pdf-info">
                            <h3 class="td-pdf-title">ðŸ“„ Official Rulebook PDF</h3>
                            <p class="td-pdf-filename">{{ tournament.terms_pdf.name|default:"tournament_rules.pdf" }}</p>
                            {% if tournament.terms_pdf.size %}
                            <p class="td-pdf-size">Size: {{ tournament.terms_pdf.size|filesizeformat }}</p>
                            {% endif %}
                        </div>
                        <a href="{{ tournament.terms_pdf.url }}" target="_blank" rel="noopener noreferrer" class="td-pdf-btn">
                            <svg class="td-btn-icon" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"/>
                                <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"/>
                            </svg>
                            Open PDF
                        </a>
                    </div>
                    
                    {# Optional: Desktop iframe preview #}
                    <div class="td-pdf-preview-frame desktop-only">
                        <iframe src="{{ tournament.terms_pdf.url }}" class="td-pdf-iframe" title="Rules PDF Preview"></iframe>
                    </div>
                </div>
                {% endif %}
                
            {% else %}
                {# No rules yet #}
                <div class="td-rules-empty">
                    <div class="td-empty-icon">ðŸ“‹</div>
                    <h3 class="td-empty-title">Rules Not Yet Published</h3>
                    <p class="td-empty-message">Tournament rules will be posted here soon. Please check back later or contact the organizer for more information.</p>
                </div>
            {% endif %}
            
        </div>
    </div>
</section>
