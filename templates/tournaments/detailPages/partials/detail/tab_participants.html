{# Participants Tab - Team Gallery #}
{# Purpose: Clean visual gallery of registered teams/players #}
{# Layout: Minimal header + full-width card grid #}

<section class="detail-tab-panel td-tab-panel td-tab-panel-participants" data-tab="participants">
    
    {# ============================================================ #}
    {# HEADER: Compact Summary + Filters #}
    {# ============================================================ #}
    <div class="td-participants-header">
        
        {# Left: Summary Stats #}
        <div class="td-participants-summary">
            <div class="td-summary-text">
                <span class="td-summary-icon">ğŸ‘¥</span>
                <span class="td-summary-label">
                    {{ participants_total|default:0 }} / {{ tournament.max_participants }} 
                    {% if tournament.participation_type == 'team' %}teams{% else %}players{% endif %} registered
                </span>
            </div>
            {% if slots_percentage > 0 %}
            <div class="td-summary-bar">
                <div class="td-summary-fill" style="width: {{ slots_percentage }}%"></div>
            </div>
            {% endif %}
        </div>
        
        {# Right: Inline Filters #}
        <div class="td-participants-filters">
            <input 
                type="text" 
                id="participantSearch" 
                class="td-filter-input" 
                placeholder="Search {{ tournament.participation_type|default:'teams' }}â€¦"
                aria-label="Search participants">
            
            <select id="statusFilter" class="td-filter-select" aria-label="Filter by status">
                <option value="">All Statuses</option>
                <option value="confirmed">Confirmed</option>
                <option value="pending">Pending</option>
                {% if tournament.enable_check_in %}
                <option value="checked-in">Checked In</option>
                {% endif %}
            </select>
            
            {% if tournament.participation_type == 'team' %}
            <select id="regionFilter" class="td-filter-select" aria-label="Filter by region">
                <option value="">All Regions</option>
                <option value="NA">North America</option>
                <option value="EU">Europe</option>
                <option value="SEA">Southeast Asia</option>
                <option value="EA">East Asia</option>
                <option value="SA">South America</option>
                <option value="OCE">Oceania</option>
                <option value="ME">Middle East</option>
                <option value="AF">Africa</option>
            </select>
            {% endif %}
        </div>
        
    </div>
    
    {# ============================================================ #}
    {# MAIN GRID: Participant Cards #}
    {# ============================================================ #}
    {% if participants %}
        <div class="td-participants-grid" id="participantsGrid">
            {% for participant in participants %}
                {# Common card wrapper with type indicator #}
                {% if participant.type == 'team' %}
                    <a href="{% url 'teams:detail' participant.slug %}" 
                       class="td-participant-card td-participant-card--team {% if participant.is_current_user %}is-current-user{% endif %}" 
                       data-participant-id="{{ participant.id }}"
                       data-status="{{ participant.status }}"
                       data-checked-in="{{ participant.checked_in|yesno:'true,false' }}"
                       data-region="{{ participant.region|default_if_none:'' }}"
                       data-name="{{ participant.name|lower }}">
                {% else %}
                    <div class="td-participant-card td-participant-card--player {% if participant.is_current_user %}is-current-user{% endif %}" 
                         data-participant-id="{{ participant.id }}"
                         data-status="{{ participant.status }}"
                         data-checked-in="{{ participant.checked_in|yesno:'true,false' }}"
                         data-region="{{ participant.region|default_if_none:'' }}"
                         data-name="{{ participant.name|lower }}">
                {% endif %}
                        
                        {# Type Pill - Prominent at top #}
                        <div class="td-participant-type-pill td-type-{{ participant.kind }}">
                            {{ participant.badge_label }}
                        </div>
                        
                        {# Card Header #}
                        <div class="td-participant-card-header">
                            <div class="td-participant-avatar">
                                {% if participant.type == 'team' %}
                                    {% if participant.logo %}
                                    <img src="{{ participant.logo }}" alt="{{ participant.name }}" class="td-avatar-img">
                                    {% else %}
                                    <div class="td-avatar-placeholder">{{ participant.tag|slice:":2"|upper }}</div>
                                    {% endif %}
                                {% else %}
                                    {% if participant.avatar %}
                                    <img src="{{ participant.avatar }}" alt="{{ participant.name }}" class="td-avatar-img">
                                    {% else %}
                                    <div class="td-avatar-placeholder">{{ participant.name|slice:":1"|upper }}</div>
                                    {% endif %}
                                {% endif %}
                            </div>
                            
                            <div class="td-participant-info">
                                <h4 class="td-participant-name">
                                    {{ participant.display_name }}
                                    {% if participant.is_current_user %}
                                    <span class="td-you-pill">You</span>
                                    {% endif %}
                                </h4>
                                {% if participant.type == 'team' %}
                                <div class="td-participant-tag">{{ participant.tag }}</div>
                                {% elif participant.game_id %}
                                <div class="td-participant-tag">{{ participant.game_id }}</div>
                                {% endif %}
                            </div>
                            
                            {# Status Chip #}
                            <div class="td-status-chip td-status-{{ participant.status }}">
                                {% if participant.status == 'confirmed' %}âœ“
                                {% elif participant.status == 'pending' %}â³
                                {% elif participant.status == 'payment_submitted' %}ğŸ’³
                                {% endif %}
                            </div>
                        </div>
                        
                        {# Card Body #}
                        <div class="td-participant-card-body">
                            {# Sub-label with auto info #}
                            <div class="td-participant-meta">
                                {{ participant.sub_label }}
                            </div>
                            
                            {# Badges #}
                            <div class="td-participant-badges">
                                {% if participant.rank and participant.type == 'team' %}
                                <div class="td-badge td-badge-rank">
                                    <span class="td-badge-icon">ğŸ†</span>
                                    <span class="td-badge-text">Rank #{{ participant.rank }}</span>
                                </div>
                                {% endif %}
                                
                                {% if participant.checked_in %}
                                <div class="td-badge td-badge-checkin">
                                    <span class="td-badge-icon">âœ“</span>
                                    <span class="td-badge-text">Checked In</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                {% if participant.type == 'team' %}
                    </a>
                {% else %}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    {% else %}
        {# Empty State #}
        <div class="td-participants-empty">
            <div class="td-empty-icon">ğŸ‘¥</div>
            <h3 class="td-empty-title">No Participants Yet</h3>
            <p class="td-empty-message">
                {% if tournament.status == 'registration_open' %}
                Be the first to join this tournament!
                {% elif tournament.status == 'published' %}
                Registration hasn't opened yet. Check back soon!
                {% else %}
                No participants have registered.
                {% endif %}
            </p>
        </div>
    {% endif %}
    
</section>
