{% load static %}
{% load game_assets %}
{# Hero Section - Cinematic Banner-First Layout #}
{# Purpose: Immediate visual impact with banner, state awareness, conversion-focused action strip #}
{# Content: Full-width banner, action strip with identity/info/CTA zones #}

<section class="td-hero" data-game-slug="{{ game_spec.slug }}">
    <!-- Full-Width Cinematic Banner -->
    <div class="td-hero-banner">
        {% if tournament.banner_image %}
        <div class="td-hero-banner-frame">
            <img src="{{ tournament.banner_image.url }}"
                 alt="{{ tournament.name }}"
                 class="td-hero-banner-img">
        </div>
        {% elif game_spec.banner %}
        <div class="td-hero-banner-frame">
            {# Banner can be either a full URL (from DB) or a static path (from assets) #}
            {% if game_spec.banner|slice:":1" == "/" or "://" in game_spec.banner %}
                {# Full URL from database ImageField #}
                <img src="{{ game_spec.banner }}" alt="{{ tournament.name }} - {{ game_spec.display_name }}" class="td-hero-banner-img" onerror="this.style.display='none'">
            {% else %}
                {# Static path from GAME_ASSETS #}
                <img src="{% static game_spec.banner %}" alt="{{ tournament.name }} - {{ game_spec.display_name }}" class="td-hero-banner-img" onerror="this.style.display='none'">
            {% endif %}
        </div>
        {% else %}
        <div class="td-hero-banner-fallback">
            {# Fallback: Show game icon when no banner available #}
            {% if game_spec.icon %}
                {% if game_spec.icon|slice:":1" == "/" or "://" in game_spec.icon %}
                    {# Full URL from database #}
                    <img src="{{ game_spec.icon }}" 
                         alt="{{ game_spec.display_name }}" 
                         class="fallback-game-icon">
                {% else %}
                    {# Static path #}
                    <img src="{% static game_spec.icon %}" 
                         alt="{{ game_spec.display_name }}" 
                         class="fallback-game-icon">
                {% endif %}
            {% elif tournament.game and tournament.game.icon %}
                <img src="{{ tournament.game.icon.url }}" 
                     alt="{{ tournament.game.name }}" 
                     class="fallback-game-icon">
            {% else %}
                {# Last resort: Show initials #}
                <div class="fallback-game-initials">
                    {{ game_spec.display_name|slice:":2"|upper|default:"TC" }}
                </div>
            {% endif %}
            <div class="fallback-game-name">{{ game_spec.display_name|default:tournament.game.name|default:"Tournament" }}</div>
        </div>
        {% endif %}
        
        <!-- Small overlay badge in corner (optional, minimal) -->
        {% if game_spec %}
        <div class="td-hero-banner-overlay">
            <span class="badge badge-game-overlay">
                {% if game_spec.icon %}
                    {% if game_spec.icon|slice:":1" == "/" or "://" in game_spec.icon %}
                        {# Full URL from database #}
                        <img src="{{ game_spec.icon }}" 
                             alt="{{ game_spec.display_name }}" 
                             class="badge-icon">
                    {% else %}
                        {# Static path #}
                        <img src="{% static game_spec.icon %}" 
                             alt="{{ game_spec.display_name }}" 
                             class="badge-icon">
                    {% endif %}
                {% elif tournament.game and tournament.game.icon %}
                    <img src="{{ tournament.game.icon.url }}" 
                         alt="{{ tournament.game.name }}" 
                         class="badge-icon">
                {% endif %}
                {{ game_spec.display_name|default:tournament.game.name }}
            </span>
        </div>
        {% endif %}
    </div>
    
    <!-- Tournament Action Strip (Below Banner) -->
    <div class="td-hero-action">
        <!-- LEFT: Identity Zone -->
        <div class="td-hero-action-left">
            <div class="action-identity">
                <h1 class="action-title">{{ tournament.name }}</h1>
                
                {% if tournament.subtitle %}
                <p class="action-subtitle">{{ tournament.subtitle }}</p>
                {% endif %}
                
                <div class="action-badges">
                    <span class="badge badge-status badge-status-{{ tournament.status }}">
                        {{ tournament.get_status_display }}
                    </span>
                    
                    {% if game_spec %}
                    <span class="badge badge-game-small">
                        {% if game_spec.icon %}
                            {% if game_spec.icon|slice:":1" == "/" or "://" in game_spec.icon %}
                                {# Full URL from database #}
                                <img src="{{ game_spec.icon }}" 
                                     alt="{{ game_spec.display_name }}" 
                                     class="badge-icon">
                            {% else %}
                                {# Static path #}
                                <img src="{% static game_spec.icon %}" 
                                     alt="{{ game_spec.display_name }}" 
                                     class="badge-icon">
                            {% endif %}
                        {% endif %}
                        {{ game_spec.display_name }}
                    </span>
                    {% endif %}
                    
                    {% if tournament.region %}
                    <span class="badge badge-region">
                        <svg class="badge-icon" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"/>
                        </svg>
                        {{ tournament.region }}
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- CENTER: Info Zone -->
        <div class="td-hero-action-center">
            <div class="action-info">
                <!-- Countdown -->
                <div class="info-countdown" data-registration-start="{{ tournament.registration_start|date:'c' }}" data-registration-end="{{ tournament.registration_end|date:'c' }}" data-tournament-start="{{ tournament.tournament_start|date:'c' }}" data-tournament-end="{{ tournament.tournament_end|date:'c' }}" data-status="{{ tournament.status }}">
                    {% if tournament.status == 'live' %}
                    <span class="countdown-live">
                        <span class="live-indicator"></span>
                        Live Now
                    </span>
                    {% elif tournament.status == 'completed' %}
                    <span class="countdown-ended">Ended {{ tournament.tournament_end|date:"M d, Y" }}</span>
                    {% elif tournament.status == 'registration_open' %}
                    <span class="countdown-timer" data-target="{{ tournament.tournament_start|date:'c' }}">
                        <svg class="countdown-icon" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                        </svg>
                        Starts in <span class="countdown-value">--</span>
                    </span>
                    {% elif tournament.status == 'published' %}
                    <span class="countdown-timer" data-target="{{ tournament.registration_start|date:'c' }}">
                        <svg class="countdown-icon" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                        </svg>
                        Registration opens in <span class="countdown-value">--</span>
                    </span>
                    {% else %}
                    <span class="countdown-status">{{ tournament.get_status_display }}</span>
                    {% endif %}
                </div>
                
                <!-- Entry Fee -->
                {% if tournament.has_entry_fee %}
                <div class="info-entry-fee">
                    <span class="info-label">Entry Fee</span>
                    <span class="info-value">
                        {% if tournament.entry_fee_amount and tournament.entry_fee_amount > 0 %}
                        {{ tournament.entry_fee_amount }} {{ tournament.entry_fee_currency|default:"BDT" }}
                        {% endif %}
                        {% if tournament.entry_fee_deltacoin and tournament.entry_fee_deltacoin > 0 %}
                        {% if tournament.entry_fee_amount and tournament.entry_fee_amount > 0 %} + {% endif %}
                        {{ tournament.entry_fee_deltacoin }} <span class="deltacoin-symbol">ΔC</span>
                        {% endif %}
                    </span>
                </div>
                {% endif %}
                
                <!-- Prize Pool (compact summary) -->
                {% if tournament.prize_pool or tournament.prize_deltacoin %}
                <div class="info-prize-pool">
                    <span class="info-label">Prize Pool</span>
                    <span class="info-value prize-highlight">
                        {% if tournament.prize_pool %}{{ tournament.prize_pool }} {{ tournament.prize_currency|default:"BDT" }}{% endif %}
                        {% if tournament.prize_deltacoin %}
                        {% if tournament.prize_pool %} + {% endif %}{{ tournament.prize_deltacoin }} <span class="deltacoin-symbol">ΔC</span>
                        {% endif %}
                    </span>
                </div>
                {% endif %}
                
                <!-- Fee Waiver Badge -->
                {% if tournament.enable_fee_waiver and tournament.fee_waiver_top_n_teams %}
                <div class="info-fee-waiver">
                    <svg class="waiver-icon" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                    </svg>
                    <span>Top {{ tournament.fee_waiver_top_n_teams }} teams enter free</span>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- RIGHT: Action Zone -->
        <div class="td-hero-action-right">
            <div class="action-cta">
                <!-- Primary CTA Button -->
                <button class="action-cta-button action-cta-{{ cta_state }}" {% if cta_disabled %}disabled{% endif %}>
                    {{ cta_label }}
                </button>
                
                {% if cta_disabled and cta_reason %}
                <p class="action-cta-note">{{ cta_reason }}</p>
                {% endif %}
                
                {% comment %}
                TODO: Secondary action for registered users
                {% if user_is_registered %}
                <a href="{% url 'tournaments:room' tournament.slug %}" class="action-cta-secondary">
                    Enter Tournament Room
                </a>
                {% endif %}
                {% endcomment %}
            </div>
        </div>
    </div>
</section>
