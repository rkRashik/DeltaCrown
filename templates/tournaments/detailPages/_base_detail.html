{% extends "tournaments/base.html" %}
{% load static humanize %}

{% block title %}{{ tournament.name }} | DeltaCrown{% endblock %}
{% block og_title %}{{ tournament.name }} | DeltaCrown{% endblock %}

{% block tournament_css %}
<style>
    /* ═══════════════════════════════════════════════════════
       DELTACROWN TOURNAMENT — CINEMATIC DARK THEME v2
       Deep dark with colorful accents, modern typography
    ═══════════════════════════════════════════════════════ */

    :root {
        --game-color: {{ game_spec.primary_color|default:"#06b6d4" }};
        --game-color-secondary: {{ game_spec.secondary_color|default:"#1e1b4b" }};
        --game-color-rgb: {{ game_spec.primary_color_rgb|default:"6, 182, 212" }};
        --glass-border: rgba(255, 255, 255, 0.12);
        --glass-surface: rgba(10, 10, 15, 0.6);
        --bg-deep: #000000;
        --bg-card: #0A0A0F;
        --bg-card-hover: #10101a;
        --bg-elevated: #12121c;
        --text-primary: #E2E8F0;
        --text-secondary: #a0a0b8;
        --text-muted: #6b6b80;
        --border-subtle: rgba(255, 255, 255, 0.08);
        --border-hover: rgba(255, 255, 255, 0.12);
        --glow-game: rgba(var(--game-color-rgb), 0.15);
        --glow-game-strong: rgba(var(--game-color-rgb), 0.35);
        --gradient-mesh: radial-gradient(ellipse 120% 80% at 80% -20%, rgba(var(--game-color-rgb), 0.08) 0%, transparent 60%),
                         radial-gradient(ellipse 80% 60% at 10% 90%, rgba(99, 102, 241, 0.04) 0%, transparent 50%);
    }

    body {
        background-color: var(--bg-deep);
        color: var(--text-primary);
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-size: 15px;
        line-height: 1.65;
        letter-spacing: 0.01em;
    }

    /* ===== AMBIENT MESH GRADIENT (page bg) ===== */
    .ambient-mesh {
        position: fixed; inset: 0; pointer-events: none; z-index: 0;
        background: var(--gradient-mesh);
    }

    /* ===== NOISE TEXTURE OVERLAY ===== */
    .noise-overlay {
        position: fixed; inset: 0; pointer-events: none; z-index: 1; opacity: 0.025;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    }

    /* ===== HERO ===== */
    .hero-container {
        position: relative; height: 60vh; min-height: 420px; max-height: 750px;
        width: 100%; overflow: hidden;
        border-bottom: 1px solid var(--border-subtle);
    }
    @media (max-width: 640px) { .hero-container { height: 48vh; min-height: 340px; } }

    .hero-banner-img {
        width: 100%; height: 100%; object-fit: cover; object-position: center 20%;
        transform: scale(1.06); animation: heroFloat 25s ease-in-out infinite alternate;
        filter: brightness(0.8) saturate(1.2);
    }
    @keyframes heroFloat {
        0% { transform: scale(1.06) translateY(0); }
        50% { transform: scale(1.08) translateY(-15px); }
        100% { transform: scale(1.06) translateY(-5px); }
    }

    .hero-gradient-overlay {
        background:
            radial-gradient(ellipse 90% 70% at 75% 20%, rgba(var(--game-color-rgb), 0.12), transparent 55%),
            radial-gradient(ellipse 60% 50% at 20% 80%, rgba(99, 102, 241, 0.06), transparent 50%),
            linear-gradient(to top, var(--bg-deep) 8%, rgba(6,6,8,0.85) 22%, rgba(6,6,8,0.3) 55%, rgba(6,6,8,0.5) 100%),
            linear-gradient(to right, var(--bg-deep) 0%, rgba(6,6,8,0.5) 18%, transparent 50%);
    }

    .grid-lines {
        background-size: 48px 48px;
        background-image:
            linear-gradient(to right, rgba(255,255,255,0.02) 1px, transparent 1px),
            linear-gradient(to bottom, rgba(255,255,255,0.02) 1px, transparent 1px);
        mask-image: linear-gradient(to bottom, black 30%, transparent 100%);
    }

    /* ===== GLASSMORPHISM v2 (liquid-glass parity with team detail) ===== */
    .glass {
        background: rgba(10, 10, 15, 0.6);
        backdrop-filter: blur(20px) saturate(140%); -webkit-backdrop-filter: blur(20px) saturate(140%);
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
    }
    .glass-strong {
        background: rgba(10, 10, 15, 0.85);
        backdrop-filter: blur(32px) saturate(150%); -webkit-backdrop-filter: blur(32px) saturate(150%);
        border: 1px solid rgba(255, 255, 255, 0.10);
        box-shadow: 0 40px 90px rgba(0, 0, 0, 0.7);
    }
    .glass-panel {
        background: rgba(10, 10, 15, 0.7);
        backdrop-filter: blur(16px) saturate(130%); -webkit-backdrop-filter: blur(16px) saturate(130%);
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255,255,255,0.04);
    }
    .glass:hover, .glass-panel:hover { border-color: var(--border-hover); box-shadow: 0 0 30px rgba(var(--game-color-rgb), 0.08); }

    /* ===== GLOW EFFECTS ===== */
    .text-glow-game { text-shadow: 0 0 24px rgba(var(--game-color-rgb), 0.6), 0 0 60px rgba(var(--game-color-rgb), 0.2); }
    .text-glow-gold { text-shadow: 0 0 20px rgba(250, 204, 21, 0.6), 0 0 50px rgba(250, 204, 21, 0.15); }
    .game-accent { color: var(--game-color); }
    .game-accent-bg { background-color: var(--game-color); }
    .game-accent-border { border-color: var(--game-color); }
    .game-glow { box-shadow: 0 0 24px rgba(var(--game-color-rgb), 0.25), 0 0 60px rgba(var(--game-color-rgb), 0.08); }
    .game-glow-border { border-color: rgba(var(--game-color-rgb), 0.3); box-shadow: 0 0 16px rgba(var(--game-color-rgb), 0.1); }

    /* ===== SECTION CARD v2 (liquid-glass parity) ===== */
    .section-card {
        background: rgba(10, 10, 15, 0.6);
        backdrop-filter: blur(20px) saturate(140%); -webkit-backdrop-filter: blur(20px) saturate(140%);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 1.25rem;
        box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.25s ease;
    }
    .section-card:hover {
        border-color: var(--game-color);
        box-shadow: 0 0 30px rgba(var(--game-color-rgb), 0.08);
        transform: translateY(-2px);
    }

    /* ===== SIDEBAR CARDS v2 (liquid-glass parity) ===== */
    .sidebar-card {
        background: rgba(10, 10, 15, 0.6);
        backdrop-filter: blur(20px) saturate(140%); -webkit-backdrop-filter: blur(20px) saturate(140%);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 1.25rem;
        box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .sidebar-card:hover {
        border-color: var(--game-color);
        box-shadow: 0 0 30px rgba(var(--game-color-rgb), 0.08);
        transform: translateY(-2px);
    }

    /* ===== TYPOGRAPHY ===== */
    .text-label {
        font-size: 0.65rem; font-weight: 700; text-transform: uppercase;
        letter-spacing: 0.15em; color: var(--text-muted);
    }
    .text-value {
        font-size: 1rem; font-weight: 600; color: var(--text-primary);
    }
    .text-hero {
        font-family: 'Rajdhani', sans-serif; font-weight: 900;
        line-height: 0.88; letter-spacing: -0.02em;
        background: linear-gradient(135deg, #ffffff 0%, rgba(var(--game-color-rgb), 0.9) 100%);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        background-clip: text;
        filter: drop-shadow(0 4px 12px rgba(0,0,0,0.5));
    }

    /* ===== SCROLLBAR ===== */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.12); border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--game-color); }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* ===== MATCH CARD v2 ===== */
    .match-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(10, 10, 15, 0.6);
        backdrop-filter: blur(20px) saturate(140%); -webkit-backdrop-filter: blur(20px) saturate(140%);
        border-radius: 1rem;
    }
    .match-card:hover {
        border-color: var(--game-color);
        box-shadow: 0 0 30px rgba(var(--game-color-rgb), 0.08);
        transform: translateY(-2px);
    }
    .match-card.is-live {
        border-left: 3px solid #ef4444;
        animation: livePulseCard 2.5s ease-in-out infinite;
        box-shadow: 0 0 20px rgba(239, 68, 68, 0.08);
    }
    @keyframes livePulseCard {
        0%, 100% { border-left-color: #ef4444; box-shadow: 0 0 20px rgba(239, 68, 68, 0.08); }
        50% { border-left-color: #fca5a5; box-shadow: 0 0 30px rgba(239, 68, 68, 0.15); }
    }

    /* ===== SELECTION ===== */
    ::selection { background: rgba(var(--game-color-rgb), 0.4); color: white; }

    /* ===== COUNTDOWN v2 ===== */
    .countdown-digit {
        font-family: 'Rajdhani', monospace; font-weight: 800;
        font-size: 2.75rem; line-height: 1; color: white;
        background: linear-gradient(135deg, rgba(var(--game-color-rgb), 0.08), rgba(255,255,255,0.03));
        border: 1px solid rgba(var(--game-color-rgb), 0.15);
        border-radius: 1rem; padding: 0.875rem 1.125rem; min-width: 5rem; text-align: center;
        box-shadow: 0 4px 24px rgba(0,0,0,0.3), 0 0 40px rgba(var(--game-color-rgb), 0.06);
    }
    .countdown-label {
        font-size: 9px; font-weight: 800; text-transform: uppercase;
        letter-spacing: 0.15em; color: var(--text-muted); margin-top: 8px;
    }
    @media (max-width: 640px) { .countdown-digit { font-size: 1.75rem; min-width: 3.5rem; padding: 0.5rem 0.75rem; } }

    /* ===== PROGRESS RING ===== */
    .progress-ring { transform: rotate(-90deg); }
    .progress-ring circle { transition: stroke-dashoffset 0.5s ease; }

    /* ===== BADGE SYSTEM ===== */
    .badge-live {
        background: rgba(239, 68, 68, 0.15); color: #fca5a5;
        border: 1px solid rgba(239, 68, 68, 0.25);
        box-shadow: 0 0 12px rgba(239, 68, 68, 0.15);
    }
    .badge-open {
        background: rgba(16, 185, 129, 0.12); color: #6ee7b7;
        border: 1px solid rgba(16, 185, 129, 0.25);
    }
    .badge-game {
        background: rgba(var(--game-color-rgb), 0.12); color: var(--game-color);
        border: 1px solid rgba(var(--game-color-rgb), 0.25);
    }

    /* ===== FADE-IN ANIMATIONS ===== */
    .fade-up {
        opacity: 0; transform: translateY(16px);
        animation: fadeUp 0.6s ease forwards;
    }
    .fade-up.delay-1 { animation-delay: 0.1s; }
    .fade-up.delay-2 { animation-delay: 0.2s; }
    .fade-up.delay-3 { animation-delay: 0.3s; }
    .fade-up.delay-4 { animation-delay: 0.4s; }
    @keyframes fadeUp {
        to { opacity: 1; transform: translateY(0); }
    }

    /* ===== PHASE TAB NAV ===== */
    .phase-tab {
        position: relative; padding-bottom: 0.75rem;
        color: var(--text-muted); font-size: 0.7rem; font-weight: 700;
        text-transform: uppercase; letter-spacing: 0.12em;
        border-bottom: 2px solid transparent;
        transition: all 0.25s ease;
    }
    .phase-tab:hover { color: var(--text-secondary); }
    .phase-tab.active {
        color: var(--game-color);
        border-bottom-color: var(--game-color);
        text-shadow: 0 0 16px rgba(var(--game-color-rgb), 0.4);
    }

    /* ===== PHASE-SPECIFIC OVERRIDES ===== */
    {% block phase_css %}{% endblock %}
</style>
{% endblock %}

{% block tournament_content %}
<!-- Ambient mesh gradient background -->
<div class="ambient-mesh"></div>
<!-- Noise texture overlay -->
<div class="noise-overlay"></div>

<!-- HERO SECTION -->
<div class="hero-container group">
    <div class="absolute inset-0 z-0">
        {% if tournament.banner_image %}
        <img src="{{ tournament.banner_image.url }}" class="hero-banner-img" alt="{{ tournament.name }}">
        {% else %}
        <div class="w-full h-full hero-banner-img" style="background: linear-gradient(135deg, var(--game-color-secondary), var(--bg-deep) 60%);"></div>
        {% endif %}
    </div>
    <div class="absolute inset-0 z-10 grid-lines opacity-20"></div>
    <div class="absolute inset-0 z-20 hero-gradient-overlay"></div>

    <div class="relative z-30 max-w-[1800px] mx-auto px-4 sm:px-6 lg:px-8 h-full flex flex-col justify-end pb-8 sm:pb-12">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-12 items-end">

            <!-- Left Column: Info -->
            <div class="lg:col-span-8 space-y-5">

                <!-- Status + Game Badges -->
                <div class="flex flex-wrap items-center gap-2 sm:gap-3 fade-up">
                    {% if tournament.status == 'live' %}
                    <div class="badge-live px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest flex items-center gap-2">
                        <span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-red-400"></span></span>
                        Live Now
                    </div>
                    {% elif tournament.status == 'registration_open' %}
                    <div class="badge-open px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest flex items-center gap-2">
                        <span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-400"></span></span>
                        Registration Open
                    </div>
                    {% elif tournament.status == 'registration_closed' %}
                    <div class="px-3 py-1.5 rounded-lg bg-amber-500/12 border border-amber-500/20 text-amber-300 text-[10px] font-black uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="lock" class="w-3 h-3"></i> Registration Closed
                    </div>
                    {% elif tournament.status == 'completed' %}
                    <div class="px-3 py-1.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20 text-emerald-300 text-[10px] font-black uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="check-circle-2" class="w-3 h-3"></i> Completed
                    </div>
                    {% elif tournament.status == 'cancelled' %}
                    <div class="px-3 py-1.5 rounded-lg bg-red-900/20 border border-red-800/25 text-red-400 text-[10px] font-black uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="x-circle" class="w-3 h-3"></i> Cancelled
                    </div>
                    {% elif tournament.status == 'archived' %}
                    <div class="px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 text-gray-400 text-[10px] font-black uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="archive" class="w-3 h-3"></i> Archived
                    </div>
                    {% elif tournament.status == 'published' %}
                    <div class="px-3 py-1.5 rounded-lg bg-blue-500/12 border border-blue-500/20 text-blue-300 text-[10px] font-black uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="eye" class="w-3 h-3"></i> Published
                    </div>
                    {% else %}
                    <div class="px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 text-gray-400 text-[10px] font-black uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="file-edit" class="w-3 h-3"></i> Draft
                    </div>
                    {% endif %}

                    <!-- Game Badge -->
                    <div class="badge-game px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase tracking-wider flex items-center gap-2">
                        {% if game_spec.icon %}
                        <img src="{{ game_spec.icon.url }}" class="w-4 h-4 rounded" alt="{{ game_spec.display_name }}">
                        {% endif %}
                        {{ game_spec.display_name }}
                    </div>

                    <!-- Platform Badge -->
                    <div class="px-3 py-1.5 rounded-lg bg-white/5 border border-white/8 backdrop-blur-md text-gray-300 text-[10px] font-bold uppercase tracking-wider flex items-center gap-2">
                        <i data-lucide="{% if tournament.platform == 'mobile' %}smartphone{% elif tournament.platform == 'ps5' %}gamepad{% elif tournament.platform == 'xbox' %}gamepad{% else %}monitor{% endif %}" class="w-3 h-3 game-accent"></i>
                        {{ tournament.get_platform_display }}
                    </div>

                    {% if tournament.is_official %}
                    <div class="px-3 py-1.5 rounded bg-dc-gold/20 border border-dc-gold/30 text-dc-gold text-[10px] font-bold uppercase tracking-wider flex items-center gap-2">
                        <i data-lucide="badge-check" class="w-3 h-3"></i> Official
                    </div>
                    {% endif %}

                    <div class="px-3 py-1.5 rounded bg-black/40 border border-white/10 backdrop-blur-md text-gray-300 text-[10px] font-bold uppercase tracking-wider flex items-center gap-2">
                        <i data-lucide="users" class="w-3 h-3 game-accent"></i> {{ tournament.get_participation_type_display }}
                    </div>
                </div>

                <!-- Title -->
                <h1 class="text-hero text-3xl sm:text-4xl md:text-5xl lg:text-7xl tracking-tight fade-up delay-1">
                    {{ tournament.name|upper }}
                </h1>

                {% block hero_extra %}{% endblock %}

                <!-- Hero Stats Row -->
                <div class="flex flex-wrap gap-6 sm:gap-8 md:gap-12 border-t border-white/8 pt-5 fade-up delay-2">
                    <div>
                        <span class="text-label flex items-center gap-1.5 mb-1.5">
                            <i data-lucide="trophy" class="w-3.5 h-3.5 text-amber-400"></i> Prize Pool
                        </span>
                        <span class="text-2xl sm:text-3xl font-display font-bold text-glow-gold" style="color: #facc15;">
                            {% if tournament.prize_pool %}৳{{ tournament.prize_pool|floatformat:0|intcomma }}{% else %}—{% endif %}
                        </span>
                    </div>
                    <div>
                        <span class="text-label flex items-center gap-1.5 mb-1.5">
                            <i data-lucide="calendar-clock" class="w-3.5 h-3.5 game-accent"></i> Start Date
                        </span>
                        <span class="text-xl sm:text-2xl font-display font-bold text-white">
                            {{ tournament.tournament_start|date:"M j" }} <span class="text-sm text-[--text-muted] font-sans">{{ tournament.tournament_start|date:"g:i A" }}</span>
                        </span>
                    </div>
                    <div>
                        <span class="text-label flex items-center gap-1.5 mb-1.5">
                            <i data-lucide="swords" class="w-3.5 h-3.5 game-accent"></i> Format
                        </span>
                        <span class="text-lg font-display font-bold text-white">{{ tournament.get_format_display }}</span>
                    </div>
                    <div>
                        <span class="text-label flex items-center gap-1.5 mb-1.5">
                            <i data-lucide="users-2" class="w-3.5 h-3.5 game-accent"></i> Slots
                        </span>
                        <span class="text-lg font-display font-bold text-white">{{ slots_filled }}<span class="text-[--text-muted]">/{{ slots_total }}</span></span>
                    </div>
                </div>
            </div>

            <!-- Right Column: Action Buttons -->
            <div class="lg:col-span-4 flex flex-col items-start lg:items-end justify-end pb-2 gap-3">
                {% if is_organizer %}
                <a href="/tournaments/{{ tournament.slug }}/organizer/"
                   class="px-4 py-2 bg-dc-purple/20 border border-dc-purple/40 text-dc-purple rounded-lg text-xs font-bold uppercase tracking-wider hover:bg-dc-purple/30 transition-all flex items-center gap-2">
                    <i data-lucide="settings" class="w-4 h-4"></i> Manage
                </a>
                {% endif %}
                <div class="flex gap-2">
                    <button class="p-3 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 text-gray-400 hover:text-white transition-all" title="Share" onclick="navigator.clipboard.writeText(window.location.href).then(() => alert('Link copied!'))">
                        <i data-lucide="share-2" class="w-4 h-4"></i>
                    </button>
                    {% if tournament.stream_youtube_url or tournament.stream_twitch_url %}
                    <a href="{{ tournament.stream_youtube_url|default:tournament.stream_twitch_url }}" target="_blank" class="p-3 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 text-gray-400 hover:text-white transition-all" title="Watch Stream">
                        <i data-lucide="tv" class="w-4 h-4"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% block phase_nav %}{% endblock %}

<!-- MAIN CONTENT AREA -->
<div class="w-full max-w-[1800px] mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 flex-1">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8 relative">

        <!-- LEFT COLUMN (8/12) -->
        <div class="lg:col-span-8 space-y-6 min-h-[600px]">
            {% block phase_content %}{% endblock %}
        </div>

        <!-- RIGHT SIDEBAR (4/12) -->
        <div class="lg:col-span-4 space-y-4 lg:sticky lg:top-[140px] lg:self-start">

            {% block sidebar_top %}{% endblock %}

            <!-- Registration / Action Card -->
            <div class="glass p-5 sm:p-6 rounded-2xl space-y-4 relative overflow-hidden game-glow-border fade-up">
                <div class="absolute top-0 right-0 w-40 h-40 rounded-full blur-[60px] pointer-events-none" style="background: rgba(var(--game-color-rgb), 0.06);"></div>
                <div class="absolute bottom-0 left-0 w-24 h-24 rounded-full blur-[40px] pointer-events-none" style="background: rgba(99, 102, 241, 0.04);"></div>

                <div class="relative z-10 space-y-4">
                    <!-- Slots Progress -->
                    {% if not is_pre_registration %}
                    <div>
                        <div class="flex items-center justify-between mb-2.5">
                            <span class="text-label">Slots</span>
                            <span class="text-xs font-bold text-white">{{ slots_filled }}<span class="text-[--text-muted]">/{{ slots_total }}</span></span>
                        </div>
                        <div class="w-full h-1.5 bg-white/5 rounded-full overflow-hidden">
                            <div class="h-full rounded-full transition-all duration-700 ease-out" style="width: {{ slots_percentage }}%; background: linear-gradient(90deg, var(--game-color), rgba(var(--game-color-rgb), 0.6));"></div>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center py-2">
                        <span class="text-label">Registration Not Yet Open</span>
                    </div>
                    {% endif %}

                    <!-- Quick Details -->
                    <div class="space-y-2.5 text-[13px]">
                        <div class="flex justify-between"><span class="text-[--text-muted]">Format</span><span class="text-white font-semibold">{{ tournament.get_format_display }}</span></div>
                        <div class="flex justify-between"><span class="text-[--text-muted]">Platform</span><span class="text-white font-semibold">{{ tournament.get_platform_display }}</span></div>
                        <div class="flex justify-between"><span class="text-[--text-muted]">Mode</span><span class="text-white font-semibold">{{ tournament.get_mode_display }}</span></div>
                        {% if tournament.has_entry_fee and tournament.entry_fee_amount %}
                        <div class="flex justify-between"><span class="text-[--text-muted]">Entry Fee</span><span class="text-white font-semibold">৳{{ tournament.entry_fee_amount|floatformat:0|intcomma }}</span></div>
                        {% else %}
                        <div class="flex justify-between"><span class="text-[--text-muted]">Entry Fee</span><span class="text-emerald-400 font-semibold">Free</span></div>
                        {% endif %}
                    </div>

                    {% block sidebar_cta %}
                    <!-- CTA Button -->
                    {% if can_register %}
                    <a href="{{ registration_action_url }}"
                       class="block w-full py-4 text-black font-black uppercase tracking-[0.15em] rounded-xl transition-all text-center text-sm hover:scale-[1.02] active:scale-[0.98]"
                       style="background: linear-gradient(135deg, var(--game-color), rgba(var(--game-color-rgb), 0.8)); box-shadow: 0 4px 24px rgba(var(--game-color-rgb), 0.3), 0 0 60px rgba(var(--game-color-rgb), 0.1);">
                        {{ registration_action_label }}
                    </a>
                    {% elif is_registered %}
                    <a href="{{ registration_action_url }}"
                       class="block w-full py-4 bg-indigo-500/15 border border-indigo-500/30 text-indigo-300 font-black uppercase tracking-[0.15em] rounded-xl text-center text-sm hover:bg-indigo-500/20 transition-all">
                        {{ registration_action_label }}
                    </a>
                    {% else %}
                    <div class="w-full py-4 border border-white/8 text-[--text-muted] font-bold uppercase tracking-[0.15em] rounded-xl text-center text-sm" style="background: var(--bg-card);">
                        {{ registration_status_reason|default:"Registration closed" }}
                    </div>
                    {% endif %}
                    {% endblock %}
                </div>
            </div>

            <!-- Game Info Card -->
            <div class="glass p-5 rounded-2xl flex items-center gap-4 group cursor-pointer hover:bg-white/[0.03] transition-all fade-up delay-1">
                <div class="w-12 h-12 rounded-xl flex items-center justify-center shadow-lg overflow-hidden flex-shrink-0" style="background: rgba(var(--game-color-rgb), 0.15);">
                    {% if game_spec.icon %}
                    <img src="{{ game_spec.icon.url }}" class="w-full h-full object-cover" alt="{{ game_spec.display_name }}">
                    {% else %}
                    <i data-lucide="gamepad-2" class="w-6 h-6 game-accent"></i>
                    {% endif %}
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-label mb-0.5">Game</p>
                    <p class="font-bold text-white text-lg leading-tight truncate">{{ game_spec.display_name }}</p>
                </div>
            </div>

            <!-- Organizer Card -->
            <div class="glass p-5 rounded-2xl flex items-center gap-4 group cursor-pointer hover:bg-white/[0.03] transition-all fade-up delay-2">
                <div class="w-12 h-12 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 rounded-xl flex items-center justify-center text-white font-black text-xl shadow-lg flex-shrink-0 border border-indigo-500/15">
                    {{ tournament.organizer.username|truncatechars:2|upper }}
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-label mb-0.5">Organized By</p>
                    <p class="font-bold text-white text-lg leading-tight truncate">{{ tournament.organizer.username }}</p>
                    {% if tournament.is_official %}
                    <p class="text-[10px] text-amber-400 flex items-center gap-1 mt-0.5"><i data-lucide="badge-check" class="w-3 h-3"></i> Official Event</p>
                    {% endif %}
                </div>
            </div>

            {% block sidebar_extra %}{% endblock %}

            <!-- Feature Flags -->
            <div class="glass p-4 rounded-2xl space-y-2 fade-up delay-3">
                <h4 class="text-label mb-3">Features</h4>
                <div class="grid grid-cols-2 gap-2.5 text-[12px]">
                    <div class="flex items-center gap-2 {% if tournament.enable_check_in %}text-emerald-400{% else %}text-[--text-muted] opacity-50{% endif %}">
                        <i data-lucide="{% if tournament.enable_check_in %}check{% else %}x{% endif %}" class="w-3.5 h-3.5"></i> Check-In
                    </div>
                    <div class="flex items-center gap-2 {% if tournament.enable_live_updates %}text-emerald-400{% else %}text-[--text-muted] opacity-50{% endif %}">
                        <i data-lucide="{% if tournament.enable_live_updates %}check{% else %}x{% endif %}" class="w-3.5 h-3.5"></i> Live Updates
                    </div>
                    <div class="flex items-center gap-2 {% if tournament.enable_certificates %}text-emerald-400{% else %}text-[--text-muted] opacity-50{% endif %}">
                        <i data-lucide="{% if tournament.enable_certificates %}check{% else %}x{% endif %}" class="w-3.5 h-3.5"></i> Certificates
                    </div>
                    <div class="flex items-center gap-2 {% if tournament.enable_dynamic_seeding %}text-emerald-400{% else %}text-[--text-muted] opacity-50{% endif %}">
                        <i data-lucide="{% if tournament.enable_dynamic_seeding %}check{% else %}x{% endif %}" class="w-3.5 h-3.5"></i> Rank Seeding
                    </div>
                </div>
            </div>

            <!-- Organizer Tools -->
            {% if is_organizer %}
            <div class="glass p-4 rounded-2xl border-indigo-500/15 space-y-2 fade-up delay-4">
                <h4 class="text-label mb-2 flex items-center gap-1.5 text-indigo-400">
                    <i data-lucide="settings" class="w-3 h-3"></i> Organizer Tools
                </h4>
                <a href="/tournaments/{{ tournament.slug }}/organizer/" class="block w-full py-2.5 px-3 bg-indigo-500/10 border border-indigo-500/20 text-indigo-300 rounded-xl text-xs font-bold hover:bg-indigo-500/20 transition text-center">
                    Open Management Hub
                </a>
            </div>
            {% endif %}

        </div><!-- /RIGHT SIDEBAR -->

    </div>
</div>

<!-- MOBILE STICKY CTA -->
{% if can_register or is_registered %}
<div class="lg:hidden fixed bottom-0 left-0 w-full backdrop-blur-2xl border-t border-white/8 p-4 z-[100] flex items-center justify-between" style="background: rgba(6,6,8,0.92); box-shadow: 0 -10px 40px rgba(0,0,0,0.6);">
    <div>
        <p class="text-label">Entry Fee</p>
        <p class="text-xl font-display font-bold text-white">{% if tournament.has_entry_fee and tournament.entry_fee_amount > 0 %}৳{{ tournament.entry_fee_amount|floatformat:0|intcomma }}{% else %}<span class="text-emerald-400">Free</span>{% endif %}</p>
    </div>
    {% if can_register %}
    <a href="{{ registration_action_url }}" class="px-6 py-3 text-black font-black rounded-xl uppercase tracking-wider text-xs flex items-center gap-2" style="background: linear-gradient(135deg, var(--game-color), rgba(var(--game-color-rgb), 0.8)); box-shadow: 0 4px 20px rgba(var(--game-color-rgb), 0.3);">
        {{ registration_action_label }} <i data-lucide="arrow-right" class="w-4 h-4"></i>
    </a>
    {% elif is_registered %}
    <a href="{{ registration_action_url }}" class="px-6 py-3 bg-indigo-500/15 border border-indigo-500/30 text-indigo-300 font-black rounded-xl uppercase tracking-wider text-xs">
        {{ registration_action_label }}
    </a>
    {% endif %}
</div>
{% endif %}

{% endblock %}

{% block tournament_js %}
<script>
    /* ===== COUNTDOWN TIMER ===== */
    function initCountdown(targetISO, containerId) {
        if (!targetISO) return;
        const target = new Date(targetISO).getTime();
        const container = document.getElementById(containerId);
        if (!container) return;

        function update() {
            const now = Date.now();
            const diff = target - now;
            if (diff <= 0) {
                container.innerHTML = '<span class="text-lg font-bold text-game-accent uppercase tracking-wider">Time\'s Up!</span>';
                return;
            }
            const d = Math.floor(diff / 86400000);
            const h = Math.floor((diff % 86400000) / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);

            container.innerHTML = `
                <div class="flex items-center gap-3 sm:gap-4">
                    <div class="text-center"><div class="countdown-digit">${String(d).padStart(2,'0')}</div><div class="countdown-label">Days</div></div>
                    <span class="text-2xl text-white/20 font-bold -mt-5">:</span>
                    <div class="text-center"><div class="countdown-digit">${String(h).padStart(2,'0')}</div><div class="countdown-label">Hours</div></div>
                    <span class="text-2xl text-white/20 font-bold -mt-5">:</span>
                    <div class="text-center"><div class="countdown-digit">${String(m).padStart(2,'0')}</div><div class="countdown-label">Mins</div></div>
                    <span class="text-2xl text-white/20 font-bold -mt-5">:</span>
                    <div class="text-center"><div class="countdown-digit">${String(s).padStart(2,'0')}</div><div class="countdown-label">Secs</div></div>
                </div>
            `;
        }
        update();
        setInterval(update, 1000);
    }

    document.addEventListener('DOMContentLoaded', function() {
        if (typeof lucide !== 'undefined') lucide.createIcons();
    });
</script>
{% block phase_js %}{% endblock %}
{% endblock %}
