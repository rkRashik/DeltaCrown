{% load static %}

{% comment %}
FE-T-001: Tournament Card Component
Purpose: Display tournament info in a card format
Props: tournament (Tournament model instance)
{% endcomment %}

<article class="tournament-card bg-surface border border-line rounded-xl overflow-hidden hover:border-primary transition-all duration-300 hover:shadow-lg">
  <a href="{% url 'tournaments:detail' slug=tournament.slug %}" class="block">
    <!-- Tournament Banner/Header -->
    <div class="tournament-card-header relative h-40 bg-gradient-to-br from-primary/20 to-accent/20 overflow-hidden">
      {% if tournament.banner_url %}
        <img 
          src="{{ tournament.banner_url }}" 
          alt="{{ tournament.name }}" 
          class="w-full h-full object-cover"
        >
      {% endif %}
      
      <!-- Game Badge (overlay) -->
      <div class="absolute top-3 left-3">
        {% if tournament.game %}
          <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-surface/90 backdrop-blur">
            <i class="fas fa-gamepad mr-1.5 text-primary"></i>
            {{ tournament.game.name }}
          </span>
        {% endif %}
      </div>

      <!-- Status Badge (overlay) -->
      <div class="absolute top-3 right-3">
        {% include "tournaments/browse/_status_pill.html" with status=tournament.status %}
      </div>
    </div>

    <!-- Tournament Info -->
    <div class="tournament-card-body p-4">
      <!-- Tournament Name -->
      <h3 class="text-lg font-bold text-primary mb-2 line-clamp-2">
        {{ tournament.name }}
      </h3>

      <!-- Key Info Grid -->
      <div class="tournament-card-info grid grid-cols-2 gap-3 text-sm text-body-secondary mb-4">
        <!-- Format -->
        <div class="flex items-center gap-2">
          <i class="fas fa-trophy text-accent"></i>
          <span>{{ tournament.get_format_display|default:"Tournament" }}</span>
        </div>

        <!-- Date -->
        <div class="flex items-center gap-2">
          <i class="fas fa-calendar text-accent"></i>
          <span>{{ tournament.tournament_start|date:"M d, Y" }}</span>
        </div>

        <!-- Prize Pool (if configured) -->
        {% if tournament.prize_pool %}
        <div class="flex items-center gap-2">
          <i class="fas fa-coins text-accent"></i>
          <span>à§³{{ tournament.prize_pool|floatformat:0 }}</span>
        </div>
        {% else %}
        <div class="flex items-center gap-2">
          <i class="fas fa-gift text-accent"></i>
          <span>Free Entry</span>
        </div>
        {% endif %}

        <!-- Slots -->
        <div class="flex items-center gap-2">
          <i class="fas fa-users text-accent"></i>
          <span>{{ tournament.current_participants|default:0 }}/{{ tournament.max_participants }} Players</span>
        </div>
      </div>

      <!-- Progress Bar (slots filled) -->
      <div class="slots-progress mb-3">
        <div class="w-full bg-surface-elevated rounded-full h-2 overflow-hidden">
          {% widthratio tournament.current_participants tournament.max_participants 100 as slots_percent %}
          <div 
            class="h-full rounded-full transition-all duration-300
              {% if slots_percent >= 90 %}bg-danger{% elif slots_percent >= 70 %}bg-warning{% else %}bg-primary{% endif %}
            "
            style="width: {{ slots_percent|default:0 }}%"
          ></div>
        </div>
      </div>

      <!-- CTA Button -->
      <div class="tournament-card-cta">
        {% if tournament.status == 'registration_open' %}
          <button class="w-full px-4 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary-hover transition-colors">
            Register Now
          </button>
        {% elif tournament.status == 'live' %}
          <button class="w-full px-4 py-2 bg-accent text-white rounded-lg font-medium hover:bg-accent-hover transition-colors">
            View Live
          </button>
        {% elif tournament.status == 'completed' %}
          <button class="w-full px-4 py-2 bg-surface-elevated text-body-secondary rounded-lg font-medium hover:bg-surface transition-colors">
            View Results
          </button>
        {% else %}
          <button class="w-full px-4 py-2 bg-surface-elevated text-body-secondary rounded-lg font-medium cursor-not-allowed" disabled>
            Coming Soon
          </button>
        {% endif %}
      </div>
    </div>
  </a>
</article>
