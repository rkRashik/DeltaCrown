{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'ecommerce/css/product-list.css' %}">
<link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
{% endblock %}

{% block title %}{{ category.name }} - CrownStore{% endblock %}

{% block content %}
<div class="store-category-detail">
    <!-- Category Header -->
    <div class="category-hero" data-aos="fade-up">
        <div class="container">
            <div class="category-hero-content">
                <div class="category-breadcrumb">
                    <a href="{% url 'ecommerce:store_home' %}" class="breadcrumb-link">CrownStore</a>
                    <span class="breadcrumb-separator">‚Ä¢</span>
                    <span class="breadcrumb-current">{{ category.name }}</span>
                </div>
                
                <div class="category-header">
                    {% if category.icon %}
                        <div class="category-icon">
                            <i class="{{ category.icon }}"></i>
                        </div>
                    {% endif %}
                    <div class="category-info">
                        <h1 class="category-title">{{ category.name }}</h1>
                        {% if category.description %}
                            <p class="category-description">{{ category.description }}</p>
                        {% endif %}
                        <div class="category-meta">
                            <span class="product-count">{{ products.count }} products</span>
                            <span class="category-type category-{{ category.category_type }}">
                                {{ category.get_category_type_display }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Products Section -->
    <div class="category-products">
        <div class="container">
            {% if products %}
                <div class="products-grid" data-aos="fade-up" data-aos-delay="200">
                    {% for product in products %}
                        <div class="product-card" data-product-id="{{ product.id }}" data-rarity="{{ product.rarity }}">
                            <!-- Product Badge -->
                            {% if product.is_featured or product.is_limited_edition or product.is_member_exclusive %}
                                <div class="product-badges">
                                    {% if product.is_featured %}
                                        <span class="product-badge featured">‚≠ê Featured</span>
                                    {% endif %}
                                    {% if product.is_limited_edition %}
                                        <span class="product-badge limited">üî• Limited</span>
                                    {% endif %}
                                    {% if product.is_member_exclusive %}
                                        <span class="product-badge exclusive">üëë Exclusive</span>
                                    {% endif %}
                                </div>
                            {% endif %}

                            <!-- Product Image -->
                            <div class="product-image-container">
                                <a href="{% url 'ecommerce:product_detail' product.slug %}" class="product-link">
                                    {% if product.featured_image %}
                                        <img src="{{ product.featured_image.url }}" 
                                             alt="{{ product.name }}" 
                                             class="product-image main-image"
                                             loading="lazy">
                                    {% else %}
                                        <div class="product-image-placeholder">
                                            <i class="fas fa-crown"></i>
                                            <span>No Image</span>
                                        </div>
                                    {% endif %}
                                    
                                    {% if product.hover_image %}
                                        <img src="{{ product.hover_image.url }}" 
                                             alt="{{ product.name }}" 
                                             class="product-image hover-image"
                                             loading="lazy">
                                    {% endif %}
                                </a>

                                <!-- Quick Actions -->
                                <div class="product-quick-actions">
                                    <button class="quick-action-btn wishlist-btn" 
                                            data-product-id="{{ product.id }}"
                                            title="Add to Wishlist">
                                        <i class="far fa-heart"></i>
                                    </button>
                                    <button class="quick-action-btn quick-view-btn" 
                                            data-product-id="{{ product.id }}"
                                            title="Quick View">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>

                                <!-- Rarity Indicator -->
                                <div class="rarity-indicator rarity-{{ product.rarity }}">
                                    <span class="rarity-text">{{ product.get_rarity_display }}</span>
                                </div>
                            </div>

                            <!-- Product Info -->
                            <div class="product-info">
                                <div class="product-header">
                                    <h3 class="product-name">
                                        <a href="{% url 'ecommerce:product_detail' product.slug %}">{{ product.name }}</a>
                                    </h3>
                                    {% if product.brand %}
                                        <span class="product-brand">{{ product.brand.name }}</span>
                                    {% endif %}
                                </div>

                                {% if product.short_description %}
                                    <p class="product-description">{{ product.short_description }}</p>
                                {% endif %}

                                <!-- Game Compatibility -->
                                {% if product.compatible_games %}
                                    <div class="product-games">
                                        <i class="fas fa-gamepad"></i>
                                        <span>{{ product.compatible_games }}</span>
                                    </div>
                                {% endif %}

                                <!-- Pricing -->
                                <div class="product-pricing">
                                    {% if product.original_price and product.discount_percentage > 0 %}
                                        <span class="price-original">${{ product.original_price }}</span>
                                        <span class="price-discount">-{{ product.discount_percentage }}%</span>
                                    {% endif %}
                                    <span class="price-current">${{ product.price }}</span>
                                    {% if product.is_digital %}
                                        <span class="digital-badge">Digital</span>
                                    {% endif %}
                                </div>

                                <!-- Stock Status -->
                                <div class="product-stock">
                                    {% if product.track_stock %}
                                        {% if product.stock > 0 %}
                                            {% if product.stock <= 5 %}
                                                <span class="stock-low">‚ö†Ô∏è Only {{ product.stock }} left</span>
                                            {% else %}
                                                <span class="stock-available">‚úÖ In Stock</span>
                                            {% endif %}
                                        {% else %}
                                            <span class="stock-out">‚ùå Out of Stock</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="stock-unlimited">‚ôæÔ∏è Always Available</span>
                                    {% endif %}
                                </div>

                                <!-- Add to Cart -->
                                <div class="product-actions">
                                    {% if product.track_stock and product.stock <= 0 %}
                                        <button class="btn btn-disabled" disabled>Out of Stock</button>
                                    {% else %}
                                        <button class="btn btn-primary add-to-cart-btn" 
                                                data-product-id="{{ product.id }}">
                                            <i class="fas fa-shopping-cart"></i>
                                            Add to Cart
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <!-- Empty State -->
                <div class="empty-category" data-aos="fade-up">
                    <div class="empty-category-content">
                        <div class="empty-icon">
                            <i class="fas fa-crown"></i>
                        </div>
                        <h2>No Products Found</h2>
                        <p>This category doesn't have any products yet. Check back soon for new arrivals!</p>
                        <a href="{% url 'ecommerce:store_home' %}" class="btn btn-primary">
                            <i class="fas fa-arrow-left"></i>
                            Back to Store
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="{% static 'ecommerce/js/store.js' %}"></script>
<script>
    // Initialize AOS
    AOS.init({
        duration: 800,
        once: true,
        offset: 100
    });

    // Initialize CrownStore
    document.addEventListener('DOMContentLoaded', function() {
        const store = new CrownStore();
    });
</script>
{% endblock %}