{% extends "base.html" %}
{% load static %}
{% block og_title %}Notifications â€” DeltaCrown{% endblock %}

{% block content %}
<section class="container my-8 max-w-5xl">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-3xl font-bold text-white">Notifications</h1>
    <form action="{% url 'notifications:mark_all_read' %}" method="post">
      {% csrf_token %}
      <button type="submit" class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition">
        Mark all read
      </button>
    </form>
  </div>

  <!-- Tab Navigation -->
  <div class="glass-panel rounded-xl p-1 mb-6 flex gap-2">
    <button onclick="switchTab('notifications')" 
            id="tab-notifications"
            class="notification-tab px-6 py-3 rounded-lg bg-cyan-500/20 text-cyan-400 font-bold transition w-full">
      <i class="fa-solid fa-bell mr-2"></i> Notifications
    </button>
    <!-- REMOVED 2026-01-22: Follow Requests tab removed -->
  </div>

  <!-- Notifications Tab Content -->
  <div id="content-notifications" class="tab-content">
    <div class="glass-panel rounded-2xl divide-y divide-white/10">
      {% if page and page.object_list %}
        {% for n in page.object_list %}
          <div class="p-4 flex items-start justify-between gap-4 hover:bg-white/5 transition" 
               data-notification-id="{{ n.id }}"
               data-notif-id="{{ n.id }}">
            <div class="flex-1">
              <div class="font-medium text-white">{{ n.title|default:"Notification" }}</div>
              <div class="text-sm text-gray-400">{{ n.body|default:n.message }}</div>
              <div class="text-xs text-gray-500 mt-1">{{ n.created_at|timesince }} ago</div>
            </div>
            <div class="flex items-center gap-2">
              <!-- REMOVED 2026-01-22: Follow request inline actions removed -->
              {% if n.url %}
                <a href="{{ n.url }}" class="px-3 py-1 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg text-sm transition">
                  View
                </a>
              {% endif %}
              {% if not n.is_read %}
                <form action="{% url 'notifications:mark_read' n.id %}" method="post" class="inline">
                  {% csrf_token %}
                  <input type="hidden" name="next" value="{{ request.get_full_path }}"/>
                  <button type="submit" class="px-3 py-1 bg-white/10 hover:bg-white/20 text-white rounded-lg text-sm transition">
                    Mark read
                  </button>
                </form>
              {% endif %}
            </div>
          </div>
        {% endfor %}
        <!-- Pagination -->
        <div class="p-4 flex items-center justify-between">
          {% if page.has_previous %}
            <a class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition" 
               href="?page={{ page.previous_page_number }}">
              <i class="fa-solid fa-chevron-left mr-1"></i> Prev
            </a>
          {% else %}
            <div></div>
          {% endif %}
          
          <span class="text-gray-400 text-sm">
            Page {{ page.number }} / {{ page.paginator.num_pages }}
          </span>
          
          {% if page.has_next %}
            <a class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition" 
               href="?page={{ page.next_page_number }}">
              Next <i class="fa-solid fa-chevron-right ml-1"></i>
            </a>
          {% else %}
            <div></div>
          {% endif %}
        </div>
      {% else %}
        <div class="p-12 text-center text-gray-400">
          <i class="fa-solid fa-bell text-5xl mb-4 opacity-50"></i>
          <p>No notifications yet.</p>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- REMOVED 2026-01-22: Follow Requests tab content removed -->
</section>

<!-- Toast Notifications -->
<div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

<script>
// ===== TAB MANAGEMENT =====
let currentTab = 'notifications';
let currentRequestTab = 'pending';

function switchTab(tab) {
  currentTab = tab;
  
  // Update tab buttons
  document.querySelectorAll('.notification-tab').forEach(btn => {
    btn.classList.remove('bg-cyan-500/20', 'text-cyan-400');
    btn.classList.add('text-gray-400', 'hover:bg-white/5');
  });
  document.getElementById(`tab-${tab}`).classList.add('bg-cyan-500/20', 'text-cyan-400');
  document.getElementById(`tab-${tab}`).classList.remove('text-gray-400', 'hover:bg-white/5');
  
  // Update content
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.add('hidden');
  });
  document.getElementById(`content-${tab}`).classList.remove('hidden');
  
  // REMOVED 2026-01-22: Follow requests tab loading removed
}

// REMOVED 2026-01-22: All follow request functions removed (switchRequestTab, loadFollowRequests, renderFollowRequests, etc.)

// ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', () => {
  // REMOVED 2026-01-22: updatePendingBadge and follow-requests check removed
});

// ===== ANIMATIONS =====
const style = document.createElement('style');
style.textContent = `
  @keyframes slideOut {
    to { transform: translateX(100%); opacity: 0; }
  }
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
`;
document.head.appendChild(style);
</script>
{% endblock %}
