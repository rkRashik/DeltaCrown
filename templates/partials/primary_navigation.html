{% load static nav_extras dc_avatar notifications_nav %}
<!-- DELTACROWN PRIMARY NAVIGATION v3 -->
<div id="dc-search-overlay"
  class="fixed inset-0 z-[200] hidden items-start justify-center pt-[12vh] px-4 transition-opacity duration-300"
  style="background:linear-gradient(135deg,rgba(2,0,5,.9),rgba(20,10,40,.85),rgba(2,0,5,.9));backdrop-filter:blur(8px);">
  <div id="dc-search-modal"
    class="w-full max-w-3xl rounded-2xl overflow-hidden flex flex-col transform scale-95 opacity-0 transition-all duration-300"
    style="background:linear-gradient(135deg,rgba(15,10,30,.98),rgba(10,5,20,.98));border:1px solid rgba(138,43,226,.3);box-shadow:0 0 60px rgba(138,43,226,.2),0 30px 80px rgba(0,0,0,.9),inset 0 1px 0 rgba(255,255,255,.1);">
    <div class="flex items-center px-6 py-5 border-b border-purple-500/20 bg-gradient-to-r from-purple-900/10 to-transparent">
      <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500/20 to-purple-600/20 flex items-center justify-center mr-4 border border-cyan-400/30">
        <i class="fa-solid fa-magnifying-glass text-cyan-400 text-xl"></i>
      </div>
      <input type="text" id="dc-cmd-input" placeholder="Search tournaments, teams, players..."
        class="flex-1 bg-transparent border-none outline-none text-white text-xl font-sans placeholder-gray-400 font-medium" autocomplete="off">
      <button id="dc-search-close" class="w-10 h-10 text-gray-400 hover:text-white transition p-2 rounded-xl hover:bg-white/5 ml-3">
        <i class="fa-solid fa-xmark text-lg"></i>
      </button>
    </div>
    <div class="p-4 max-h-[400px] overflow-y-auto" style="scrollbar-width:none;">
      <div class="text-xs font-bold text-purple-400/70 uppercase px-4 py-2 tracking-widest">Quick Access</div>
      <a href="/tournaments/" class="flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 group transition-all border border-transparent hover:border-purple-500/30 mb-2">
        <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-purple-500/20 to-purple-700/10 text-purple-400 flex items-center justify-center border border-purple-500/30">
          <i class="fa-solid fa-trophy text-lg"></i>
        </div>
        <div class="flex-1"><span class="text-gray-100 font-semibold group-hover:text-white block">Browse Tournaments</span><span class="text-sm text-gray-400">Find active competitions</span></div>
        <i class="fa-solid fa-chevron-right text-gray-600 group-hover:text-cyan-400 transition-all group-hover:translate-x-1"></i>
      </a>
      <a href="{% if ORG_APP_ENABLED %}/teams/vnext/{% else %}/teams/{% endif %}" class="flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 group transition-all border border-transparent hover:border-cyan-400/30">
        <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-cyan-400/20 to-cyan-600/10 text-cyan-400 flex items-center justify-center border border-cyan-400/30">
          <i class="fa-solid fa-users text-lg"></i>
        </div>
        <div class="flex-1"><span class="text-gray-100 font-semibold group-hover:text-white block">{% if ORG_APP_ENABLED %}Teams{% else %}Find a Team{% endif %}</span><span class="text-sm text-gray-400">{% if ORG_APP_ENABLED %}Esports teams & organizations{% else %}Join a roster or create one{% endif %}</span></div>
        <i class="fa-solid fa-chevron-right text-gray-600 group-hover:text-cyan-400 transition-all group-hover:translate-x-1"></i>
      </a>
    </div>
    <div class="px-6 py-3 bg-black/30 border-t border-purple-500/20 flex justify-between text-xs text-gray-400 font-medium">
      <div class="flex gap-4">
        <span><kbd class="bg-white/10 px-2 py-1 rounded text-gray-300 border border-white/20">↑↓</kbd> navigate</span>
        <span><kbd class="bg-white/10 px-2 py-1 rounded text-gray-300 border border-white/20">↵</kbd> select</span>
      </div>
      <span><kbd class="bg-white/10 px-2 py-1 rounded text-gray-300 border border-white/20">ESC</kbd> close</span>
    </div>
  </div>
</div>

<!-- Mobile Top Header -->
<header id="dc-mobile-header"
  class="md:hidden fixed top-0 left-0 right-0 h-16 flex items-center justify-between px-5"
  style="z-index:100;background:rgba(2,0,5,.95);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-bottom:1px solid rgba(255,255,255,.05);transition:transform .3s ease;padding-top:env(safe-area-inset-top);">
  <a href="/" class="flex items-center gap-2">
    <img src="{% static 'img/deltaCrown_logos/logo_animated.svg' %}" alt="DeltaCrown" class="w-8 h-8">
    <img src="{% static 'img/deltaCrown_logos/DeltaCrown_Teal-Purple-Gold.svg' %}" alt="DELTACROWN" class="h-6 w-auto">
  </a>
  <div class="flex items-center gap-3">
    {% if request.user.is_authenticated %}
    <a href="/notifications/" class="w-9 h-9 rounded-full flex items-center justify-center text-gray-400 hover:text-white relative">
      <i class="fa-regular fa-bell text-lg"></i>
      {% with nav_unread_count|default:0 as unread_count %}{% if unread_count > 0 %}<span class="absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>{% endif %}{% endwith %}
    </a>
    {% endif %}
    <button id="dc-mobile-menu-toggle" aria-label="Open menu" aria-expanded="false"
      class="w-10 h-10 rounded-lg flex items-center justify-center text-white">
      <span id="dc-hamburger" class="dc-hamburger"><span></span><span></span><span></span></span>
    </button>
  </div>
</header>

<!-- Desktop Navigation -->
<nav id="dc-navbar"
  class="hidden md:flex fixed top-0 left-0 right-0 z-[100] items-center justify-center transition-all duration-500"
  style="height:80px;background:rgba(2,0,5,.6);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-bottom:1px solid rgba(255,255,255,.03);">
  <div class="w-full px-6 md:px-8 grid grid-cols-[1fr_auto_1fr] items-center h-full gap-2">
    <!-- Logo -->
    <a href="/" class="flex items-center gap-3 group focus:outline-none justify-self-start min-w-max" aria-label="DeltaCrown Home">
      <img src="{% static 'img/deltaCrown_logos/logo_animated.svg' %}" alt="DeltaCrown" class="w-10 h-10 drop-shadow-[0_0_12px_rgba(108,0,255,0.4)]">
      <img src="{% static 'img/deltaCrown_logos/DeltaCrown_Teal-Purple-Gold.svg' %}" alt="DELTACROWN" class="hidden md:block h-8 w-auto drop-shadow-[0_0_8px_rgba(0,229,255,0.3)]">
    </a>
    <!-- Center Nav Links -->
    <nav class="flex items-center gap-4 md:gap-5 h-full justify-self-center" aria-label="Primary navigation">
      {% nav_active '/tournaments/' '/tournaments' as tournaments_active %}
      <div class="dc-nav-item{% if tournaments_active %} active{% endif %}"><a href="/tournaments/" class="dc-nav-link" {% if tournaments_active %}aria-current="page"{% endif %}>Tournaments</a></div>

      {% if ORG_APP_ENABLED %}{% nav_active '/teams/vnext/' '/teams' '/orgs/' as teams_active %}
      <div class="dc-nav-item{% if teams_active %} active{% endif %}"><a href="/teams/vnext/" class="dc-nav-link" {% if teams_active %}aria-current="page"{% endif %}>Teams</a></div>
      {% else %}{% nav_active '/teams/' '/teams' as teams_active %}
      <div class="dc-nav-item{% if teams_active %} active{% endif %}"><a href="/teams/" class="dc-nav-link" {% if teams_active %}aria-current="page"{% endif %}>Teams</a></div>
      {% endif %}

      {% if request.user.is_authenticated %}{% nav_active '/dashboard/' '/dashboard' as dashboard_active %}
      <div class="dc-nav-item{% if dashboard_active %} active{% endif %}"><a href="/dashboard/" class="dc-nav-link" {% if dashboard_active %}aria-current="page"{% endif %}>Dashboard</a></div>
      {% endif %}

      {% if COMPETITION_APP_ENABLED %}{% nav_active '/competition/' '/competition' as competition_active %}
      <div class="dc-nav-item{% if competition_active %} active{% endif %}"><a href="/competition/rankings/" class="dc-nav-link" {% if competition_active %}aria-current="page"{% endif %}>Rankings</a></div>
      {% endif %}

      {% nav_active '/community/' '/community' as community_active %}
      <div class="dc-nav-item{% if community_active %} active{% endif %}"><a href="/community/" class="dc-nav-link" {% if community_active %}aria-current="page"{% endif %}>Community</a></div>

      {% nav_active '/watch/' '/arena' as arena_active %}
      <div class="dc-nav-item{% if arena_active %} active{% endif %}"><a href="/watch/" class="dc-nav-link flex items-center gap-2" {% if arena_active %}aria-current="page"{% endif %}>Arena <span class="w-1.5 h-1.5 bg-red-500 rounded-full animate-ping" aria-hidden="true"></span></a></div>

      {% nav_active '/crownstore/' '/crownstore' as store_active %}
      <div class="dc-nav-item{% if store_active %} active{% endif %}"><a href="/crownstore/" class="dc-nav-link text-yellow-400/90 hover:text-white" {% if store_active %}aria-current="page"{% endif %}>Store</a></div>
    </nav>
    <!-- Right: Actions & Profile -->
    <div class="flex items-center gap-5 justify-self-end">
      <button id="dc-search-btn" class="w-10 h-10 rounded-xl flex items-center justify-center text-gray-400 hover:text-white hover:bg-white/5 transition-all group" title="Search (Cmd+K)" aria-label="Open search">
        <i class="fa-solid fa-magnifying-glass text-[1.1rem] group-hover:scale-110 transition-transform"></i>
      </button>
      {% if request.user.is_authenticated %}
      <!-- Notifications -->
      <div class="relative">
        <button id="dc-notif-btn" class="w-10 h-10 rounded-xl flex items-center justify-center text-gray-400 hover:text-white hover:bg-white/5 transition-all relative group" aria-label="Notifications" aria-haspopup="true" aria-expanded="false">
          <i class="fa-regular fa-bell text-[1.25rem] group-hover:rotate-12 transition-transform"></i>
          {% with nav_unread_count|default:0 as unread_count %}{% if unread_count > 0 %}<span class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full border-2 border-[#020005] animate-pulse"></span>{% endif %}{% endwith %}
        </button>
        <div id="dc-notif-menu" class="dc-dropdown absolute top-full right-0 mt-4 w-[400px]">
          <div class="px-5 py-4 border-b border-white/5 bg-white/[0.02] flex justify-between items-center">
            <h4 class="font-bold text-white text-sm tracking-widest uppercase">Notifications</h4>
            <button id="dc-mark-read-btn" class="text-[11px] text-cyan-400 hover:text-white transition font-bold uppercase tracking-wider"><i class="fa-solid fa-check-double"></i> Mark Read</button>
          </div>
          {% notifications_bell %}
        </div>
      </div>
      <div class="w-px h-6 bg-white/10 mx-2"></div>
      <!-- Profile Dropdown -->
      {% user_avatar_url request.user as avatar_url %}
      <div class="relative">
        <button id="dc-profile-btn" class="flex items-center gap-3 pl-1 pr-4 py-1.5 rounded-full bg-white/[0.03] border border-white/10 hover:border-white/20 hover:bg-white/[0.08] transition-all group" aria-label="Profile menu" aria-haspopup="true" aria-expanded="false">
          <img src="{{ avatar_url }}" class="w-9 h-9 rounded-full object-cover ring-2 ring-transparent group-hover:ring-cyan-400 transition-all" alt="{{ request.user.username }}">
          <span class="text-sm font-semibold text-gray-200 group-hover:text-white">{{ request.user.username }}</span>
          <i class="fa-solid fa-chevron-down text-[10px] text-gray-500 group-hover:text-white transition-transform duration-300 ml-1" id="dc-profile-chevron"></i>
        </button>
        <div id="dc-profile-menu" class="dc-dropdown absolute top-full right-0 mt-4 w-64">
          <div class="p-5 border-b border-white/5 bg-gradient-to-b from-white/[0.03] to-transparent">
            <div class="flex items-center gap-4">
              <div class="relative">
                <img src="{{ avatar_url }}" class="w-14 h-14 rounded-full object-cover border border-white/10 shadow-lg" alt="{{ request.user.username }}">
                <div class="absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 border-2 border-black rounded-full" title="Online"></div>
              </div>
              <div>
                <p class="text-white font-bold text-base">{{ request.user.get_full_name|default:request.user.username }}</p>
                <p class="text-xs text-gray-400 mt-1">@{{ request.user.username }}</p>
              </div>
            </div>
          </div>
          <div class="py-2 px-1">
            <a href="{% url 'user_profile:public_profile' request.user.username %}" class="dc-dd-item"><i class="fa-regular fa-user"></i> <span>My Profile</span></a>
            <a href="/dashboard/" class="dc-dd-item"><i class="fa-solid fa-chart-pie"></i> <span>Dashboard</span></a>
            {% if ORG_APP_ENABLED %}<a href="/teams/vnext/" class="dc-dd-item"><i class="fa-solid fa-users"></i> <span>Teams</span></a>
            {% elif LEGACY_TEAMS_ENABLED %}<a href="/teams/" class="dc-dd-item"><i class="fa-solid fa-users"></i> <span>Teams</span></a>{% endif %}
            <div class="h-px bg-white/5 mx-4 my-1.5"></div>
            <a href="{% url 'user_profile:settings' %}" class="dc-dd-item"><i class="fa-solid fa-sliders"></i> <span>Settings</span></a>
          </div>
          <div class="p-2 border-t border-white/5 bg-white/[0.01] px-1">
            <a href="/accounts/logout/" class="dc-dd-item text-red-400 hover:text-red-300 hover:bg-red-500/10"><i class="fa-solid fa-arrow-right-from-bracket"></i> <span>Sign Out</span></a>
          </div>
        </div>
      </div>
      {% else %}
      <div class="flex items-center gap-3">
        <a href="/accounts/login/" class="px-4 py-2 text-gray-300 hover:text-white transition font-medium">Sign In</a>
        <a href="/accounts/signup/" class="px-5 py-2 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg font-semibold transition">Sign Up</a>
      </div>
      {% endif %}
    </div>
  </div>
</nav>

<!-- Mobile Bottom Nav -->
<nav id="dc-bottom-nav"
  class="md:hidden fixed bottom-0 left-0 right-0 flex items-center justify-around px-1"
  style="z-index:90;height:60px;background:rgba(2,0,5,.95);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-top:1px solid rgba(255,255,255,.08);transition:transform .3s ease;padding-bottom:env(safe-area-inset-bottom);"
  aria-label="Mobile navigation">
  {% nav_active '/tournaments/' '/tournaments' as tournaments_active %}
  <a href="/tournaments/" class="dc-btm-item {% if tournaments_active %}active{% endif %}" {% if tournaments_active %}aria-current="page"{% endif %}>
    <i class="fa-solid fa-trophy"></i><span>Events</span>
  </a>
  {% if ORG_APP_ENABLED %}{% nav_active '/teams/vnext/' '/teams' '/orgs/' as teams_active %}
  <a href="/teams/vnext/" class="dc-btm-item {% if teams_active %}active{% endif %}" {% if teams_active %}aria-current="page"{% endif %}>
    <i class="fa-solid fa-users"></i><span>Teams</span>
  </a>
  {% else %}{% nav_active '/teams/' '/teams' as teams_active %}
  <a href="/teams/" class="dc-btm-item {% if teams_active %}active{% endif %}" {% if teams_active %}aria-current="page"{% endif %}>
    <i class="fa-solid fa-users"></i><span>Teams</span>
  </a>{% endif %}
  {% if request.user.is_authenticated %}{% nav_active '/dashboard/' '/dashboard' as dashboard_active %}
  <a href="/dashboard/" class="dc-btm-item {% if dashboard_active %}active{% endif %}" {% if dashboard_active %}aria-current="page"{% endif %}>
    <i class="fa-solid fa-chart-pie"></i><span>Dash</span>
  </a>{% endif %}
  {% nav_active '/watch/' '/arena' as arena_active %}
  <a href="/watch/" class="dc-btm-item {% if arena_active %}active{% endif %}" {% if arena_active %}aria-current="page"{% endif %}>
    <i class="fa-solid fa-gamepad"></i><span>Arena</span>
  </a>
  {% nav_active '/crownstore/' '/crownstore' as store_active %}
  <a href="/crownstore/" class="dc-btm-item {% if store_active %}active{% endif %}" {% if store_active %}aria-current="page"{% endif %}>
    <i class="fa-solid fa-store"></i><span>Store</span>
  </a>
</nav>

<!-- Mobile Drawer -->
<div id="dc-mobile-drawer"
  style="position:fixed;top:0;right:0;width:18rem;height:100%;z-index:160;transform:translateX(100%);transition:transform .3s cubic-bezier(.16,1,.3,1),box-shadow .3s;overflow-y:auto;background:rgba(2,0,5,.98);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-left:1px solid rgba(255,255,255,.1);">
  <div class="p-6">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-xl font-bold text-white">Menu</h2>
      <button id="dc-drawer-close" aria-label="Close menu" class="w-10 h-10 rounded-full flex items-center justify-center text-gray-400 hover:text-white hover:bg-white/10">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M5 5l10 10M15 5l-10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      </button>
    </div>
    {% if request.user.is_authenticated %}
    <div class="mb-6 p-4 bg-white/5 rounded-xl">
      {% user_avatar_url request.user as drawer_avatar %}
      <div class="flex items-center gap-3">
        <img src="{{ drawer_avatar }}" class="w-12 h-12 rounded-full border-2 border-white/20" alt="{{ request.user.username }}">
        <div>
          <p class="text-white font-bold">{{ request.user.get_full_name|default:request.user.username }}</p>
          <p class="text-sm text-gray-400">@{{ request.user.username }}</p>
        </div>
      </div>
    </div>
    <div class="space-y-1">
      <a href="/dashboard/" class="dc-drawer-link"><i class="fa-solid fa-chart-pie w-5"></i> Dashboard</a>
      <a href="{% url 'user_profile:public_profile' request.user.username %}" class="dc-drawer-link"><i class="fa-solid fa-user w-5"></i> Profile</a>
      <a href="{% if TEAM_VNEXT_ADAPTER_ENABLED and not TEAM_VNEXT_FORCE_LEGACY and TEAM_VNEXT_ROUTING_MODE != 'legacy_only' %}{% url 'organizations:team_invites' %}{% else %}{% url 'teams:my_invites' %}{% endif %}" class="dc-drawer-link relative">
        <i class="fa-solid fa-user-plus w-5"></i> Team Invites
        {% if pending_invites_count > 0 %}<span class="absolute top-2 right-2 inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full">{{ pending_invites_count }}</span>{% endif %}
      </a>
      <a href="/notifications/" class="dc-drawer-link"><i class="fa-solid fa-bell w-5"></i> Notifications</a>
      <a href="{% url 'user_profile:settings' %}" class="dc-drawer-link"><i class="fa-solid fa-cog w-5"></i> Settings</a>
      <div class="h-px bg-white/10 my-3"></div>
      <a href="/accounts/logout/" class="dc-drawer-link !text-red-400 hover:!text-red-300 hover:!bg-red-500/10"><i class="fa-solid fa-arrow-right-from-bracket w-5"></i> Sign Out</a>
    </div>
    {% else %}
    <div class="space-y-3">
      <a href="/accounts/login/" class="block w-full px-6 py-3 bg-cyan-500 hover:bg-cyan-600 text-white text-center rounded-lg font-semibold transition">Sign In</a>
      <a href="/accounts/signup/" class="block w-full px-6 py-3 border border-white/20 hover:bg-white/5 text-white text-center rounded-lg font-semibold transition">Create Account</a>
    </div>
    {% endif %}
  </div>
</div>

<!-- Mobile Backdrop -->
<div id="dc-backdrop" style="position:fixed;inset:0;z-index:155;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:opacity .3s;display:none;"></div>

<!-- Inline Nav Styles -->
<style>
/* Hamburger Icon */
.dc-hamburger { display:flex;flex-direction:column;justify-content:center;align-items:center;width:22px;height:22px;gap:5px;cursor:pointer; }
.dc-hamburger span { display:block;width:100%;height:2px;background:#fff;border-radius:2px;transition:transform .3s ease,opacity .3s ease;transform-origin:center; }
.dc-hamburger.is-open span:nth-child(1) { transform:translateY(7px) rotate(45deg); }
.dc-hamburger.is-open span:nth-child(2) { opacity:0;transform:scaleX(0); }
.dc-hamburger.is-open span:nth-child(3) { transform:translateY(-7px) rotate(-45deg); }

/* Bottom nav items */
.dc-btm-item { display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 0;flex:1;text-decoration:none;transition:color .2s; }
.dc-btm-item i { font-size:1.15rem;color:rgba(255,255,255,.4);transition:color .2s; }
.dc-btm-item span { font-size:10px;color:rgba(255,255,255,.4);font-weight:500;letter-spacing:.03em;transition:color .2s; }
.dc-btm-item:active { transform:scale(.95); }
.dc-btm-item.active i { color:#00E5FF; }
.dc-btm-item.active span { color:#00E5FF; }
.dc-btm-item.active { position:relative; }
.dc-btm-item.active::before { content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:40%;height:2px;background:linear-gradient(90deg,transparent,#00E5FF,transparent);border-radius:1px; }

/* Drawer links */
.dc-drawer-link { display:block;padding:12px 16px;color:#cbd5e1;border-radius:8px;transition:all .2s;text-decoration:none; }
.dc-drawer-link:hover,.dc-drawer-link:active { color:#fff;background:rgba(255,255,255,.05); }

/* Hide mobile stuff on desktop */
@media (min-width:768px) {
  #dc-mobile-header,#dc-mobile-drawer,#dc-backdrop,#dc-bottom-nav { display:none !important; }
}
/* Hide desktop stuff on mobile */
@media (max-width:767px) {
  #dc-navbar { display:none !important; }
}
</style>

<!-- Notification Script -->
<script>
function getCookie(n){let v=null;if(document.cookie)document.cookie.split(';').forEach(c=>{c=c.trim();if(c.startsWith(n+'='))v=decodeURIComponent(c.substring(n.length+1))});return v}

{% if request.user.is_authenticated %}
document.getElementById('dc-mark-read-btn')?.addEventListener('click',async function(){
  try{const r=await fetch('/notifications/mark-all-read/',{method:'POST',headers:{'X-CSRFToken':getCookie('csrftoken'),'Content-Type':'application/json'}});const d=await r.json();if(d.success){document.querySelectorAll('.notification-dropdown-item').forEach(i=>{i.classList.remove('bg-cyan-500/5');const dot=i.querySelector('.bg-cyan-400');if(dot)dot.remove()});const b=document.querySelector('#dc-notif-btn .animate-pulse');if(b)b.remove();setTimeout(()=>location.reload(),1000)}}catch(e){console.error('Mark read failed:',e)}
});

let _ncnt=0;
async function _pollNotif(){try{const r=await fetch('/notifications/api/unread-count/',{headers:{'X-Requested-With':'XMLHttpRequest'}});if(!r.ok)return;const d=await r.json(),c=d.count||0;const b=document.querySelector('#dc-notif-btn .animate-pulse');if(c>0){if(!b){const btn=document.getElementById('dc-notif-btn');if(btn){const s=document.createElement('span');s.className='absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full border-2 border-[#020005] animate-pulse';btn.appendChild(s)}}}else{if(b)b.remove()}_ncnt=c}catch(e){}}
let _nint;function _startPoll(){_pollNotif();_nint=setInterval(_pollNotif,15000)}
document.addEventListener('visibilitychange',()=>{if(document.hidden){clearInterval(_nint)}else{_startPoll()}});
_startPoll();
{% endif %}
</script>
