{% load static nav_extras dc_avatar %}
<header class="site-nav" role="banner" data-site-nav>
  <nav class="nav-shell" aria-label="Primary">
    <div class="nav-left">
      {% nav_active '/' as is_home %}
      <a href="/" class="brand" aria-label="DeltaCrown"{% if is_home %} aria-current="page"{% endif %}>
        <span class="brand-logo-wrap">
          <img src="{% static 'siteui/svg/Logos/DeltaCrown.svg' %}" alt="" class="brand-logo" />
        </span>
        <span class="brand-wordmark">DeltaCrown</span>
      </a>

      <button class="nav-icon-btn nav-mobile-toggle" type="button" data-open-drawer="main-drawer" aria-label="Open menu" aria-controls="main-drawer" aria-expanded="false">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M4 6h16" />
          <path d="M4 12h16" />
          <path d="M4 18h16" />
        </svg>
      </button>
    </div>

    <div class="nav-center">
      <ul class="nav-links" role="list">
        {% nav_active '/tournaments/' '/tournaments' as tournaments_active %}
        <li class="nav-item">
          <a class="nav-link{% if tournaments_active %} is-active{% endif %}" href="/tournaments/"{% if tournaments_active %} aria-current="page"{% endif %}>
            <span>Tournaments</span>
          </a>
        </li>

        {% nav_active '/teams/' '/teams' as teams_active %}
        <li class="nav-item">
          <a class="nav-link{% if teams_active %} is-active{% endif %}" href="/teams/"{% if teams_active %} aria-current="page"{% endif %}>
            <span>Teams</span>
          </a>
        </li>

        {% if request.user.is_authenticated %}
          {% nav_active '/dashboard/' '/dashboard' as dashboard_active %}
          <li class="nav-item">
            <a class="nav-link{% if dashboard_active %} is-active{% endif %}" href="/dashboard/"{% if dashboard_active %} aria-current="page"{% endif %}>
              <span>Dashboard</span>
            </a>
          </li>
        {% endif %}

        {% nav_active '/crowngear/' '/crowngear' as crowngear_active %}
        <li class="nav-item">
          <a class="nav-link{% if crowngear_active %} is-active{% endif %}" href="/crowngear/"{% if crowngear_active %} aria-current="page"{% endif %}>
            <span>CrownGear</span>
          </a>
        </li>

        {% nav_active '/arenalive/' '/arenalive' as arenalive_active %}
        <li class="nav-item">
          <a class="nav-link{% if arenalive_active %} is-active{% endif %}" href="/arenalive/"{% if arenalive_active %} aria-current="page"{% endif %}>
            <span>ArenaLive</span>
            {% if nav_live %}<span class="live-badge"><span class="live-dot"></span>Live</span>{% endif %}
          </a>
        </li>

        {% nav_active '/community/' '/community' as community_active %}
        <li class="nav-item">
          <a class="nav-link{% if community_active %} is-active{% endif %}" href="/community/"{% if community_active %} aria-current="page"{% endif %}>
            <span>Community</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="nav-right">
      <div class="nav-actions" role="group" aria-label="Primary actions">
        <button class="nav-icon-btn theme-toggle" id="theme-toggle" data-theme-toggle aria-label="Toggle theme" aria-pressed="false">
          <svg class="theme-icon-light" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <circle cx="12" cy="12" r="4" />
            <path d="M12 3v2M12 19v2M4.6 4.6l1.4 1.4M18 18l1.4 1.4M3 12h2M19 12h2M4.6 19.4l1.4-1.4M18 6l1.4-1.4" />
          </svg>
          <svg class="theme-icon-dark" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M15.75 4.25a6.75 6.75 0 1 0 4 11.98 7.5 7.5 0 1 1-8.73-10.7 6.77 6.77 0 0 0 4.73-1.28Z" />
          </svg>
        </button>

        <div class="nav-dropdown">
          {% with nav_unread_count|default:0 as unread_count %}
          <button class="nav-icon-btn notif-trigger" type="button" data-menu-toggle aria-haspopup="true" aria-expanded="false" aria-controls="menu-notifications">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M12 21a2 2 0 0 0 2-2h-4a2 2 0 0 0 2 2Z" />
              <path d="M6.5 16.5h11l-1.1-1.54a4.5 4.5 0 0 1-.9-2.7V10a4.5 4.5 0 0 0-9 0v2.26a4.5 4.5 0 0 1-.9 2.7L6.5 16.5Z" />
            </svg>
            <span class="notif-badge" data-notif-badge{% if unread_count|add:0 > 0 %} data-has-unread="true"{% endif %}>
              {% if unread_count|add:0 > 0 %}{{ unread_count }}{% else %}3{% endif %}
            </span>
          </button>
          {% endwith %}
          <div id="menu-notifications" class="dropdown-menu notifications-menu" hidden data-menu role="menu" aria-label="Notifications">
            <div class="dropdown-header">
              <h2 class="dropdown-title">Notifications</h2>
              <a class="dropdown-link" href="/notifications/">View all</a>
            </div>
            <ul class="dropdown-list" role="none">
              <li role="none">
                <a href="/notifications/" role="menuitem" class="dropdown-item">
                  <span class="item-title">New team invite</span>
                  <span class="item-meta">GhostFox Gaming wants you on the roster.</span>
                </a>
              </li>
              <li role="none">
                <a href="/notifications/" role="menuitem" class="dropdown-item">
                  <span class="item-title">Payout processed</span>
                  <span class="item-meta">Your CrownCup winnings have been sent.</span>
                </a>
              </li>
              <li role="none">
                <a href="/notifications/" role="menuitem" class="dropdown-item">
                  <span class="item-title">Match starting soon</span>
                  <span class="item-meta">Quarter-final kicks off in 15 minutes.</span>
                </a>
              </li>
            </ul>
          </div>
        </div>

        <a class="nav-cta" href="/tournaments/">Join a Tournament</a>
      </div>

      {% if request.user.is_authenticated %}
        {% user_avatar_url request.user '/static/img/user_avatar/default-avatar.png' as avatar_url %}
        {% with request.user.get_full_name|default:request.user.first_name|default:request.user.username as nav_display_name %}
        <div class="nav-profile">
          <button class="profile-trigger" type="button" data-avatar-toggle aria-haspopup="true" aria-expanded="false" aria-controls="menu-account">
            <span class="profile-avatar">
              <img src="{{ avatar_url }}" alt="" class="profile-avatar-img" />
              <span class="avatar-fallback" aria-hidden="true">{{ nav_display_name|slice:':1'|upper }}</span>
            </span>
            <span class="profile-label">
              <span class="profile-name">{{ nav_display_name }}</span>
            </span>
          </button>

          <div id="menu-account" class="dropdown-menu profile-menu" hidden data-avatar-menu role="menu" aria-label="Account">
            <div class="profile-menu-header">
              <span class="profile-menu-avatar">
                <img src="{{ avatar_url }}" alt="" />
              </span>
              <div class="profile-menu-meta">
                <span class="profile-menu-name">{{ nav_display_name }}</span>
                <span class="profile-menu-handle">@{{ request.user.username }}</span>
              </div>
            </div>

            <div class="profile-menu-section" role="none">
              <span class="profile-menu-heading" role="presentation">Quick Actions</span>
              <a class="profile-menu-item" href="/user/u/{{ request.user.username }}/" role="menuitem">View Profile</a>
              <a class="profile-menu-item" href="/teams/" role="menuitem">My Teams</a>
              <a class="profile-menu-item" href="/dashboard/matches/" role="menuitem">My Matches</a>
            </div>

            <div class="profile-menu-section" role="none">
              <span class="profile-menu-heading" role="presentation">Account</span>
              <a class="profile-menu-item" href="/user/me/edit/" role="menuitem">Settings</a>
              <a class="profile-menu-item" href="/notifications/" role="menuitem">Notification Center</a>
            </div>

            <div class="profile-menu-section" role="none">
              <a class="profile-menu-item profile-menu-signout" href="/accounts/logout/" role="menuitem">Sign out</a>
            </div>
          </div>
        </div>
        {% endwith %}
      {% else %}
        <div class="nav-auth">
          <a class="nav-auth-link" href="/accounts/login/">Log in</a>
          <a class="nav-auth-cta" href="/accounts/signup/">Create account</a>
        </div>
      {% endif %}
    </div>
  </nav>

  {% include "partials/mobile_nav.html" %}
</header>
