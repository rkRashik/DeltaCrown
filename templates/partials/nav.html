{% load static nav_extras dc_avatar %}
<header class="site-nav" role="banner" data-site-nav>
  <nav class="nav-shell" aria-label="Primary">
    <div class="nav-left">
      {% nav_active '/' as is_home %}
      <a href="/" class="brand" aria-label="DeltaCrown Home"{% if is_home %} aria-current="page"{% endif %}>
        <span class="brand-logo-wrap">
          <svg class="brand-logo" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#5865F2"/>
                <stop offset="50%" style="stop-color:#7C3AED"/>
                <stop offset="100%" style="stop-color:#F59E0B"/>
              </linearGradient>
            </defs>
            <rect x="2" y="2" width="36" height="36" rx="10" fill="url(#logoGradient)" stroke="rgba(255,255,255,0.2)" stroke-width="0.5"/>
            <path d="M20 12L28 18L20 24L20 28L12 22L12 18L20 12Z" fill="white" opacity="0.9"/>
            <circle cx="20" cy="20" r="3" fill="white" opacity="0.7"/>
          </svg>
        </span>
        <span class="brand-wordmark">
          <img src="{% static 'siteui/svg/Logos/DeltaCrown_Teal-Purple-Gold.svg' %}" alt="DeltaCrown" class="brand-wordmark-img" />
        </span>
      </a>

      <button class="nav-icon-btn nav-mobile-toggle" type="button" data-open-drawer="main-drawer" aria-label="Open navigation menu" aria-controls="main-drawer" aria-expanded="false">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M4 6h16" />
          <path d="M4 12h16" />
          <path d="M4 18h16" />
        </svg>
      </button>
    </div>

    <div class="nav-center">
      <ul class="nav-links" role="list">
        {% nav_active '/tournaments/' '/tournaments' as tournaments_active %}
        <li class="nav-item">
          <a class="nav-link{% if tournaments_active %} is-active{% endif %}" href="/tournaments/"{% if tournaments_active %} aria-current="page"{% endif %}>
            <span>Tournaments</span>
          </a>
        </li>

        {% nav_active '/teams/' '/teams' as teams_active %}
        <li class="nav-item">
          <a class="nav-link{% if teams_active %} is-active{% endif %}" href="/teams/"{% if teams_active %} aria-current="page"{% endif %}>
            <span>Teams</span>
          </a>
        </li>

        {% if request.user.is_authenticated %}
          {% nav_active '/dashboard/' '/dashboard' as dashboard_active %}
          <li class="nav-item">
            <a class="nav-link{% if dashboard_active %} is-active{% endif %}" href="/dashboard/"{% if dashboard_active %} aria-current="page"{% endif %}>
              <span>Dashboard</span>
            </a>
          </li>
        {% endif %}

        {% nav_active '/community/' '/community' as community_active %}
        <li class="nav-item">
          <a class="nav-link{% if community_active %} is-active{% endif %}" href="/community/"{% if community_active %} aria-current="page"{% endif %}>
            <span>Community</span>
          </a>
        </li>

        {% nav_active '/watch/' '/arena' as arena_active %}
        <li class="nav-item">
          <a class="nav-link{% if arena_active %} is-active{% endif %}" href="/watch/"{% if arena_active %} aria-current="page"{% endif %}>
            <span>Arena</span>
            {% if nav_live %}
              <span class="live-badge" aria-label="Live content available">
                <span class="live-dot" aria-hidden="true"></span>
                <span>Live</span>
              </span>
            {% endif %}
          </a>
        </li>

        {% nav_active '/crowngear/' '/crownstore' as crownstore_active %}
        <li class="nav-item">
          <a class="nav-link{% if crownstore_active %} is-active{% endif %}" href="/crowngear/"{% if crownstore_active %} aria-current="page"{% endif %}>
            <span>CrownStore</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="nav-right">
      <div class="nav-actions" role="group" aria-label="Navigation actions">
        <label class="bb8-toggle">
          <input class="bb8-toggle__checkbox" type="checkbox" id="theme-toggle" data-theme-toggle>
          <div class="bb8-toggle__container">
            <div class="bb8-toggle__scenery">
              <div class="bb8-toggle__star"></div>
              <div class="bb8-toggle__star"></div>
              <div class="bb8-toggle__star"></div>
              <div class="bb8-toggle__star"></div>
              <div class="bb8-toggle__star"></div>
              <div class="bb8-toggle__star"></div>
              <div class="bb8-toggle__star"></div>
              <div class="tatto-1"></div>
              <div class="tatto-2"></div>
              <div class="gomrassen"></div>
              <div class="hermes"></div>
              <div class="chenini"></div>
              <div class="bb8-toggle__cloud"></div>
              <div class="bb8-toggle__cloud"></div>
              <div class="bb8-toggle__cloud"></div>
            </div>
            <div class="bb8">
              <div class="bb8__head-container">
                <div class="bb8__antenna"></div>
                <div class="bb8__antenna"></div>
                <div class="bb8__head"></div>
              </div>
              <div class="bb8__body"></div>
            </div>
            <div class="artificial__hidden">
              <div class="bb8__shadow"></div>
            </div>
          </div>
        </label>

        <div class="nav-dropdown">
          {% with nav_unread_count|default:0 as unread_count %}
          <button class="nav-icon-btn notif-trigger" type="button" data-menu-toggle aria-haspopup="true" aria-expanded="false" aria-controls="menu-notifications">
            <svg class="notif-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <defs>
                <linearGradient id="bellGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:currentColor"/>
                  <stop offset="100%" style="stop-color:currentColor" stop-opacity="0.7"/>
                </linearGradient>
              </defs>
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" stroke="url(#bellGradient)" fill="none"/>
              <path d="M13.73 21a2 2 0 0 1-3.46 0" stroke="currentColor" fill="none"/>
              <circle cx="18" cy="6" r="3" fill="var(--accent)" stroke="none" opacity="0.9"/>
            </svg>
            {% if unread_count|add:0 > 0 %}
              <span class="notif-badge" data-notif-badge data-has-unread="true">
                {{ unread_count }}
              </span>
            {% endif %}
          </button>
          {% endwith %}
          <div id="menu-notifications" class="dropdown-menu notifications-menu" hidden data-menu role="menu" aria-label="Notifications">
            <div class="dropdown-header">
              <h2 class="dropdown-title">Notifications</h2>
              <a class="dropdown-link" href="/notifications/">View all</a>
            </div>
            <ul class="dropdown-list" role="none">
              <li role="none">
                <a href="/notifications/" role="menuitem" class="dropdown-item">
                  <span class="item-title">New team invite</span>
                  <span class="item-meta">GhostFox Gaming wants you on the roster.</span>
                </a>
              </li>
              <li role="none">
                <a href="/notifications/" role="menuitem" class="dropdown-item">
                  <span class="item-title">Payout processed</span>
                  <span class="item-meta">Your CrownCup winnings have been sent.</span>
                </a>
              </li>
              <li role="none">
                <a href="/notifications/" role="menuitem" class="dropdown-item">
                  <span class="item-title">Match starting soon</span>
                  <span class="item-meta">Quarter-final kicks off in 15 minutes.</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      {% if request.user.is_authenticated %}
        {% user_avatar_url request.user '/static/img/user_avatar/default-avatar.png' as avatar_url %}
        {% with request.user.get_full_name|default:request.user.first_name|default:request.user.username as nav_display_name %}
        <div class="nav-profile">
          <button class="profile-trigger" type="button" data-avatar-toggle aria-haspopup="true" aria-expanded="false" aria-controls="menu-account">
            <span class="profile-avatar">
              <img src="{{ avatar_url }}" alt="" class="profile-avatar-img" />
              <span class="avatar-fallback" aria-hidden="true">{{ nav_display_name|slice:':1'|upper }}</span>
            </span>
            <span class="profile-label">
              <span class="profile-name">{{ nav_display_name }}</span>
            </span>
          </button>

          <div id="menu-account" class="dropdown-menu profile-menu" hidden data-avatar-menu role="menu" aria-label="Account">
            <div class="profile-menu-header">
              <span class="profile-menu-avatar">
                <img src="{{ avatar_url }}" alt="" />
              </span>
              <div class="profile-menu-meta">
                <span class="profile-menu-name">{{ nav_display_name }}</span>
                <span class="profile-menu-handle">@{{ request.user.username }}</span>
              </div>
            </div>

            <div class="profile-menu-section" role="none">
              <span class="profile-menu-heading" role="presentation">Quick Actions</span>
              <a class="profile-menu-item" href="/user/u/{{ request.user.username }}/" role="menuitem">View Profile</a>
              <a class="profile-menu-item" href="/teams/" role="menuitem">My Teams</a>
              <a class="profile-menu-item" href="/dashboard/matches/" role="menuitem">My Matches</a>
            </div>

            <div class="profile-menu-section" role="none">
              <span class="profile-menu-heading" role="presentation">Account</span>
              <a class="profile-menu-item" href="/user/me/edit/" role="menuitem">Settings</a>
              <a class="profile-menu-item" href="/notifications/" role="menuitem">Notification Center</a>
            </div>

            <div class="profile-menu-section" role="none">
              <a class="profile-menu-item profile-menu-signout" href="/accounts/logout/" role="menuitem">Sign out</a>
            </div>
          </div>
        </div>
        {% endwith %}
      {% else %}
        <div class="nav-auth">
          <a class="nav-auth-link" href="/accounts/login/">Log in</a>
          <a class="nav-auth-cta" href="/accounts/signup/">Create account</a>
        </div>
      {% endif %}
    </div>
  </nav>

  {% include "partials/mobile_nav.html" %}
</header>
