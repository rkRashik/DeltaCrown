{% load static nav_extras dc_avatar %}
<header class="site-nav" role="banner" data-site-nav>
  <nav class="nav-shell" aria-label="Primary">
    <div class="nav-left">
      {% nav_active '/' as is_home %}
      <a href="/" class="brand" aria-label="DeltaCrown Home"{% if is_home %} aria-current="page"{% endif %}>
        <span class="brand-logo-wrap">
          <svg class="brand-logo" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <!-- Animated gradient for crown -->
              <linearGradient id="crownGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:var(--accent)">
                  <animate attributeName="stop-color" 
                    values="var(--accent);rgba(126,58,237,0.9);var(--accent)" 
                    dur="3s" repeatCount="indefinite"/>
                </stop>
                <stop offset="50%" style="stop-color:rgba(126,58,237,0.8)">
                  <animate attributeName="stop-color" 
                    values="rgba(126,58,237,0.8);rgba(245,158,11,0.8);rgba(126,58,237,0.8)" 
                    dur="3s" repeatCount="indefinite"/>
                </stop>
                <stop offset="100%" style="stop-color:rgba(245,158,11,0.7)">
                  <animate attributeName="stop-color" 
                    values="rgba(245,158,11,0.7);var(--accent);rgba(245,158,11,0.7)" 
                    dur="3s" repeatCount="indefinite"/>
                </stop>
              </linearGradient>
              
              <!-- Glow effect gradient -->
              <radialGradient id="glowGradient" cx="50%" cy="50%" r="60%">
                <stop offset="0%" style="stop-color:var(--accent);stop-opacity:0.3"/>
                <stop offset="70%" style="stop-color:var(--accent);stop-opacity:0.1"/>
                <stop offset="100%" style="stop-color:transparent"/>
              </radialGradient>
              
              <!-- Inner detail gradient -->
              <linearGradient id="detailGradient" x1="30%" y1="20%" x2="70%" y2="80%">
                <stop offset="0%" style="stop-color:rgba(255,255,255,0.9)"/>
                <stop offset="50%" style="stop-color:rgba(255,255,255,0.6)"/>
                <stop offset="100%" style="stop-color:rgba(255,255,255,0.3)"/>
              </linearGradient>
              
              <!-- Drop shadow filter -->
              <filter id="dropShadow" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
                <feOffset dx="0" dy="2" result="offset"/>
                <feComponentTransfer>
                  <feFuncA type="linear" slope="0.3"/>
                </feComponentTransfer>
                <feMerge> 
                  <feMergeNode/>
                  <feMergeNode in="SourceGraphic"/> 
                </feMerge>
              </filter>
            </defs>
            
            <!-- Glow background -->
            <circle cx="24" cy="24" r="20" fill="url(#glowGradient)" opacity="0.8">
              <animate attributeName="r" values="18;22;18" dur="4s" repeatCount="indefinite"/>
              <animate attributeName="opacity" values="0.6;0.9;0.6" dur="4s" repeatCount="indefinite"/>
            </circle>
            
            <!-- Main crown structure -->
            <g filter="url(#dropShadow)">
              <!-- Crown base -->
              <rect x="8" y="32" width="32" height="4" rx="2" fill="url(#crownGradient)" opacity="0.9"/>
              
              <!-- Crown peaks -->
              <path d="M12 32L16 18L20 24L24 12L28 24L32 18L36 32Z" 
                    fill="url(#crownGradient)" opacity="0.95">
                <animateTransform attributeName="transform" 
                  type="scale" values="1;1.02;1" dur="3s" repeatCount="indefinite"/>
              </path>
              
              <!-- Crown jewels -->
              <circle cx="24" cy="16" r="3" fill="url(#detailGradient)">
                <animate attributeName="r" values="2.5;3.5;2.5" dur="2s" repeatCount="indefinite"/>
              </circle>
              <circle cx="18" cy="22" r="2" fill="url(#detailGradient)" opacity="0.8">
                <animate attributeName="r" values="1.5;2.5;1.5" dur="2.5s" repeatCount="indefinite"/>
              </circle>
              <circle cx="30" cy="22" r="2" fill="url(#detailGradient)" opacity="0.8">
                <animate attributeName="r" values="1.5;2.5;1.5" dur="2.3s" repeatCount="indefinite"/>
              </circle>
              
              <!-- Delta symbol in center -->
              <path d="M24 20L28 26L20 26Z" fill="rgba(255,255,255,0.9)" opacity="0.9">
                <animateTransform attributeName="transform" 
                  type="rotate" values="0 24 24;5 24 24;-5 24 24;0 24 24" 
                  dur="6s" repeatCount="indefinite"/>
              </path>
              
              <!-- Crown detail lines -->
              <line x1="16" y1="28" x2="16" y2="18" stroke="rgba(255,255,255,0.4)" stroke-width="1" opacity="0.7"/>
              <line x1="24" y1="28" x2="24" y2="12" stroke="rgba(255,255,255,0.4)" stroke-width="1" opacity="0.7"/>
              <line x1="32" y1="28" x2="32" y2="18" stroke="rgba(255,255,255,0.4)" stroke-width="1" opacity="0.7"/>
            </g>
            
            <!-- Sparkle effects -->
            <g opacity="0.8">
              <circle cx="14" cy="14" r="1" fill="rgba(255,255,255,0.9)">
                <animate attributeName="opacity" values="0;1;0" dur="1.5s" repeatCount="indefinite"/>
              </circle>
              <circle cx="34" cy="16" r="1" fill="rgba(255,255,255,0.9)">
                <animate attributeName="opacity" values="0;1;0" dur="2s" repeatCount="indefinite" begin="0.5s"/>
              </circle>
              <circle cx="38" cy="28" r="0.5" fill="rgba(255,255,255,0.9)">
                <animate attributeName="opacity" values="0;1;0" dur="1.8s" repeatCount="indefinite" begin="1s"/>
              </circle>
            </g>
          </svg>
        </span>
        <span class="brand-wordmark">
          <img src="{% static 'siteui/svg/Logos/DeltaCrown_Teal-Purple-Gold.svg' %}" alt="DeltaCrown" class="brand-wordmark-img" />
        </span>
      </a>

      <button class="nav-icon-btn nav-mobile-toggle" type="button" data-open-drawer="main-drawer" aria-label="Open navigation menu" aria-controls="main-drawer" aria-expanded="false">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M4 6h16" />
          <path d="M4 12h16" />
          <path d="M4 18h16" />
        </svg>
      </button>
    </div>

    <div class="nav-center">
      <ul class="nav-links" role="list">
        {% nav_active '/tournaments/' '/tournaments' as tournaments_active %}
        <li class="nav-item">
          <a class="nav-link{% if tournaments_active %} is-active{% endif %}" href="/tournaments/"{% if tournaments_active %} aria-current="page"{% endif %}>
            <span>Tournaments</span>
          </a>
        </li>

        {% nav_active '/teams/' '/teams' as teams_active %}
        <li class="nav-item">
          <a class="nav-link{% if teams_active %} is-active{% endif %}" href="/teams/"{% if teams_active %} aria-current="page"{% endif %}>
            <span>Teams</span>
          </a>
        </li>

        {% if request.user.is_authenticated %}
          {% nav_active '/dashboard/' '/dashboard' as dashboard_active %}
          <li class="nav-item">
            <a class="nav-link{% if dashboard_active %} is-active{% endif %}" href="/dashboard/"{% if dashboard_active %} aria-current="page"{% endif %}>
              <span>Dashboard</span>
            </a>
          </li>
        {% endif %}

        {% nav_active '/community/' '/community' as community_active %}
        <li class="nav-item">
          <a class="nav-link{% if community_active %} is-active{% endif %}" href="/community/"{% if community_active %} aria-current="page"{% endif %}>
            <span>Community</span>
          </a>
        </li>

        {% nav_active '/watch/' '/arena' as arena_active %}
        <li class="nav-item">
          <a class="nav-link{% if arena_active %} is-active{% endif %}" href="/watch/"{% if arena_active %} aria-current="page"{% endif %}>
            <span>Arena</span>
            {% if nav_live %}
              <span class="live-badge" aria-label="Live content available">
                <span class="live-dot" aria-hidden="true"></span>
                <span>Live</span>
              </span>
            {% endif %}
          </a>
        </li>

        {% nav_active '/crowngear/' '/crownstore' as crownstore_active %}
        <li class="nav-item">
          <a class="nav-link{% if crownstore_active %} is-active{% endif %}" href="/crowngear/"{% if crownstore_active %} aria-current="page"{% endif %}>
            <span>CrownStore</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="nav-right">
      <div class="nav-actions" role="group" aria-label="Navigation actions">

        <div class="nav-dropdown">
          {% with nav_unread_count|default:0 as unread_count %}
          <button class="nav-icon-btn notif-trigger" type="button" data-menu-toggle aria-haspopup="true" aria-expanded="false" aria-controls="menu-notifications">
            <svg class="notif-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <defs>
                <linearGradient id="bellGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:currentColor"/>
                  <stop offset="100%" style="stop-color:currentColor" stop-opacity="0.7"/>
                </linearGradient>
              </defs>
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" stroke="url(#bellGradient)" fill="none"/>
              <path d="M13.73 21a2 2 0 0 1-3.46 0" stroke="currentColor" fill="none"/>
              <circle cx="18" cy="6" r="2" fill="var(--accent)" stroke="none" opacity="0.9"/>
            </svg>
            {% if unread_count|add:0 > 0 %}
              <span class="notif-badge" data-notif-badge data-has-unread="true">
                {{ unread_count }}
              </span>
            {% endif %}
          </button>
          {% endwith %}
          <div id="menu-notifications" class="dropdown-menu notifications-menu" hidden data-menu role="menu" aria-label="Notifications">
            <div class="dropdown-header">
              <h2 class="dropdown-title">Notifications</h2>
              <a class="dropdown-link" href="/notifications/">View all</a>
            </div>
            <ul class="dropdown-list" role="none">
              <li role="none">
                <a href="/notifications/" role="menuitem" class="dropdown-item">
                  <span class="item-title">New team invite</span>
                  <span class="item-meta">GhostFox Gaming wants you on the roster.</span>
                </a>
              </li>
              <li role="none">
                <a href="/notifications/" role="menuitem" class="dropdown-item">
                  <span class="item-title">Payout processed</span>
                  <span class="item-meta">Your CrownCup winnings have been sent.</span>
                </a>
              </li>
              <li role="none">
                <a href="/notifications/" role="menuitem" class="dropdown-item">
                  <span class="item-title">Match starting soon</span>
                  <span class="item-meta">Quarter-final kicks off in 15 minutes.</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      {% if request.user.is_authenticated %}
        {% user_avatar_url request.user '/static/img/user_avatar/default-avatar.png' as avatar_url %}
        {% with request.user.get_full_name|default:request.user.first_name|default:request.user.username as nav_display_name %}
        <div class="nav-profile">
          <button class="profile-trigger" type="button" data-avatar-toggle aria-haspopup="true" aria-expanded="false" aria-controls="menu-account">
            <span class="profile-avatar">
              <img src="{{ avatar_url }}" alt="{{ nav_display_name }}" class="profile-avatar-img" />
              <span class="avatar-fallback" aria-hidden="true">{{ nav_display_name|slice:':1'|upper }}</span>
            </span>
          </button>

          <div id="menu-account" class="dropdown-menu profile-menu" hidden data-avatar-menu role="menu" aria-label="Account">
            <div class="profile-menu-header">
              <span class="profile-menu-avatar">
                <img src="{{ avatar_url }}" alt="" />
              </span>
              <div class="profile-menu-meta">
                <span class="profile-menu-name">{{ nav_display_name }}</span>
                <span class="profile-menu-handle">@{{ request.user.username }}</span>
              </div>
            </div>

            <div class="profile-menu-section" role="none">
              <span class="profile-menu-heading" role="presentation">Quick Actions</span>
              <a class="profile-menu-item" href="/user/u/{{ request.user.username }}/" role="menuitem">View Profile</a>
              <a class="profile-menu-item" href="/teams/" role="menuitem">My Teams</a>
              <a class="profile-menu-item" href="/dashboard/matches/" role="menuitem">My Matches</a>
            </div>

            <div class="profile-menu-section" role="none">
              <span class="profile-menu-heading" role="presentation">Account</span>
              <a class="profile-menu-item" href="/user/me/edit/" role="menuitem">Settings</a>
              <a class="profile-menu-item" href="/notifications/" role="menuitem">Notification Center</a>
              <label for="profile-theme-toggle" class="profile-menu-item profile-theme-toggle" role="menuitem" tabindex="0">
                <input type="checkbox" id="profile-theme-toggle" data-theme-toggle style="position: absolute; opacity: 0; pointer-events: none;" />
                <svg class="profile-theme-sun" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <circle cx="10" cy="10" r="4"/>
                  <path d="M10 1v2M10 17v2M3.22 3.22l1.42 1.42M15.36 15.36l1.42 1.42M1 10h2M17 10h2M3.22 16.78l1.42-1.42M15.36 4.64l1.42-1.42"/>
                </svg>
                <svg class="profile-theme-moon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <path d="M17 10.79A7 7 0 1 1 9.21 3 5 5 0 0 0 17 10.79Z"/>
                </svg>
                <span class="profile-theme-text">Switch Theme</span>
              </label>
            </div>

            <div class="profile-menu-section" role="none">
              <a class="profile-menu-item profile-menu-signout" href="/accounts/logout/" role="menuitem">Sign out</a>
            </div>
          </div>
        </div>
        {% endwith %}
      {% else %}
        <div class="nav-auth">
          <a class="nav-auth-link" href="/accounts/signup/">Sign up</a>
          <a class="nav-auth-cta" href="/accounts/login/">Sign in</a>
        </div>
      {% endif %}
    </div>
  </nav>

  {% include "partials/mobile_nav.html" %}
</header>
