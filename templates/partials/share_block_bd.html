{# templates/partials/share_block_bd.html #}
{# Inputs: title (string), url (absolute URL). Fallback to request.build_absolute_uri when url not passed. #}
{% load static %}
{% with share_title=title|default:"" share_url=url|default:request.build_absolute_uri %}
<div class="share-block" aria-label="Share options">
  <div class="share-label">Share:</div>
  <ul class="share-list" style="display:flex;gap:.5rem;list-style:none;padding-left:0;margin:0;align-items:center;">
    {# Facebook #}
    <li>
      <a class="btn-share btn-share--facebook"
         href="https://www.facebook.com/sharer/sharer.php?u={{ share_url|urlencode }}&t={{ share_title|urlencode }}"
         target="_blank" rel="noopener"
         aria-label="Share on Facebook">
        <span>Facebook</span>
      </a>
    </li>

    {# Instagram — no official web share; provide an obvious jump target.
       Tests expect the element id 'share-instagram'. #}
    <li>
      <a id="share-instagram"
         class="btn-share btn-share--instagram"
         href="https://www.instagram.com/?url={{ share_url|urlencode }}"
         target="_blank" rel="noopener"
         aria-label="Open Instagram">
        <span>Instagram</span>
      </a>
    </li>

    {# Discord — open the app; users paste the copied link in a channel/DM.
       Tests expect the element id 'share-discord'. #}
    <li>
      <a id="share-discord"
         class="btn-share btn-share--discord"
         href="https://discord.com/app"
         target="_blank" rel="noopener"
         aria-label="Open Discord">
        <span>Discord</span>
      </a>
    </li>

    {# WhatsApp (tests expect api.whatsapp.com/send?text=...) #}
    <li>
      <a class="btn-share btn-share--whatsapp"
         href="https://api.whatsapp.com/send?text={{ share_title|urlencode }}%20{{ share_url|urlencode }}"
         target="_blank" rel="noopener"
         aria-label="Share on WhatsApp">
        <span>WhatsApp</span>
      </a>
    </li>

    {# Copy Link (tests expect id='copy-share-link') #}
    <li>
      <button type="button"
              id="copy-share-link"
              class="btn-share btn-share--copy"
              data-share-url="{{ share_url }}"
              aria-label="Copy link">
        <span>Copy link</span>
      </button>
    </li>
  </ul>
</div>

<script>
(function () {
  var btn = document.getElementById('copy-share-link');
  if (!btn) return;
  btn.addEventListener('click', function () {
    var url = this.getAttribute('data-share-url') || window.location.href;
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(url).then(() => {
        btn.innerHTML = '<span>Copied!</span>';
        setTimeout(() => { btn.innerHTML = '<span>Copy link</span>'; }, 1500);
      }).catch(() => {
        window.prompt('Copy this link:', url);
      });
    } else {
      window.prompt('Copy this link:', url);
    }
  });
})();
</script>

<style>
  .btn-share { display:inline-flex; align-items:center; padding:.35rem .6rem; border-radius:.5rem; text-decoration:none; border:1px solid #e5e7eb; font-size:.875rem; }
  .btn-share:hover { background:#f9fafb; }
</style>
{% endwith %}
