{% extends "base.html" %}
{% load static %}

{% block title %}My Dashboard - {{ team.name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center gap-4 mb-4">
      <a href="{% url 'teams:detail' team.slug %}" class="text-cyan-400 hover:text-cyan-300 transition-colors">
        <i class="fas fa-arrow-left"></i> Back to Team
      </a>
    </div>
    <h1 class="text-4xl font-bold flex items-center gap-3 mb-2">
      <i class="fas fa-tachometer-alt text-cyan-400"></i>
      Personal Hub
    </h1>
    <p class="text-gray-400">{{ team.name }} - Your Performance Dashboard</p>
  </div>

  <!-- Player Role Badge -->
  <div class="card glass p-6 mb-6">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-cyan-500/20 to-blue-500/20 flex items-center justify-center border-2 border-cyan-500/30">
          {% if is_owner %}
            <i class="fas fa-crown text-yellow-400 text-2xl"></i>
          {% elif is_manager %}
            <i class="fas fa-user-tie text-blue-400 text-2xl"></i>
          {% elif is_coach %}
            <i class="fas fa-chalkboard-teacher text-green-400 text-2xl"></i>
          {% else %}
            <i class="fas fa-gamepad text-purple-400 text-2xl"></i>
          {% endif %}
        </div>
        <div>
          <div class="text-sm text-gray-400">Your Role</div>
          <div class="text-2xl font-bold">
            {% if is_owner %}
              Team Owner
            {% elif is_manager %}
              Team Manager
            {% elif is_coach %}
              Team Coach
            {% else %}
              Player
            {% endif %}
          </div>
        </div>
      </div>
      <div class="text-right">
        <div class="text-sm text-gray-400">Member Since</div>
        <div class="text-lg font-semibold">{{ membership.joined_at|date:"M d, Y" }}</div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
    <!-- Stats Overview -->
    <div class="lg:col-span-2">
      <div class="card glass p-6">
        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
          <i class="fas fa-chart-line text-cyan-400"></i>
          My Performance Stats
        </h2>
        
        {% if player_stats %}
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="p-4 rounded-lg bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border border-cyan-500/20">
            <div class="text-sm text-gray-400">Matches Played</div>
            <div class="text-3xl font-bold text-cyan-400">{{ player_stats.matches_played|default:0 }}</div>
          </div>
          <div class="p-4 rounded-lg bg-gradient-to-br from-green-500/10 to-emerald-500/10 border border-green-500/20">
            <div class="text-sm text-gray-400">Win Rate</div>
            <div class="text-3xl font-bold text-green-400">{{ player_stats.win_rate|default:"0" }}%</div>
          </div>
          <div class="p-4 rounded-lg bg-gradient-to-br from-purple-500/10 to-pink-500/10 border border-purple-500/20">
            <div class="text-sm text-gray-400">K/D Ratio</div>
            <div class="text-3xl font-bold text-purple-400">{{ player_stats.kd_ratio|default:"0.0" }}</div>
          </div>
          <div class="p-4 rounded-lg bg-gradient-to-br from-yellow-500/10 to-orange-500/10 border border-yellow-500/20">
            <div class="text-sm text-gray-400">MVP Awards</div>
            <div class="text-3xl font-bold text-yellow-400">{{ player_stats.mvp_count|default:0 }}</div>
          </div>
        </div>
        
        <div class="flex gap-3">
          <a href="{% url 'teams:player_analytics' membership.profile.id %}" class="btn btn-primary">
            <i class="fas fa-chart-bar"></i> Full Analytics
          </a>
          <a href="{% url 'teams:team_analytics' team.id %}" class="btn btn-secondary">
            <i class="fas fa-users"></i> Team Analytics
          </a>
        </div>
        {% else %}
        <div class="text-center py-12 text-gray-400">
          <i class="fas fa-chart-line text-6xl mb-4 opacity-30"></i>
          <p class="text-lg font-semibold mb-2">No Stats Yet</p>
          <p class="text-sm">Your performance stats will appear here once you start playing matches with the team.</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Quick Info -->
    <div class="space-y-6">
      <!-- Team Context -->
      <div class="card glass p-6">
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
          <i class="fas fa-users text-purple-400"></i>
          Team Info
        </h3>
        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-gray-400">Game</span>
            <span class="font-semibold">{{ team.get_game_display|default:"General" }}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">Members</span>
            <span class="font-semibold">{{ member_count }}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">Region</span>
            <span class="font-semibold">{{ team.region|default:"Global" }}</span>
          </div>
          {% if membership.player_role %}
          <div class="flex justify-between items-center">
            <span class="text-gray-400">Position</span>
            <span class="font-semibold">{{ membership.get_player_role_display }}</span>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card glass p-6">
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
          <i class="fas fa-bolt text-yellow-400"></i>
          Quick Actions
        </h3>
        <div class="space-y-2">
          <a href="{% url 'teams:player_settings' team.slug %}" class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-cyan-500/10 transition-colors">
            <i class="fas fa-cog text-gray-400"></i>
            <span>My Settings</span>
          </a>
          <a href="{% url 'teams:team_room' team.slug %}" class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-cyan-500/10 transition-colors">
            <i class="fas fa-comments text-cyan-400"></i>
            <span>Team Room</span>
          </a>
          <a href="{% url 'teams:collect_game_id' team.game %}" class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-cyan-500/10 transition-colors">
            <i class="fas fa-id-card text-purple-400"></i>
            <span>Update Game ID</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Matches -->
  <div class="card glass p-6 mb-6">
    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-history text-green-400"></i>
      Recent Matches
    </h2>
    
    {% if recent_matches %}
    <div class="space-y-3">
      {% for match in recent_matches %}
      <div class="p-4 rounded-lg bg-white/5 hover:bg-white/10 transition-colors flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-lg {% if match.result == 'win' %}bg-green-500/20{% elif match.result == 'loss' %}bg-red-500/20{% else %}bg-gray-500/20{% endif %} flex items-center justify-center">
            {% if match.result == 'win' %}
              <i class="fas fa-trophy text-green-400 text-xl"></i>
            {% elif match.result == 'loss' %}
              <i class="fas fa-times text-red-400 text-xl"></i>
            {% else %}
              <i class="fas fa-minus text-gray-400 text-xl"></i>
            {% endif %}
          </div>
          <div>
            <div class="font-semibold">
              {% if match.tournament %}
                {{ match.tournament.name }}
              {% else %}
                Practice Match
              {% endif %}
            </div>
            <div class="text-sm text-gray-400">{{ match.match_date|date:"M d, Y" }}</div>
          </div>
        </div>
        <div class="text-right">
          <div class="text-lg font-bold">
            {% if match.result == 'win' %}
              <span class="text-green-400">Victory</span>
            {% elif match.result == 'loss' %}
              <span class="text-red-400">Defeat</span>
            {% else %}
              <span class="text-gray-400">Draw</span>
            {% endif %}
          </div>
          <div class="text-sm text-gray-400">{{ match.score|default:"--" }}</div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12 text-gray-400">
      <i class="fas fa-gamepad text-6xl mb-4 opacity-30"></i>
      <p class="text-lg font-semibold mb-2">No Matches Yet</p>
      <p class="text-sm">Your match history will appear here once the team starts competing.</p>
    </div>
    {% endif %}
  </div>

  <!-- Upcoming Schedule -->
  {% if upcoming_matches %}
  <div class="card glass p-6">
    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-calendar-alt text-yellow-400"></i>
      Upcoming Tournaments
    </h2>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      {% for registration in upcoming_matches %}
      <div class="p-4 rounded-lg bg-gradient-to-br from-yellow-500/10 to-orange-500/10 border border-yellow-500/20">
        <div class="font-semibold mb-2">{{ registration.tournament.name }}</div>
        <div class="text-sm text-gray-400 mb-3">
          Starts {{ registration.tournament.start_date|date:"M d" }}
        </div>
        <a href="{% url 'teams:team_tournaments' team.slug %}" class="text-cyan-400 hover:text-cyan-300 text-sm">
          View Details <i class="fas fa-arrow-right ml-1"></i>
        </a>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}
</div>

<style>
.card.glass {
  background: rgba(15, 23, 42, 0.7);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
}

.card.glass:hover {
  border-color: rgba(6, 182, 212, 0.3);
}
</style>
{% endblock %}
