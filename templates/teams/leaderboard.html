{% extends "base.html" %}
{% load static %}

{% block title %}{{ selected_game|upper }} Leaderboard{% endblock %}

{% block content %}
<div class="container py-4">
    <h1>🏆 {{ selected_game|upper }} Leaderboard</h1>
    
    <div class="d-flex justify-content-between align-items-center my-4">
        <div>
            <select id="gameSelector" class="form-select" style="width: 200px;">
                {% for game in available_games %}
                <option value="{{ game }}" {% if game == selected_game %}selected{% endif %}>
                    {{ game|upper }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div>
            <a href="?game={{ selected_game }}&type=teams" class="btn btn-primary {% if leaderboard_type == 'teams' %}active{% endif %}">
                Teams
            </a>
            <a href="?game={{ selected_game }}&type=players" class="btn btn-primary {% if leaderboard_type == 'players' %}active{% endif %}">
                Players
            </a>
        </div>
        <div>
            <a href="{% url 'teams:export_leaderboard' %}?game={{ selected_game }}&type={{ leaderboard_type }}" 
               class="btn btn-success">
                📥 Export CSV
            </a>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            {% if leaderboard_type == 'teams' %}
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Team</th>
                        <th>Points</th>
                        <th>Win Rate</th>
                        <th>Matches</th>
                        <th>Streak</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in leaderboard %}
                    <tr>
                        <td>
                            {% if entry.rank == 1 %}🥇
                            {% elif entry.rank == 2 %}🥈
                            {% elif entry.rank == 3 %}🥉
                            {% else %}{{ entry.rank }}
                            {% endif %}
                        </td>
                        <td><strong>{{ entry.team_name }}</strong></td>
                        <td>{{ entry.total_points }}</td>
                        <td>{{ entry.win_rate|floatformat:1 }}%</td>
                        <td>{{ entry.total_matches }}</td>
                        <td>
                            {% if entry.current_streak > 0 %}
                                <span class="text-success">+{{ entry.current_streak }}</span>
                            {% elif entry.current_streak < 0 %}
                                <span class="text-danger">{{ entry.current_streak }}</span>
                            {% else %}
                                —
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Team</th>
                        <th>Contribution</th>
                        <th>MVP</th>
                        <th>Matches</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in leaderboard %}
                    <tr>
                        <td>
                            {% if entry.rank == 1 %}🥇
                            {% elif entry.rank == 2 %}🥈
                            {% elif entry.rank == 3 %}🥉
                            {% else %}{{ entry.rank }}
                            {% endif %}
                        </td>
                        <td><strong>{{ entry.player_name }}</strong></td>
                        <td>{{ entry.team_name }}</td>
                        <td>{{ entry.contribution_score|floatformat:2 }}</td>
                        <td>{{ entry.mvp_count }}</td>
                        <td>{{ entry.matches_played }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.getElementById('gameSelector').addEventListener('change', function() {
        const type = '{{ leaderboard_type }}';
        window.location.href = `?game=${this.value}&type=${type}`;
    });
</script>
{% endblock %}
