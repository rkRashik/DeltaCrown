{% extends "base.html" %}
{% block title %}Teams — DeltaCrown{% endblock %}

{% block content %}
{% meta_tags title="Teams — DeltaCrown" description="Browse teams, view rosters, and find your next squad." %}

<section aria-labelledby="h1" data-testid="teams-index">
  <header class="d-flex align-items-center justify-content-between">
    <div>
      <h1 class="mb-3">Teams</h1>
      <p class="text-muted mb-0">Browse rosters and discover squads to compete with.</p>
    </div>
    <div class="d-flex gap-2">
      <!-- Safer literal path for now; won’t break template rendering if URL name differs -->
      <a class="btn btn-primary" href="/teams/create/">Create Team</a>
    </div>
  </header>

  <!-- Optional filter/search (non-functional shell; wire later if view supports it) -->
  <form class="card p-3 mb-3" method="get" action="">
    <div class="form-field">
      <label class="label" for="q">Search teams</label>
      <input id="q" name="q" value="{{ request.GET.q }}" placeholder="Team name or tag" />
      <div class="help">Press Enter to search</div>
    </div>
  </form>

  {% if teams or object_list %}
    {% with items=teams|default:object_list %}
      {% if items %}
        <div class="d-flex flex-wrap g-3">
          {% for team in items %}
            {% with href=team.get_absolute_url|default:'/teams/'|add:team.tag|default:''|add:'/' %}
            <article class="card p-3" style="flex:1 1 320px;min-width:280px">
              <div class="fw-medium mb-1">
                <a href="{{ href }}">{{ team.name|default:team.tag|default:"Team" }}</a>
              </div>
              <div class="text-muted mb-2">
                <span class="badge">{{ team.tag|default:"—" }}</span>
              </div>
              <div class="mb-2">
                Members:
                {% if team.members_count %}{{ team.members_count }}
                {% elif team.members %}{{ team.members.count }}
                {% else %}—{% endif %}
              </div>
              {% if team.created_at %}
                <div class="text-muted mb-2">Created {{ team.created_at|date:"M d, Y" }}</div>
              {% endif %}
              <div class="d-flex gap-2">
                <a class="btn btn-outline btn-sm" href="{{ href }}">View</a>
              </div>
            </article>
            {% endwith %}
          {% endfor %}
        </div>
      {% else %}
        <article class="card p-3">
          <div class="fw-medium mb-1">No teams found.</div>
          <p class="mb-0 text-muted">Be the first—create your team and invite your friends.</p>
        </article>
      {% endif %}
    {% endwith %}
  {% else %}
    <article class="card p-3">
      <div class="fw-medium mb-1">No teams found.</div>
      <p class="mb-0 text-muted">Try adjusting your search or come back later.</p>
    </article>
  {% endif %}

  <div class="mt-3">
    {% include "partials/pagination.html" %}
  </div>
</section>
{% endblock %}
