{% extends "base.html" %}
{% load static %}

{% block title %}Create Your Esports Team | DeltaCrown{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'teams/css/team-create-esports.css' %}?v=2.1">
{% endblock %}

{% block content %}
<div class="esports-create-page">
    <!-- Animated Background -->
    <div class="esports-bg">
        <div class="grid-overlay"></div>
        <div class="gradient-orb orb-1"></div>
        <div class="gradient-orb orb-2"></div>
        <div class="gradient-orb orb-3"></div>
        <div class="scan-line"></div>
    </div>

    <!-- Hero Header -->
    <section class="hero-section">
        <div class="hero-content">
            <div class="hero-badge">
                <i class="fas fa-shield-alt"></i>
                <span>Team Creation</span>
            </div>
            <h1 class="hero-title">
                <span class="title-line">Build Your</span>
                <span class="title-line gradient-text">Esports Dynasty</span>
            </h1>
            <p class="hero-subtitle">Create a professional team, recruit top players, and dominate the competition</p>
            
            <!-- Progress Steps -->
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <div class="step-circle">1</div>
                    <span class="step-label">Identity</span>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="2">
                    <div class="step-circle">2</div>
                    <span class="step-label">Game & Region</span>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="3">
                    <div class="step-circle">3</div>
                    <span class="step-label">Branding</span>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="4">
                    <div class="step-circle">4</div>
                    <span class="step-label">Roster</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Form Container -->
    <div class="form-container">
        <form method="post" enctype="multipart/form-data" id="team-create-form" novalidate>
            {% csrf_token %}
            
            <!-- Form Errors Display (Always show on POST with errors) -->
            {% if form.errors or form.non_field_errors or request.method == 'POST' and not form.is_valid %}
            <div class="error-banner">
                <div class="error-banner-content">
                    <div class="error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="error-text">
                        <h3>Please Correct the Following Errors:</h3>
                        <ul class="error-list">
                            {% if form.non_field_errors %}
                                {% for error in form.non_field_errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            {% endif %}
                            {% for field in form %}
                                {% if field.errors %}
                                    {% for error in field.errors %}
                                        <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                        </ul>
                        
                        {% if form.game.errors %}
                        <div class="error-help">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>Already in a team for this game?</strong><br>
                                You can only be in one team per game. To create a new team, you'll need to:
                                <ul>
                                    <li>Leave your current team first, OR</li>
                                    <li>Choose a different game for this team</li>
                                </ul>
                                <a href="{% url 'teams:list' %}" class="btn-view-teams">View My Teams</a>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Step 1: Team Identity -->
            <div class="form-step active" data-step="1">
                <div class="step-card">
                    <div class="card-header">
                        <div class="header-icon">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div class="header-text">
                            <h2>Team Identity</h2>
                            <p>Choose your team's name and identity</p>
                        </div>
                    </div>

                    <div class="card-body">
                        <!-- Team Name -->
                        <div class="form-field">
                            <label class="field-label">
                                <i class="fas fa-flag"></i>
                                Team Name
                                <span class="required">*</span>
                            </label>
                            <div class="input-wrapper">
                                <input 
                                    type="text" 
                                    name="name" 
                                    id="id_name" 
                                    class="esports-input" 
                                    placeholder="Enter your team name"
                                    required
                                    minlength="3"
                                    maxlength="50"
                                    value="{{ form.name.value|default:'' }}"
                                    autocomplete="off">
                                <div class="input-status" id="name-status">
                                    <i class="fas fa-circle-notch fa-spin"></i>
                                </div>
                            </div>
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                Choose a unique, memorable name (3-50 characters)
                            </div>
                            <div class="field-error" id="name-error"></div>
                        </div>

                        <!-- Team Tag -->
                        <div class="form-field">
                            <label class="field-label">
                                <i class="fas fa-tag"></i>
                                Team Tag
                                <span class="required">*</span>
                            </label>
                            <div class="input-wrapper">
                                <input 
                                    type="text" 
                                    name="tag" 
                                    id="id_tag" 
                                    class="esports-input tag-input" 
                                    placeholder="TL" 
                                    required
                                    minlength="2"
                                    maxlength="10"
                                    value="{{ form.tag.value|default:'' }}"
                                    autocomplete="off">
                                <div class="input-status" id="tag-status">
                                    <i class="fas fa-circle-notch fa-spin"></i>
                                </div>
                            </div>
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                Short tag for your team (2-10 characters, e.g., G2, TL, LOUD)
                            </div>
                            <div class="field-error" id="tag-error"></div>
                        </div>

                        <!-- Tagline -->
                        <div class="form-field">
                            <label class="field-label">
                                <i class="fas fa-quote-left"></i>
                                Team Motto
                            </label>
                            <input 
                                type="text" 
                                name="tagline" 
                                id="id_tagline" 
                                class="esports-input" 
                                placeholder="Rise Above. Never Back Down." 
                                maxlength="200"
                                value="{{ form.tagline.value|default:'' }}">
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                A powerful slogan that defines your team's spirit
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="form-field">
                            <label class="field-label">
                                <i class="fas fa-align-left"></i>
                                Team Description
                            </label>
                            <textarea 
                                name="description" 
                                id="id_description" 
                                class="esports-textarea" 
                                placeholder="Tell the world about your team, your goals, and what makes you special..."
                                maxlength="500"
                                rows="4">{{ form.description.value|default:'' }}</textarea>
                            <div class="char-counter">
                                <span id="desc-count">0</span>/500
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <button type="button" class="btn-esports btn-next" data-next="2">
                            Next Step
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Game & Region -->
            <div class="form-step" data-step="2">
                <div class="step-card">
                    <div class="card-header">
                        <div class="header-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <div class="header-text">
                            <h2>Game & Region</h2>
                            <p>Select your competitive game and region</p>
                        </div>
                    </div>

                    <div class="card-body">
                        <!-- Game Selection -->
                        <div class="form-field">
                            <label class="field-label">
                                <i class="fas fa-trophy"></i>
                                Competitive Game
                                <span class="required">*</span>
                            </label>
                            <div class="game-grid-modern">
                                {% load static %}
                                {% for value, label in form.game.field.choices %}
                                    {% if value %}
                                    <div class="game-card-modern" data-game="{{ value }}">
                                        <input 
                                            type="radio" 
                                            name="game" 
                                            id="game-{{ value }}" 
                                            value="{{ value }}"
                                            {% if form.game.value == value %}checked{% endif %}
                                            required>
                                        <label for="game-{{ value }}">
                                            <div class="game-card-content">
                                                <div class="game-logo-wrapper">
                                                    {% if value == 'VALORANT' %}
                                                        <img src="{% static 'img/game_cards/Valorant.jpg' %}" alt="Valorant" class="game-logo">
                                                    {% elif value == 'CS2' %}
                                                        <img src="{% static 'img/game_cards/CS2.jpg' %}" alt="CS2" class="game-logo">
                                                    {% elif value == 'DOTA2' %}
                                                        <img src="{% static 'img/game_cards/Dota2.jpg' %}" alt="Dota 2" class="game-logo">
                                                    {% elif value == 'EFOOTBALL' %}
                                                        <img src="{% static 'img/game_cards/efootball.jpeg' %}" alt="eFootball" class="game-logo">
                                                    {% elif value == 'FC26' %}
                                                        <img src="{% static 'img/game_cards/FC26.jpg' %}" alt="FC26" class="game-logo">
                                                    {% elif value == 'MLBB' %}
                                                        <img src="{% static 'img/game_cards/MobileLegend.jpg' %}" alt="Mobile Legends" class="game-logo">
                                                    {% elif value == 'CODM' %}
                                                        <img src="{% static 'img/game_cards/CallOfDutyMobile.jpg' %}" alt="COD Mobile" class="game-logo">
                                                    {% elif value == 'FREEFIRE' %}
                                                        <img src="{% static 'img/game_cards/FreeFire.jpeg' %}" alt="Free Fire" class="game-logo">
                                                    {% elif value == 'PUBG' %}
                                                        <img src="{% static 'img/game_cards/PUBG.jpeg' %}" alt="PUBG" class="game-logo">
                                                    {% else %}
                                                        <div class="game-icon-fallback">
                                                            <i class="fas fa-gamepad"></i>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                                <div class="game-info">
                                                    <span class="game-name-modern">{{ label }}</span>
                                                    <span class="game-platform">
                                                        {% if value == 'VALORANT' or value == 'CS2' or value == 'DOTA2' %}
                                                            <i class="fas fa-desktop"></i> PC
                                                        {% elif value == 'MLBB' or value == 'CODM' or value == 'FREEFIRE' or value == 'PUBG' %}
                                                            <i class="fas fa-mobile-alt"></i> Mobile
                                                        {% else %}
                                                            <i class="fas fa-gamepad"></i> Multi-Platform
                                                        {% endif %}
                                                    </span>
                                                </div>
                                                <div class="game-check-modern">
                                                    <i class="fas fa-check-circle"></i>
                                                </div>
                                            </div>
                                            <div class="game-card-glow"></div>
                                        </label>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <div class="field-error" id="game-error"></div>
                        </div>

                        <!-- Region Selection -->
                        <div class="form-field">
                            <label class="field-label">
                                <i class="fas fa-globe"></i>
                                Primary Region
                                <span class="required">*</span>
                            </label>
                            <div class="region-grid-modern">
                                {% for value, label in form.region.field.choices %}
                                    {% if value %}
                                    <div class="region-card-modern">
                                        <input 
                                            type="radio" 
                                            name="region" 
                                            id="region-{{ value }}" 
                                            value="{{ value }}"
                                            {% if form.region.value == value %}checked{% endif %}
                                            required>
                                        <label for="region-{{ value }}">
                                            <div class="region-icon-wrapper">
                                                <i class="fas fa-map-marker-alt"></i>
                                            </div>
                                            <span class="region-name-modern">{{ label }}</span>
                                            <div class="region-check-modern">
                                                <i class="fas fa-check"></i>
                                            </div>
                                            <div class="region-card-shine"></div>
                                        </label>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <div class="field-error" id="region-error"></div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <button type="button" class="btn-esports btn-secondary btn-prev" data-prev="1">
                            <i class="fas fa-arrow-left"></i>
                            Previous
                        </button>
                        <button type="button" class="btn-esports btn-next" data-next="3">
                            Next Step
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Team Branding -->
            <div class="form-step" data-step="3">
                <div class="step-card">
                    <div class="card-header">
                        <div class="header-icon">
                            <i class="fas fa-palette"></i>
                        </div>
                        <div class="header-text">
                            <h2>Team Branding</h2>
                            <p>Create a visual identity for your team</p>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="branding-grid">
                            <!-- Logo Upload -->
                            <div class="upload-card">
                                <div class="upload-header">
                                    <i class="fas fa-shield-alt"></i>
                                    <h3>Team Logo</h3>
                                </div>
                                <div class="upload-zone" id="logo-zone">
                                    <input type="file" name="logo" id="id_logo" accept="image/*" hidden>
                                    <div class="upload-placeholder">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Drag & drop or click</p>
                                        <span>Square · Max 10MB</span>
                                    </div>
                                    <div class="upload-preview" id="logo-preview"></div>
                                </div>
                                <div class="upload-actions">
                                    <button type="button" class="btn-upload" data-target="id_logo">
                                        <i class="fas fa-upload"></i>
                                        Choose File
                                    </button>
                                    <button type="button" class="btn-clear" data-clear="logo" style="display: none;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Banner Upload -->
                            <div class="upload-card">
                                <div class="upload-header">
                                    <i class="fas fa-panorama"></i>
                                    <h3>Team Banner</h3>
                                </div>
                                <div class="upload-zone" id="banner-zone">
                                    <input type="file" name="banner_image" id="id_banner_image" accept="image/*" hidden>
                                    <div class="upload-placeholder">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Drag & drop or click</p>
                                        <span>16:9 · Max 10MB</span>
                                    </div>
                                    <div class="upload-preview" id="banner-preview"></div>
                                </div>
                                <div class="upload-actions">
                                    <button type="button" class="btn-upload" data-target="id_banner_image">
                                        <i class="fas fa-upload"></i>
                                        Choose File
                                    </button>
                                    <button type="button" class="btn-clear" data-clear="banner" style="display: none;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="branding-tips">
                            <div class="tip-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Use high-quality images for best results</span>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Logo should be square (512x512px recommended)</span>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Banner should be 16:9 ratio (1920x1080px recommended)</span>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <button type="button" class="btn-esports btn-secondary btn-prev" data-prev="2">
                            <i class="fas fa-arrow-left"></i>
                            Previous
                        </button>
                        <button type="button" class="btn-esports btn-next" data-next="4">
                            Next Step
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Roster -->
            <div class="form-step" data-step="4">
                <div class="step-card">
                    <div class="card-header">
                        <div class="header-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="header-text">
                            <h2>Build Your Roster</h2>
                            <p>Invite players to join your team (optional)</p>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="roster-info">
                            <i class="fas fa-info-circle"></i>
                            <p>You can add team members now or later from your team dashboard. Invited members will receive notifications.</p>
                        </div>

                        <div id="roster-container">
                            <!-- Dynamic roster invites -->
                        </div>

                        <button type="button" class="btn-add-member" id="add-member-btn">
                            <i class="fas fa-plus-circle"></i>
                            <span>Add Team Member</span>
                        </button>

                        <!-- Hidden data -->
                        <input type="hidden" name="roster_data" id="roster_data" value="[]">
                    </div>

                    <div class="card-footer">
                        <button type="button" class="btn-esports btn-secondary btn-prev" data-prev="3">
                            <i class="fas fa-arrow-left"></i>
                            Previous
                        </button>
                        <button type="submit" class="btn-esports btn-primary btn-submit">
                            <i class="fas fa-rocket"></i>
                            Create Team
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
        </div>
        <p class="loading-text">Creating your esports team...</p>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>
    
    <!-- Confirmation Modal -->
    <div class="confirmation-modal" id="confirmation-modal">
        <div class="confirmation-overlay" id="modal-overlay"></div>
        <div class="confirmation-content">
            <!-- Header -->
            <div class="confirmation-header">
                <div class="confirmation-icon-large">
                    <i class="fas fa-users"></i>
                </div>
                <h2 class="confirmation-title">Ready to Create Your Team?</h2>
                <p class="confirmation-subtitle">Review your team profile before making it official</p>
            </div>
            
            <!-- Team Preview Card -->
            <div class="team-preview-card" id="team-preview">
                <div class="team-preview-banner" id="preview-banner">
                    <div class="team-preview-logo" id="preview-logo">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                </div>
                <div class="team-preview-body">
                    <div class="team-preview-header">
                        <h3 class="team-preview-name" id="preview-name">Team Name</h3>
                        <span class="team-preview-tag" id="preview-tag">[TAG]</span>
                    </div>
                    <p class="team-preview-tagline" id="preview-tagline">Team tagline goes here</p>
                    
                    <div class="team-preview-details">
                        <div class="preview-detail-item">
                            <i class="fas fa-gamepad"></i>
                            <span id="preview-game">Game</span>
                        </div>
                        <div class="preview-detail-item">
                            <i class="fas fa-globe"></i>
                            <span id="preview-region">Region</span>
                        </div>
                        <div class="preview-detail-item">
                            <i class="fas fa-users"></i>
                            <span id="preview-roster">0 members</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="confirmation-note">
                <i class="fas fa-info-circle"></i>
                <span>Your team will be visible to other players and can participate in tournaments</span>
            </div>
            
            <!-- Actions -->
            <div class="confirmation-actions">
                <button type="button" class="btn-cancel" id="cancel-confirm">
                    <i class="fas fa-arrow-left"></i>
                    <span>Go Back</span>
                </button>
                <button type="button" class="btn-confirm" id="confirm-submit">
                    <i class="fas fa-check-circle"></i>
                    <span>Create Team</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Member Invite Template -->
<template id="member-template">
    <div class="member-card">
        <div class="member-header">
            <i class="fas fa-user-circle"></i>
            <span class="member-number">Member #1</span>
            <button type="button" class="btn-remove-member">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="member-body">
            <div class="member-field">
                <label>Username or Email</label>
                <input type="text" class="member-identifier" placeholder="player123 or email@example.com">
            </div>
            <div class="member-field">
                <label>Role</label>
                <select class="member-role">
                    <option value="PLAYER">Player</option>
                    <option value="SUBSTITUTE">Substitute</option>
                    <option value="COACH">Coach</option>
                    <option value="MANAGER">Manager</option>
                </select>
            </div>
        </div>
    </div>
</template>
{% endblock %}

{% block extra_js %}
<script src="{% static 'teams/js/team-create-esports.js' %}?v=2.1"></script>
{% endblock %}
