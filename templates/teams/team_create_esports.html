{% extends "base.html" %}
{% load static %}

{% block title %}Create Your Esports Team | DeltaCrown{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'teams/css/team-create-esports.css' %}?v=1.0">
{% endblock %}

{% block content %}
<div class="esports-create-page">
    <!-- Animated Background -->
    <div class="esports-bg">
        <div class="grid-overlay"></div>
        <div class="gradient-orb orb-1"></div>
        <div class="gradient-orb orb-2"></div>
        <div class="gradient-orb orb-3"></div>
        <div class="scan-line"></div>
    </div>

    <!-- Hero Header -->
    <section class="hero-section">
        <div class="hero-content">
            <div class="hero-badge">
                <i class="fas fa-shield-alt"></i>
                <span>Team Creation</span>
            </div>
            <h1 class="hero-title">
                <span class="title-line">Build Your</span>
                <span class="title-line gradient-text">Esports Dynasty</span>
            </h1>
            <p class="hero-subtitle">Create a professional team, recruit top players, and dominate the competition</p>
            
            <!-- Progress Steps -->
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <div class="step-circle">1</div>
                    <span class="step-label">Identity</span>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="2">
                    <div class="step-circle">2</div>
                    <span class="step-label">Game & Region</span>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="3">
                    <div class="step-circle">3</div>
                    <span class="step-label">Branding</span>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="4">
                    <div class="step-circle">4</div>
                    <span class="step-label">Roster</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Form Container -->
    <div class="form-container">
        <form method="post" enctype="multipart/form-data" id="esports-team-form" novalidate>
            {% csrf_token %}

            <!-- Step 1: Team Identity -->
            <div class="form-step active" data-step="1">
                <div class="step-card">
                    <div class="card-header">
                        <div class="header-icon">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div class="header-text">
                            <h2>Team Identity</h2>
                            <p>Choose your team's name and identity</p>
                        </div>
                    </div>

                    <div class="card-body">
                        <!-- Team Name -->
                        <div class="form-field">
                            <label class="field-label">
                                <i class="fas fa-flag"></i>
                                Team Name
                                <span class="required">*</span>
                            </label>
                            <div class="input-wrapper">
                                <input 
                                    type="text" 
                                    name="name" 
                                    id="id_name" 
                                    class="esports-input" 
                                    placeholder="Enter your team name"
                                    required
                                    minlength="3"
                                    maxlength="50"
                                    value="{{ form.name.value|default:'' }}"
                                    autocomplete="off">
                                <div class="input-status" id="name-status">
                                    <i class="fas fa-circle-notch fa-spin"></i>
                                </div>
                            </div>
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                Choose a unique, memorable name (3-50 characters)
                            </div>
                            <div class="field-error" id="name-error"></div>
                        </div>

                        <!-- Team Tag -->
                        <div class="form-field">
                            <label class="field-label">
                                <i class="fas fa-tag"></i>
                                Team Tag
                                <span class="required">*</span>
                            </label>
                            <div class="input-wrapper">
                                <input 
                                    type="text" 
                                    name="tag" 
                                    id="id_tag" 
                                    class="esports-input tag-input" 
                                    placeholder="TL" 
                                    required
                                    minlength="2"
                                    maxlength="10"
                                    value="{{ form.tag.value|default:'' }}"
                                    autocomplete="off">
                                <div class="input-status" id="tag-status">
                                    <i class="fas fa-circle-notch fa-spin"></i>
                                </div>
                            </div>
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                Short tag for your team (2-10 characters, e.g., G2, TL, LOUD)
                            </div>
                            <div class="field-error" id="tag-error"></div>
                        </div>

                        <!-- Tagline -->
                        <div class="form-field">
                            <label class="field-label">
                                <i class="fas fa-quote-left"></i>
                                Team Motto
                            </label>
                            <input 
                                type="text" 
                                name="tagline" 
                                id="id_tagline" 
                                class="esports-input" 
                                placeholder="Rise Above. Never Back Down." 
                                maxlength="200"
                                value="{{ form.tagline.value|default:'' }}">
                            <div class="field-hint">
                                <i class="fas fa-info-circle"></i>
                                A powerful slogan that defines your team's spirit
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="form-field">
                            <label class="field-label">
                                <i class="fas fa-align-left"></i>
                                Team Description
                            </label>
                            <textarea 
                                name="description" 
                                id="id_description" 
                                class="esports-textarea" 
                                placeholder="Tell the world about your team, your goals, and what makes you special..."
                                maxlength="500"
                                rows="4">{{ form.description.value|default:'' }}</textarea>
                            <div class="char-counter">
                                <span id="desc-count">0</span>/500
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <button type="button" class="btn-esports btn-next" data-next="2">
                            Next Step
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Game & Region -->
            <div class="form-step" data-step="2">
                <div class="step-card">
                    <div class="card-header">
                        <div class="header-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <div class="header-text">
                            <h2>Game & Region</h2>
                            <p>Select your competitive game and region</p>
                        </div>
                    </div>

                    <div class="card-body">
                        <!-- Game Selection -->
                        <div class="form-field">
                            <label class="field-label">
                                <i class="fas fa-trophy"></i>
                                Competitive Game
                                <span class="required">*</span>
                            </label>
                            <div class="game-grid">
                                {% for value, label in form.game.field.choices %}
                                    {% if value %}
                                    <div class="game-option" data-game="{{ value }}">
                                        <input 
                                            type="radio" 
                                            name="game" 
                                            id="game-{{ value }}" 
                                            value="{{ value }}"
                                            {% if form.game.value == value %}checked{% endif %}
                                            required>
                                        <label for="game-{{ value }}">
                                            <div class="game-icon">
                                                {% if value == 'VALORANT' %}
                                                    <img src="{% static 'img/game_cards/Valorant.jpg' %}" alt="{{ label }}">
                                                {% elif value == 'CS2' %}
                                                    <img src="{% static 'img/game_cards/CS2.jpg' %}" alt="{{ label }}">
                                                {% elif value == 'DOTA2' %}
                                                    <img src="{% static 'img/game_cards/Dota2.jpg' %}" alt="{{ label }}">
                                                {% elif value == 'MLBB' %}
                                                    <img src="{% static 'img/game_cards/MobileLegend.jpg' %}" alt="{{ label }}">
                                                {% elif value == 'PUBG' %}
                                                    <img src="{% static 'img/game_cards/PUBG.jpeg' %}" alt="{{ label }}">
                                                {% elif value == 'FREEFIRE' %}
                                                    <img src="{% static 'img/game_cards/FreeFire.jpeg' %}" alt="{{ label }}">
                                                {% elif value == 'EFOOTBALL' %}
                                                    <img src="{% static 'img/game_cards/efootball.jpeg' %}" alt="{{ label }}">
                                                {% elif value == 'FC26' %}
                                                    <img src="{% static 'img/game_cards/FC26.jpg' %}" alt="{{ label }}">
                                                {% elif value == 'CODM' %}
                                                    <img src="{% static 'img/game_cards/CallOfDutyMobile.jpg' %}" alt="{{ label }}">
                                                {% else %}
                                                    <i class="fas fa-gamepad"></i>
                                                {% endif %}
                                            </div>
                                            <span class="game-name">{{ label }}</span>
                                            <div class="game-check">
                                                <i class="fas fa-check-circle"></i>
                                            </div>
                                        </label>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <div class="field-error" id="game-error"></div>
                        </div>

                        <!-- Region Selection -->
                        <div class="form-field">
                            <label class="field-label">
                                <i class="fas fa-globe"></i>
                                Primary Region
                                <span class="required">*</span>
                            </label>
                            <div class="region-grid">
                                {% for value, label in form.region.field.choices %}
                                    {% if value %}
                                    <div class="region-option">
                                        <input 
                                            type="radio" 
                                            name="region" 
                                            id="region-{{ value }}" 
                                            value="{{ value }}"
                                            {% if form.region.value == value %}checked{% endif %}
                                            required>
                                        <label for="region-{{ value }}">
                                            <i class="fas fa-map-marker-alt"></i>
                                            <span>{{ label }}</span>
                                            <div class="region-check">
                                                <i class="fas fa-check"></i>
                                            </div>
                                        </label>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <div class="field-error" id="region-error"></div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <button type="button" class="btn-esports btn-secondary btn-prev" data-prev="1">
                            <i class="fas fa-arrow-left"></i>
                            Previous
                        </button>
                        <button type="button" class="btn-esports btn-next" data-next="3">
                            Next Step
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Team Branding -->
            <div class="form-step" data-step="3">
                <div class="step-card">
                    <div class="card-header">
                        <div class="header-icon">
                            <i class="fas fa-palette"></i>
                        </div>
                        <div class="header-text">
                            <h2>Team Branding</h2>
                            <p>Create a visual identity for your team</p>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="branding-grid">
                            <!-- Logo Upload -->
                            <div class="upload-card">
                                <div class="upload-header">
                                    <i class="fas fa-shield-alt"></i>
                                    <h3>Team Logo</h3>
                                </div>
                                <div class="upload-zone" id="logo-zone">
                                    <input type="file" name="logo" id="id_logo" accept="image/*" hidden>
                                    <div class="upload-placeholder">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Drag & drop or click</p>
                                        <span>Square · Max 10MB</span>
                                    </div>
                                    <div class="upload-preview" id="logo-preview"></div>
                                </div>
                                <div class="upload-actions">
                                    <button type="button" class="btn-upload" data-target="id_logo">
                                        <i class="fas fa-upload"></i>
                                        Choose File
                                    </button>
                                    <button type="button" class="btn-clear" data-clear="logo" style="display: none;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Banner Upload -->
                            <div class="upload-card">
                                <div class="upload-header">
                                    <i class="fas fa-panorama"></i>
                                    <h3>Team Banner</h3>
                                </div>
                                <div class="upload-zone" id="banner-zone">
                                    <input type="file" name="banner_image" id="id_banner_image" accept="image/*" hidden>
                                    <div class="upload-placeholder">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Drag & drop or click</p>
                                        <span>16:9 · Max 10MB</span>
                                    </div>
                                    <div class="upload-preview" id="banner-preview"></div>
                                </div>
                                <div class="upload-actions">
                                    <button type="button" class="btn-upload" data-target="id_banner_image">
                                        <i class="fas fa-upload"></i>
                                        Choose File
                                    </button>
                                    <button type="button" class="btn-clear" data-clear="banner" style="display: none;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="branding-tips">
                            <div class="tip-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Use high-quality images for best results</span>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Logo should be square (512x512px recommended)</span>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Banner should be 16:9 ratio (1920x1080px recommended)</span>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <button type="button" class="btn-esports btn-secondary btn-prev" data-prev="2">
                            <i class="fas fa-arrow-left"></i>
                            Previous
                        </button>
                        <button type="button" class="btn-esports btn-next" data-next="4">
                            Next Step
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Roster -->
            <div class="form-step" data-step="4">
                <div class="step-card">
                    <div class="card-header">
                        <div class="header-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="header-text">
                            <h2>Build Your Roster</h2>
                            <p>Invite players to join your team (optional)</p>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="roster-info">
                            <i class="fas fa-info-circle"></i>
                            <p>You can add team members now or later from your team dashboard. Invited members will receive notifications.</p>
                        </div>

                        <div id="roster-container">
                            <!-- Dynamic roster invites -->
                        </div>

                        <button type="button" class="btn-add-member" id="add-member-btn">
                            <i class="fas fa-plus-circle"></i>
                            <span>Add Team Member</span>
                        </button>

                        <!-- Hidden data -->
                        <input type="hidden" name="roster_data" id="roster_data" value="[]">
                        
                        <!-- Terms & Conditions -->
                        <div class="form-field terms-field" style="margin-top: 2rem;">
                            <div class="terms-checkbox">
                                <input 
                                    type="checkbox" 
                                    name="accept_terms" 
                                    id="id_accept_terms" 
                                    required>
                                <label for="id_accept_terms">
                                    I have read and accept the 
                                    <a href="{% url 'core:terms' %}" target="_blank" class="terms-link">Terms & Conditions</a> 
                                    and 
                                    <a href="{% url 'core:privacy' %}" target="_blank" class="terms-link">Privacy Policy</a>
                                    <span class="required">*</span>
                                </label>
                            </div>
                            <div class="field-error" id="terms-error"></div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <button type="button" class="btn-esports btn-secondary btn-prev" data-prev="3">
                            <i class="fas fa-arrow-left"></i>
                            Previous
                        </button>
                        <button type="submit" class="btn-esports btn-primary btn-submit">
                            <i class="fas fa-rocket"></i>
                            Create Team
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
        </div>
        <p class="loading-text">Creating your esports team...</p>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>
</div>

<!-- Member Invite Template -->
<template id="member-template">
    <div class="member-card">
        <div class="member-header">
            <i class="fas fa-user-circle"></i>
            <span class="member-number">Member #1</span>
            <button type="button" class="btn-remove-member">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="member-body">
            <div class="member-field">
                <label>Username or Email</label>
                <input type="text" class="member-identifier" placeholder="player123 or email@example.com">
            </div>
            <div class="member-field">
                <label>Role</label>
                <select class="member-role">
                    <option value="PLAYER">Player</option>
                    <option value="SUBSTITUTE">Substitute</option>
                    <option value="COACH">Coach</option>
                    <option value="MANAGER">Manager</option>
                </select>
            </div>
        </div>
    </div>
</template>
{% endblock %}

{% block extra_js %}
<script src="{% static 'teams/js/team-create-esports.js' %}?v=1.0"></script>
{% endblock %}
