{% extends "base.html" %}
{% load static %}

{% block title %}Manager Tools - {{ team.name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center gap-4 mb-4">
      <a href="{% url 'teams:detail' team.slug %}" class="text-cyan-400 hover:text-cyan-300">
        <i class="fas fa-arrow-left"></i> Back to Team
      </a>
    </div>
    <h1 class="text-4xl font-bold flex items-center gap-3">
      <i class="fas fa-user-tie text-blue-400"></i>
      Manager Tools
    </h1>
    <p class="text-gray-400 mt-2">{{ team.name }} - Roster Management & Operations</p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Pending Invites -->
    <div class="card glass p-6">
      <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
        <i class="fas fa-envelope text-cyan-400"></i>
        Pending Invites
      </h2>
      
      {% if pending_invites %}
      <div class="space-y-3">
        {% for invite in pending_invites %}
        <div class="p-4 rounded-lg bg-white/5 hover:bg-white/10 transition-colors">
          <div class="flex items-center justify-between">
            <div>
              <div class="font-semibold">
                {% if invite.invited_user %}
                  {{ invite.invited_user.username }}
                {% else %}
                  {{ invite.invited_email }}
                {% endif %}
              </div>
              <div class="text-sm text-gray-400">
                Invited {{ invite.created_at|timesince }} ago by {{ invite.inviter.username }}
              </div>
            </div>
            <button class="btn btn-sm btn-danger" onclick="cancelInvite({{ invite.id }})">
              <i class="fas fa-times"></i> Cancel
            </button>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="text-center py-8 text-gray-400">
        <i class="fas fa-inbox text-4xl mb-3 opacity-50"></i>
        <p>No pending invites</p>
      </div>
      {% endif %}
      
      <div class="mt-4">
        <a href="{% url 'teams:invite_member' team.slug %}" class="btn btn-primary w-full">
          <i class="fas fa-user-plus"></i> Send New Invite
        </a>
      </div>
    </div>

    <!-- Pending Join Requests -->
    <div class="card glass p-6">
      <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
        <i class="fas fa-inbox text-green-400"></i>
        Join Requests
      </h2>
      
      {% if pending_join_requests %}
      <div class="space-y-3">
        {% for request in pending_join_requests %}
        <div class="p-4 rounded-lg bg-white/5 hover:bg-white/10 transition-colors">
          <div class="flex items-center justify-between">
            <div>
              <div class="font-semibold">{{ request.profile.user.username }}</div>
              <div class="text-sm text-gray-400">
                Requested {{ request.created_at|timesince }} ago
              </div>
              {% if request.message %}
              <div class="text-sm text-gray-300 mt-1 italic">"{{ request.message }}"</div>
              {% endif %}
            </div>
            <div class="flex gap-2">
              <button class="btn btn-sm btn-success" onclick="approveRequest({{ request.id }})">
                <i class="fas fa-check"></i> Approve
              </button>
              <button class="btn btn-sm btn-danger" onclick="rejectRequest({{ request.id }})">
                <i class="fas fa-times"></i> Reject
              </button>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="text-center py-8 text-gray-400">
        <i class="fas fa-inbox text-4xl mb-3 opacity-50"></i>
        <p>No pending join requests</p>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="card glass p-6 mt-6">
    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-bolt text-yellow-400"></i>
      Quick Actions
    </h2>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <a href="{% url 'teams:manage' team.slug %}" class="p-4 rounded-lg bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border border-cyan-500/20 hover:border-cyan-500/40 transition-colors text-center">
        <i class="fas fa-users-cog text-cyan-400 text-3xl mb-2"></i>
        <div class="font-semibold">Manage Roster</div>
        <div class="text-sm text-gray-400">Edit roles and positions</div>
      </a>
      
      <a href="{% url 'teams:settings' team.slug %}" class="p-4 rounded-lg bg-gradient-to-br from-purple-500/10 to-pink-500/10 border border-purple-500/20 hover:border-purple-500/40 transition-colors text-center">
        <i class="fas fa-cog text-purple-400 text-3xl mb-2"></i>
        <div class="font-semibold">Team Settings</div>
        <div class="text-sm text-gray-400">Configure team options</div>
      </a>
      
      <a href="{% url 'teams:team_tournaments' team.slug %}" class="p-4 rounded-lg bg-gradient-to-br from-green-500/10 to-emerald-500/10 border border-green-500/20 hover:border-green-500/40 transition-colors text-center">
        <i class="fas fa-trophy text-green-400 text-3xl mb-2"></i>
        <div class="font-semibold">Tournaments</div>
        <div class="text-sm text-gray-400">View schedule & register</div>
      </a>
    </div>
  </div>
</div>

<script>
function cancelInvite(inviteId) {
  if (!confirm('Are you sure you want to cancel this invite?')) return;
  
  fetch(`/teams/api/invites/${inviteId}/cancel/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': getCookie('csrftoken'),
      'Content-Type': 'application/json'
    }
  }).then(response => response.json())
    .then(data => {
      if (data.success) {
        location.reload();
      } else {
        alert(data.message || 'Failed to cancel invite');
      }
    });
}

function approveRequest(requestId) {
  fetch(`/teams/api/join-requests/${requestId}/approve/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': getCookie('csrftoken'),
      'Content-Type': 'application/json'
    }
  }).then(response => response.json())
    .then(data => {
      if (data.success) {
        location.reload();
      } else {
        alert(data.message || 'Failed to approve request');
      }
    });
}

function rejectRequest(requestId) {
  if (!confirm('Are you sure you want to reject this request?')) return;
  
  fetch(`/teams/api/join-requests/${requestId}/reject/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': getCookie('csrftoken'),
      'Content-Type': 'application/json'
    }
  }).then(response => response.json())
    .then(data => {
      if (data.success) {
        location.reload();
      } else {
        alert(data.message || 'Failed to reject request');
      }
    });
}

function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
}
</script>
{% endblock %}
