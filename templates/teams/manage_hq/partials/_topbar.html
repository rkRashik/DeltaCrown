{% comment %}
Topbar — Dynamic smart header with per-section quick actions, breadcrumb, notifications & platform nav.
{% endcomment %}
<header class="sticky top-0 z-30 backdrop-blur-xl bg-[var(--bg0)]/80 border-b border-line">
    {# ── Breadcrumb / Back nav ── #}
    <div class="flex items-center gap-2 px-4 lg:px-6 pt-2.5 pb-0.5">
        <a href="/" class="text-[11px] text-white/35 hover:text-white/60 transition flex items-center gap-1 shrink-0" title="Go to Platform Home">
            <i data-lucide="layout-grid" class="w-3 h-3"></i>
            <span class="hidden xs:inline">Platform</span>
        </a>
        <i data-lucide="chevron-right" class="w-3 h-3 text-white/20 shrink-0"></i>
        <a href="{% url 'teams:detail' team.slug %}" class="text-[11px] text-white/35 hover:text-white/60 transition truncate" title="Back to team page">
            {{ team.name|truncatechars:20 }}
        </a>
        <i data-lucide="chevron-right" class="w-3 h-3 text-white/20 shrink-0"></i>
        <span id="breadcrumbSection" class="text-[11px] text-white/55 font-medium truncate">Command Center</span>
    </div>

    {# ── Main topbar row ── #}
    <div class="flex items-center justify-between h-12 px-4 lg:px-6">
        {# Mobile hamburger #}
        <button id="openSidebar" aria-label="Open navigation menu"
            class="lg:hidden h-9 w-9 grid place-items-center rounded-xl bg-white/8 hover:bg-white/12 transition shrink-0">
            <i data-lucide="menu" class="w-4 h-4"></i>
        </button>

        {# Title block #}
        <div class="flex-1 ml-3 lg:ml-0 min-w-0">
            <h2 id="pageTitle" class="text-sm font-bold leading-tight truncate">Command Center</h2>
            <p id="pageSub" class="text-[11px] text-white/50 leading-tight truncate">Real-time team overview</p>
        </div>

        {# ── Dynamic Quick Actions (changes per section) ── #}
        <div id="topbarActions" class="hidden sm:flex items-center gap-1.5 mr-2">
            {# Actions are injected by JS based on active route #}
        </div>

        {# ── Notification bell + dropdown ── #}
        <div class="relative" id="notifBellWrap">
            <button id="notifBellBtn"
                    aria-label="Notifications"
                    aria-haspopup="true"
                    aria-expanded="false"
                    aria-controls="notifPanel"
                    class="relative h-9 w-9 grid place-items-center rounded-xl bg-white/8 hover:bg-white/12 transition mr-1.5"
                    onclick="ManageHQ.toggleNotifPanel()">
                <i data-lucide="bell" class="w-4 h-4 text-white/70"></i>
                <span id="notifBadge" aria-live="polite" aria-atomic="true"
                      class="hidden absolute -top-0.5 -right-0.5 min-w-[18px] h-[18px] rounded-full bg-red-500 text-[10px] font-bold text-white flex items-center justify-center px-1 pointer-events-none">
                    0
                </span>
            </button>
            {# Dropdown panel — populated by JS #}
            <div id="notifPanel"
                 class="hidden absolute right-0 top-full mt-1 w-80 max-h-96 overflow-y-auto rounded-2xl border border-line bg-[var(--bg1)] shadow-2xl z-50"
                 role="region" aria-label="Notifications panel">
                <div class="flex items-center justify-between px-4 py-3 border-b border-line">
                    <span class="text-xs font-bold text-white/80">Notifications</span>
                    <button id="notifMarkAllRead"
                            class="text-[10px] text-white/50 hover:text-white/80 transition"
                            onclick="ManageHQ.markAllNotifRead()">Mark all read</button>
                </div>
                <div id="notifList" class="divide-y divide-white/5">
                    <div class="px-4 py-6 text-center text-xs text-white/30">Loading…</div>
                </div>
                <a href="{% url 'notifications:list' %}"
                   class="block text-center text-[11px] font-semibold text-white/50 hover:text-white/80 py-2 border-t border-line transition">
                    View All Notifications
                </a>
            </div>
        </div>

        {# ── Back to team page button ── #}
        <a href="{% url 'teams:detail' team.slug %}" title="Back to {{ team.name }}"
           class="h-9 w-9 grid place-items-center rounded-xl bg-white/8 hover:bg-white/12 transition shrink-0">
            <i data-lucide="external-link" class="w-4 h-4 text-white/60"></i>
        </a>
    </div>
</header>
