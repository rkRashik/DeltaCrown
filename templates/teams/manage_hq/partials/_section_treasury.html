{% comment %}
Treasury & Economy ‚Äî Prize history, registration fees, wallet card, transaction log.
Section 7.8 & 11.4 of the Master Plan. Phase 4 wired to DeltaCrownWallet context.
Role Gating:
  OWNER: Full view ‚Äî wallet summary, prize history, transaction log, payout settings
  MANAGER/ADMIN: Prize history, registration fees
  COACH/PLAYER: Prize history (amounts only)
{% endcomment %}
<section id="treasury" class="hq-section space-y-4">

    {# ‚îÄ‚îÄ Header ‚îÄ‚îÄ #}
    <div class="mb-2">
        <h2 class="text-lg font-bold flex items-center gap-2">
            <i data-lucide="landmark" class="w-5 h-5 text-emerald-400"></i>
            Treasury & Economy
        </h2>
        <p class="text-sm text-white/50 mt-0.5">Prize earnings, registration fees, and financial overview</p>
    </div>

    {# ‚îÄ‚îÄ Prize Distribution Flow Info (Org teams) ‚îÄ‚îÄ #}
    {% if team.organization %}
    <div class="rounded-2xl border border-blue-500/15 bg-blue-500/5 p-3.5 flex items-center gap-3">
        <i data-lucide="info" class="w-4 h-4 text-blue-400 shrink-0"></i>
        <p class="text-xs text-white/50">
            Prize money for org teams flows to the <b class="text-white/70">Organization Master Wallet</b>.
            The org CEO distributes funds to players.
            {% if org_control_plane_url %}
            <a href="{{ org_control_plane_url }}" class="text-blue-400 hover:underline">View in Control Plane ‚Üí</a>
            {% endif %}
        </p>
    </div>
    {% elif is_owner %}
    <div class="rounded-2xl border border-emerald-500/15 bg-emerald-500/5 p-3.5 flex items-center gap-3">
        <i data-lucide="info" class="w-4 h-4  text-emerald-400 shrink-0"></i>
        <p class="text-xs text-white/50">
            As an independent team, prize money is deposited into the <b class="text-white/70">team owner's personal wallet</b>.
            The owner distributes funds to teammates.
        </p>
    </div>
    {% endif %}

    {# ‚îÄ‚îÄ Owner Wallet Card (OWNER only) ‚îÄ‚îÄ #}
    {% if is_owner %}
    <div class="rounded-3xl border border-emerald-500/20 bg-gradient-to-br from-emerald-500/8 to-transparent shadow-soft p-5 lg:p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-base font-bold flex items-center gap-2">
                <i data-lucide="wallet" class="w-4 h-4 text-emerald-400"></i>
                {% if team.organization %}Org Master Wallet{% else %}Owner Wallet{% endif %}
            </h3>
            <span class="text-[10px] px-2 py-0.5 rounded-full bg-emerald-500/15 text-emerald-400 font-semibold uppercase">Owner Only</span>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div class="rounded-xl bg-white/5 border border-white/8 p-4 text-center">
                <div class="text-2xl font-black text-emerald-400" id="wallet-balance">
                    {% if wallet_context %}{{ wallet_context.balance }}{% else %}‚Äî{% endif %}
                </div>
                <div class="text-[10px] text-white/40 uppercase tracking-wide mt-1">Available Balance</div>
            </div>
            <div class="rounded-xl bg-white/5 border border-white/8 p-4 text-center">
                <div class="text-2xl font-black text-amber-400" id="wallet-held">
                    {% if wallet_context %}{{ wallet_context.held_balance }}{% else %}‚Äî{% endif %}
                </div>
                <div class="text-[10px] text-white/40 uppercase tracking-wide mt-1">Held / Pending</div>
            </div>
            <div class="rounded-xl bg-white/5 border border-white/8 p-4 text-center">
                <div class="text-2xl font-black text-white/60" id="wallet-lifetime">
                    {% if wallet_context %}{{ wallet_context.lifetime_earned }}{% else %}‚Äî{% endif %}
                </div>
                <div class="text-[10px] text-white/40 uppercase tracking-wide mt-1">Lifetime Earned</div>
            </div>
        </div>
        {% if not wallet_context %}
        <p class="text-xs text-white/30 mt-3 flex items-center gap-1.5">
            <i data-lucide="info" class="w-3 h-3"></i>
            No wallet data available. The economy module will populate this when active.
        </p>
        {% endif %}
    </div>
    {% endif %}

    {# ‚îÄ‚îÄ Prize History (visible to all roles) ‚îÄ‚îÄ #}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h3 class="text-base font-bold mb-3 flex items-center gap-2">
            <i data-lucide="trophy" class="w-4 h-4 text-amber-400"></i>
            Prize History
        </h3>
        <div id="prize-history-list">
            {# Table header #}
            <div class="hidden sm:grid grid-cols-12 gap-2 text-[10px] text-white/30 uppercase tracking-wider font-semibold px-3 py-2 mb-1">
                <div class="col-span-4">Tournament</div>
                <div class="col-span-2">Placement</div>
                <div class="col-span-2">Prize</div>
                <div class="col-span-2">Date</div>
                <div class="col-span-2">Status</div>
            </div>
            {# Empty state ‚Äî will be populated via JS/API when data exists #}
            <div class="rounded-xl border border-dashed border-white/15 bg-white/3 p-6 text-center" id="prize-empty-state">
                <i data-lucide="coins" class="w-7 h-7 text-white/15 mx-auto mb-2"></i>
                <p class="text-sm text-white/40">No prize earnings yet</p>
                <p class="text-xs text-white/25 mt-1">Place in tournaments to start earning</p>
            </div>
        </div>
    </div>

    {# ‚îÄ‚îÄ Registration Fee Log (OWNER + ADMIN) ‚îÄ‚îÄ #}
    {% if is_admin %}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h3 class="text-base font-bold mb-3 flex items-center gap-2">
            <i data-lucide="receipt" class="w-4 h-4 text-blue-400"></i>
            Registration Fees
        </h3>
        <p class="text-xs text-white/40 mb-3">Tournament entry fees paid by this team</p>
        <div id="fee-log-list">
            {# Table header #}
            <div class="hidden sm:grid grid-cols-12 gap-2 text-[10px] text-white/30 uppercase tracking-wider font-semibold px-3 py-2 mb-1">
                <div class="col-span-4">Tournament</div>
                <div class="col-span-2">Fee Amount</div>
                <div class="col-span-2">Method</div>
                <div class="col-span-2">Date</div>
                <div class="col-span-2">Status</div>
            </div>
            <div class="rounded-xl border border-dashed border-white/15 bg-white/3 p-6 text-center">
                <i data-lucide="file-text" class="w-7 h-7 text-white/15 mx-auto mb-2"></i>
                <p class="text-sm text-white/40">No registration fee history</p>
                <p class="text-xs text-white/25 mt-1">Fees will appear here when team registers for tournaments</p>
            </div>
        </div>
    </div>
    {% endif %}

    {# ‚îÄ‚îÄ Transaction Log (OWNER + ADMIN) ‚îÄ‚îÄ #}
    {% if is_admin %}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <div class="flex items-center justify-between mb-3">
            <h3 class="text-base font-bold flex items-center gap-2">
                <i data-lucide="list" class="w-4 h-4 text-white/50"></i>
                Transaction Log
            </h3>
            {% if is_owner %}
            <div class="flex items-center gap-2">
                <select id="tx-filter-type" class="text-xs bg-white/5 border border-white/15 rounded-lg px-2 py-1 focus:outline-none">
                    <option value="all">All Types</option>
                    <option value="credit">Credits</option>
                    <option value="debit">Debits</option>
                </select>
            </div>
            {% endif %}
        </div>
        <div id="transaction-log-list">
            <div class="rounded-xl border border-dashed border-white/15 bg-white/3 p-6 text-center">
                <i data-lucide="scroll-text" class="w-7 h-7 text-white/15 mx-auto mb-2"></i>
                <p class="text-sm text-white/30">No transactions recorded</p>
                <p class="text-xs text-white/20 mt-1">Tournament prizes, fees, and payouts appear here</p>
            </div>
        </div>
    </div>
    {% endif %}

    {# ‚îÄ‚îÄ Payout Preferences (Coming Soon ‚Äî OWNER only) ‚îÄ‚îÄ #}
    {% if is_owner %}
    <div class="rounded-2xl border border-dashed border-white/15 bg-white/3 p-5 text-center">
        <i data-lucide="settings" class="w-6 h-6 text-white/15 mx-auto mb-2"></i>
        <h3 class="font-bold text-sm mb-1 text-white/50">Payout Preferences</h3>
        <p class="text-xs text-white/30">Split ratios, auto-distribution rules, and payout settings coming soon.</p>
    </div>
    {% endif %}

    {# ‚îÄ‚îÄ Payment Methods Info ‚îÄ‚îÄ #}
    {% if is_owner %}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h3 class="text-base font-bold mb-3 flex items-center gap-2">
            <i data-lucide="credit-card" class="w-4 h-4 text-purple-400"></i>
            Payment Methods
        </h3>
        <p class="text-xs text-white/40 mb-3">Accepted methods for tournament fees and wallet top-ups</p>
        <div class="grid grid-cols-2 sm:grid-cols-5 gap-2">
            <div class="rounded-xl bg-white/5 border border-white/8 p-3 text-center">
                <div class="text-lg mb-1">üí≥</div>
                <p class="text-[10px] text-white/50 font-medium">bKash</p>
            </div>
            <div class="rounded-xl bg-white/5 border border-white/8 p-3 text-center">
                <div class="text-lg mb-1">üí≥</div>
                <p class="text-[10px] text-white/50 font-medium">Nagad</p>
            </div>
            <div class="rounded-xl bg-white/5 border border-white/8 p-3 text-center">
                <div class="text-lg mb-1">üí≥</div>
                <p class="text-[10px] text-white/50 font-medium">Rocket</p>
            </div>
            <div class="rounded-xl bg-white/5 border border-white/8 p-3 text-center">
                <div class="text-lg mb-1">üè¶</div>
                <p class="text-[10px] text-white/50 font-medium">Bank</p>
            </div>
            <div class="rounded-xl bg-white/5 border border-white/8 p-3 text-center">
                <div class="text-lg mb-1">ü™ô</div>
                <p class="text-[10px] text-white/50 font-medium">DeltaCoin</p>
            </div>
        </div>
    </div>
    {% endif %}

</section>
