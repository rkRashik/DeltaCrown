{% load static %}
{% comment %}
Team Profile — Inline editing for team identity: name, tag, description, logo, banner, socials.
All changes submit via AJAX — no page reload required.
{% endcomment %}
<section id="profile" class="hq-section space-y-4">

    {# ── Brand Inheritance Banner (Org teams with enforce_brand) ── #}
    {% if org_policies.enforce_brand %}
    <div class="rounded-2xl border border-amber-500/20 bg-amber-500/5 p-4 flex items-center gap-3">
        <div class="h-10 w-10 rounded-xl bg-amber-500/15 grid place-items-center shrink-0">
            <i data-lucide="palette" class="w-5 h-5 text-amber-400"></i>
        </div>
        <div class="min-w-0 flex-1">
            <p class="text-sm font-semibold text-amber-400">Brand Inherited from {{ team.organization.name }}</p>
            <p class="text-xs text-white/40">This team's logo and visual identity are enforced by the parent organization. Custom branding is disabled.</p>
        </div>
        {% if org_control_plane_url %}
        <a href="{{ org_control_plane_url }}" class="shrink-0 text-xs text-amber-400 hover:text-amber-300 transition font-medium">
            Manage →
        </a>
        {% endif %}
    </div>
    {% endif %}

    {# ── Team Branding (Logo & Banner) ── #}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h2 class="text-base font-bold mb-4 flex items-center gap-2">
            <i data-lucide="image" class="w-4 h-4 text-purple-400"></i>
            Team Branding
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {# Logo Upload #}
            <div>
                <label class="block text-xs text-white/60 mb-2 font-medium">Team Logo</label>
                <div class="relative rounded-2xl border-2 border-dashed border-white/15 hover:border-white/25 transition bg-white/5 p-4 text-center group cursor-pointer"
                     onclick="this.querySelector('input[type=file]').click()">
                    <div class="h-24 w-24 mx-auto rounded-2xl overflow-hidden bg-white/10 grid place-items-center mb-3">
                        {% if team.logo %}
                        <img id="preview-logo" src="{{ team.logo.url }}" alt="Logo" class="w-full h-full object-cover">
                        {% else %}
                        <img id="preview-logo" src="" alt="" class="w-full h-full object-cover hidden">
                        <i data-lucide="image-plus" class="w-8 h-8 text-white/30"></i>
                        {% endif %}
                    </div>
                    <p class="text-xs text-white/40 group-hover:text-white/60 transition">Click to upload logo (max 5MB)</p>
                    <input type="file" accept="image/*" data-media-upload="logo" class="hidden"
                           onchange="ManageHQ.uploadMedia(this)">
                </div>
            </div>

            {# Banner Upload #}
            <div>
                <label class="block text-xs text-white/60 mb-2 font-medium">Team Banner / Cover</label>
                <div class="relative rounded-2xl border-2 border-dashed border-white/15 hover:border-white/25 transition bg-white/5 p-4 text-center group cursor-pointer"
                     onclick="this.querySelector('input[type=file]').click()">
                    <div class="h-24 w-full rounded-xl overflow-hidden bg-white/10 grid place-items-center mb-3">
                        {% if team.banner %}
                        <img id="preview-banner" src="{{ team.banner.url }}" alt="Banner" class="w-full h-full object-cover">
                        {% else %}
                        <img id="preview-banner" src="" alt="" class="w-full h-full object-cover hidden">
                        <i data-lucide="panorama" class="w-8 h-8 text-white/30"></i>
                        {% endif %}
                    </div>
                    <p class="text-xs text-white/40 group-hover:text-white/60 transition">Click to upload banner (max 10MB)</p>
                    <input type="file" accept="image/*" data-media-upload="banner" class="hidden"
                           onchange="ManageHQ.uploadMedia(this)">
                </div>
            </div>
        </div>
    </div>

    {# ── Team Information ── #}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h2 class="text-base font-bold mb-4 flex items-center gap-2">
            <i data-lucide="file-text" class="w-4 h-4 text-blue-400"></i>
            Team Information
        </h2>

        <form id="profile-info-form" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="profile-name" class="block text-xs text-white/60 mb-1.5 font-medium">Team Name</label>
                    <input id="profile-name" type="text" value="{{ team.name|escapejs }}" maxlength="100"
                        class="w-full px-3 py-2.5 rounded-xl bg-white/5 border border-white/15 text-sm focus:border-white/30 focus:outline-none transition">
                </div>
                <div>
                    <label for="profile-tag" class="block text-xs text-white/60 mb-1.5 font-medium">Team Tag</label>
                    <input id="profile-tag" type="text" value="{{ team.tag|escapejs }}" maxlength="10" style="text-transform:uppercase"
                        class="w-full px-3 py-2.5 rounded-xl bg-white/5 border border-white/15 text-sm focus:border-white/30 focus:outline-none transition">
                </div>
            </div>

            <div>
                <label for="profile-tagline" class="block text-xs text-white/60 mb-1.5 font-medium">Tagline</label>
                <input id="profile-tagline" type="text" value="{{ team.tagline|default:""|escapejs }}" maxlength="200"
                    placeholder="A short motto or tagline…"
                    class="w-full px-3 py-2.5 rounded-xl bg-white/5 border border-white/15 text-sm placeholder-white/30 focus:border-white/30 focus:outline-none transition">
            </div>

            <div>
                <label for="profile-description" class="block text-xs text-white/60 mb-1.5 font-medium">Description</label>
                <textarea id="profile-description" rows="3" maxlength="500"
                    placeholder="Tell the world about your team…"
                    class="w-full px-3 py-2.5 rounded-xl bg-white/5 border border-white/15 text-sm placeholder-white/30 focus:border-white/30 focus:outline-none transition resize-none">{{ team.description|default:"" }}</textarea>
                <p class="text-xs text-white/30 mt-1 text-right"><span id="desc-count">{{ team.description|default:""|length }}</span>/500</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="profile-region" class="block text-xs text-white/60 mb-1.5 font-medium">Region</label>
                    <select id="profile-region"
                        class="w-full px-3 py-2.5 rounded-xl bg-white/5 border border-white/15 text-sm focus:border-white/30 focus:outline-none transition">
                        <option value="">Select Region</option>
                        {% for rc in region_choices %}
                        <option value="{{ rc.value }}" {% if team.region == rc.value %}selected{% endif %}>{{ rc.label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-white/60 mb-1.5 font-medium">Game (Locked)</label>
                    <input type="text" value="{{ game_display }}" disabled
                        class="w-full px-3 py-2.5 rounded-xl bg-white/5 border border-white/10 text-sm text-white/40 cursor-not-allowed">
                    <p class="text-xs text-white/30 mt-1">Game cannot be changed after creation</p>
                </div>
            </div>

            <div class="flex justify-end pt-2">
                <button id="profile-info-submit" type="submit"
                    class="px-5 py-2.5 rounded-xl text-sm font-medium text-white transition"
                    style="background:linear-gradient(135deg,color-mix(in oklab,var(--team-primary) 70%,transparent),rgba(255,255,255,.08))">
                    Save Changes
                </button>
            </div>
        </form>
    </div>

    {# ── Social Links ── #}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h2 class="text-base font-bold mb-4 flex items-center gap-2">
            <i data-lucide="link" class="w-4 h-4 text-cyan-400"></i>
            Social Links
        </h2>

        <form id="profile-socials-form" class="space-y-3">
            {# Twitter / X #}
            <div class="flex items-center gap-3">
                <div class="h-9 w-9 rounded-lg bg-white/5 border border-white/10 grid place-items-center shrink-0">
                    <i data-lucide="twitter" class="w-4 h-4 text-sky-400"></i>
                </div>
                <input id="social-twitter" type="url"
                    value="{{ team.twitter_url|default:"" }}"
                    placeholder="Twitter / X URL"
                    class="flex-1 px-3 py-2 rounded-xl bg-white/5 border border-white/15 text-sm placeholder-white/30 focus:border-white/30 focus:outline-none transition">
            </div>

            {# Instagram #}
            <div class="flex items-center gap-3">
                <div class="h-9 w-9 rounded-lg bg-white/5 border border-white/10 grid place-items-center shrink-0">
                    <i data-lucide="instagram" class="w-4 h-4 text-pink-400"></i>
                </div>
                <input id="social-instagram" type="url"
                    value="{{ team.instagram_url|default:"" }}"
                    placeholder="Instagram URL"
                    class="flex-1 px-3 py-2 rounded-xl bg-white/5 border border-white/15 text-sm placeholder-white/30 focus:border-white/30 focus:outline-none transition">
            </div>

            {# YouTube #}
            <div class="flex items-center gap-3">
                <div class="h-9 w-9 rounded-lg bg-white/5 border border-white/10 grid place-items-center shrink-0">
                    <i data-lucide="youtube" class="w-4 h-4 text-red-400"></i>
                </div>
                <input id="social-youtube" type="url"
                    value="{{ team.youtube_url|default:"" }}"
                    placeholder="YouTube URL"
                    class="flex-1 px-3 py-2 rounded-xl bg-white/5 border border-white/15 text-sm placeholder-white/30 focus:border-white/30 focus:outline-none transition">
            </div>

            {# Twitch #}
            <div class="flex items-center gap-3">
                <div class="h-9 w-9 rounded-lg bg-white/5 border border-white/10 grid place-items-center shrink-0">
                    <i data-lucide="twitch" class="w-4 h-4 text-purple-400"></i>
                </div>
                <input id="social-twitch" type="url"
                    value="{{ team.twitch_url|default:"" }}"
                    placeholder="Twitch URL"
                    class="flex-1 px-3 py-2 rounded-xl bg-white/5 border border-white/15 text-sm placeholder-white/30 focus:border-white/30 focus:outline-none transition">
            </div>

            <div class="flex justify-end pt-3">
                <button id="profile-socials-submit" type="submit"
                    class="px-5 py-2.5 rounded-xl bg-cyan-600 hover:bg-cyan-500 transition text-sm font-medium text-white">
                    Save Links
                </button>
            </div>
        </form>
    </div>

</section>

<script>
// Character counter for description
document.addEventListener('DOMContentLoaded', function() {
    const desc = document.getElementById('profile-description');
    const counter = document.getElementById('desc-count');
    if (desc && counter) {
        desc.addEventListener('input', () => { counter.textContent = desc.value.length; });
    }
});
</script>
