{% comment %}
History & Archive — Activity timeline, membership ledger, filter bar.
Section 7.9 of the Master Plan.
{% endcomment %}
<section id="history" class="hq-section space-y-4" aria-labelledby="history-heading">

    {# ── Header ── #}
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-2">
        <div>
            <h2 id="history-heading" class="text-lg font-bold flex items-center gap-2">
                <i data-lucide="scroll-text" class="w-5 h-5 text-slate-400"></i>
                History & Archive
            </h2>
            <p class="text-sm text-white/50 mt-0.5">Full team activity timeline and membership ledger</p>
        </div>
        <div class="flex items-center gap-2">
            {# Export placeholder #}
            <button disabled
                class="rounded-xl px-3 py-1.5 text-xs font-medium border border-white/10 bg-white/5 text-white/30 cursor-not-allowed inline-flex items-center gap-1.5"
                title="Export coming soon">
                <i data-lucide="download" class="w-3 h-3"></i>
                Export
            </button>
        </div>
    </div>

    {# ── Filter Bar ── #}
    <div class="rounded-2xl border border-line bg-card p-3 flex flex-wrap items-center gap-2">
        <div class="flex items-center gap-1.5 text-xs text-white/40">
            <i data-lucide="filter" class="w-3.5 h-3.5"></i>
            <span>Filters:</span>
        </div>
        <select id="history-filter-type" aria-label="Filter by activity type"
            class="text-xs px-2.5 py-1.5 rounded-lg bg-white/5 border border-white/10 text-white/60 focus:outline-none">
            <option value="">All Types</option>
            <option value="roster">Roster Changes</option>
            <option value="tournament">Tournament Events</option>
            <option value="settings">Settings Changes</option>
            <option value="profile">Profile Updates</option>
        </select>
        <input type="date" id="history-filter-from" aria-label="Filter from date"
            class="text-xs px-2.5 py-1.5 rounded-lg bg-white/5 border border-white/10 text-white/60 focus:outline-none"
            placeholder="From">
        <input type="date" id="history-filter-to" aria-label="Filter to date"
            class="text-xs px-2.5 py-1.5 rounded-lg bg-white/5 border border-white/10 text-white/60 focus:outline-none"
            placeholder="To">
        <button onclick="ManageHQ.History.applyFilters()"
            class="text-xs px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 transition font-medium">Apply</button>
        <button onclick="ManageHQ.History.clearFilters()"
            class="text-xs px-2 py-1.5 text-white/30 hover:text-white/50 transition">Clear</button>
    </div>

    {# ── Activity Timeline ── #}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h3 class="text-base font-bold mb-4 flex items-center gap-2">
            <i data-lucide="activity" class="w-4 h-4 text-blue-400"></i>
            Activity Timeline
        </h3>
        <div id="history-timeline">
            {# Will be populated via JS from /manage/api/activity/ #}
            <div class="text-sm text-white/40 text-center py-8">
                <i data-lucide="loader" class="w-5 h-5 animate-spin inline-block mb-2"></i><br>
                Loading timeline…
            </div>
        </div>
        <div id="history-timeline-empty" class="hidden rounded-xl border border-dashed border-white/15 bg-white/3 p-8 text-center">
            <i data-lucide="clock" class="w-8 h-8 text-white/15 mx-auto mb-3"></i>
            <p class="text-sm text-white/40">No activity recorded yet</p>
            <p class="text-xs text-white/25 mt-1">Team actions will appear here as they happen</p>
        </div>
    </div>

    {# ── Membership Ledger (OWNER / MANAGER) ── #}
    {% if is_admin %}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h3 class="text-base font-bold mb-4 flex items-center gap-2">
            <i data-lucide="users" class="w-4 h-4 text-purple-400"></i>
            Membership Ledger
        </h3>

        {# Table header #}
        <div class="hidden sm:grid grid-cols-12 gap-2 text-[10px] text-white/30 uppercase tracking-wider font-semibold px-3 py-2 mb-1">
            <div class="col-span-3">Member</div>
            <div class="col-span-2">Event</div>
            <div class="col-span-2">Old Role</div>
            <div class="col-span-2">New Role</div>
            <div class="col-span-3">Date</div>
        </div>

        <div id="membership-ledger-list">
            {# Will be populated via JS #}
            <div class="rounded-xl border border-dashed border-white/15 bg-white/3 p-6 text-center">
                <i data-lucide="book-open" class="w-7 h-7 text-white/15 mx-auto mb-2"></i>
                <p class="text-sm text-white/40">No membership events recorded</p>
            </div>
        </div>
    </div>
    {% endif %}

    {# ── Archive Info (if team is DISBANDED) ── #}
    {% if team.status == 'DISBANDED' %}
    <div class="rounded-3xl border border-red-500/20 bg-red-500/5 shadow-soft p-5 lg:p-6">
        <h3 class="text-base font-bold mb-2 flex items-center gap-2 text-red-400">
            <i data-lucide="archive" class="w-4 h-4"></i>
            Archived Team
        </h3>
        <p class="text-sm text-white/50 mb-3">
            This team was disbanded. Data will be retained per our retention policy.
        </p>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="rounded-xl bg-white/5 border border-white/8 p-3">
                <div class="text-xs text-white/40">Created</div>
                <div class="text-sm font-semibold mt-0.5">{{ team.created_at|date:"M d, Y" }}</div>
            </div>
            <div class="rounded-xl bg-white/5 border border-white/8 p-3">
                <div class="text-xs text-white/40">Status Changed</div>
                <div class="text-sm font-semibold mt-0.5">{{ team.updated_at|date:"M d, Y"|default:"—" }}</div>
            </div>
        </div>
    </div>
    {% endif %}

</section>
