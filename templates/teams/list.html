{% extends "base.html" %}
{% load static %}
{% load game_assets %}

{% block title %}Teams Hub — DeltaCrown Esports{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'teams/css/team-list-premium-complete.css' %}?v=7.0">
<link rel="stylesheet" href="{% static 'teams/css/team-list-modern-redesign.css' %}?v=1.0">
<link rel="stylesheet" href="{% static 'teams/css/team-join-modern.css' %}?v=1.0">
{% endblock %}

{% block content %}
<div class="teams-hub-premium">
    <!-- Advanced Background -->
    <div class="hub-background-advanced">
        <div class="gradient-mesh"></div>
        <div class="particle-layer" id="particles"></div>
        <div class="grid-pattern"></div>
    </div>

    <!-- Top Navigation Bar -->
    <nav class="teams-navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <i class="fas fa-users"></i>
                <span>Teams Hub</span>
            </div>
            
            <div class="navbar-actions">
                {% if user.is_authenticated %}
                <a href="{% url 'dashboard:index' %}" class="navbar-btn" title="My Teams & Invites">
                    <i class="fas fa-user-shield"></i>
                    <span>My Teams</span>
                    {% if user.userprofile.teams.count > 0 %}
                    <span class="badge">{{ user.userprofile.teams.count }}</span>
                    {% endif %}
                </a>
                <a href="{% url 'dashboard:index' %}" class="navbar-btn" title="Dashboard - View Invitations">
                    <i class="fas fa-envelope"></i>
                    <span>Invites</span>
                </a>
                {% endif %}
                
                <a href="{% url 'teams:create' %}" class="navbar-btn primary">
                    <i class="fas fa-plus-circle"></i>
                    <span>Create Team</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Hero Section with Stats -->
    <section class="hero-advanced">
        <div class="hero-content">
            <div class="hero-badge-group">
                <span class="hero-badge">
                    <i class="fas fa-fire"></i>
                    Competitive Hub
                </span>
                <span class="hero-badge secondary">
                    <i class="fas fa-globe"></i>
                    Global
                </span>
            </div>
            
            <h1 class="hero-title">
                <span class="title-line">Elite Competitive</span>
                <span class="title-line gradient">Teams & Rosters</span>
            </h1>
            
            <p class="hero-description">
                Join the competitive scene with <strong>{{ total_teams|default:"0" }}</strong> active teams 
                across <strong>{{ games_list|length|default:"0" }}</strong> games
            </p>

            <!-- Live Stats Grid -->
            <div class="hero-stats-grid">
                <div class="hero-stat-card">
                    <div class="stat-icon cyan">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-data">
                        <span class="stat-number">{{ total_teams|default:"0" }}</span>
                        <span class="stat-label">Active Teams</span>
                    </div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i> 12%
                    </div>
                </div>

                <div class="hero-stat-card">
                    <div class="stat-icon purple">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="stat-data">
                        <span class="stat-number">{{ active_tournaments|default:"0" }}</span>
                        <span class="stat-label">Tournaments</span>
                    </div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i> 8%
                    </div>
                </div>

                <div class="hero-stat-card">
                    <div class="stat-icon pink">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="stat-data">
                        <span class="stat-number">{{ recruiting_teams|default:"0" }}</span>
                        <span class="stat-label">Recruiting</span>
                    </div>
                    <div class="stat-badge">Open</div>
                </div>

                <div class="hero-stat-card">
                    <div class="stat-icon gold">
                        <i class="fas fa-gamepad"></i>
                    </div>
                    <div class="stat-data">
                        <span class="stat-number">{{ games_list|length|default:"0" }}</span>
                        <span class="stat-label">Games</span>
                    </div>
                    <div class="stat-badge">Active</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Container -->
    <div class="teams-main-container">
        
        <!-- Advanced Game Filter Bar -->
        <section class="game-filter-premium">
            <div class="filter-header-bar">
                <h2 class="filter-title">
                    <i class="fas fa-gamepad"></i>
                    Browse by Game
                </h2>
                <div class="filter-actions">
                    <button class="filter-scroll-btn" id="scroll-left">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="filter-scroll-btn" id="scroll-right">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <div class="game-filters-container" id="game-filters-scroll">
                <!-- All Games -->
                <a href="?{% if query %}q={{ query }}&{% endif %}{% if sort %}sort={{ sort }}{% endif %}" 
                   class="game-filter-card {% if not active_game %}active{% endif %}">
                    <div class="game-card-icon all-games">
                        <i class="fas fa-globe"></i>
                    </div>
                    <div class="game-card-info">
                        <span class="game-card-name">All Games</span>
                        <span class="game-card-count">{{ total_teams|default:"0" }} teams</span>
                    </div>
                    <div class="game-card-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                </a>

                <!-- Individual Games -->
                {% for game_info in games_list %}
                <a href="?game={{ game_info.code }}{% if query %}&q={{ query }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" 
                   class="game-filter-card {% if active_game == game_info.code %}active{% endif %}">
                    <div class="game-card-icon">
                        {% with game_code=game_info.code|upper %}
                        <img src="{% game_logo game_code %}" alt="{{ game_info.name }}">
                        {% endwith %}
                    </div>
                    <div class="game-card-info">
                        <span class="game-card-name">{{ game_info.name }}</span>
                        <span class="game-card-count">{{ game_info.team_count|default:"0" }} teams</span>
                    </div>
                    <div class="game-card-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                </a>
                {% endfor %}
            </div>
        </section>

        <!-- Control Panel -->
        <section class="control-panel-premium">
            <div class="control-panel-left">
                <!-- Search -->
                <div class="search-premium">
                    <div class="search-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <input type="search" 
                           class="search-input" 
                           placeholder="Search teams by name, tag, region..."
                           value="{{ query }}"
                           id="team-search-premium"
                           autocomplete="off">
                    <button class="search-clear" id="search-clear-premium" style="display: none;">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="search-loader" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </div>

                <!-- Advanced Filters Toggle -->
                <button class="btn-filters" id="filters-toggle">
                    <i class="fas fa-sliders-h"></i>
                    <span>Filters</span>
                    <span class="filter-badge" style="display: none;">0</span>
                </button>

                <!-- View Switcher -->
                <div class="view-switcher">
                    <button class="view-btn active" data-view="grid" title="Grid View">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="view-btn" data-view="list" title="List View">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>

            <div class="control-panel-right">
                <!-- Sort Options -->
                <div class="sort-premium">
                    <div class="sort-icon">
                        <i class="fas fa-sort-amount-down"></i>
                    </div>
                    <select class="sort-select" id="sort-select-premium">
                        <option value="rank_high" {% if sort == "rank_high" %}selected{% endif %}>Power Rank: High → Low</option>
                        <option value="rank_low" {% if sort == "rank_low" %}selected{% endif %}>Power Rank: Low → High</option>
                        <option value="points_high" {% if sort == "points_high" %}selected{% endif %}>Points: High → Low</option>
                        <option value="members_high" {% if sort == "members_high" %}selected{% endif %}>Members: Most First</option>
                        <option value="wins_high" {% if sort == "wins_high" %}selected{% endif %}>Wins: Most First</option>
                        <option value="name_az" {% if sort == "name_az" %}selected{% endif %}>Name: A → Z</option>
                        <option value="newest" {% if sort == "newest" %}selected{% endif %}>Newest First</option>
                    </select>
                </div>

                <!-- Results Count -->
                <div class="results-count">
                    <i class="fas fa-check-circle"></i>
                    <span>{{ object_list|length }} of {{ total_teams }}</span>
                </div>
            </div>
        </section>

        <!-- Advanced Filters Panel (Collapsible) -->
        <div class="advanced-filters-panel" id="advanced-filters" style="display: none;">
            <div class="filters-grid">
                <!-- Quick Filters -->
                <div class="filter-group">
                    <label class="filter-label">
                        <i class="fas fa-bolt"></i>
                        Quick Filters
                    </label>
                    <div class="filter-buttons">
                        <button class="filter-chip" data-filter="verified">
                            <i class="fas fa-check-circle"></i>
                            Verified Only
                        </button>
                        <button class="filter-chip" data-filter="recruiting">
                            <i class="fas fa-bullhorn"></i>
                            Recruiting
                        </button>
                        <button class="filter-chip" data-filter="featured">
                            <i class="fas fa-star"></i>
                            Featured
                        </button>
                    </div>
                </div>

                <!-- Region Filter -->
                <div class="filter-group">
                    <label class="filter-label">
                        <i class="fas fa-globe-americas"></i>
                        Region
                    </label>
                    <select class="filter-select" id="region-filter">
                        <option value="">All Regions</option>
                        <option value="North America">North America</option>
                        <option value="Europe">Europe</option>
                        <option value="Asia">Asia</option>
                        <option value="South America">South America</option>
                        <option value="Oceania">Oceania</option>
                        <option value="Middle East">Middle East</option>
                    </select>
                </div>

                <!-- Member Range -->
                <div class="filter-group">
                    <label class="filter-label">
                        <i class="fas fa-users"></i>
                        Team Size
                    </label>
                    <div class="range-inputs">
                        <input type="number" class="range-input" placeholder="Min" min="1" max="50" id="min-members">
                        <span class="range-separator">—</span>
                        <input type="number" class="range-input" placeholder="Max" min="1" max="50" id="max-members">
                    </div>
                </div>

                <!-- Clear Filters -->
                <div class="filter-group">
                    <button class="btn-clear-filters" id="clear-all-filters">
                        <i class="fas fa-undo"></i>
                        Clear All
                    </button>
                </div>
            </div>

            <!-- Active Filters Display -->
            <div class="active-filters-display" id="active-filters-display" style="display: none;">
                <span class="active-filters-label">Active Filters:</span>
                <div class="active-filters-list" id="active-filters-list">
                    <!-- Dynamically populated -->
                </div>
            </div>
        </div>

        <!-- Teams Display Area -->
        <section class="teams-display-section">
            <!-- My Teams Quick Access (Authenticated Only) -->
            {% if user.is_authenticated %}
            <div class="my-teams-quick" id="my-teams-quick" style="display: none;">
                <div class="quick-header">
                    <h3>
                        <i class="fas fa-user-shield"></i>
                        My Teams
                    </h3>
                    <button class="close-quick" id="close-my-teams-quick">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="quick-content" id="my-teams-quick-content">
                    <!-- Loaded via AJAX -->
                </div>
            </div>
            {% endif %}

            <!-- Teams Grid/List -->
            <div class="teams-container grid-view" id="teams-container">
                {% if object_list %}
                    {% for team in object_list %}
                    <article class="team-card-premium {% if team.rank_position <= 3 %}podium-team{% endif %}" 
                             data-team-id="{{ team.id }}"
                             data-team-slug="{{ team.slug }}"
                             data-rank="{{ team.rank_position }}"
                             style="cursor: pointer;"
                             onclick="window.location.href='{{ team.get_absolute_url }}';">
                        
                        <!-- Rank Badge (Top 3 get special treatment) -->
                        {% if team.rank_position <= 3 %}
                        <div class="rank-badge-podium rank-{{ team.rank_position }}">
                            <div class="podium-icon">
                                {% if team.rank_position == 1 %}
                                    <i class="fas fa-crown"></i>
                                {% elif team.rank_position == 2 %}
                                    <i class="fas fa-medal"></i>
                                {% else %}
                                    <i class="fas fa-award"></i>
                                {% endif %}
                            </div>
                            <span class="podium-number">#{{ team.rank_position }}</span>
                        </div>
                        {% else %}
                        <div class="rank-badge-normal">
                            <span>#{{ team.rank_position }}</span>
                        </div>
                        {% endif %}

                        <!-- Team Banner -->
                        <div class="team-banner-advanced">
                            {% if team.banner_image %}
                                <img src="{{ team.banner_image.url }}" alt="{{ team.name }} banner" class="banner-img">
                            {% else %}
                                <div class="banner-gradient"></div>
                            {% endif %}
                            <div class="banner-overlay-gradient"></div>
                            
                            <!-- Badges Overlay -->
                            <div class="banner-badges">
                                {% if team.is_verified %}
                                <span class="team-badge verified" title="Verified Team">
                                    <i class="fas fa-check-circle"></i>
                                </span>
                                {% endif %}
                                {% if team.is_featured %}
                                <span class="team-badge featured" title="Featured Team">
                                    <i class="fas fa-star"></i>
                                </span>
                                {% endif %}
                                {% if team.is_recruiting or team.allow_join_requests %}
                                <span class="team-badge recruiting" title="Recruiting">
                                    <i class="fas fa-bullhorn"></i>
                                    Recruiting
                                </span>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Team Logo -->
                        <div class="team-logo-premium">
                            <div class="logo-container">
                                {% if team.logo %}
                                    <img src="{{ team.logo.url }}" alt="{{ team.name }}" class="logo-img">
                                {% else %}
                                    <div class="logo-placeholder">
                                        {{ team.name|first|upper }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Team Info -->
                        <div class="team-info-premium">
                            <div class="team-name-section">
                                <h3 class="team-name">
                                    {{ team.name }}
                                    {% if team.is_verified %}
                                        <i class="fas fa-check-circle verified-inline" title="Verified"></i>
                                    {% endif %}
                                </h3>
                                {% if team.tag %}
                                    <span class="team-tag-premium">[{{ team.tag }}]</span>
                                {% endif %}
                            </div>

                            {% if team.tagline %}
                                <p class="team-tagline">{{ team.tagline|truncatechars:60 }}</p>
                            {% endif %}

                            <!-- Game & Region Badge -->
                            <div class="team-meta-badges">
                                {% if team.game %}
                                <div class="meta-badge game">
                                    {% load game_helpers %}
                                    <img src="{% game_logo team.game %}" alt="{{ team.game }}">
                                    <span>{{ team.game|game_display_name }}</span>
                                </div>
                                {% endif %}
                                
                                {% if team.region %}
                                <div class="meta-badge region">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span>{{ team.region }}</span>
                                </div>
                                {% endif %}
                            </div>

                            <!-- Stats Grid -->
                            <div class="team-stats-premium">
                                <div class="stat-box">
                                    <div class="stat-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value">{{ team.members_count|default:0 }}</span>
                                        <span class="stat-label">Members</span>
                                    </div>
                                </div>

                                <div class="stat-box">
                                    <div class="stat-icon">
                                        <i class="fas fa-bolt"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value">{{ team.total_points|default:0 }}</span>
                                        <span class="stat-label">Points</span>
                                    </div>
                                </div>

                                <div class="stat-box">
                                    <div class="stat-icon">
                                        <i class="fas fa-trophy"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value">{{ team.tournament_wins|default:0 }}</span>
                                        <span class="stat-label">Wins</span>
                                    </div>
                                </div>

                                <div class="stat-box">
                                    <div class="stat-icon">
                                        <i class="fas fa-fire"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value">{{ team.power_rank|floatformat:0|default:0 }}</span>
                                        <span class="stat-label">Power</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="team-actions-premium">
                                <a href="{{ team.get_absolute_url }}" class="btn-action primary-action">
                                    <i class="fas fa-eye"></i>
                                    <span>View Team</span>
                                </a>
                                {% if team.show_join_button %}
                                    <button class="btn-action secondary-action join-team-btn" 
                                            data-team-slug="{{ team.slug }}"
                                            data-team-name="{{ team.name }}"
                                            data-team-game="{{ team.game }}"
                                            onclick="event.stopPropagation();">
                                        <i class="fas fa-user-plus"></i>
                                        <span>Join</span>
                                    </button>
                                {% elif team.user_is_member %}
                                    <span class="btn-action member-badge" title="You are a member">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Member</span>
                                    </span>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Power Rank Indicator -->
                        {% if team.power_rank %}
                        <div class="power-rank-indicator">
                            <div class="power-fill" style="width: {{ team.power_rank|floatformat:0|add:"0"|divisibleby:"50" }}%"></div>
                            <span class="power-label">
                                <i class="fas fa-bolt"></i>
                                {{ team.power_rank|floatformat:0 }}
                            </span>
                        </div>
                        {% endif %}
                    </article>
                    {% endfor %}

                    <!-- Pagination Controls -->
                    {% if paginator.num_pages > 1 %}
                    <div class="pagination-container-premium">
                        <div class="pagination-info">
                            <i class="fas fa-list"></i>
                            <span>Showing page {{ page_obj.number }} of {{ paginator.num_pages }} ({{ paginator.count }} total teams)</span>
                        </div>
                        
                        <nav class="pagination-controls" aria-label="Team pagination">
                            <!-- Previous Button -->
                            {% if page_obj.has_previous %}
                                <a href="?page=1{% if query %}&q={{ query }}{% endif %}{% if active_game %}&game={{ active_game }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" 
                                   class="pagination-btn" title="First page">
                                    <i class="fas fa-angle-double-left"></i>
                                </a>
                                <a href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if active_game %}&game={{ active_game }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" 
                                   class="pagination-btn" title="Previous page">
                                    <i class="fas fa-angle-left"></i>
                                    <span class="btn-text">Previous</span>
                                </a>
                            {% else %}
                                <span class="pagination-btn disabled">
                                    <i class="fas fa-angle-double-left"></i>
                                </span>
                                <span class="pagination-btn disabled">
                                    <i class="fas fa-angle-left"></i>
                                    <span class="btn-text">Previous</span>
                                </span>
                            {% endif %}

                            <!-- Page Numbers -->
                            <div class="pagination-numbers">
                                {% for num in paginator.page_range %}
                                    {% if page_obj.number == num %}
                                        <span class="pagination-number active">{{ num }}</span>
                                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                        <a href="?page={{ num }}{% if query %}&q={{ query }}{% endif %}{% if active_game %}&game={{ active_game }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" 
                                           class="pagination-number">{{ num }}</a>
                                    {% elif num == 1 or num == paginator.num_pages %}
                                        {% if num == 1 and page_obj.number > 4 %}
                                            <a href="?page={{ num }}{% if query %}&q={{ query }}{% endif %}{% if active_game %}&game={{ active_game }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" 
                                               class="pagination-number">{{ num }}</a>
                                            <span class="pagination-ellipsis">...</span>
                                        {% elif num == paginator.num_pages and page_obj.number < paginator.num_pages|add:'-3' %}
                                            <span class="pagination-ellipsis">...</span>
                                            <a href="?page={{ num }}{% if query %}&q={{ query }}{% endif %}{% if active_game %}&game={{ active_game }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" 
                                               class="pagination-number">{{ num }}</a>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </div>

                            <!-- Next Button -->
                            {% if page_obj.has_next %}
                                <a href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if active_game %}&game={{ active_game }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" 
                                   class="pagination-btn" title="Next page">
                                    <span class="btn-text">Next</span>
                                    <i class="fas fa-angle-right"></i>
                                </a>
                                <a href="?page={{ paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}{% if active_game %}&game={{ active_game }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" 
                                   class="pagination-btn" title="Last page">
                                    <i class="fas fa-angle-double-right"></i>
                                </a>
                            {% else %}
                                <span class="pagination-btn disabled">
                                    <span class="btn-text">Next</span>
                                    <i class="fas fa-angle-right"></i>
                                </span>
                                <span class="pagination-btn disabled">
                                    <i class="fas fa-angle-double-right"></i>
                                </span>
                            {% endif %}
                        </nav>

                        <!-- Quick Jump -->
                        <div class="pagination-jump">
                            <label for="page-jump-input">Go to page:</label>
                            <input type="number" 
                                   id="page-jump-input" 
                                   min="1" 
                                   max="{{ paginator.num_pages }}" 
                                   value="{{ page_obj.number }}"
                                   class="page-jump-input">
                            <button class="page-jump-btn" id="page-jump-btn">
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                    {% endif %}

                {% else %}
                    <!-- Empty State -->
                    <div class="empty-state-premium">
                        <div class="empty-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3>No Teams Found</h3>
                        <p>
                            {% if query or active_game %}
                                No teams match your current search and filters.
                                Try adjusting your criteria or clearing all filters.
                            {% else %}
                                Be the first to create a competitive team!
                            {% endif %}
                        </p>
                        <div class="empty-actions">
                            {% if query or active_game %}
                                <button class="btn-empty primary" onclick="window.location.href='{% url 'teams:list' %}'">
                                    <i class="fas fa-undo"></i>
                                    Clear Filters
                                </button>
                            {% endif %}
                            <a href="{% url 'teams:create' %}" class="btn-empty secondary">
                                <i class="fas fa-plus-circle"></i>
                                Create Team
                            </a>
                        </div>
                    </div>
                {% endif %}
            </div>
        </section>
    </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay-premium" id="loading-overlay-premium">
    <div class="loading-content">
        <div class="loading-spinner-premium"></div>
        <p>Loading teams...</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'teams/js/team-join-modern.js' %}?v=1.0"></script>
    <script src="{% static 'teams/js/team-list-premium.js' %}?v=8.0"></script>
    <script src="{% static 'teams/js/team-list-vlr-style.js' %}?v=1.0"></script>
    
    <!-- Pagination Quick Jump Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const pageJumpBtn = document.getElementById('page-jump-btn');
            const pageJumpInput = document.getElementById('page-jump-input');
            
            if (pageJumpBtn && pageJumpInput) {
                // Handle jump button click
                pageJumpBtn.addEventListener('click', function() {
                    const pageNum = parseInt(pageJumpInput.value);
                    const maxPages = parseInt(pageJumpInput.max);
                    
                    if (pageNum >= 1 && pageNum <= maxPages) {
                        // Build URL with current filters preserved
                        const currentUrl = new URL(window.location.href);
                        const params = new URLSearchParams(currentUrl.search);
                        params.set('page', pageNum);
                        window.location.href = `${currentUrl.pathname}?${params.toString()}`;
                    } else {
                        alert(`Please enter a page number between 1 and ${maxPages}`);
                        pageJumpInput.value = '';
                        pageJumpInput.focus();
                    }
                });
                
                // Allow Enter key to trigger jump
                pageJumpInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        pageJumpBtn.click();
                    }
                });
            }
        });
    </script>
{% endblock %}
