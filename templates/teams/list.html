{% extends "base_no_footer.html" %}
{% load static %}
{% load game_assets %}

{% block title %}Team Rankings — DeltaCrown{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'siteui/css/teams-list-two-column.css' %}?v=1.2">
<link rel="stylesheet" href="{% static 'siteui/css/teams-responsive.css' %}?v=1.0">
<link rel="stylesheet" href="{% static 'siteui/css/teams-hub-hero.css' %}?v=1.0">
<link rel="preload" href="{% static 'siteui/js/teams-list-two-column.js' %}" as="script">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
{% endblock %}

{% block content %}
<div class="teams-page-wrapper">
  <!-- Mobile Sidebar Toggle -->
  <button class="mobile-sidebar-toggle" id="mobile-sidebar-toggle" aria-label="Open filters">
    <i class="fas fa-filter"></i>
  </button>

  <!-- Sidebar Overlay for Mobile -->
  <div class="sidebar-overlay" id="sidebar-overlay"></div>

  <div class="teams-page-container">
    <!-- LEFT SIDEBAR - Quick Actions, Filters, Stats -->
    <aside class="left-sidebar" id="left-sidebar">
      <!-- Mobile Close Button -->
      <button class="sidebar-close" id="sidebar-close" aria-label="Close filters">
        <i class="fas fa-times"></i>
      </button>

      <!-- Quick Actions Section -->
      <div class="sidebar-section">
        <h3 class="sidebar-title">
          <i class="fas fa-bolt"></i>
          Quick Actions
        </h3>
        <div class="quick-actions">
          <a href="{% url 'teams:create' %}" class="action-button primary">
            <i class="fas fa-plus"></i>
            Create New Team
          </a>
          {% if user.is_authenticated %}
            <a href="{% url 'teams:my_invites' %}" class="action-button">
              <i class="fas fa-envelope"></i>
              My Invitations
            </a>
            <a href="#" class="action-button">
              <i class="fas fa-users"></i>
              My Teams
            </a>
          {% else %}
            <a href="/admin/login/" class="action-button">
              <i class="fas fa-sign-in-alt"></i>
              Login to Join Teams
            </a>
          {% endif %}
        </div>
      </div>

      <!-- Filter by Game Section -->
      <div class="sidebar-section">
        <button class="sidebar-title filter-toggle" id="game-filter-toggle" aria-expanded="true">
          <div class="filter-title-content">
            <i class="fas fa-gamepad"></i>
            <span>Filter by Game</span>
          </div>
          <i class="fas fa-chevron-down filter-chevron"></i>
        </button>
        <div class="game-filters expanded" id="game-filters">
          <div class="games-grid-filter">
            <!-- All Games Filter -->
            <a href="?{% if query %}q={{ query }}&{% endif %}{% if sort %}sort={{ sort }}&{% endif %}{% if order %}order={{ order }}{% endif %}" 
               class="game-filter-card {% if not active_game %}active{% endif %}" 
               data-game="">
              <div class="game-filter-banner" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
              <div class="game-filter-overlay">
                <div class="game-filter-logo" style="background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%); display: flex; align-items: center; justify-content: center;">
                  <i class="fas fa-globe" style="font-size: 12px; color: white;"></i>
                </div>
                <div class="game-filter-info">
                  <div class="game-filter-name">All Games</div>
                  <div class="game-filter-count">
                    <i class="fas fa-shield-alt"></i>
                    {{ paginator.count|default:"0" }} teams
                  </div>
                </div>
              </div>
              <div class="game-filter-action">View All</div>
            </a>
            
            <!-- Individual Game Filters -->
            {% for game_info in games_list %}
            <a href="?game={{ game_info.code }}{% if query %}&q={{ query }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}{% if order %}&order={{ order }}{% endif %}" 
               class="game-filter-card {% if active_game == game_info.code %}active{% endif %}" 
               data-game="{{ game_info.code }}">
              
              <!-- Use centralized game assets system -->
              {% with game_code=game_info.code|upper %}
                <img src="{% game_card game_code %}" alt="{{ game_info.name }}" class="game-filter-banner">
                <div class="game-filter-overlay">
                  <img src="{% game_logo game_code %}" alt="{{ game_info.name }} Logo" class="game-filter-logo">
                  <div class="game-filter-info">
                    <div class="game-filter-name">{{ game_info.name }}</div>
                    <div class="game-filter-count">
                      <i class="fas fa-shield-alt"></i>
                      {{ game_info.team_count|default:"0" }} teams
                    </div>
                  </div>
                </div>
              {% endwith %}
              <div class="game-filter-action">View Teams</div>
            </a>
            {% endfor %}
        </div>
      </div>

      <!-- Team Stats Section -->
      <div class="sidebar-section">
        <h3 class="sidebar-title">
          <i class="fas fa-chart-bar"></i>
          Team Stats
        </h3>
        <div class="team-stats">
          <div class="stat-card">
            <div class="stat-value">{{ total_teams|default:"0" }}</div>
            <div class="stat-label">Total Teams</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ active_teams|default:"0" }}</div>
            <div class="stat-label">Active</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ recruiting_teams|default:"0" }}</div>
            <div class="stat-label">Recruiting</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ games_list|length|default:"0" }}</div>
            <div class="stat-label">Games</div>
          </div>
        </div>
      </div>

      <!-- Team Ranking System Info -->
      <div class="sidebar-section">
        <div class="ranking-system">
          <h3 class="ranking-title">
            <i class="fas fa-trophy"></i>
            Ranking Algorithm
          </h3>
          <div class="ranking-explanation">
            <p class="ranking-description">Rankings are calculated using multiple performance metrics:</p>
            
            <div class="ranking-formula">
              <div class="formula-title">
                <i class="fas fa-calculator"></i>
                <span>Power Score Formula</span>
              </div>
              <div class="formula-breakdown">
                <div class="formula-item">
                  <span class="formula-component">Base Score:</span>
                  <span class="formula-value">1000 pts</span>
                </div>
                <div class="formula-item">
                  <span class="formula-component">Members (×50):</span>
                  <span class="formula-value">Up to +400</span>
                </div>
                <div class="formula-item">
                  <span class="formula-component">Tournament Wins:</span>
                  <span class="formula-value">+500 each</span>
                </div>
                <div class="formula-item">
                  <span class="formula-component">Recent Activity:</span>
                  <span class="formula-value">+200</span>
                </div>
                <div class="formula-item">
                  <span class="formula-component">Verified Status:</span>
                  <span class="formula-value">+300</span>
                </div>
              </div>
            </div>
            
            <div class="ranking-factors">
              <div class="ranking-factor">
                <i class="fas fa-medal"></i>
                <span>Tournament Performance</span>
                <small>Major factor</small>
              </div>
              <div class="ranking-factor">
                <i class="fas fa-users"></i>
                <span>Team Size & Activity</span>
                <small>Growth indicator</small>
              </div>
              <div class="ranking-factor">
                <i class="fas fa-certificate"></i>
                <span>Official Recognition</span>
                <small>Trust signal</small>
              </div>
            </div>
            
            <div class="ranking-update">
              <i class="fas fa-sync-alt"></i>
              <small>Rankings update in real-time based on team performance</small>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- RIGHT CONTENT - Team List with Top 10 + Load More -->
    <main class="right-content" id="teams-page-container">
      <!-- Modern Esports Hero Section -->
      <header class="esports-hero-section">
        <!-- Animated Background -->
        <div class="hero-background">
          <div class="hero-gradient-mesh"></div>
          <div class="hero-grid-overlay"></div>
          <div class="hero-particles-container">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
          </div>
        </div>
        
        <!-- Hero Content -->
        <div class="hero-content-wrapper">
          <div class="hero-main-content">
            <!-- Title Section -->
            <div class="hero-title-section">
              <div class="hero-badge">
                <i class="fas fa-shield-alt"></i>
                <span>Competitive Rankings</span>
              </div>
              <h1 class="hero-title">
                <span class="hero-title-line-1">Elite Esports</span>
                <span class="hero-title-line-2">Team Rankings</span>
              </h1>
              <p class="hero-description">
                Compete with the best. Join <span class="highlight-text">{{ total_teams|default:"0" }}</span> active teams across <span class="highlight-text">{{ games_list|length }}</span> esports titles.
              </p>
            </div>
            
            <!-- Stats Grid -->
            <div class="hero-stats-grid">
              <div class="hero-stat-card">
                <div class="stat-icon">
                  <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-number" data-count="{{ total_teams|default:'0' }}">{{ total_teams|default:"0" }}</div>
                  <div class="stat-label">Active Teams</div>
                </div>
                <div class="stat-glow"></div>
              </div>
              
              <div class="hero-stat-card">
                <div class="stat-icon">
                  <i class="fas fa-user-plus"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-number" data-count="{{ recruiting_teams|default:'0' }}">{{ recruiting_teams|default:"0" }}</div>
                  <div class="stat-label">Recruiting</div>
                </div>
                <div class="stat-glow"></div>
              </div>
              
              <div class="hero-stat-card">
                <div class="stat-icon">
                  <i class="fas fa-gamepad"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-number" data-count="{{ games_list|length|default:'0' }}">{{ games_list|length|default:"0" }}</div>
                  <div class="stat-label">Games</div>
                </div>
                <div class="stat-glow"></div>
              </div>
            </div>
          </div>
          
          <!-- Decorative Elements -->
          <div class="hero-decoration">
            <div class="decoration-circle circle-1"></div>
            <div class="decoration-circle circle-2"></div>
            <div class="decoration-circle circle-3"></div>
          </div>
        </div>
      </header>

      <!-- My Teams Section (Initially Hidden) -->
      {% if user.is_authenticated %}
      <div class="my-teams-section" id="my-teams-section" style="display: none;">
        <div class="my-teams-header">
          <h2 class="my-teams-title">
            <i class="fas fa-user-shield"></i>
            My Teams
          </h2>
          <button type="button" class="close-my-teams" id="close-my-teams">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="my-teams-content" id="my-teams-content">
          <!-- Content will be loaded via AJAX -->
          <div class="loading-teams">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Loading your teams...</span>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Content Navigation -->
      <div class="content-navigation">
        <div class="nav-breadcrumb">
          <span class="nav-current">Team Rankings</span>
          <span class="nav-info">
            Showing {% if paginator.count %}{{ paginator.count }}{% else %}0{% endif %} teams
            {% if active_game %}in {{ active_game|title }}{% endif %}
          </span>
        </div>
      </div>

      <!-- Game Icon Filter Bar -->
      <div class="game-icon-filter-bar">
        <div class="game-filter-label">
          <i class="fas fa-gamepad"></i>
          <span>Filter by Game:</span>
        </div>
        <div class="game-icon-filters">
          <a href="?{% if query %}q={{ query }}&{% endif %}{% if sort %}sort={{ sort }}&{% endif %}{% if order %}order={{ order }}{% endif %}" 
             class="game-icon-filter {% if not active_game %}active{% endif %}" 
             data-game=""
             title="All Games">
            <div class="game-icon-circle all-games">
              <i class="fas fa-globe"></i>
            </div>
            <span class="game-icon-label">All</span>
          </a>
          
          {% for game_info in games_list %}
          <a href="?game={{ game_info.code }}{% if query %}&q={{ query }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}{% if order %}&order={{ order }}{% endif %}" 
             class="game-icon-filter {% if active_game == game_info.code %}active{% endif %}" 
             data-game="{{ game_info.code }}"
             title="{{ game_info.name }} ({{ game_info.team_count }} teams)">
            <div class="game-icon-circle">
              {% with game_code=game_info.code|upper %}
                <img src="{% game_logo game_code %}" alt="{{ game_info.name }}">
              {% endwith %}
            </div>
            <span class="game-icon-label">{{ game_info.name }}</span>
            <span class="game-team-count">{{ game_info.team_count }}</span>
          </a>
          {% endfor %}
        </div>
      </div>

      <!-- Search and Sort Bar -->
      <div class="search-sort-bar">
        <div class="search-input-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input type="search" 
                 class="search-input" 
                 placeholder="Search teams by name or tag..." 
                 value="{{ query }}"
                 id="team-search"
                 autocomplete="off">
          <button type="button" class="search-clear-btn" id="search-clear" style="display: none;" aria-label="Clear search">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <div class="sort-controls">
          <div class="sort-group">
            <label for="sort-select" class="sort-label">Sort by:</label>
            <select class="sort-select" id="sort-select">
              <option value="rank_high" {% if sort == "rank_high" %}selected{% endif %}>Ranking (High to Low)</option>
              <option value="rank_low" {% if sort == "rank_low" %}selected{% endif %}>Ranking (Low to High)</option>
              <option value="points_high" {% if sort == "points_high" %}selected{% endif %}>Points (High to Low)</option>
              <option value="points_low" {% if sort == "points_low" %}selected{% endif %}>Points (Low to High)</option>
              <option value="members_high" {% if sort == "members_high" %}selected{% endif %}>Members (High to Low)</option>
              <option value="members_low" {% if sort == "members_low" %}selected{% endif %}>Members (Low to High)</option>
              <option value="name_az" {% if sort == "name_az" %}selected{% endif %}>Name (A to Z)</option>
              <option value="name_za" {% if sort == "name_za" %}selected{% endif %}>Name (Z to A)</option>
              <option value="newest" {% if sort == "newest" %}selected{% endif %}>Newest First</option>
              <option value="oldest" {% if sort == "oldest" %}selected{% endif %}>Oldest First</option>
            </select>
          </div>
          
          <button type="button" class="sort-direction-toggle" id="sort-direction-toggle" aria-label="Toggle sort direction" title="Toggle sort direction">
            <i class="fas fa-sort-amount-down" id="sort-direction-icon"></i>
          </button>
          
          <div class="view-options">
            <button type="button" class="view-toggle" data-view="grid" aria-label="Grid view" title="Grid view">
              <i class="fas fa-th"></i>
            </button>
            <button type="button" class="view-toggle active" data-view="list" aria-label="List view" title="List view">
              <i class="fas fa-list"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Team List Container with Infinite Scroll -->
      <div class="team-list-container" id="team-list-container">
        {% if object_list %}
          <div class="team-list" id="team-list">
            {% for team in object_list %}
              <article class="team-card {% if forloop.counter <= 3 %}top-rank{% endif %}" 
                       data-team-id="{{ team.id }}"
                       onclick="window.location.href='{{ team.get_absolute_url }}';"
                       style="cursor: pointer;">
                
                <!-- Team Header - Compact Layout -->
                <header class="team-header">
                  <div class="team-rank {% if team.rank_position <= 3 %}top-3{% endif %}">
                    #{{ team.rank_position|default:forloop.counter }}
                  </div>
                  
                  <div class="team-logo-container">
                    {% if team.logo %}
                      <img src="{{ team.logo.url }}" alt="{{ team.name }} logo" class="team-logo" loading="lazy">
                    {% else %}
                      <div class="team-logo-placeholder">
                        {{ team.name|first|upper }}
                      </div>
                    {% endif %}
                  </div>
                  
                  <div class="team-main-info">
                    <div class="team-name-section">
                      <h2 class="team-name">{{ team.name }}</h2>
                      {% if team.tag %}
                        <span class="team-tag">[{{ team.tag }}]</span>
                      {% endif %}
                    </div>
                    
                    {% if team.game %}
                      <div class="team-game-badge">
                        {% with game_code=team.game|upper %}
                          <img src="{% game_logo game_code %}" alt="{{ team.game|title }}" class="team-game-logo">
                          <span>{{ team.game|title }}</span>
                        {% endwith %}
                      </div>
                    {% endif %}
                  </div>
                </header>

                <!-- Team Stats - Compact -->
                <div class="team-stats">
                  <div class="team-stat-item">
                    <span class="stat-value">{{ team.memberships.count|default:0 }}</span>
                    <span class="stat-label">Members</span>
                  </div>
                  <div class="team-stat-item">
                    <span class="stat-value">{{ team.total_points|default:0 }}</span>
                    <span class="stat-label">Points</span>
                  </div>
                  <div class="team-stat-item">
                    <span class="stat-value">{{ team.tournament_wins|default:0 }}</span>
                    <span class="stat-label">Wins</span>
                  </div>
                  <div class="team-stat-item">
                    <span class="stat-value">{{ team.region|default:"Global"|truncatechars:6 }}</span>
                    <span class="stat-label">Region</span>
                  </div>
                </div>

                <!-- Power Rank Indicator -->
                {% if team.power_rank %}
                <div class="power-rank-indicator">
                  <div class="power-rank-score">
                    <i class="fas fa-bolt"></i>
                    <span class="power-score">{{ team.power_rank|floatformat:0 }}</span>
                  </div>
                  <div class="power-rank-label">Power Score</div>
                </div>
                {% endif %}

                <!-- Team Actions -->
                <div class="team-actions" onclick="event.stopPropagation();">
                  <a href="{{ team.get_absolute_url }}" class="team-action-btn secondary">
                    <i class="fas fa-eye"></i>
                    View Details
                  </a>
                  {% if team.allow_join_requests %}
                    <a href="{% url 'teams:join' team.slug %}" class="team-action-btn primary">
                      <i class="fas fa-user-plus"></i>
                      Join Team
                    </a>
                  {% endif %}
                </div>
              </article>
            {% endfor %}
          </div>

          <!-- Load More Button Container -->
          {% if paginator.num_pages > 1 and page_obj.has_next %}
            <div class="load-more-container">
              <button class="load-more-btn" id="load-more-btn" data-next-page="{{ page_obj.next_page_number }}">
                <span class="load-more-text">Load More Teams</span>
                <i class="fas fa-chevron-down"></i>
              </button>
            </div>
          {% endif %}

        {% else %}
          <!-- Empty State -->
          <div class="empty-state">
            <div class="empty-state-icon">
              <i class="fas fa-users"></i>
            </div>
            <h3>No Teams Found</h3>
            <p>{% if query or active_game %}No teams match your current search criteria.{% else %}No teams are currently registered on the platform.{% endif %}</p>
            <a href="{% url 'teams:create' %}" class="team-action-btn primary">
              <i class="fas fa-plus"></i>
              Create First Team
            </a>
          </div>
        {% endif %}

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loading-overlay">
          <div class="loading-spinner"></div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- Skip Link for Accessibility -->
<a href="#team-list" class="skip-link">Skip to team list</a>
{% endblock %}

{% block extra_js %}
<script src="{% static 'siteui/js/teams-list-two-column.js' %}?v=1.0" defer></script>
<script src="{% static 'siteui/js/teams-responsive.js' %}?v=1.0" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Enhanced projectile interaction system
    initProjectileSystem();
    
    // My Teams functionality
    const showMyTeamsBtn = document.getElementById('show-my-teams-btn');
    const myTeamsSection = document.getElementById('my-teams-section');
    
    if (showMyTeamsBtn && myTeamsSection) {
        showMyTeamsBtn.addEventListener('click', function() {
            const isHidden = myTeamsSection.style.display === 'none' || 
                            myTeamsSection.style.display === '';
            
            if (isHidden) {
                myTeamsSection.style.display = 'block';
                showMyTeamsBtn.innerHTML = '<i class="fas fa-users"></i> Hide My Teams';
                
                // Load user teams via AJAX if not already loaded
                if (!myTeamsSection.dataset.loaded) {
                    loadMyTeams();
                    myTeamsSection.dataset.loaded = 'true';
                }
            } else {
                myTeamsSection.style.display = 'none';
                showMyTeamsBtn.innerHTML = '<i class="fas fa-users"></i> My Teams';
            }
        });
    }
    
    function loadMyTeams() {
        const loadingIndicator = myTeamsSection.querySelector('.my-teams-loading');
        const contentContainer = myTeamsSection.querySelector('.my-teams-content');
        
        if (loadingIndicator) {
            loadingIndicator.style.display = 'block';
        }
        
        // Fetch user teams
        fetch('/teams/my-teams-data/', {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
            }
            
            if (data.teams && data.teams.length > 0) {
                displayMyTeams(data.teams, contentContainer);
            } else {
                displayNoTeams(contentContainer);
            }
        })
        .catch(error => {
            console.error('Error loading teams:', error);
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
            }
            displayError(contentContainer);
        });
    }
    
    function displayMyTeams(teams, container) {
        if (!container) return;
        
        let html = '<div class="my-teams-grid">';
        teams.forEach(team => {
            html += `
                <div class="my-team-card">
                    <div class="my-team-header">
                        ${team.logo ? `<img src="${team.logo}" alt="${team.name}" class="my-team-logo">` : 
                                    `<div class="my-team-logo-placeholder"><i class="fas fa-shield-alt"></i></div>`}
                        <div class="my-team-info">
                            <h4 class="my-team-name">${team.name}</h4>
                            <p class="my-team-game">${team.game_display}</p>
                        </div>
                    </div>
                    <div class="my-team-stats">
                        <span class="my-team-role ${team.role}">${team.role}</span>
                        <span class="my-team-members">${team.members_count} members</span>
                    </div>
                    <div class="my-team-actions">
                        <a href="${team.url}" class="btn-team-view">View Team</a>
                        ${team.can_manage ? `<a href="${team.manage_url}" class="btn-team-manage">Manage</a>` : ''}
                    </div>
                </div>
            `;
        });
        html += '</div>';
        
        container.innerHTML = html;
    }
    
    function displayNoTeams(container) {
        if (!container) return;
        
        container.innerHTML = `
            <div class="my-teams-empty">
                <div class="empty-state-icon">
                    <i class="fas fa-users-slash"></i>
                </div>
                <h4>No Teams Yet</h4>
                <p>You haven't joined any teams yet. Start by creating your own or joining an existing team!</p>
                <div class="empty-actions">
                    <a href="/teams/create/" class="hero-btn primary">
                        <i class="fas fa-plus"></i>
                        Create Team
                    </a>
                    <a href="#team-list-container" class="hero-btn secondary">
                        <i class="fas fa-search"></i>
                        Browse Teams
                    </a>
                </div>
            </div>
        `;
    }
    
    function displayError(container) {
        if (!container) return;
        
        container.innerHTML = `
            <div class="my-teams-error">
                <div class="error-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h4>Error Loading Teams</h4>
                <p>There was a problem loading your teams. Please try again.</p>
                <button onclick="loadMyTeams()" class="hero-btn secondary">
                    <i class="fas fa-refresh"></i>
                    Retry
                </button>
            </div>
        `;
    }
    
    // Enhanced projectile interaction system
    function initProjectileSystem() {
        const floatingIcons = document.querySelectorAll('.floating-game-icon');
        const projectiles = document.querySelectorAll('.projectile');
        
        // Add collision detection for projectiles and floating icons
        if (projectiles.length > 0 && floatingIcons.length > 0) {
            setInterval(() => {
                projectiles.forEach(projectile => {
                    const projectileRect = projectile.getBoundingClientRect();
                    
                    floatingIcons.forEach(icon => {
                        const iconRect = icon.getBoundingClientRect();
                        
                        // Simple collision detection
                        if (projectileRect.left < iconRect.right && 
                            projectileRect.right > iconRect.left && 
                            projectileRect.top < iconRect.bottom && 
                            projectileRect.bottom > iconRect.top) {
                            
                            // Add hit effect
                            icon.classList.add('hit');
                            setTimeout(() => {
                                icon.classList.remove('hit');
                            }, 600);
                        }
                    });
                });
            }, 100);
        }
        
        // Add click-to-filter functionality to floating game icons
        floatingIcons.forEach(icon => {
            icon.addEventListener('click', function() {
                const gameCode = this.dataset.game;
                if (gameCode) {
                    // Build URL with current query params
                    const url = new URL(window.location);
                    url.searchParams.set('game', gameCode);
                    window.location.href = url.toString();
                }
            });
            
            // Add cursor pointer
            icon.style.cursor = 'pointer';
        });
    }
});
</script>
{% endblock %}

