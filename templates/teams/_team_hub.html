<!-- Role-Based Member Dashboard -->
<!-- Only shown to team members (is_member=True) -->
{% if is_member %}

<!-- Dashboard Header with Role Display -->
<div class="card glass p-6 mb-6">
  <div class="flex items-center justify-between mb-4">
    <div>
      <h2 class="text-2xl font-bold flex items-center gap-3">
        <i class="fas fa-tachometer-alt text-cyan-400"></i>
        {% if is_owner %}
          Team Owner Dashboard
        {% elif is_manager %}
          Manager Dashboard
        {% elif is_coach %}
          Coach Dashboard
        {% else %}
          Member Dashboard
        {% endif %}
      </h2>
      <p class="text-gray-400 mt-1">Welcome back, {{ request.user.username }}!</p>
    </div>
    <div class="text-right">
      <div class="text-sm text-gray-400">Your Role</div>
      <div class="font-semibold text-lg">
        {% if is_owner %}
          <i class="fas fa-crown text-yellow-400"></i> Owner
        {% elif is_manager %}
          <i class="fas fa-user-tie text-blue-400"></i> Manager
        {% elif is_coach %}
          <i class="fas fa-chalkboard-teacher text-green-400"></i> Coach
        {% elif is_player %}
          <i class="fas fa-gamepad text-purple-400"></i> Player
        {% else %}
          <i class="fas fa-user text-gray-400"></i> Member
        {% endif %}
        {% if user_membership.is_captain %}
          <span class="text-yellow-400 text-sm ml-2">(Captain)</span>
        {% endif %}
      </div>
    </div>
  </div>
  
  <!-- Quick Stats -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
    <div class="p-4 rounded-lg bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border border-cyan-500/20">
      <div class="text-sm text-gray-400">Team Members</div>
      <div class="text-2xl font-bold text-cyan-400">{{ roster_count|default:roster|length }}</div>
    </div>
    <div class="p-4 rounded-lg bg-gradient-to-br from-purple-500/10 to-pink-500/10 border border-purple-500/20">
      <div class="text-sm text-gray-400">Tournaments</div>
      <div class="text-2xl font-bold text-purple-400">{{ team.tournament_count|default:0 }}</div>
    </div>
    <div class="p-4 rounded-lg bg-gradient-to-br from-green-500/10 to-emerald-500/10 border border-green-500/20">
      <div class="text-sm text-gray-400">Win Rate</div>
      <div class="text-2xl font-bold text-green-400">{{ latest_stats.win_rate|default:"0" }}%</div>
    </div>
    <div class="p-4 rounded-lg bg-gradient-to-br from-yellow-500/10 to-orange-500/10 border border-yellow-500/20">
      <div class="text-sm text-gray-400">Rank Points</div>
      <div class="text-2xl font-bold text-yellow-400">{{ team.total_points|default:0 }}</div>
    </div>
  </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  
  <!-- =================================================================== -->
  <!-- OWNER / CAPTAIN CONTROLS -->
  <!-- Show only for owners and captains -->
  <!-- =================================================================== -->
  {% if is_owner or is_captain %}
  <div class="card glass p-6">
    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-crown text-yellow-400"></i>
      Captain Controls
    </h3>
    
    <div class="space-y-3">
      <!-- Full Dashboard -->
      <a href="{% url 'teams:dashboard' team.slug %}" class="w-full btn btn-primary justify-start">
        <i class="fas fa-tachometer-alt"></i>
        <span>Full Dashboard</span>
      </a>
      
      <!-- Team Settings -->
      <a href="{% url 'teams:settings' team.slug %}" class="w-full btn btn-primary justify-start">
        <i class="fas fa-cog"></i>
        <span>Team Settings</span>
      </a>
      
      <!-- Invite Members -->
      <a href="{% url 'teams:invite_member' team.slug %}" class="w-full btn btn-primary justify-start">
        <i class="fas fa-user-plus"></i>
        <span>Invite Members</span>
      </a>
      
      <!-- Manage Roster -->
      <a href="{% url 'teams:manage' team.slug %}" class="w-full btn btn-primary justify-start">
        <i class="fas fa-users-cog"></i>
        <span>Manage Roster</span>
      </a>
      
      <!-- Tournament Registration -->
      <a href="{% url 'tournaments:list' %}" class="w-full btn btn-primary justify-start">
        <i class="fas fa-trophy"></i>
        <span>Browse Tournaments</span>
      </a>
      
      <!-- Team Analytics -->
      <a href="{% url 'teams:team_analytics' team.id %}" class="w-full btn btn-secondary justify-start">
        <i class="fas fa-chart-line"></i>
        <span>View Analytics</span>
      </a>
    </div>
  </div>
  {% endif %}
  
  <!-- =================================================================== -->
  <!-- MANAGER CONTROLS -->
  <!-- Show only for managers (not owners/captains) -->
  <!-- =================================================================== -->
  {% if is_manager and not is_owner and not is_captain %}
  <div class="card glass p-6">
    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-user-tie text-blue-400"></i>
      Manager Tools
    </h3>
    
    <div class="space-y-3">
      <!-- Manage Roster -->
      {% if can_manage_roster %}
      <a href="{% url 'teams:manage' team.slug %}" class="w-full btn btn-primary justify-start">
        <i class="fas fa-users-cog"></i>
        <span>Manage Roster</span>
      </a>
      {% endif %}
      
      <!-- Invite Members -->
      <a href="{% url 'teams:invite_member' team.slug %}" class="w-full btn btn-primary justify-start">
        <i class="fas fa-user-plus"></i>
        <span>Invite Members</span>
      </a>
      
      <!-- Edit Team Profile -->
      {% if can_edit_team_profile %}
      <a href="{% url 'teams:edit' team.slug %}" class="w-full btn btn-primary justify-start">
        <i class="fas fa-edit"></i>
        <span>Edit Team Profile</span>
      </a>
      {% endif %}
      
      <!-- Tournament Registration -->
      {% if can_register_tournaments %}
      <a href="{% url 'tournaments:list' %}" class="w-full btn btn-primary justify-start">
        <i class="fas fa-trophy"></i>
        <span>Browse Tournaments</span>
      </a>
      {% endif %}
      
      <!-- Team Analytics -->
      <a href="{% url 'teams:team_analytics' team.id %}" class="w-full btn btn-secondary justify-start">
        <i class="fas fa-chart-line"></i>
        <span>View Analytics</span>
      </a>
      
      <!-- Team Settings (View) -->
      {% if can_view_team_settings %}
      <a href="{% url 'teams:settings' team.slug %}" class="w-full btn btn-secondary justify-start">
        <i class="fas fa-cog"></i>
        <span>View Settings</span>
      </a>
      {% endif %}
    </div>
  </div>
  {% endif %}
  
  <!-- =================================================================== -->
  <!-- COACH TOOLS -->
  <!-- Show only for coaches (not owners/managers) -->
  <!-- =================================================================== -->
  {% if is_coach and not is_owner and not is_manager %}
  <div class="card glass p-6">
    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-chalkboard-teacher text-green-400"></i>
      Coach Tools
    </h3>
    
    <div class="space-y-3">
      <!-- Strategy Planner -->
      <button class="w-full btn btn-primary justify-start" onclick="alert('Strategy planner coming soon! Plan tactics for upcoming matches.'); return false;">
        <i class="fas fa-chess"></i>
        <span>Strategy Planner</span>
        <span class="badge bg-yellow-500/20 text-yellow-300 ml-auto text-xs">Soon</span>
      </button>
      
      <!-- Schedule Practice -->
      <button class="w-full btn btn-primary justify-start" onclick="alert('Practice scheduler coming soon! Schedule and manage practice sessions.'); return false;">
        <i class="fas fa-calendar-check"></i>
        <span>Schedule Practice</span>
        <span class="badge bg-yellow-500/20 text-yellow-300 ml-auto text-xs">Soon</span>
      </button>
      
      <!-- Performance Analytics -->
      <a href="{% url 'teams:team_analytics' team.id %}" class="w-full btn btn-primary justify-start">
        <i class="fas fa-chart-line"></i>
        <span>Performance Analytics</span>
      </a>
      
      <!-- Training Materials -->
      <button class="w-full btn btn-primary justify-start" onclick="alert('Training materials coming soon! Upload training guides and resources.'); return false;">
        <i class="fas fa-graduation-cap"></i>
        <span>Training Materials</span>
        <span class="badge bg-yellow-500/20 text-yellow-300 ml-auto text-xs">Soon</span>
      </button>
      
      <!-- Team Settings (View) -->
      {% if can_view_team_settings %}
      <a href="{% url 'teams:settings' team.slug %}" class="w-full btn btn-secondary justify-start">
        <i class="fas fa-cog"></i>
        <span>View Settings</span>
      </a>
      {% endif %}
    </div>
  </div>
  {% endif %}
  
  <!-- =================================================================== -->
  <!-- MEMBER / PLAYER PERSONAL TOOLS -->
  <!-- Shown to ALL members including owner/manager/coach -->
  <!-- =================================================================== -->
  <div class="card glass p-6">
    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-user-cog text-cyan-400"></i>
      {% if is_player and not is_owner and not is_manager and not is_coach %}
        Player Tools
      {% else %}
        My Tools
      {% endif %}
    </h3>
    
    <div class="space-y-3">
      <!-- Update Game ID -->
      <button 
        class="w-full btn btn-secondary justify-start text-left"
        onclick="updateGameID('{{ team.game }}', '{{ team.get_game_display }}')">
        <i class="fas fa-id-card"></i>
        <span>Update Game ID</span>
      </button>

      <!-- View My Stats -->
      <a href="{% url 'user_profile:profile' user.username %}" class="w-full btn btn-secondary justify-start">
        <i class="fas fa-chart-bar"></i>
        <span>View My Stats</span>
      </a>

      <!-- Notifications -->
      <button class="w-full btn btn-secondary justify-start text-left" onclick="showTeamNotifications()">
        <i class="fas fa-bell"></i>
        <span>Team Notifications</span>
        {% if pending_notifications_count %}
        <span class="badge bg-red-500 ml-auto">{{ pending_notifications_count }}</span>
        {% endif %}
      </button>

      <!-- Team Calendar -->
      <button class="w-full btn btn-secondary justify-start" onclick="alert('Team calendar coming soon! View matches and team events.'); return false;">
        <i class="fas fa-calendar-alt"></i>
        <span>Team Calendar</span>
        <span class="badge bg-gray-500/20 text-gray-300 ml-auto text-xs">Soon</span>
      </button>

      <!-- Practice Schedule -->
      <button class="w-full btn btn-secondary justify-start" onclick="alert('Practice schedule coming soon! Check your practice attendance.'); return false;">
        <i class="fas fa-clock"></i>
        <span>Practice Schedule</span>
        <span class="badge bg-gray-500/20 text-gray-300 ml-auto text-xs">Soon</span>
      </button>
      
      <!-- Leave Team -->
      {% if can_leave_team %}
      <div class="pt-3 mt-3 border-t border-red-900/30">
        <button 
          class="w-full btn btn-danger justify-start text-left"
          onclick="showLeaveTeamModal('{{ team.slug }}', '{{ team.name }}', {{ roster_count|default:roster|length }}, false)">
          <i class="fas fa-sign-out-alt"></i>
          <span>Leave Team</span>
        </button>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- =================================================================== -->
  <!-- TEAM COMMUNICATION -->
  <!-- Shown to ALL members -->
  <!-- =================================================================== -->
  <div class="card glass p-6">
    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-comments text-purple-400"></i>
      Communication
    </h3>
    
    <div class="space-y-4">
      {% if team.discord %}
      <a href="{{ team.discord }}" target="_blank" rel="noopener" class="block p-4 rounded-lg bg-indigo-600 hover:bg-indigo-700 transition-colors">
        <div class="flex items-center gap-3">
          <i class="fab fa-discord text-2xl"></i>
          <div>
            <div class="font-semibold">Discord Server</div>
            <div class="text-sm opacity-75">Join team chat</div>
          </div>
        </div>
      </a>
      {% endif %}

      <div class="p-4 rounded-lg border border-gray-700 bg-gray-800/50">
        <div class="flex items-start gap-3">
          <i class="fas fa-info-circle text-cyan-400 mt-1"></i>
          <div class="text-sm">
            <p class="font-semibold mb-1">Team Coordination</p>
            <p class="text-gray-400">Connect with teammates through Discord. Stay updated on practice and tournaments.</p>
          </div>
        </div>
      </div>

      <!-- Contact Owner -->
      {% if not is_owner and team.captain %}
      <div class="p-4 rounded-lg border border-gray-700">
        <div class="flex items-center gap-3">
          <i class="fas fa-user-shield text-lg text-yellow-400"></i>
          <div>
            <div class="text-sm text-gray-400">Team Owner</div>
            <div class="font-semibold">{{ team.captain.user.username }}</div>
          </div>
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- =================================================================== -->
  <!-- QUICK LINKS -->
  <!-- =================================================================== -->
  <div class="card glass p-6">
    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-bolt text-yellow-400"></i>
      Quick Links
    </h3>
    
    <div class="space-y-2">
      <a href="{% url 'teams:team_tournaments' team.slug %}" class="flex items-center gap-3 p-3 rounded hover:bg-white/5 transition-colors">
        <i class="fas fa-trophy text-yellow-400"></i>
        <span>Tournament History</span>
      </a>
      
      <a href="{% url 'teams:team_analytics' team.id %}" class="flex items-center gap-3 p-3 rounded hover:bg-white/5 transition-colors">
        <i class="fas fa-chart-line text-green-400"></i>
        <span>Team Analytics</span>
      </a>
      
      {% if can_manage_roster %}
      <a href="{% url 'teams:invite_member' team.slug %}" class="flex items-center gap-3 p-3 rounded hover:bg-white/5 transition-colors">
        <i class="fas fa-user-plus text-blue-400"></i>
        <span>Invite Members</span>
      </a>
      {% endif %}
    </div>
  </div>

  <!-- =================================================================== -->
  <!-- TEAM INFO -->
  <!-- =================================================================== -->
  <div class="card glass p-6">
    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-info-circle text-blue-400"></i>
      Team Info
    </h3>
    
    <div class="space-y-3">
      <div class="flex justify-between items-center">
        <span class="text-gray-400">Members</span>
        <span class="font-semibold">{{ roster_count|default:roster|length }}</span>
      </div>
      
      <div class="flex justify-between items-center">
        <span class="text-gray-400">Your Role</span>
        <span class="font-semibold">
          {% if is_owner %}
            <i class="fas fa-crown text-yellow-400"></i> Owner
          {% elif is_manager %}
            <i class="fas fa-user-tie text-blue-400"></i> Manager
          {% elif is_coach %}
            <i class="fas fa-chalkboard-teacher text-green-400"></i> Coach
          {% elif is_player %}
            <i class="fas fa-gamepad text-purple-400"></i> Player
          {% else %}
            <i class="fas fa-user"></i> Member
          {% endif %}
        </span>
      </div>
      
      <div class="flex justify-between items-center">
        <span class="text-gray-400">Team Status</span>
        <span class="font-semibold">
          {% if team.is_active %}
            <span class="text-green-400"><i class="fas fa-check-circle"></i> Active</span>
          {% else %}
            <span class="text-gray-400"><i class="fas fa-pause-circle"></i> Inactive</span>
          {% endif %}
        </span>
      </div>

      <div class="flex justify-between items-center">
        <span class="text-gray-400">Recruitment</span>
        <span class="font-semibold">
          {% if team.is_recruiting %}
            <span class="text-green-400"><i class="fas fa-unlock"></i> Open</span>
          {% else %}
            <span class="text-yellow-400"><i class="fas fa-lock"></i> Invite Only</span>
          {% endif %}
        </span>
      </div>
    </div>
  </div>
  
  <!-- =================================================================== -->
  <!-- TEAM ACHIEVEMENTS -->
  <!-- =================================================================== -->
  <div class="card glass p-6">
    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-medal text-yellow-400"></i>
      Team Achievements
    </h3>
    
    <div class="space-y-3">
      {% if total_achievements and total_achievements > 0 %}
        {% for achievement in achievements_by_year.values.0|slice:":4" %}
        <div class="flex items-center gap-3 p-3 rounded-lg bg-gradient-to-r from-yellow-500/10 to-orange-500/10 border border-yellow-500/20">
          <div class="w-10 h-10 rounded-full bg-yellow-500/20 flex items-center justify-center flex-shrink-0">
            <i class="fas fa-trophy text-yellow-400"></i>
          </div>
          <div class="flex-1">
            <div class="font-semibold text-sm">{{ achievement.title }}</div>
            <div class="text-xs text-gray-400">{{ achievement.date_earned|date:"M d, Y" }}</div>
          </div>
        </div>
        {% endfor %}
        {% if total_achievements > 4 %}
        <a href="#" class="text-sm text-cyan-400 hover:text-cyan-300 flex items-center gap-2">
          <span>View all {{ total_achievements }} achievements</span>
          <i class="fas fa-arrow-right"></i>
        </a>
        {% endif %}
      {% else %}
        <div class="text-center py-6 text-gray-500">
          <i class="fas fa-medal text-3xl mb-2 opacity-50"></i>
          <p class="text-sm">No achievements yet</p>
          <p class="text-xs">Win tournaments to earn achievements!</p>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- =================================================================== -->
  <!-- UPCOMING EVENTS -->
  <!-- =================================================================== -->
  <div class="card glass p-6">
    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-calendar-check text-purple-400"></i>
      Upcoming Events
    </h3>
    
    <div class="space-y-3">
      {% if upcoming_matches %}
        {% for event in upcoming_matches|slice:":3" %}
        <div class="p-3 rounded-lg border border-purple-500/20 bg-purple-500/5 hover:bg-purple-500/10 transition-colors">
          <div class="flex items-start gap-3">
            <div class="w-10 h-10 rounded bg-purple-500/20 flex items-center justify-center flex-shrink-0">
              <i class="fas fa-calendar text-purple-400"></i>
            </div>
            <div class="flex-1">
              <div class="font-semibold text-sm">{{ event.title }}</div>
              <div class="text-xs text-gray-400">{{ event.scheduled_date|date:"M d, Y - g:i A" }}</div>
            </div>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="text-center py-6 text-gray-500">
          <i class="fas fa-calendar-times text-3xl mb-2 opacity-50"></i>
          <p class="text-sm">No upcoming events</p>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- =================================================================== -->
  <!-- TEAM RESOURCES -->
  <!-- =================================================================== -->
  <div class="card glass p-6">
    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-book text-blue-400"></i>
      Team Resources
    </h3>
    
    <div class="space-y-2">
      <button class="flex items-center gap-3 p-3 rounded hover:bg-white/5 transition-colors w-full text-left" onclick="alert('Team strategies coming soon!'); return false;">
        <i class="fas fa-chess text-blue-400"></i>
        <span>Strategies & Tactics</span>
      </button>
      
      <button class="flex items-center gap-3 p-3 rounded hover:bg-white/5 transition-colors w-full text-left" onclick="alert('Training materials coming soon!'); return false;">
        <i class="fas fa-graduation-cap text-green-400"></i>
        <span>Training Materials</span>
      </button>
      
      <button class="flex items-center gap-3 p-3 rounded hover:bg-white/5 transition-colors w-full text-left" onclick="alert('Match recordings coming soon!'); return false;">
        <i class="fas fa-video text-red-400"></i>
        <span>Match Recordings</span>
      </button>
      
      <button class="flex items-center gap-3 p-3 rounded hover:bg-white/5 transition-colors w-full text-left" onclick="alert('Team wiki coming soon!'); return false;">
        <i class="fas fa-file-alt text-purple-400"></i>
        <span>Team Wiki</span>
      </button>
    </div>
  </div>

  <!-- =================================================================== -->
  <!-- RECENT ACTIVITY -->
  <!-- =================================================================== -->
  <div class="card glass p-6 md:col-span-2">
    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
      <i class="fas fa-history text-green-400"></i>
      Recent Activity
    </h3>
    
    <div class="space-y-3 max-h-64 overflow-y-auto">
      {% if activities %}
        {% for activity in activities|slice:":5" %}
        <div class="p-3 rounded-lg bg-gray-800/50 border border-gray-700 flex items-start gap-3">
          <i class="fas fa-circle-notch text-cyan-400 mt-1"></i>
          <div class="flex-1">
            <p class="text-sm">{{ activity.description|default:"Team activity" }}</p>
            <span class="text-xs text-gray-500">{{ activity.created_at|timesince }} ago</span>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="text-center py-8 text-gray-500">
          <i class="fas fa-inbox text-4xl mb-2 opacity-50"></i>
          <p>No recent activity</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% endif %}
