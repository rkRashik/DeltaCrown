{% load teams_extras %}


{% if request.user.is_authenticated and membership %}
  <div class="d-flex gap-2 my-3">
    {% if membership.role == "captain" %}
      <a class="btn btn-warning btn-sm" href="{% url 'teams:transfer' team.tag %}">Transfer Captain</a>
    {% endif %}
    <a class="btn btn-outline-danger btn-sm" href="{% url 'teams:leave' team.tag %}">Leave Team</a>
  </div>
{% endif %}

<h1>Team: {{ team.name }}</h1>
<p>Captain: {{ team.captain.display_name }}</p>
<img src="{{ team.logo.url }}" alt="{{ team.name }} logo" />

<h2>Roster</h2>
<ul>
    {% for membership in team.memberships.all %}
        <li>{{ membership.user.display_name }} (Role: {{ membership.get_role_display }})</li>
    {% endfor %}
</ul>

<h2>Pending Invites</h2>
<ul>
    {% for invite in pending_invites %}
        <li>{{ invite.user.display_name }} (Pending)</li>
    {% endfor %}
</ul>

<h2>Match History</h2>
<ul>
    {% for tournament in match_history %}
        <li>{{ tournament.name }} - {{ tournament.status }}</li>
    {% endfor %}
</ul>

<!-- Button to transfer captain role -->
{% if user == team.captain.user %}
    <h2>Transfer Captain Role</h2>
    <form method="POST" action="{% url 'teams:transfer_captain' team.slug %}">
        {% csrf_token %}
        <label for="new_captain">New Captain: </label>
        <select id="new_captain" name="new_captain">
            {% for member in team.memberships.exclude(user=team.captain.user) %}
                <option value="{{ member.user.id }}">{{ member.user.display_name }}</option>
            {% endfor %}
        </select>
        <button type="submit">Transfer Captain Role</button>
    </form>
{% endif %}

<!-- Button to leave the team -->
{% if user != team.captain.user %}
    <h2>Leave Team</h2>
    <form method="POST" action="{% url 'teams:leave_team' team.slug %}">
        {% csrf_token %}
        <button type="submit">Leave Team</button>
    </form>
{% endif %}
