{% extends "base.html" %}

{% block title %}Manage Team — {{ team.name|default:"Team" }}{% endblock %}

{% block content %}
<main class="container mx-auto px-4 max-w-7xl py-8">
  <nav aria-label="Breadcrumb" class="text-sm text-muted mb-3">
    <a class="link-nav" href="/teams/">Teams</a> / <span>Manage</span>
  </nav>

  <h1 class="text-2xl font-bold">Manage {{ team.name|default:"Team" }}</h1>

  <div class="grid gap-6 lg:grid-cols-3 mt-4">
    <section class="glass rounded-2xl p-6 lg:col-span-2">
      <h2 class="font-semibold mb-3">Team Settings</h2>
      <form method="post" enctype="multipart/form-data" class="grid gap-4">
        {% csrf_token %}
        {% if form %}
          {{ form.non_field_errors }}
          {% for field in form %}
            <div>
              <label class="label-text" for="{{ field.id_for_label }}">{{ field.label }}</label>
              {{ field }}
              {% if field.help_text %}<div class="text-sm text-muted mt-1">{{ field.help_text }}</div>{% endif %}
              {{ field.errors }}
            </div>
          {% endfor %}
        {% else %}
          <p class="text-muted">Form unavailable.</p>
        {% endif %}
        <button class="btn-primary" type="submit">Save</button>
      </form>
    </section>

    <aside class="space-y-6">
      <div class="glass rounded-2xl p-6">
        <h3 class="font-semibold mb-2">Latest Stats</h3>
        {% if latest_stats %}
          <ul class="text-sm grid gap-1">
            <li>Wins: {{ latest_stats.wins|default:0 }}</li>
            <li>Losses: {{ latest_stats.losses|default:0 }}</li>
            <li>Updated: {{ latest_stats.updated_at|date:"M d, Y" }}</li>
          </ul>
          <form method="post" class="mt-3">
            {% csrf_token %}
            <button class="btn-ghost" name="rebuild_stats" value="1">Rebuild Stats</button>
          </form>
        {% else %}
          <p class="text-muted">No stats yet.</p>
          <form method="post" class="mt-3">
            {% csrf_token %}
            <button class="btn-ghost" name="rebuild_stats" value="1">Compute Stats</button>
          </form>
        {% endif %}
      </div>

      <div class="glass rounded-2xl p-6">
        <h3 class="font-semibold mb-2">Achievements</h3>
        <form method="post" class="grid gap-3">
          {% csrf_token %}
          {% if aform %}
            {% for field in aform %}
              <div>
                <label class="label-text" for="{{ field.id_for_label }}">{{ field.label }}</label>
                {{ field }}
                {{ field.errors }}
              </div>
            {% endfor %}
          {% endif %}
          <button class="btn-ghost" type="submit">Add Achievement</button>
        </form>
        {% if achievements %}
          <ul class="grid gap-2 mt-4">
            {% for ach in achievements %}
              <li class="border border-line rounded-xl p-3 flex items-center justify-between text-sm">
                <span>{{ ach.title }}{% if ach.year %} · {{ ach.year }}{% endif %}</span>
                <form method="post">
                  {% csrf_token %}
                  <input type="hidden" name="delete_achievement_id" value="{{ ach.id }}">
                  <button class="btn-ghost" type="submit">Delete</button>
                </form>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted mt-3">No achievements yet.</p>
        {% endif %}
      </div>
    </aside>
  </div>
</main>
{% endblock %}

