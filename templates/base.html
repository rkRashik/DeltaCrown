{% load static %}
<!doctype html>
<html lang="en" data-theme="system" class="h-full">
  <head>
    <!-- Preconnect for Google auth fonts/icons -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <meta name="theme-color" content="#0b1220">

    <!-- Basic OG -->
    <meta property="og:site_name" content="DeltaCrown">
    <meta property="og:type" content="website">
    <meta property="og:title" content="{% block og_title %}DeltaCrown{% endblock %}">
    <meta property="og:image" content="{% static 'siteui/og/default.png' %}">

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Favicon - New Logo -->
    <link rel="icon" href="{% static 'img/favicon/favicon.ico' %}?v=new" sizes="any">
    <link rel="icon" href="{% static 'img/favicon/favicon-16x16.png' %}?v=new" sizes="16x16" type="image/png">
    <link rel="icon" href="{% static 'img/favicon/favicon-32x32.png' %}?v=new" sizes="32x32" type="image/png">
    <link rel="icon" href="{% static 'img/favicon/favicon-48x48.png' %}?v=new" sizes="48x48" type="image/png">
    <link rel="icon" href="{% static 'img/favicon/favicon-64x64.png' %}?v=new" sizes="64x64" type="image/png">
    <link rel="apple-touch-icon" href="{% static 'img/favicon/favicon-180x180.png' %}?v=new">
    <link rel="manifest" href="{% static 'img/favicon/site-v2.webmanifest' %}">


    {% include "partials/seo_meta.html" %}
    <title>{% block title %}DeltaCrown{% endblock %}</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="{% static 'siteui/js/tailwind-config.js' %}"></script>

    <!-- Site CSS -->
    <link rel="preload" href="{% static 'siteui/css/tokens.css' %}?v=20260102" as="style" />
    <link rel="stylesheet" href="{% static 'siteui/css/tokens.css' %}?v=20260102" />
    <link rel="stylesheet" href="{% static 'siteui/css/base.css' %}" />
    <link rel="stylesheet" href="{% static 'siteui/css/components.css' %}" />
    <link rel="stylesheet" href="{% static 'siteui/css/effects.css' %}" />
    <link rel="stylesheet" href="{% static 'siteui/css/primary_navigation.css' %}" />
    <link rel="stylesheet" href="{% static 'siteui/css/footer.css' %}" />
    <link rel="stylesheet" href="{% static 'siteui/css/auth.css' %}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
    <!-- Phase 9A-24: Toastify.js for modern toast notifications -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.css">

    {# ðŸ”½ allow pages to inject extra CSS (e.g., tournaments-detail.css) #}
    {% block extra_css %}{% endblock %}
    {% block extra_head %}{% endblock %}
    <!-- Provide a safe no-op `dcLog` early so inline scripts can call it without errors -->
    <script>
      window.DELTACROWN_DEBUG = false;
      window.dcLog = function(){};
    </script>
  </head>
  <body class="min-h-full bg-body text-body antialiased">
    <a href="#main" class="skip-link">Skip to main content</a>

    {% include "partials/primary_navigation.html" %}

    <main id="main" tabindex="-1">
      {% block content %}{% endblock %}
    </main>

    {% block footer %}
    {% if request.path == '/' %}
      {% include "partials/footer_modern.html" %}
    {% endif %}
    {% endblock %}
    {% include "partials/toasts.html" %}

    <!-- Site JS -->
    <script>
      // Server-side controlled debug flag (authorized users only)
      window.DELTACROWN_DEBUG = {% if request.user.is_superuser or debug|default:False %}true{% else %}false{% endif %};
    </script>
    <script src="{% static 'siteui/js/debug.js' %}"></script>
    <script src="{% static 'siteui/js/theme.js' %}"></script>
    <script src="{% static 'siteui/js/esports-theme-toggle.js' %}"></script>
    <script src="{% static 'siteui/js/notifications.js' %}?v=2"></script>
    <script src="{% static 'siteui/js/components.js' %}"></script>
    <script src="{% static 'siteui/js/motion.js' %}"></script>
    <script src="{% static 'siteui/js/tournaments.js' %}"></script>
    <script src="{% static 'siteui/js/tournaments-list.js' %}"></script>
    <script src="{% static 'siteui/js/teams.js' %}"></script>
    <script src="{% static 'siteui/js/auth.js' %}"></script>
    <script src="{% static 'siteui/js/micro.js' %}"></script>
    <script src="{% static 'siteui/js/toast-modern.js' %}"></script>
    <script src="{% static 'siteui/js/primary_navigation.js' %}"></script>
    <script src="{% static 'siteui/js/reg_wizard.js' %}"></script>
    <script src="{% static 'siteui/js/follow.js' %}"></script>

    <!-- Phase 9A-24: Toastify.js + Messages Init -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.js"></script>
    <script src="{% static 'siteui/js/toast.js' %}"></script>
    
    {% if messages %}
    <script id="messages-data" type="application/json">[
      {% for message in messages %}
        {"level":"{{ message.tags|default:'info' }}","text":"{{ message|escapejs }}"}{% if not forloop.last %},{% endif %}
      {% endfor %}
    ]</script>
    <script>
      // Phase 9A-24: Auto-show Django messages as toasts on page load
      document.addEventListener('DOMContentLoaded', function() {
        const messagesEl = document.getElementById('messages-data');
        if (messagesEl && window.showToast) {
          try {
            const messages = JSON.parse(messagesEl.textContent);
            messages.forEach(msg => {
              const type = msg.level === 'error' ? 'error' : 
                          msg.level === 'warning' ? 'warning' : 
                          msg.level === 'success' ? 'success' : 'info';
              window.showToast({type, message: msg.text});
            });
          } catch(e) {
            console.error('[Toast] Failed to parse Django messages:', e);
          }
        }
      });
    </script>
    {% endif %}

    {# ðŸ”½ allow pages to inject extra JS (e.g., tournament-detail.js) #}
    {% block extra_js %}{% endblock %}
  </body>
</html>
