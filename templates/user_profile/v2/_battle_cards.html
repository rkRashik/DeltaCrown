{% comment %}
Battle Cards: Featured Game Passports UI
- Shows pinned passports as large cards at top
- Collapses unpinned under "More Games"
- Privacy icons, LFT badges, lock countdown
{% endcomment %}

<div class="battle-cards-section">
    {% if pinned_passports %}
    <div class="pinned-passports-header mb-4">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Featured Games</h2>
        <p class="text-sm text-gray-600 dark:text-gray-400">{{ pinned_passports|length }} / {{ MAX_PINNED_GAMES }} pinned</p>
    </div>
    
    <div class="battle-cards-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        {% for passport in pinned_passports %}
        <div class="battle-card relative bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden border-2 border-purple-500 hover:shadow-xl transition-shadow duration-200">
            {# Game Header #}
            <div class="card-header bg-gradient-to-r from-purple-600 to-indigo-600 p-4 text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <span class="game-icon text-2xl">ğŸ®</span>
                        <h3 class="text-lg font-bold">{{ passport.game_display_name }}</h3>
                    </div>
                    <div class="flex items-center space-x-2">
                        {# Privacy Badge #}
                        {% if passport.visibility == 'PRIVATE' %}
                        <span class="text-xs bg-red-500 px-2 py-1 rounded" title="Private">ğŸ”’</span>
                        {% elif passport.visibility == 'PROTECTED' %}
                        <span class="text-xs bg-yellow-500 px-2 py-1 rounded" title="Protected">ğŸ‘¥</span>
                        {% else %}
                        <span class="text-xs bg-green-500 px-2 py-1 rounded" title="Public">ğŸŒ</span>
                        {% endif %}
                        
                        {# LFT Badge #}
                        {% if passport.is_lft %}
                        <span class="text-xs bg-blue-500 px-2 py-1 rounded animate-pulse" title="Looking for Team">ğŸ” LFT</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            {# Identity #}
            <div class="card-body p-4">
                <div class="identity-section mb-3">
                    <div class="flex items-center justify-between">
                        <p class="text-xl font-bold text-gray-900 dark:text-white">{{ passport.in_game_name }}</p>
                        {% if passport.is_identity_locked %}
                        <span class="text-xs text-red-600 dark:text-red-400" title="Identity locked until {{ passport.locked_until|date:'M d, Y' }}">
                            ğŸ”’ Locked
                        </span>
                        {% endif %}
                    </div>
                    {% if passport.main_role %}
                    <p class="text-sm text-gray-600 dark:text-gray-400">{{ passport.main_role }}</p>
                    {% endif %}                    
                    {# GP-FINAL-01: Team Badge #}
                    {% if passport.current_team %}
                    <div class="team-badge mt-2 flex items-center space-x-2 p-2 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800">
                        {% if passport.current_team.logo %}
                        <img src="{{ passport.current_team.logo.url }}" alt="{{ passport.current_team.name }}" class="w-6 h-6 rounded">
                        {% else %}
                        <span class="text-lg">ğŸ›¡ï¸</span>
                        {% endif %}
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-semibold text-blue-900 dark:text-blue-100 truncate">
                                {{ passport.current_team.name }}{% if passport.current_team.tag %} [{{ passport.current_team.tag }}]{% endif %}
                            </p>
                            {% if passport.team_role %}
                            <p class="text-xs text-blue-700 dark:text-blue-300">{{ passport.team_role }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% else %}
                    <div class="team-badge mt-2 flex items-center space-x-2 p-2 bg-gray-50 dark:bg-gray-700 rounded">
                        <span class="text-lg">ğŸ†“</span>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Free Agent</p>
                    </div>
                    {% endif %}                </div>
                
                {# Rank Display #}
                {% if passport.rank_name %}
                <div class="rank-section flex items-center space-x-2 mb-3 p-2 bg-gray-50 dark:bg-gray-700 rounded">
                    {% if passport.rank_image %}
                    <img src="{{ passport.rank_image.url }}" alt="{{ passport.rank_name }}" class="w-8 h-8">
                    {% endif %}
                    <div>
                        <p class="text-sm font-semibold text-gray-900 dark:text-white">{{ passport.rank_name }}</p>
                        {% if passport.rank_points %}
                        <p class="text-xs text-gray-600 dark:text-gray-400">{{ passport.rank_points }} pts</p>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                {# Stats Grid #}
                {% if passport.matches_played > 0 %}
                <div class="stats-grid grid grid-cols-2 gap-2 text-xs">
                    <div class="stat-item">
                        <p class="text-gray-600 dark:text-gray-400">Matches</p>
                        <p class="font-bold text-gray-900 dark:text-white">{{ passport.matches_played }}</p>
                    </div>
                    <div class="stat-item">
                        <p class="text-gray-600 dark:text-gray-400">Win Rate</p>
                        <p class="font-bold text-gray-900 dark:text-white">{{ passport.win_rate }}%</p>
                    </div>
                    {% if passport.kd_ratio %}
                    <div class="stat-item">
                        <p class="text-gray-600 dark:text-gray-400">K/D</p>
                        <p class="font-bold text-gray-900 dark:text-white">{{ passport.kd_ratio|floatformat:2 }}</p>
                    </div>
                    {% endif %}
                    {% if passport.hours_played %}
                    <div class="stat-item">
                        <p class="text-gray-600 dark:text-gray-400">Hours</p>
                        <p class="font-bold text-gray-900 dark:text-white">{{ passport.hours_played }}h</p>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
                
                {# Lock Countdown (if locked) #}
                {% if passport.is_identity_locked %}
                <div class="lock-countdown mt-3 p-2 bg-red-50 dark:bg-red-900/20 rounded text-center">
                    <p class="text-xs text-red-700 dark:text-red-300">
                        Identity locked until {{ passport.locked_until|date:"M d, Y" }}
                    </p>
                    <p class="text-xs text-red-600 dark:text-red-400 font-mono">
                        {{ passport.locked_until|timeuntil }} remaining
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    {% if unpinned_passports %}
    <details class="more-games-section mt-8">
        <summary class="cursor-pointer text-lg font-semibold text-gray-700 dark:text-gray-300 hover:text-purple-600 dark:hover:text-purple-400 transition-colors">
            <span class="inline-flex items-center space-x-2">
                <span>More Games ({{ unpinned_passports|length }})</span>
                <svg class="w-5 h-5 transition-transform duration-200" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                </svg>
            </span>
        </summary>
        
        <div class="unpinned-games-grid grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-4">
            {% for passport in unpinned_passports %}
            <div class="unpinned-card bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-md transition-shadow duration-200 p-3 border border-gray-200 dark:border-gray-700">
                <div class="flex items-start justify-between mb-2">
                    <h4 class="text-sm font-bold text-gray-900 dark:text-white truncate flex-1">{{ passport.game_display_name }}</h4>
                    <div class="flex items-center space-x-1 ml-2">
                        {% if passport.visibility == 'PRIVATE' %}
                        <span class="text-xs" title="Private">ğŸ”’</span>
                        {% elif passport.visibility == 'PROTECTED' %}
                        <span class="text-xs" title="Protected">ğŸ‘¥</span>
                        {% endif %}
                        {% if passport.is_lft %}
                        <span class="text-xs text-blue-500" title="Looking for Team">ğŸ”</span>
                        {% endif %}
                    </div>
                </div>
                <p class="text-sm text-gray-900 dark:text-white font-medium truncate">{{ passport.in_game_name }}</p>
                {% if passport.current_team %}
                <div class="flex items-center space-x-1 mt-1">
                    {% if passport.current_team.logo %}
                    <img src="{{ passport.current_team.logo.url }}" alt="{{ passport.current_team.name }}" class="w-4 h-4 rounded">
                    {% else %}
                    <span class="text-xs">ğŸ›¡ï¸</span>
                    {% endif %}
                    <p class="text-xs text-blue-600 dark:text-blue-400 truncate">{{ passport.current_team.tag|default:passport.current_team.name }}</p>
                </div>
                {% else %}
                <p class="text-xs text-gray-500 dark:text-gray-500">Free Agent</p>
                {% endif %}
                {% if passport.rank_name %}
                <p class="text-xs text-gray-600 dark:text-gray-400 truncate">{{ passport.rank_name }}</p>
                {% endif %}
                {% if passport.main_role %}
                <p class="text-xs text-gray-500 dark:text-gray-500 truncate">{{ passport.main_role }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </details>
    {% endif %}
    
    {% if not pinned_passports and not unpinned_passports %}
    <div class="no-passports text-center py-12">
        <div class="text-6xl mb-4">ğŸ®</div>
        <p class="text-gray-600 dark:text-gray-400">No game passports yet</p>
        {% if is_owner %}
        <a href="{% url 'user_profile:profile_settings_v2' %}" class="inline-block mt-4 px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
            Add Your First Game
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>

<style>
.battle-card {
    min-height: 300px;
}

.battle-cards-grid {
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

details[open] summary svg {
    transform: rotate(180deg);
}

.unpinned-card:hover {
    transform: translateY(-2px);
}
</style>
