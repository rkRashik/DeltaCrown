{% extends "base.html" %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<link href="{% static 'css/user_profile/core.css' %}" rel="stylesheet">
<style>
/* UP-UI-POLISH-04: Design Tokens */
:root {
    --card-bg: rgba(15, 23, 42, 0.6);
    --card-border: rgba(255, 255, 255, 0.1);
    --card-hover-border: rgba(255, 255, 255, 0.2);
    --glass-blur: blur(16px);
    --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --glow-indigo: 0 0 20px rgba(99, 102, 241, 0.5);
    --glow-emerald: 0 0 20px rgba(16, 185, 129, 0.5);
}

/* Battle Card Glow Effects */
.battle-card-featured {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(168, 85, 247, 0.15));
    border: 1px solid rgba(99, 102, 241, 0.3);
    transition: var(--transition-smooth);
}

.battle-card-featured:hover {
    border-color: rgba(99, 102, 241, 0.6);
    box-shadow: var(--glow-indigo);
    transform: translateY(-2px);
}

.battle-card-standard {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    backdrop-filter: var(--glass-blur);
    transition: var(--transition-smooth);
}

.battle-card-standard:hover {
    border-color: var(--card-hover-border);
    transform: translateY(-2px);
}

/* Copy Button Animation */
.copy-btn {
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
}

.battle-card:hover .copy-btn,
.battle-card:focus-within .copy-btn {
    opacity: 1;
}

/* Toast Notification */
.toast {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: rgba(16, 185, 129, 0.95);
    backdrop-filter: blur(8px);
    padding: 1rem 1.5rem;
    border-radius: 0.75rem;
    color: white;
    font-weight: 600;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    animation: slideInUp 0.3s ease-out;
}

@keyframes slideInUp {
    from {
        transform: translateY(100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Pinned Star Indicator */
.pinned-star {
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

/* Empty State Illustration */
.empty-state {
    opacity: 0.6;
    transition: opacity 0.3s ease-in-out;
}

.empty-state:hover {
    opacity: 1;
}

/* Focus Styles for Accessibility */
button:focus-visible,
a:focus-visible {
    outline: 2px solid rgba(99, 102, 241, 0.8);
    outline-offset: 2px;
}

/* Collapse/Expand Transition */
.collapsible-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.collapsible-content.expanded {
    max-height: 5000px;
}
</style>
{% endblock %}

{% block content %}
<!-- UP-UI-POLISH-04: Production-Grade Profile (Premium 2025 Esports UI/UX) -->

<div class="min-h-screen bg-slate-950">
    
    <!-- SECTION 1: HERO HEADER (Banner + Avatar + Username + Badges) -->
    <section class="relative w-full h-64 md:h-80 overflow-hidden">
        {% if profile.banner_url %}
        <img src="{{ profile.banner_url }}" 
             alt="{{ profile.display_name }} banner" 
             class="absolute inset-0 w-full h-full object-cover"
             loading="eager">
        {% else %}
        <div class="absolute inset-0 bg-gradient-to-br from-indigo-600 via-purple-700 to-pink-600"></div>
        {% endif %}
        
        <!-- Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-950/50 to-transparent"></div>
        
        <!-- Hero Content Container -->
        <div class="absolute bottom-0 left-0 right-0">
            <div class="container mx-auto px-4 md:px-6 pb-6 max-w-7xl">
                <div class="flex flex-col sm:flex-row items-center sm:items-end gap-4 md:gap-6">
                    <!-- Avatar with Verification Badge -->
                    <div class="relative flex-shrink-0">
                        {% if profile.avatar_url %}
                        <img src="{{ profile.avatar_url }}" 
                             alt="{{ profile.username }}" 
                             class="w-28 h-28 md:w-36 md:h-36 rounded-2xl border-4 border-slate-950 shadow-2xl object-cover"
                             loading="eager">
                        {% else %}
                        <div class="w-28 h-28 md:w-36 md:h-36 rounded-2xl border-4 border-slate-950 bg-gradient-to-br from-indigo-600 to-purple-700 flex items-center justify-center text-5xl font-black text-white shadow-2xl">
                            {{ profile.display_name|slice:":1"|upper }}
                        </div>
                        {% endif %}
                        
                        {% if profile.is_kyc_verified %}
                        <div class="absolute -bottom-2 -right-2 w-9 h-9 bg-blue-500 rounded-full border-3 border-slate-950 flex items-center justify-center shadow-lg"
                             title="Verified Player">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Name & Username -->
                    <div class="flex-1 text-center sm:text-left">
                        <h1 class="text-3xl md:text-5xl font-black text-white uppercase tracking-tight drop-shadow-lg">
                            {{ profile.display_name }}
                        </h1>
                        <p class="text-sm md:text-base text-slate-300 mt-1 font-semibold">
                            @{{ profile.username }}{% if profile.level %} ‚Ä¢ Level {{ profile.level }}{% endif %}
                        </p>
                        
                        <!-- Badge Pills (KYC, Pro, etc.) -->
                        <div class="flex flex-wrap gap-2 mt-3 justify-center sm:justify-start">
                            {% if profile.is_kyc_verified %}
                            <span class="px-3 py-1 bg-blue-500/20 border border-blue-500/30 rounded-full text-xs font-bold text-blue-300 uppercase tracking-wide">
                                ‚úì Verified
                            </span>
                            {% endif %}
                            {% if profile.is_pro %}
                            <span class="px-3 py-1 bg-yellow-500/20 border border-yellow-500/30 rounded-full text-xs font-bold text-yellow-300 uppercase tracking-wide">
                                ‚≠ê Pro
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- SECTION 2: PRIMARY ACTIONS ROW -->
    <section class="border-b border-white/5 bg-slate-900/80 backdrop-blur-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 md:px-6 py-4 max-w-7xl">
            <div class="flex flex-wrap items-center justify-between gap-3">
                <div class="flex flex-wrap gap-2">
                    <a href="#stats" 
                       class="px-4 py-2 text-sm font-semibold text-slate-300 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                        Stats
                    </a>
                    <a href="#passports" 
                       class="px-4 py-2 text-sm font-semibold text-slate-300 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                        Game Passports
                    </a>
                    <a href="#activity" 
                       class="px-4 py-2 text-sm font-semibold text-slate-300 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                        Activity
                    </a>
                    <a href="#about" 
                       class="px-4 py-2 text-sm font-semibold text-slate-300 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                        About
                    </a>
                </div>
                
                <div class="flex gap-2">
                    {% if is_owner %}
                    <a href="{% url 'user_profile:profile_settings_v2' %}" 
                       class="px-5 py-2.5 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-bold text-sm transition-all shadow-lg"
                       aria-label="Edit profile settings">
                        <span class="hidden sm:inline">Edit Profile</span>
                        <span class="sm:hidden">Edit</span>
                    </a>
                    <a href="{% url 'user_profile:profile_privacy_v2' %}" 
                       class="px-5 py-2.5 bg-slate-700 hover:bg-slate-600 border border-white/10 rounded-lg text-white font-bold text-sm transition-all"
                       aria-label="Privacy settings">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                        </svg>
                    </a>
                    {% else %}
                    <button class="px-5 py-2.5 bg-emerald-600 hover:bg-emerald-700 rounded-lg text-white font-bold text-sm transition-all shadow-lg"
                            aria-label="Follow {{ profile.username }}">
                        + Follow
                    </button>
                    <button class="px-5 py-2.5 bg-slate-700 hover:bg-slate-600 border border-white/10 rounded-lg text-white font-bold text-sm transition-all"
                            aria-label="Send message to {{ profile.username }}">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
    
    <!-- Main Content Container -->
    <div class="container mx-auto px-4 md:px-6 py-8 max-w-7xl">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- LEFT SIDEBAR: About & Social -->
            <aside class="lg:col-span-3 space-y-6">
                
                <!-- SECTION 7: ABOUT + SOCIAL LINKS CARD -->
                <div id="about" class="bg-slate-900/60 backdrop-blur-lg rounded-2xl p-6 border border-white/10 shadow-2xl">
                    <h2 class="text-sm font-black text-slate-400 uppercase tracking-wider mb-4 pb-3 border-b border-white/10">
                        About
                    </h2>
                    
                    {% if profile.bio %}
                    <p class="text-sm text-slate-300 leading-relaxed mb-5">{{ profile.bio }}</p>
                    {% else %}
                    <div class="text-center py-6 empty-state">
                        <div class="text-4xl mb-2">üìù</div>
                        <p class="text-sm text-slate-400">No bio yet</p>
                    </div>
                    {% endif %}
                    
                    {% if profile.country or profile.pronouns %}
                    <div class="space-y-3 mb-5">
                        {% if profile.country %}
                        <div class="flex items-center gap-3 text-sm">
                            <span class="text-xl" aria-hidden="true">üìç</span>
                            <span class="text-slate-300">{{ profile.country }}</span>
                        </div>
                        {% endif %}
                        
                        {% if profile.pronouns %}
                        <div class="flex items-center gap-3 text-sm">
                            <span class="text-xl" aria-hidden="true">üë§</span>
                            <span class="text-slate-300">{{ profile.pronouns }}</span>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- Social Links -->
                    {% if social %}
                    <div class="mt-6 pt-6 border-t border-white/10">
                        <h3 class="text-xs font-black text-slate-400 uppercase tracking-wider mb-3">
                            Connect
                        </h3>
                        
                        <div class="space-y-2">
                            {% for link in social %}
                            <a href="{{ link.url }}" 
                               target="_blank" 
                               rel="noopener noreferrer"
                               class="flex items-center gap-3 p-2.5 rounded-lg bg-slate-800/40 hover:bg-slate-700 border border-white/10 hover:border-white/20 transition-all group"
                               aria-label="Visit {{ link.platform }}">
                                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-lg bg-slate-700/50">
                                    {% if link.platform == "Discord" %}üéÆ
                                    {% elif link.platform == "Twitch" %}üì∫
                                    {% elif link.platform == "YouTube" %}‚ñ∂Ô∏è
                                    {% elif link.platform == "Twitter" %}üê¶
                                    {% elif link.platform == "Instagram" %}üì∑
                                    {% else %}üîó
                                    {% endif %}
                                </div>
                                <span class="text-sm font-semibold text-white group-hover:text-indigo-400 transition-colors truncate">
                                    {{ link.platform }}
                                </span>
                                <svg class="w-4 h-4 ml-auto text-slate-500 group-hover:text-indigo-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                </svg>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                    {% else %}
                    <div class="mt-6 pt-6 border-t border-white/10 text-center empty-state">
                        <div class="text-3xl mb-2">üîó</div>
                        <p class="text-xs text-slate-400">No social links yet</p>
                    </div>
                    {% endif %}
                </div>
            </aside>
            
            <!-- MAIN CONTENT -->
            <main class="lg:col-span-9 space-y-6">
                
                <!-- SECTION 3: STATS STRIP -->
                <div id="stats" class="bg-slate-900/60 backdrop-blur-lg rounded-2xl p-6 border border-white/10 shadow-2xl">
                    <h2 class="text-xl font-black text-white uppercase mb-5 flex items-center gap-2">
                        <span>Career Stats</span>
                        <svg class="w-5 h-5 text-indigo-400" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                        </svg>
                    </h2>
                    
                    {% if stats %}
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-slate-800/40 rounded-xl border border-white/10 hover:border-indigo-500/30 transition-colors">
                            <div class="text-3xl md:text-4xl font-black text-indigo-400">{{ stats.tournaments_played|default:"0" }}</div>
                            <div class="text-xs text-slate-400 uppercase mt-2 font-semibold">Tournaments</div>
                        </div>
                        <div class="text-center p-4 bg-slate-800/40 rounded-xl border border-white/10 hover:border-emerald-500/30 transition-colors">
                            <div class="text-3xl md:text-4xl font-black text-emerald-400">{{ stats.tournaments_won|default:"0" }}</div>
                            <div class="text-xs text-slate-400 uppercase mt-2 font-semibold">Wins</div>
                        </div>
                        <div class="text-center p-4 bg-slate-800/40 rounded-xl border border-white/10 hover:border-purple-500/30 transition-colors">
                            <div class="text-3xl md:text-4xl font-black text-purple-400">
                                {% if stats.tournaments_played and stats.tournaments_played > 0 %}
                                {% widthratio stats.tournaments_won|default:0 stats.tournaments_played 100 %}%
                                {% else %}‚Äî{% endif %}
                            </div>
                            <div class="text-xs text-slate-400 uppercase mt-2 font-semibold">Win Rate</div>
                        </div>
                        <div class="text-center p-4 bg-slate-800/40 rounded-xl border border-white/10 hover:border-amber-500/30 transition-colors">
                            <div class="text-3xl md:text-4xl font-black text-amber-400">{{ stats.reputation|default:"‚Äî" }}</div>
                            <div class="text-xs text-slate-400 uppercase mt-2 font-semibold">Reputation</div>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center py-8 empty-state">
                        <div class="text-5xl mb-3">üìä</div>
                        <p class="text-slate-400">No stats available yet</p>
                        <p class="text-sm text-slate-500 mt-2">Stats will appear after participating in tournaments</p>
                    </div>
                    {% endif %}
                </div>
                
                <!-- SECTION 4 & 5: GAME PASSPORTS (Featured + More Games) -->
                <div id="passports" class="bg-slate-900/60 backdrop-blur-lg rounded-2xl p-6 border border-white/10 shadow-2xl">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-black text-white uppercase flex items-center gap-2">
                            <span>Game Passports</span>
                            <svg class="w-5 h-5 text-indigo-400" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd"/>
                            </svg>
                        </h2>
                        
                        {% if is_owner %}
                        <a href="{% url 'user_profile:profile_settings_v2' %}#games" 
                           class="px-4 py-2 bg-indigo-600/20 hover:bg-indigo-600/30 border border-indigo-500/30 rounded-lg text-sm font-semibold text-indigo-300 transition-all"
                           aria-label="Manage game passports">
                            + Add Game
                        </a>
                        {% endif %}
                    </div>
                    
                    {% if pinned_passports or unpinned_passports %}
                        
                        <!-- FEATURED GAME PASSPORTS (Pinned) -->
                        {% if pinned_passports %}
                        <div class="space-y-4 mb-6">
                            {% for passport in pinned_passports %}
                            <div class="battle-card battle-card-featured rounded-xl p-5 relative">
                                <!-- Pinned Star Indicator -->
                                <div class="absolute top-3 right-3 w-8 h-8 bg-indigo-500/30 rounded-full flex items-center justify-center pinned-star"
                                     title="Pinned Game">
                                    <span class="text-lg" aria-label="Pinned">üìå</span>
                                </div>
                                
                                <div class="flex flex-col sm:flex-row sm:items-start gap-4">
                                    <!-- Game Icon (if available) -->
                                    <div class="flex-shrink-0">
                                        <div class="w-16 h-16 bg-gradient-to-br from-indigo-600 to-purple-700 rounded-xl flex items-center justify-center text-3xl font-black text-white shadow-lg">
                                            {{ passport.game_name|slice:":1" }}
                                        </div>
                                    </div>
                                    
                                    <!-- Passport Details -->
                                    <div class="flex-1 min-w-0">
                                        <h3 class="text-lg font-black text-white mb-1">{{ passport.game_name }}</h3>
                                        
                                        <!-- IGN with Copy Button -->
                                        <div class="flex items-center gap-2 mb-3">
                                            <span class="text-sm font-semibold text-indigo-300 truncate" id="ign-{{ passport.id }}">
                                                {{ passport.identity_key }}
                                            </span>
                                            {% if is_owner or passport.visibility == 'public' %}
                                            <button class="copy-btn p-1.5 hover:bg-white/10 rounded transition-colors"
                                                    onclick="copyToClipboard('{{ passport.identity_key }}', 'ign-{{ passport.id }}')"
                                                    aria-label="Copy IGN to clipboard">
                                                <svg class="w-4 h-4 text-slate-400 hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                                </svg>
                                            </button>
                                            {% endif %}
                                        </div>
                                        
                                        <!-- Meta Info Pills -->
                                        <div class="flex flex-wrap gap-2 mb-3">
                                            {% if passport.region %}
                                            <span class="px-2.5 py-1 bg-slate-800/60 border border-white/10 rounded-md text-xs font-semibold text-slate-300">
                                                üåç {{ passport.region }}
                                            </span>
                                            {% endif %}
                                            
                                            {% if passport.rank_name %}
                                            <span class="px-2.5 py-1 bg-amber-500/20 border border-amber-500/30 rounded-md text-xs font-bold text-amber-300">
                                                üèÜ {{ passport.rank_name }}
                                            </span>
                                            {% endif %}
                                            
                                            {% if passport.looking_for_team %}
                                            <span class="px-2.5 py-1 bg-emerald-500/20 border border-emerald-500/30 rounded-md text-xs font-bold text-emerald-300">
                                                üîç LFT - Recruit Me
                                            </span>
                                            {% endif %}
                                            
                                            {% if is_owner and passport.visibility != 'public' %}
                                            <span class="px-2.5 py-1 bg-slate-700/60 border border-white/10 rounded-md text-xs font-semibold text-slate-400">
                                                üëÅÔ∏è {{ passport.visibility|title }}
                                            </span>
                                            {% endif %}
                                        </div>
                                        
                                        <!-- Team Badge -->
                                        {% if passport.current_team %}
                                        <div class="mt-3 pt-3 border-t border-white/10">
                                            <div class="flex items-center gap-3">
                                                {% if passport.current_team.logo_url %}
                                                <img src="{{ passport.current_team.logo_url }}" 
                                                     alt="{{ passport.current_team.name }}" 
                                                     class="w-10 h-10 rounded-lg object-cover border border-white/10">
                                                {% else %}
                                                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-slate-700 to-slate-800 flex items-center justify-center text-lg font-black text-white border border-white/10">
                                                    {{ passport.current_team.name|slice:":1" }}
                                                </div>
                                                {% endif %}
                                                <div class="flex-1 min-w-0">
                                                    <p class="text-xs text-slate-400">Playing for</p>
                                                    <p class="text-sm font-bold text-white truncate">{{ passport.current_team.name }}</p>
                                                </div>
                                            </div>
                                        </div>
                                        {% else %}
                                        <div class="mt-3 pt-3 border-t border-white/10">
                                            <p class="text-xs text-slate-400 flex items-center gap-2">
                                                <span class="text-base">üéØ</span>
                                                <span>Free Agent</span>
                                            </p>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        <!-- MORE GAMES SECTION (Unpinned - Collapsed by Default) -->
                        {% if unpinned_passports %}
                        <div class="mt-6">
                            <button id="toggleMoreGames"
                                    class="w-full px-4 py-3 bg-slate-800/40 hover:bg-slate-800 border border-white/10 hover:border-white/20 rounded-lg text-sm font-semibold text-slate-300 transition-all flex items-center justify-between"
                                    aria-expanded="false"
                                    aria-controls="moreGamesContent">
                                <span>More Games ({{ unpinned_passports|length }})</span>
                                <svg id="expandIcon" class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                </svg>
                            </button>
                            
                            <div id="moreGamesContent" class="collapsible-content" aria-hidden="true">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                                    {% for passport in unpinned_passports %}
                                    <div class="battle-card battle-card-standard rounded-xl p-4">
                                        <div class="flex items-start gap-3">
                                            <div class="w-12 h-12 bg-gradient-to-br from-slate-700 to-slate-800 rounded-lg flex items-center justify-center text-xl font-black text-white flex-shrink-0">
                                                {{ passport.game_name|slice:":1" }}
                                            </div>
                                            
                                            <div class="flex-1 min-w-0">
                                                <h3 class="text-base font-black text-white truncate">{{ passport.game_name }}</h3>
                                                <p class="text-xs text-slate-400 font-semibold truncate">{{ passport.identity_key }}</p>
                                                
                                                {% if passport.region %}
                                                <div class="mt-2">
                                                    <span class="px-2 py-0.5 bg-slate-800/60 border border-white/10 rounded text-xs text-slate-300">
                                                        üåç {{ passport.region }}
                                                    </span>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        
                    {% else %}
                        <!-- EMPTY STATE: No Passports -->
                        <div class="text-center py-12 empty-state">
                            <div class="text-6xl mb-4">üéÆ</div>
                            <h3 class="text-xl font-bold text-white mb-2">No Game Passports Yet</h3>
                            <p class="text-slate-400 mb-6">
                                {% if is_owner %}
                                Add your first game passport to showcase your gaming identity
                                {% else %}
                                {{ profile.username }} hasn't added any game passports yet
                                {% endif %}
                            </p>
                            {% if is_owner %}
                            <a href="{% url 'user_profile:profile_settings_v2' %}#games" 
                               class="inline-flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-bold transition-all shadow-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                <span>Add Your First Game Passport</span>
                            </a>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
                
                <!-- SECTION 6: ACTIVITY PREVIEW -->
                <div id="activity" class="bg-slate-900/60 backdrop-blur-lg rounded-2xl p-6 border border-white/10 shadow-2xl">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-black text-white uppercase flex items-center gap-2">
                            <span>Recent Activity</span>
                            <svg class="w-5 h-5 text-indigo-400" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                            </svg>
                        </h2>
                        
                        {% if activities %}
                        <a href="{% url 'user_profile:profile_activity_v2' username=profile.username %}" 
                           class="text-sm font-semibold text-indigo-400 hover:text-indigo-300 transition-colors flex items-center gap-1">
                            <span>View All</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </a>
                        {% endif %}
                    </div>
                    
                    {% if activities %}
                    <div class="space-y-3">
                        {% for event in activities|slice:":5" %}
                        <div class="flex items-start gap-4 p-4 bg-slate-800/40 rounded-lg border border-white/10 hover:border-white/20 transition-colors">
                            <div class="text-2xl flex-shrink-0" aria-hidden="true">
                                {% if event.event_type == 'tournament_win' %}üèÜ
                                {% elif event.event_type == 'tournament_joined' %}üéØ
                                {% elif event.event_type == 'match_won' %}‚úÖ
                                {% elif event.event_type == 'achievement' %}‚≠ê
                                {% elif event.event_type == 'level_up' %}üìà
                                {% elif event.event_type == 'team_joined' %}ü§ù
                                {% else %}üì¢
                                {% endif %}
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm text-white font-medium">{{ event.message }}</p>
                                <p class="text-xs text-slate-400 mt-1">{{ event.timestamp|timesince }} ago</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-12 empty-state">
                        <div class="text-5xl mb-3">üì≠</div>
                        <p class="text-slate-400">No recent activity</p>
                        <p class="text-sm text-slate-500 mt-2">Activity will appear here after tournaments and matches</p>
                    </div>
                    {% endif %}
                </div>
                
            </main>
        </div>
    </div>
    
</div>

<!-- Toast Container -->
<div id="toastContainer"></div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'user_profile/v2/profile_public.js' %}"></script>
{% endblock %}
