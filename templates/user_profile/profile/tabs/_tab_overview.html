<!-- UP.4 TACTICAL ABOUT SECTION (v4.0) -->
{% include "user_profile/profile/partials/_about_tactical_v4.html" %}

<div class="glass-panel p-6 rounded-2xl">
    <div class="flex justify-between items-center mb-6">
        <h3 class="text-gray-400 font-bold text-xs uppercase tracking-widest flex items-center gap-2">
            <i class="fa-solid fa-chart-pie text-z-cyan"></i> Performance Analytics
        </h3>
        <select class="bg-black/40 text-white text-xs px-3 py-1 rounded border border-white/10 outline-none">
            <option>Last 20 Matches</option>
            <option>All Time</option>
        </select>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-black/20 rounded-xl p-4 border border-white/5 text-center relative overflow-hidden">
            <div class="text-[10px] text-gray-500 uppercase font-bold mb-1">K/D Ratio</div>
            <div class="text-2xl font-black text-white">{{ stats_ctx.kd_ratio|default:"0.00" }}</div>
            <div class="text-[10px] text-gray-400 mt-1">{{ stats_ctx.total_kills|default:0 }} K / {{ stats_ctx.total_deaths|default:0 }} D</div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-z-green to-transparent opacity-50"></div>
        </div>
        <div class="bg-black/20 rounded-xl p-4 border border-white/5 text-center relative overflow-hidden">
            <div class="text-[10px] text-gray-500 uppercase font-bold mb-1">Win Rate</div>
            <div class="text-2xl font-black text-white">{{ stats_ctx.win_rate|default:0 }}%</div>
            <div class="text-[10px] text-gray-400 mt-1">{{ stats_ctx.total_wins|default:0 }} W / {{ stats_ctx.total_matches|default:0 }} M</div>
             <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-z-cyan to-transparent opacity-50"></div>
        </div>
        <div class="bg-black/20 rounded-xl p-4 border border-white/5 text-center relative overflow-hidden">
            <div class="text-[10px] text-gray-500 uppercase font-bold mb-1">Matches</div>
            <div class="text-2xl font-black text-white">{{ stats_ctx.total_matches|default:0 }}</div>
            <div class="text-[10px] text-gray-400 mt-1">Played</div>
             <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-z-purple to-transparent opacity-50"></div>
        </div>
        <div class="bg-black/20 rounded-xl p-4 border border-white/5 text-center relative overflow-hidden">
            <div class="text-[10px] text-gray-500 uppercase font-bold mb-1">Tournaments</div>
            <div class="text-2xl font-black text-white">{{ stats_ctx.tournaments_won|default:0 }}</div>
            <div class="text-[10px] text-gray-400 mt-1">Won / {{ stats_ctx.tournaments_played|default:0 }} Played</div>
             <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-z-gold to-transparent opacity-50"></div>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    
    {# UP PHASE 8: Career Widget - Real Data #}
    <div class="glass-panel p-6 rounded-2xl hover:border-z-gold/50 transition duration-300 group cursor-pointer relative overflow-hidden" data-career-deep-link>
        <div class="absolute right-0 top-0 w-40 h-40 bg-z-gold/5 rounded-full blur-3xl group-hover:bg-z-gold/10 transition"></div>
        
        <div class="flex justify-between items-start mb-4">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-z-gold/20 to-transparent border border-z-gold/20 flex items-center justify-center text-z-gold text-xl shadow-lg">
                <i class="fa-solid fa-trophy"></i>
            </div>
            <i class="fa-solid fa-arrow-right text-gray-600 group-hover:text-white -rotate-45 transition"></i>
        </div>
        
        <h3 class="text-white font-bold font-display text-xl mb-1">Career</h3>
        <p class="text-xs text-gray-400 mb-6 font-medium">
            {% if user_teams %}
                {{ user_teams|length }} Team{{ user_teams|length|pluralize }}
            {% else %}
                No team affiliations
            {% endif %}
        </p>

        <div class="space-y-4">
            {% if user_teams %}
                {% for team in user_teams|slice:":2" %}
                <div class="flex items-center gap-4 relative pl-4 border-l-2 border-z-green">
                    {% if team.logo_url %}
                    <img src="{{ team.logo_url }}" alt="{{ team.name }}" class="w-10 h-10 rounded-lg object-cover border border-white/10">
                    {% else %}
                    <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center text-xs font-bold">{{ team.tag|default:'TM'|upper }}</div>
                    {% endif %}
                    <div class="flex-1 min-w-0">
                        <div class="text-white text-sm font-bold truncate">{{ team.name }}</div>
                        <div class="text-[10px] text-z-green font-bold uppercase tracking-wider">
                            {{ team.role|default:'Member' }}{% if team.game %} • {{ team.game }}{% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
                
                {% if user_teams|length > 2 %}
                <div class="text-center pt-2">
                    <button data-career-deep-link class="text-xs text-z-cyan hover:text-white transition font-medium">
                        View all {{ user_teams|length }} teams <i class="fa-solid fa-arrow-right ml-1"></i>
                    </button>
                </div>
                {% endif %}
            {% else %}
                <div class="text-center py-4">
                    <i class="fa-solid fa-users-slash text-2xl text-gray-600 mb-2 block"></i>
                    <div class="text-xs text-gray-400">No team history yet</div>
                </div>
            {% endif %}
        </div>
    </div>

    {# UP PHASE 8: Game Passports Widget - Limit to 2 items #}
    <div class="glass-panel p-6 rounded-2xl hover:border-z-purple/50 transition duration-300 group cursor-pointer relative overflow-hidden" data-career-deep-link>
        <div class="absolute right-0 top-0 w-40 h-40 bg-z-purple/5 rounded-full blur-3xl group-hover:bg-z-purple/10 transition"></div>

        <div class="flex justify-between items-start mb-4">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-z-purple/20 to-transparent border border-z-purple/20 flex items-center justify-center text-z-purple text-xl shadow-lg">
                <i class="fa-solid fa-gamepad"></i>
            </div>
            <i class="fa-solid fa-arrow-right text-gray-600 group-hover:text-white -rotate-45 transition"></i>
        </div>
        
        <h3 class="text-white font-bold font-display text-xl mb-1">Game Passports</h3>
        <p class="text-xs text-gray-400 mb-6 font-medium">{{ pinned_passports|length|add:unpinned_passports|length }} Linked Account{{ pinned_passports|length|add:unpinned_passports|length|pluralize }}</p>

        {% if is_owner or permissions.can_view_game_passports %}
        <div class="space-y-3">
            {# UP PHASE 8: Show max 2 passports (pinned first) #}
            {% with all_passports=pinned_passports|add:unpinned_passports %}
                {% if all_passports %}
                    {% for passport in all_passports|slice:":2" %}
                    <div class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 transition">
                        <div class="flex items-center gap-3">
                            {% if passport.is_pinned %}
                            <div class="w-8 h-8 rounded bg-z-cyan flex items-center justify-center text-white"><i class="fa-solid fa-gamepad"></i></div>
                            {% else %}
                            <div class="w-8 h-8 rounded bg-gray-700 flex items-center justify-center text-white"><i class="fa-solid fa-gamepad"></i></div>
                            {% endif %}
                            <div>
                                <div class="text-white text-xs font-bold font-mono">{{ passport.in_game_name }}{% if passport.discriminator %}#{{ passport.discriminator }}{% endif %}</div>
                                <div class="text-[10px] {% if passport.is_pinned %}text-z-cyan{% else %}text-gray-400{% endif %}">
                                    {% if passport.rank_name %}{{ passport.rank_name }}{% endif %}{% if passport.platform %} • {{ passport.platform }}{% endif %}
                                </div>
                            </div>
                        </div>
                        {% if passport.verification_status == 'VERIFIED' %}
                        <i class="fa-solid fa-circle-check text-z-cyan text-sm shadow-neon-cyan"></i>
                        {% endif %}
                    </div>
                    {% endfor %}
                    
                    {% if all_passports|length > 2 %}
                    <div class="text-center pt-2">
                        <button data-career-deep-link class="text-xs text-z-purple hover:text-white transition font-medium">
                            View all {{ all_passports|length }} passports <i class="fa-solid fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                    {% endif %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="fa-solid fa-gamepad text-2xl text-gray-600 mb-2 block"></i>
                        <div class="text-xs text-gray-400">No game passports linked</div>
                    </div>
                {% endif %}
            {% endwith %}
        </div>
        {% else %}
        <div class="text-center py-8">
            <i class="fa-solid fa-lock text-2xl text-gray-600 mb-2 block"></i>
            <div class="text-xs text-gray-400">Game passports are private</div>
        </div>
        {% endif %}
    </div>
</div>
