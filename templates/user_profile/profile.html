{% extends "base.html" %}
{% load static %}

{% block title %}{{ profile.display_name }} (@{{ profile_user.username }}) - Profile{% endblock %}

{% block extra_css %}
<link href="{% static 'css/user_profile/core.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- Debug panel removed for production - only accessible via browser console for superusers -->

<!-- ============================================
     DELTACROWN ESPORTS HUD - USER PROFILE
     Phase 2 Implementation - Modular Architecture
     ============================================ -->

<div class="min-h-screen bg-slate-950" 
     x-data="{
        // Tab Management
        activeGameTab: '{{ game_profiles.0.game|default:"valorant" }}',
        mobileTab: 'info',
        
        // State Management
        isFollowing: {{ is_following|yesno:"true,false" }},
        walletBlurred: true,
        
        // Toast Notification System
        toast: {
            show: false,
            message: '',
            icon: 'âœ“'
        },
        
        // Methods
        showToast(message, icon = 'âœ“') {
            this.toast.message = message;
            this.toast.icon = icon;
            this.toast.show = true;
            setTimeout(() => { this.toast.show = false; }, 3000);
        },
        
        copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                this.showToast('Copied to clipboard!', 'ðŸ“‹');
            }).catch(() => {
                this.showToast('Failed to copy', 'âŒ');
            });
        },
        
        shareProfile() {
            const url = window.location.href;
            if (navigator.share) {
                navigator.share({ title: '{{ profile.display_name }} - DeltaCrown', url: url });
            } else {
                this.copyToClipboard(url);
            }
        },
        
        toggleFollow() {
            this.isFollowing = !this.isFollowing;
            this.showToast(this.isFollowing ? 'Following!' : 'Unfollowed', this.isFollowing ? 'âœ“' : 'â„¹');
            // TODO: Implement AJAX call to backend
        }
     }">

    <!-- ============================================
         HERO BANNER SECTION (Full Width, Responsive Height)
         Section 3.1.1 - Master Plan
         ============================================ -->
    <section class="relative w-full h-64 md:h-80 lg:h-96 overflow-hidden">
        <!-- Background Image -->
        {% if profile.banner %}
        <img src="{{ profile.banner.url }}" 
             alt="{{ profile.display_name }} banner" 
             class="absolute inset-0 w-full h-full object-cover"
             loading="eager">
        {% else %}
        <div class="absolute inset-0 w-full h-full bg-gradient-to-br from-indigo-900 via-slate-900 to-slate-950"></div>
        {% endif %}
        
        <!-- Gradient Fade (Bottom) -->
        <div class="absolute bottom-0 left-0 right-0 h-24 md:h-32 bg-gradient-to-t from-slate-950 to-transparent"></div>
        
        <!-- Content Layer (Bottom Aligned) -->
        <div class="absolute bottom-0 left-0 right-0 z-10">
            <div class="container mx-auto px-4 md:px-6 lg:px-8 pb-4 md:pb-6 max-w-7xl">
                <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-3 md:gap-4">
                    
                    <!-- Left: Avatar + Name + Metadata -->
                    <div class="flex items-end gap-3 md:gap-5">
                        <!-- Avatar with Online Ring -->
                        <div class="relative flex-shrink-0">
                            {% if profile.avatar %}
                            <img src="{{ profile.avatar.url }}" 
                                 alt="{{ profile.display_name }}" 
                                 class="w-24 h-24 md:w-32 md:h-32 lg:w-40 lg:h-40 rounded-full border-4 md:border-[6px] border-slate-950 object-cover shadow-2xl
                                        {% if profile.stream_status %}ring-4 ring-emerald-500 ring-offset-4 ring-offset-slate-950 animate-pulse-border{% endif %}">
                            {% else %}
                            <div class="w-24 h-24 md:w-32 md:h-32 lg:w-40 lg:h-40 rounded-full border-4 md:border-[6px] border-slate-950 
                                        bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center 
                                        text-3xl md:text-4xl lg:text-5xl font-black text-white shadow-2xl
                                        {% if profile.stream_status %}ring-4 ring-emerald-500 ring-offset-4 ring-offset-slate-950 animate-pulse-border{% endif %}">
                                {{ profile.display_name|slice:":1"|upper }}
                            </div>
                            {% endif %}
                            
                            <!-- Live Badge -->
                            {% if profile.stream_status %}
                            <div class="absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold px-2 md:px-3 py-1 rounded-full animate-pulse shadow-lg">
                                ðŸ”´ LIVE
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Name, Username, Level, Team -->
                        <div class="pb-1 md:pb-2">
                            <div class="flex items-center gap-2 md:gap-3 mb-1">
                                <h1 class="text-2xl md:text-4xl lg:text-5xl font-black text-white uppercase tracking-tight leading-none">
                                    {{ profile.display_name }}
                                </h1>
                                {% if profile.is_kyc_verified %}
                                <span class="text-blue-500 text-xl md:text-2xl lg:text-3xl" title="KYC Verified">âœ“</span>
                                {% endif %}
                            </div>
                            <div class="flex items-center gap-2 md:gap-3 text-slate-400 text-xs md:text-sm lg:text-base flex-wrap">
                                <span>@{{ profile_user.username }}</span>
                                <span class="text-slate-600">â€¢</span>
                                <span class="text-amber-400 font-semibold">Lvl {{ profile.level }}</span>
                                {% if current_teams %}
                                <span class="text-slate-600 hidden sm:inline">â€¢</span>
                                <span class="hidden sm:inline">{{ current_teams.0.team.name }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right: Action Buttons -->
                    <div class="flex gap-2 md:gap-3 pb-1 md:pb-2 flex-wrap">
                        {% if is_own_profile %}
                            <!-- Owner Actions -->
                            <a href="{% url 'user_profile:settings' %}" 
                               class="btn-primary px-4 md:px-6 py-2 md:py-2.5 text-sm md:text-base font-semibold rounded-lg 
                                      transition-all duration-200 hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl
                                      inline-flex items-center gap-2">
                                <i class="fas fa-cog text-sm md:text-base"></i>
                                <span class="hidden sm:inline">Settings</span>
                                <span class="sm:hidden">Edit</span>
                            </a>
                            <button @click="shareProfile()" 
                                    class="btn-secondary px-4 md:px-6 py-2 md:py-2.5 text-sm md:text-base font-semibold rounded-lg 
                                           transition-all duration-200 hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl
                                           inline-flex items-center gap-2">
                                <i class="fas fa-share-alt text-sm md:text-base"></i>
                                <span class="hidden sm:inline">Share</span>
                            </button>
                        {% else %}
                            <!-- Visitor Actions -->
                            <button @click="toggleFollow()" 
                                    :disabled="followLoading"
                                    :class="isFollowing 
                                            ? 'bg-slate-700 hover:bg-red-600 border-2 border-slate-600 hover:border-red-500' 
                                            : 'btn-primary'"
                                    class="px-4 md:px-6 py-2 md:py-2.5 text-sm md:text-base font-semibold rounded-lg 
                                           transition-all duration-200 shadow-lg hover:shadow-xl
                                           inline-flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed
                                           hover:scale-105 active:scale-95">
                                <i :class="isFollowing ? 'fas fa-user-check' : 'fas fa-user-plus'" class="text-sm md:text-base"></i>
                                <span x-text="followLoading ? 'Loading...' : (isFollowing ? 'Following' : 'Follow')"></span>
                            </button>
                            
                            <button class="btn-secondary px-4 md:px-6 py-2 md:py-2.5 text-sm md:text-base font-semibold rounded-lg 
                                           transition-all duration-200 hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl
                                           inline-flex items-center gap-2">
                                <i class="fas fa-envelope text-sm md:text-base"></i>
                                <span class="hidden sm:inline">Message</span>
                            </button>
                            
                            <button @click="shareProfile()" 
                                    class="btn-secondary px-4 py-2 md:py-2.5 text-sm md:text-base font-semibold rounded-lg 
                                           transition-all duration-200 hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl
                                           inline-flex items-center justify-center md:hidden"
                                    title="Share Profile">
                                <i class="fas fa-share-alt text-sm"></i>
                            </button>
                            
                            <button @click="shareProfile()" 
                                    class="btn-secondary px-4 md:px-6 py-2 md:py-2.5 text-sm md:text-base font-semibold rounded-lg 
                                           transition-all duration-200 hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl
                                           hidden md:inline-flex items-center gap-2">
                                <i class="fas fa-share-alt text-sm md:text-base"></i>
                                <span>Share</span>
                            </button>
                        {% endif %}
                    </div>
                    
                </div>
            </div>
        </div>
    </section>

    <!-- ============================================
         MAIN CONTENT AREA
         Section 3.1 & 3.2 - Master Plan
         ============================================ -->
    <div class="container mx-auto px-4 md:px-6 lg:px-8 py-6 md:py-10">
        
        <!-- ============================================
             DESKTOP LAYOUT: 3-COLUMN GRID
             Hidden on Mobile (md:grid)
             ============================================ -->
        <div class="hidden md:grid md:grid-cols-12 gap-6 lg:gap-8">
            
            <!-- LEFT COLUMN (col-span-3) - Sticky -->
            <div class="col-span-12 md:col-span-4 lg:col-span-3 space-y-4 lg:space-y-6 md:sticky md:top-6 md:self-start">
                <!-- Component: Identity Card -->
                {% include 'user_profile/components/_identity_card.html' %}
                
                <!-- Component: Vital Statistics -->
                {% include 'user_profile/components/_vital_stats.html' %}
                
                <!-- Component: Connected Socials -->
                {% include 'user_profile/components/_social_links.html' %}
            </div>
            
            <!-- MIDDLE COLUMN (col-span-6) - Scrollable -->
            <div class="col-span-12 md:col-span-8 lg:col-span-6 space-y-4 lg:space-y-6">
                <!-- Component: Current Team(s) -->
                {% include 'user_profile/components/_team_card.html' %}
                
                <!-- Component: Game Passport -->
                {% include 'user_profile/components/_game_passport.html' %}
                
                <!-- Component: Match History -->
                {% include 'user_profile/components/_match_history.html' %}
            </div>
            
            <!-- RIGHT COLUMN (col-span-3) - Sticky -->
            <div class="hidden lg:block lg:col-span-3 space-y-4 lg:space-y-6 lg:sticky lg:top-6 lg:self-start">
                <!-- Component: Trophy Shelf (Achievements) -->
                {% include 'user_profile/components/_trophy_shelf.html' %}
                
                <!-- Component: Wallet -->
                {% include 'user_profile/components/_wallet_card.html' %}
                
                <!-- Component: Certificates -->
                {% include 'user_profile/components/_certificates.html' %}
            </div>
            
        </div>
        
        <!-- ============================================
             MOBILE LAYOUT: STICKY TAB NAVIGATION
             Visible only on Mobile (md:hidden)
             Section 3.2 - Master Plan
             ============================================ -->
        <div class="md:hidden">
            
            <!-- Sticky Tab Bar -->
            <div class="sticky top-0 z-40 bg-slate-950/95 backdrop-blur-xl border-b border-white/10 -mx-4 px-4 mb-6 shadow-lg">
                <div class="flex">
                    <button @click="mobileTab = 'info'"
                            :class="mobileTab === 'info' ? 'border-b-2 border-indigo-500 text-white font-bold' : 'text-slate-400'"
                            class="flex-1 py-4 text-xs md:text-sm font-semibold uppercase tracking-wide transition-all duration-200">
                        <i class="fas fa-user mr-1"></i> Info
                    </button>
                    <button @click="mobileTab = 'games'"
                            :class="mobileTab === 'games' ? 'border-b-2 border-indigo-500 text-white font-bold' : 'text-slate-400'"
                            class="flex-1 py-4 text-xs md:text-sm font-semibold uppercase tracking-wide transition-all duration-200">
                        <i class="fas fa-gamepad mr-1"></i> Games
                    </button>
                    <button @click="mobileTab === 'career'"
                            :class="mobileTab === 'career' ? 'border-b-2 border-indigo-500 text-white font-bold' : 'text-slate-400'"
                            class="flex-1 py-4 text-xs md:text-sm font-semibold uppercase tracking-wide transition-all duration-200">
                        <i class="fas fa-trophy mr-1"></i> Career
                    </button>
                </div>
            </div>
            
            <!-- Mobile Tab Content -->
            <div class="space-y-4">
                <!-- INFO Tab (Identity + Vitals + Socials + Trophies) -->
                <div x-show="mobileTab === 'info'" class="space-y-4">
                    {% include 'user_profile/components/_identity_card.html' %}
                    {% include 'user_profile/components/_vital_stats.html' %}
                    {% include 'user_profile/components/_social_links.html' %}
                    {% include 'user_profile/components/_trophy_shelf.html' %}
                </div>
                
                <!-- GAMES Tab (Game Passport + Match History) -->
                <div x-show="mobileTab === 'games'" class="space-y-4" style="display: none;">
                    {% include 'user_profile/components/_game_passport.html' %}
                    {% include 'user_profile/components/_match_history.html' %}
                </div>
                
                <!-- CAREER Tab (Team + Wallet + Certificates) -->
                <div x-show="mobileTab === 'career'" class="space-y-4" style="display: none;">
                    {% include 'user_profile/components/_team_card.html' %}
                    {% include 'user_profile/components/_wallet_card.html' %}
                    {% include 'user_profile/components/_certificates.html' %}
                </div>
            </div>
            
        </div>
        
    </div>

    <!-- Toast Notification (Global) -->
    <div x-show="toast.show" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-y-2"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed top-4 right-4 z-50 glass-card px-6 py-4 rounded-lg shadow-2xl max-w-sm"
         style="display: none;">
        <div class="flex items-center gap-3">
            <span x-text="toast.icon" class="text-2xl"></span>
            <p x-text="toast.message" class="text-white font-semibold"></p>
        </div>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<!-- Alpine.js for Reactive Components -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
{% endblock %}
