{% extends "base.html" %}
{% load static %}
{% load profile_tags %}

{% block title %}{{ profile_user.username }}'s Profile - DeltaCrown{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}

{% block content %}
<div class="profile-container">
    
    <!-- Profile Header with Parallax Banner -->
    <div class="profile-header">
        <div class="banner-wrapper">
            {% if profile.banner %}
                <img src="{{ profile.banner.url }}" alt="Profile Banner" class="profile-banner">
            {% else %}
                <div class="profile-banner gradient-banner"></div>
            {% endif %}
            <div class="banner-overlay"></div>
        </div>
        
        <div class="profile-info-card">
            <div class="avatar-section">
                <div class="avatar-ring">
                    {% if profile.avatar %}
                        <img src="{{ profile.avatar.url }}" alt="{{ profile_user.username }}" class="profile-avatar">
                    {% else %}
                        <div class="profile-avatar default-avatar">
                            {{ profile_user.username|first|upper }}
                        </div>
                    {% endif %}
                    {% if profile.is_kyc_verified %}
                        <div class="verified-badge" title="KYC Verified">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
                            </svg>
                        </div>
                    {% endif %}
                    {% if profile.stream_status %}
                        <div class="live-badge">LIVE</div>
                    {% endif %}
                </div>
                
                <div class="user-info">
                    <h1 class="username">{{ profile_user.username }}</h1>
                    {% if profile.display_name and profile.display_name != profile_user.username %}
                        <p class="display-name">{{ profile.display_name }}</p>
                    {% endif %}
                    {% if profile.bio %}
                        <p class="bio">{{ profile.bio }}</p>
                    {% endif %}
                    
                    <div class="user-meta">
                        {% if profile.country and profile.show_country %}
                            <span class="meta-item">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                                {{ profile.country }}
                            </span>
                        {% endif %}
                        
                        {% if profile.age and profile.show_age %}
                            <span class="meta-item">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/></svg>
                                {{ profile.age }} years old
                            </span>
                        {% endif %}
                        
                        <span class="meta-item">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                            Joined {{ profile.created_at|date:"M Y" }}
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Level & XP Progress -->
            <div class="level-section">
                <div class="level-badge">
                    <span class="level-number">{{ profile.level }}</span>
                    <span class="level-label">LVL</span>
                </div>
                <div class="xp-progress">
                    <div class="xp-bar-container">
                        <div class="xp-bar" style="width: {{ profile.level_progress_percentage }}%"></div>
                    </div>
                    <span class="xp-text">{{ profile.xp }} / {{ profile.xp_to_next_level }} XP</span>
                </div>
            </div>
            {% if is_own_profile %}
            <div class="profile-actions">
                <a href="{% url 'user_profile:settings' %}" class="btn btn-secondary settings-btn">Settings</a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Stats Dashboard -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon trophy">üèÜ</div>
            <div class="stat-content">
                <h3 class="stat-value">{{ tournament_stats.total_wins|default:0 }}</h3>
                <p class="stat-label">Tournament Wins</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon coins">üí∞</div>
            <div class="stat-content">
                <h3 class="stat-value">‚Çø{{ profile.lifetime_earnings|floatformat:0 }}</h3>
                <p class="stat-label">Lifetime Earnings</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon teams">üë•</div>
            <div class="stat-content">
                <h3 class="stat-value">{{ current_teams|length }}</h3>
                <p class="stat-label">Active Teams</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon rating">‚≠ê</div>
            <div class="stat-content">
                <h3 class="stat-value">{{ profile.skill_rating }}</h3>
                <p class="stat-label">Skill Rating</p>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="content-grid">
        
        <!-- Left Column -->
        <div class="left-column">
            
            <!-- Pinned Badges -->
            {% if pinned_badges %}
            <div class="content-card badges-card">
                <h2 class="card-title">
                    <span class="title-icon">üèÖ</span>
                    Showcase Badges
                </h2>
                <div class="badges-showcase">
                    {% for user_badge in pinned_badges %}
                        <div class="badge-item" data-rarity="{{ user_badge.badge.rarity }}" title="{{ user_badge.badge.description }}">
                            <div class="badge-icon">{{ user_badge.badge.icon }}</div>
                            <p class="badge-name">{{ user_badge.badge.name }}</p>
                            <span class="badge-rarity">{{ user_badge.badge.get_rarity_display }}</span>
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- Game Profiles -->
            {% if game_profiles or profile.riot_id or profile.steam_id or profile.mlbb_id %}
            <div class="content-card game-profiles-card">
                <h2 class="card-title">
                    <span class="title-icon">üéÆ</span>
                    Game Profiles
                </h2>
                <div class="game-profiles-list">
                    {% for game_profile in game_profiles %}
                        <div class="game-profile-item">
                            <div class="game-info">
                                <span class="game-name">{{ game_profile.game|upper }}</span>
                                {% if game_profile.rank %}
                                    <span class="game-rank">{{ game_profile.rank }}</span>
                                {% endif %}
                            </div>
                            <div class="game-ign">{{ game_profile.ign }}</div>
                            {% if game_profile.is_verified %}
                                <div class="verified-icon" title="Verified">‚úì</div>
                            {% endif %}
                        </div>
                    {% endfor %}
                    
                    {% if profile.riot_id %}
                        <div class="game-profile-item legacy">
                            <div class="game-info">
                                <span class="game-name">VALORANT</span>
                            </div>
                            <div class="game-ign">{{ profile.riot_id }}</div>
                        </div>
                    {% endif %}
                    
                    {% if profile.steam_id %}
                        <div class="game-profile-item legacy">
                            <div class="game-info">
                                <span class="game-name">STEAM</span>
                            </div>
                            <div class="game-ign">{{ profile.steam_id }}</div>
                        </div>
                    {% endif %}
                    
                    {% if profile.mlbb_id %}
                        <div class="game-profile-item legacy">
                            <div class="game-info">
                                <span class="game-name">MLBB</span>
                            </div>
                            <div class="game-ign">{{ profile.mlbb_id }}</div>
                        </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            <!-- Social Links -->
            {% if profile.show_socials and social %}
            <div class="content-card social-card">
                <h2 class="card-title">
                    <span class="title-icon">üîó</span>
                    Connect
                </h2>
                <div class="social-links">
                    {% for link in social %}
                        <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer" class="social-link" data-platform="{{ link.platform|lower }}">
                            <span class="social-icon">
                                {% if link.platform == "YouTube" %}üì∫
                                {% elif link.platform == "Twitch" %}üé•
                                {% elif link.platform == "Discord" %}üí¨
                                {% elif link.platform == "Twitter" %}üê¶
                                {% elif link.platform == "Instagram" %}üì∑
                                {% elif link.platform == "Facebook" %}üëç
                                {% else %}üîó{% endif %}
                            </span>
                            <span class="social-platform">{{ link.platform }}</span>
                        </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Right Column -->
        <div class="right-column">
            
            <!-- Active Teams -->
            {% if current_teams %}
            <div class="content-card teams-card">
                <h2 class="card-title">
                    <span class="title-icon">üõ°Ô∏è</span>
                    Teams
                </h2>
                <div class="teams-list">
                    {% for team_data in current_teams %}
                        <a href="{% url 'teams:detail' team_data.team.slug %}" class="team-item">
                            <div class="team-logo">
                                {% if team_data.logo_url %}
                                    <img src="{{ team_data.logo_url }}" alt="{{ team_data.team.name }}">
                                {% else %}
                                    <div class="team-logo-placeholder">{{ team_data.team.name|first|upper }}</div>
                                {% endif %}
                            </div>
                            <div class="team-details">
                                <h3 class="team-name">{{ team_data.team.name }}</h3>
                                <p class="team-meta">
                                    <span class="team-role">{{ team_data.role }}</span>
                                    {% if team_data.game %}
                                        <span class="team-game">{{ team_data.game }}</span>
                                    {% endif %}
                                </p>
                            </div>
                            {% if team_data.is_captain %}
                                <div class="captain-badge" title="Team Captain">‚òÖ</div>
                            {% endif %}
                        </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- Tournament Activity -->
            {% if tournament_history %}
            <div class="content-card tournaments-card">
                <h2 class="card-title">
                    <span class="title-icon">üéØ</span>
                    Tournament History
                </h2>
                <div class="tournament-timeline">
                    {% for tournament in tournament_history %}
                        <div class="timeline-item" data-result="{{ tournament.placement|default:'participated' }}">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <h4 class="tournament-name">{{ tournament.tournament.name }}</h4>
                                <p class="tournament-meta">
                                    <span class="tournament-game">{{ tournament.tournament.game_display|default:tournament.tournament.game }}</span>
                                    <span class="tournament-date">{{ tournament.registered_at|date:"M d, Y" }}</span>
                                </p>
                                {% if tournament.placement %}
                                    <div class="placement-badge" data-placement="{{ tournament.placement }}">
                                        {% if tournament.placement == 1 %}ü•á
                                        {% elif tournament.placement == 2 %}ü•à
                                        {% elif tournament.placement == 3 %}ü•â
                                        {% else %}#{{ tournament.placement }}{% endif %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- Match History -->
            {% if match_history %}
            <div class="content-card matches-card">
                <h2 class="card-title">
                    <span class="title-icon">‚öîÔ∏è</span>
                    Recent Matches
                </h2>
                <div class="matches-list">
                    {% for match in match_history %}
                        <div class="match-item" data-result="{{ match.result|lower }}">
                            <div class="match-result {{ match.result|lower }}">{{ match.result }}</div>
                            <div class="match-details">
                                <p class="match-tournament">{{ match.tournament_name }}</p>
                                <p class="match-meta">
                                    <span class="match-game">{{ match.game }}</span>
                                    <span class="match-date">{{ match.played_at|date:"M d" }}</span>
                                </p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- Activity Feed (Placeholder for future) -->
            <div class="content-card activity-card">
                <h2 class="card-title">
                    <span class="title-icon">üìä</span>
                    Recent Activity
                </h2>
                <div class="activity-feed">
                    <div class="activity-item">
                        <div class="activity-icon">üéÆ</div>
                        <div class="activity-content">
                            <p>Joined DeltaCrown</p>
                            <span class="activity-time">{{ profile.created_at|timesince }} ago</span>
                        </div>
                    </div>
                    
                    {% if current_teams %}
                        <div class="activity-item">
                            <div class="activity-icon">üë•</div>
                            <div class="activity-content">
                                <p>Joined team {{ current_teams.0.team.name }}</p>
                                <span class="activity-time">{{ current_teams.0.joined_at|timesince }} ago</span>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
            
        </div>
    </div>
    
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/profile.js' %}"></script>
{% endblock %}
