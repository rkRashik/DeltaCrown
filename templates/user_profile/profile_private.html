{% extends 'base.html' %}
{% load static %}

{% block title %}Private Profile - DeltaCrown{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto text-center">
        <div class="bg-gray-800 rounded-lg p-8 shadow-xl">
            <svg class="w-24 h-24 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
            </svg>
            
            <h1 class="text-3xl font-bold text-white mb-4">Private Profile</h1>
            
            <p class="text-gray-400 text-lg mb-2">
                @{{ profile_user.username }}'s account is private.
            </p>
            
            {% if has_pending_request %}
                <p class="text-yellow-400 text-sm mb-4">
                    <i class="fa-solid fa-clock"></i> Your follow request is pending approval.
                </p>
            {% endif %}
            
            <p class="text-gray-500 text-sm mb-8">
                {% if viewer_role == 'anonymous' %}
                    Log in to send a follow request and view this profile.
                {% elif has_pending_request %}
                    Once approved, you'll be able to see their profile, loadouts, and match history.
                {% elif viewer_role == 'visitor' %}
                    Send a follow request to view this profile.
                {% else %}
                    You do not have permission to view this profile.
                {% endif %}
            </p>
            
            <div class="mt-8">
                {% if viewer_role == 'anonymous' %}
                    <a href="/accounts/login/" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg transition">
                        <i class="fa-solid fa-sign-in-alt mr-2"></i>Log In
                    </a>
                {% elif viewer_role == 'visitor' and not has_pending_request %}
                    <button onclick="sendFollowRequest()" id="follow-request-btn" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-3 rounded-lg transition">
                        <i class="fa-solid fa-user-plus mr-2"></i>Send Follow Request
                    </button>
                {% elif has_pending_request %}
                    <button disabled class="bg-yellow-500/30 text-yellow-400 font-semibold px-6 py-3 rounded-lg cursor-not-allowed">
                        <i class="fa-solid fa-clock mr-2"></i>Request Pending
                    </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
async function sendFollowRequest() {
    const btn = document.getElementById('follow-request-btn');
    btn.disabled = true;
    btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i>Sending...';
    
    try {
        const response = await fetch('/profiles/{{ profile_user.username }}/follow/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json'
            }
        });
        
        const data = await response.json();
        
        if (data.success && data.action === 'request_sent') {
            btn.innerHTML = '<i class="fa-solid fa-check mr-2"></i>Request Sent!';
            btn.classList.remove('bg-green-600', 'hover:bg-green-700');
            btn.classList.add('bg-yellow-500/30', 'text-yellow-400', 'cursor-not-allowed');
            setTimeout(() => {
                btn.innerHTML = '<i class="fa-solid fa-clock mr-2"></i>Request Pending';
            }, 2000);
        } else {
            throw new Error(data.error || 'Failed to send request');
        }
    } catch (err) {
        alert('Failed to send follow request: ' + err.message);
        btn.disabled = false;
        btn.innerHTML = '<i class="fa-solid fa-user-plus mr-2"></i>Send Follow Request';
    }
}
</script>
{% endblock %}
