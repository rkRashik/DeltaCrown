{% extends "base.html" %}
{% load static %}

{% block title %}{% if active_filter == 'recruiting' %}Recruiting Teams{% else %}Team Directory{% endif %} | DeltaCrown{% endblock %}
{% block og_title %}{% if active_filter == 'recruiting' %}Recruiting Teams{% else %}Team Directory{% endif %} | DeltaCrown{% endblock %}

{% block extra_css %}
<style>
  .directory-hero {
    background:
      radial-gradient(ellipse 80% 60% at 50% 0%, rgba(6,182,212,0.10) 0%, transparent 60%),
      radial-gradient(ellipse 60% 50% at 20% 30%, rgba(139,92,246,0.07) 0%, transparent 50%),
      linear-gradient(180deg, #020204 0%, #0A0A0F 100%);
  }
  .glass-panel {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.06);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-radius: 1rem;
  }
  .team-card {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 1rem;
    transition: all 0.3s ease;
    overflow: hidden;
  }
  .team-card:hover {
    border-color: rgba(6,182,212,0.25);
    box-shadow: 0 0 24px rgba(6,182,212,0.06);
    transform: translateY(-2px);
  }
  .filter-pill {
    display: inline-flex; align-items: center; gap: 0.375rem;
    padding: 0.4rem 1rem; border-radius: 9999px;
    font-size: 0.7rem; font-weight: 700; letter-spacing: 0.05em;
    text-transform: uppercase; cursor: pointer; text-decoration: none;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.03);
    color: #94a3b8; transition: all 0.25s ease; white-space: nowrap;
  }
  .filter-pill:hover, .filter-pill.active {
    background: rgba(6,182,212,0.12);
    border-color: rgba(6,182,212,0.35);
    color: #fff;
  }
  .filter-pill.recruiting.active {
    background: rgba(34,197,94,0.12);
    border-color: rgba(34,197,94,0.35);
    color: #22c55e;
  }
  .chip {
    display: inline-flex; align-items: center; gap: 0.25rem;
    padding: 0.15rem 0.5rem; border-radius: 9999px;
    font-size: 0.6rem; font-weight: 700; letter-spacing: 0.06em;
    text-transform: uppercase;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.04);
    color: #94a3b8;
  }
  .chip.green { background: rgba(34,197,94,0.1); border-color: rgba(34,197,94,0.25); color: #22c55e; }
  .chip.cyan { background: rgba(6,182,212,0.1); border-color: rgba(6,182,212,0.25); color: #06b6d4; }
  .chip.violet { background: rgba(139,92,246,0.1); border-color: rgba(139,92,246,0.25); color: #8b5cf6; }
  .chip.gold { background: rgba(255,215,0,0.1); border-color: rgba(255,215,0,0.25); color: #ffd700; }
  .stat-card {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 1rem; padding: 1.25rem;
    text-align: center; transition: all 0.3s ease;
  }
  .stat-card:hover {
    border-color: rgba(6,182,212,0.2);
    box-shadow: 0 0 24px rgba(6,182,212,0.05);
  }
  .recruit-badge {
    display: inline-flex; align-items: center; gap: 0.25rem;
    padding: 0.15rem 0.5rem; border-radius: 9999px;
    font-size: 0.6rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.06em;
    background: rgba(34,197,94,0.12);
    border: 1px solid rgba(34,197,94,0.25);
    color: #22c55e;
  }
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .fade-in-up { animation: fadeInUp 0.5s ease forwards; opacity: 0; }
</style>
{% endblock %}

{% block content %}
<div class="directory-hero min-h-screen">
  <!-- Decorative Glows -->
  <div class="fixed inset-0 z-0 pointer-events-none overflow-hidden">
    <div class="absolute top-[-200px] right-1/3 w-[600px] h-[600px] bg-[#06b6d4]/[0.05] rounded-full blur-[180px]"></div>
    <div class="absolute bottom-[-100px] left-1/4 w-[500px] h-[500px] bg-[#8b5cf6]/[0.04] rounded-full blur-[160px]"></div>
  </div>

  <div class="relative z-10 max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">

    <!-- ===== HERO HEADER ===== -->
    <div class="text-center mb-10 sm:mb-14 fade-in-up" style="animation-delay: 0.1s">
      <div class="inline-flex items-center gap-2 text-[10px] sm:text-xs font-bold uppercase tracking-[0.25em] text-slate-500 mb-4">
        <i class="fas fa-users text-[#06b6d4]"></i>
        DeltaCrown Teams
        {% if active_filter == 'recruiting' %}
        <span class="chip green"><i class="fas fa-bullhorn mr-1"></i> Recruiting</span>
        {% endif %}
      </div>
      <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-white uppercase tracking-tight" style="font-family: Rajdhani, sans-serif;">
        {% if active_filter == 'recruiting' %}
        <span class="bg-gradient-to-r from-[#22c55e] to-[#06b6d4] bg-clip-text text-transparent">Recruiting</span> Teams
        {% else %}
        Team <span class="bg-gradient-to-r from-[#06b6d4] via-[#8b5cf6] to-[#facc15] bg-clip-text text-transparent">Directory</span>
        {% endif %}
      </h1>
      <p class="text-sm sm:text-base text-slate-400 mt-3 max-w-2xl mx-auto leading-relaxed">
        {% if active_filter == 'recruiting' %}
        These teams are actively looking for new players. Find your squad, join their ranks, and compete.
        {% else %}
        Browse all public teams on DeltaCrown. Filter by game, region, or find teams actively recruiting.
        {% endif %}
      </p>
    </div>

    <!-- ===== STATS ROW ===== -->
    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4 mb-8 fade-in-up" style="animation-delay: 0.15s">
      <div class="stat-card">
        <div class="text-2xl sm:text-3xl font-bold text-white" style="font-family: Rajdhani, sans-serif;">{{ total_teams }}</div>
        <div class="text-[10px] sm:text-xs text-slate-500 uppercase tracking-widest font-bold mt-1">Total Teams</div>
      </div>
      <div class="stat-card">
        <div class="text-2xl sm:text-3xl font-bold text-[#22c55e]" style="font-family: Rajdhani, sans-serif;">{{ recruiting_count }}</div>
        <div class="text-[10px] sm:text-xs text-slate-500 uppercase tracking-widest font-bold mt-1">Recruiting Now</div>
      </div>
      <div class="stat-card hidden sm:block">
        <div class="text-2xl sm:text-3xl font-bold text-[#06b6d4]" style="font-family: Rajdhani, sans-serif;">{{ active_games|length }}</div>
        <div class="text-[10px] sm:text-xs text-slate-500 uppercase tracking-widest font-bold mt-1">Active Games</div>
      </div>
    </div>

    <!-- ===== FILTER BAR ===== -->
    <div class="glass-panel p-4 sm:p-5 mb-5 fade-in-up" style="animation-delay: 0.2s">
      <div class="flex flex-col gap-3">
        <!-- Mode pills -->
        <div class="flex flex-wrap gap-2">
          <a href="{% url 'organizations:team_directory' %}" class="filter-pill {% if active_filter == 'all' %}active{% endif %}">
            <i class="fas fa-globe"></i> All Teams
          </a>
          <a href="{% url 'organizations:team_directory' %}?filter=recruiting" class="filter-pill recruiting {% if active_filter == 'recruiting' %}active{% endif %}">
            <i class="fas fa-bullhorn"></i> Recruiting
          </a>
        </div>

        <!-- Game + Search filter -->
        <form method="get" class="flex flex-col sm:flex-row flex-wrap gap-3 items-stretch sm:items-end">
          {% if active_filter == 'recruiting' %}
          <input type="hidden" name="filter" value="recruiting">
          {% endif %}

          <!-- Game filter -->
          <div class="flex-1 min-w-[140px]">
            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Game</label>
            <select name="game" class="w-full bg-white/[0.04] border border-white/10 text-white rounded-lg px-3 py-2 text-sm focus:ring-1 focus:ring-[#06b6d4] focus:border-[#06b6d4] outline-none transition appearance-none">
              <option value="" style="background:#0A0A0F">All Games</option>
              {% for game in active_games %}
              <option value="{{ game.slug }}" style="background:#0A0A0F" {% if game.slug == game_filter %}selected{% endif %}>{{ game.display_name }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Region filter -->
          <div class="flex-1 min-w-[120px]">
            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Region</label>
            <select name="region" class="w-full bg-white/[0.04] border border-white/10 text-white rounded-lg px-3 py-2 text-sm focus:ring-1 focus:ring-[#06b6d4] focus:border-[#06b6d4] outline-none transition appearance-none">
              <option value="" style="background:#0A0A0F">All Regions</option>
              {% for r in regions %}
              <option value="{{ r }}" style="background:#0A0A0F" {% if r == region_filter %}selected{% endif %}>{{ r }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Sort -->
          <div class="min-w-[120px]">
            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Sort</label>
            <select name="sort" class="w-full bg-white/[0.04] border border-white/10 text-white rounded-lg px-3 py-2 text-sm focus:ring-1 focus:ring-[#06b6d4] focus:border-[#06b6d4] outline-none transition appearance-none">
              <option value="newest" style="background:#0A0A0F" {% if sort_by == 'newest' %}selected{% endif %}>Newest</option>
              <option value="name" style="background:#0A0A0F" {% if sort_by == 'name' %}selected{% endif %}>Name (A-Z)</option>
              <option value="members" style="background:#0A0A0F" {% if sort_by == 'members' %}selected{% endif %}>Most Members</option>
            </select>
          </div>

          <!-- Search -->
          <div class="flex-[2] min-w-[180px]">
            <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1.5">Search</label>
            <input type="text" name="q" value="{{ search_query }}" placeholder="Team name or tag..."
                   class="w-full bg-white/[0.04] border border-white/10 text-white rounded-lg px-3 py-2 text-sm focus:ring-1 focus:ring-[#06b6d4] focus:border-[#06b6d4] outline-none transition placeholder-slate-600">
          </div>

          <button type="submit"
                  class="px-5 py-2.5 bg-[#06b6d4]/10 text-[#06b6d4] border border-[#06b6d4]/25 rounded-lg text-xs font-bold uppercase tracking-widest hover:bg-[#06b6d4]/20 transition self-end">
            <i class="fas fa-search mr-2"></i>Search
          </button>
        </form>
      </div>
    </div>

    <!-- ===== TEAM GRID ===== -->
    <div class="fade-in-up" style="animation-delay: 0.3s">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <h2 class="text-lg font-bold text-white uppercase tracking-wider" style="font-family: Rajdhani, sans-serif;">
            <i class="fas fa-th-large text-[#06b6d4] mr-2"></i>
            {% if active_filter == 'recruiting' %}Recruiting Teams{% else %}All Teams{% endif %}
          </h2>
          <span class="chip cyan">{{ teams|length }} result{{ teams|length|pluralize }}</span>
        </div>
      </div>

      {% if teams %}
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for item in teams %}
        <a href="{{ item.team.get_absolute_url }}" class="team-card group block no-underline">
          <!-- Card header colored strip -->
          <div class="h-1.5" style="background: linear-gradient(90deg, {{ item.team.primary_color|default:'#06b6d4' }}, {{ item.team.accent_color|default:'#8b5cf6' }})"></div>

          <div class="p-5">
            <!-- Logo + Name -->
            <div class="flex items-center gap-3 mb-3">
              <div class="w-12 h-12 rounded-xl flex items-center justify-center shrink-0 overflow-hidden
                {% if item.team.logo %}bg-white/5{% else %}bg-gradient-to-br from-[#06b6d4]/20 to-[#8b5cf6]/20 border border-white/5{% endif %}">
                {% if item.team.logo %}
                <img src="{{ item.team.logo.url }}" alt="{{ item.team.name }}" class="w-full h-full object-cover">
                {% else %}
                <i class="fas fa-shield-alt text-lg text-[#06b6d4]/60"></i>
                {% endif %}
              </div>
              <div class="min-w-0 flex-1">
                <div class="flex items-center gap-2">
                  <h3 class="text-base font-bold text-white group-hover:text-[#06b6d4] transition truncate">{{ item.team.name }}</h3>
                  {% if item.team.tag %}<span class="text-xs text-slate-500 font-mono">[{{ item.team.tag }}]</span>{% endif %}
                </div>
                {% if item.team.tagline %}
                <p class="text-[10px] text-slate-500 truncate mt-0.5">{{ item.team.tagline }}</p>
                {% endif %}
              </div>
            </div>

            <!-- Meta row -->
            <div class="flex flex-wrap gap-1.5 mb-3">
              {% if item.game_obj %}
              <span class="chip">
                <span class="w-1.5 h-1.5 rounded-full inline-block" style="background:{{ item.game_obj.primary_color|default:'#64748b' }}"></span>
                {{ item.game_obj.display_name }}
              </span>
              {% endif %}
              {% if item.team.region %}
              <span class="chip"><i class="fas fa-map-marker-alt text-[8px] mr-0.5"></i>{{ item.team.region }}</span>
              {% endif %}
              <span class="chip"><i class="fas fa-users text-[8px] mr-0.5"></i>{{ item.team.member_count }}</span>
              {% if item.team.is_recruiting %}
              <span class="recruit-badge"><i class="fas fa-bullhorn text-[8px]"></i> Recruiting</span>
              {% endif %}
            </div>

            <!-- Description -->
            {% if item.team.description %}
            <p class="text-xs text-slate-500 leading-relaxed line-clamp-2">{{ item.team.description|truncatewords:25 }}</p>
            {% endif %}

            <!-- Footer -->
            <div class="flex items-center justify-between mt-4 pt-3 border-t border-white/5">
              {% if item.team.organization %}
              <div class="text-[10px] text-slate-500 truncate">
                <i class="fas fa-building mr-1"></i>{{ item.team.organization.name }}
              </div>
              {% else %}
              <div class="text-[10px] text-slate-600">
                <i class="fas fa-user mr-1"></i>Independent
              </div>
              {% endif %}
              <span class="text-[10px] text-[#06b6d4] font-bold uppercase tracking-wider opacity-0 group-hover:opacity-100 transition">
                View <i class="fas fa-arrow-right ml-1"></i>
              </span>
            </div>
          </div>
        </a>
        {% endfor %}
      </div>
      {% else %}
      <!-- Empty state -->
      <div class="glass-panel p-12 text-center">
        <div class="max-w-sm mx-auto">
          <div class="w-16 h-16 mx-auto rounded-2xl bg-white/[0.03] border border-white/5 flex items-center justify-center mb-4">
            <i class="fas fa-users text-2xl text-slate-600"></i>
          </div>
          <p class="text-base font-bold text-slate-400 uppercase tracking-wider mb-2">No teams found</p>
          <p class="text-sm text-slate-600 mb-4">
            {% if active_filter == 'recruiting' %}
            No teams are currently recruiting. Check back soon or browse all teams.
            {% elif search_query %}
            No teams match "{{ search_query }}". Try a different search.
            {% else %}
            No teams match your filters. Try adjusting your criteria.
            {% endif %}
          </p>
          <div class="flex flex-wrap justify-center gap-3">
            {% if active_filter == 'recruiting' %}
            <a href="{% url 'organizations:team_directory' %}" class="px-4 py-2 text-xs font-bold uppercase tracking-widest text-[#06b6d4] border border-[#06b6d4]/20 rounded-lg hover:bg-[#06b6d4]/10 transition no-underline">
              <i class="fas fa-globe mr-2"></i>Browse All
            </a>
            {% endif %}
            <a href="{% url 'organizations:team_directory' %}" class="px-4 py-2 text-xs font-bold uppercase tracking-widest text-slate-400 border border-white/10 rounded-lg hover:bg-white/5 transition no-underline">
              <i class="fas fa-times mr-2"></i>Clear Filters
            </a>
          </div>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- ===== CTA ===== -->
    <div class="mt-10 sm:mt-14 glass-panel p-6 sm:p-10 text-center fade-in-up" style="animation-delay: 0.4s">
      <h2 class="text-xl sm:text-2xl font-bold text-white uppercase tracking-wider mb-3" style="font-family: Rajdhani, sans-serif;">
        {% if active_filter == 'recruiting' %}
        Can't Find the Right Team?
        {% else %}
        Start Your Own Squad
        {% endif %}
      </h2>
      <p class="text-sm text-slate-400 max-w-lg mx-auto mb-6 leading-relaxed">
        {% if active_filter == 'recruiting' %}
        Create your own team and start recruiting players. Build your roster, compete in tournaments, and climb the rankings.
        {% else %}
        Set up your team in seconds â€” pick your game, brand your squad, and start competing on DeltaCrown.
        {% endif %}
      </p>
      <div class="flex flex-wrap justify-center gap-3">
        <a href="{% url 'organizations:team_create' %}" class="px-6 py-3 bg-[#facc15] text-black text-xs font-bold uppercase tracking-widest rounded-lg hover:brightness-110 shadow-lg shadow-[#facc15]/10 transition no-underline">
          <i class="fas fa-plus mr-2"></i>Create Team
        </a>
        {% if active_filter != 'recruiting' %}
        <a href="{% url 'organizations:team_directory' %}?filter=recruiting" class="px-6 py-3 bg-[#22c55e]/10 border border-[#22c55e]/25 text-[#22c55e] text-xs font-bold uppercase tracking-widest rounded-lg hover:bg-[#22c55e]/20 transition no-underline">
          <i class="fas fa-bullhorn mr-2"></i>Find Recruiting Teams
        </a>
        {% else %}
        <a href="/competition/rankings/" class="px-6 py-3 bg-white/5 border border-white/10 text-white text-xs font-bold uppercase tracking-widest rounded-lg hover:bg-white/10 transition no-underline">
          <i class="fas fa-trophy mr-2"></i>View Rankings
        </a>
        {% endif %}
      </div>
    </div>

  </div>
</div>
{% endblock %}
