{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Team Hub â€” DeltaCrown{% endblock %}
{% block og_title %}Team Hub â€” DeltaCrown Esports{% endblock %}

{% block extra_head %}
<meta name="description" content="Build your competitive legacy. Create a team, climb DCRS Rankings, and compete in Bangladesh's premier esports ecosystem.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>
<script>
tailwind.config = {
    darkMode: 'class',
    theme: {
        extend: {
            colors: {
                'dc-cyan': '#06b6d4',
                'dc-purple': '#8b5cf6',
                'dc-gold': '#facc15',
                'dc-dark': '#050505',
                'dc-surface': '#0d0d0d'
            },
            fontFamily: {
                'sans': ['Inter', 'system-ui', 'sans-serif'],
                'display': ['Space Grotesk', 'sans-serif']
            },
            animation: {
                'marquee': 'marquee 35s linear infinite',
                'pulse-glow': 'pulseGlow 2.5s ease-in-out infinite'
            },
            keyframes: {
                marquee: {
                    '0%': { transform: 'translateX(0%)' },
                    '100%': { transform: 'translateX(-50%)' }
                },
                pulseGlow: {
                    '0%,100%': { boxShadow: '0 0 15px rgba(6,182,212,0.4)' },
                    '50%': { boxShadow: '0 0 5px rgba(6,182,212,0.1)' }
                }
            }
        }
    }
};
</script>
{% endblock %}

{% block extra_css %}
<style>
/* ===== BASE ===== */
body {
    background: #050505;
    color: #fff;
    font-family: 'Inter', sans-serif;
    overflow-x: hidden;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    letter-spacing: -0.005em;
    font-size: 16px;
    line-height: 1.65;
}
h1, h2, h3, h4, h5, h6 {
    text-rendering: geometricPrecision;
    font-feature-settings: 'kern' 1;
    line-height: 1.2;
}
p, span, a, button, input, select, label {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* ===== GRAIN OVERLAY ===== */
body::before {
    content: '';
    position: fixed;
    inset: 0;
    z-index: 9999;
    pointer-events: none;
    opacity: .035;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
}

/* ===== GLASSMORPHISM V2 ===== */
.glass {
    background: rgba(255, 255, 255, 0.025);
    backdrop-filter: blur(16px) saturate(1.4);
    border: 1px solid rgba(255, 255, 255, 0.06);
    transition: all .4s cubic-bezier(.22, 1, .36, 1);
    position: relative;
}
.glass:hover {
    background: rgba(255, 255, 255, 0.055);
    border-color: rgba(6, 182, 212, 0.3);
    transform: translateY(-2px)
}
.glass-glow { position: relative; overflow: hidden }
.glass-glow::before {
    content: '';
    position: absolute;
    inset: -1px;
    z-index: -1;
    border-radius: inherit;
    background: conic-gradient(from var(--angle, 0deg), transparent 40%, #06b6d4 50%, #8b5cf6 60%, transparent 70%);
    opacity: 0;
    transition: opacity .5s;
    animation: spin-border 4s linear infinite;
}
.glass-glow:hover::before { opacity: 1 }
@property --angle { syntax: '<angle>'; initial-value: 0deg; inherits: false }
@keyframes spin-border { to { --angle: 360deg } }

/* ===== 3D TILT ===== */
.tilt-card {
    transition: transform .4s cubic-bezier(.22, 1, .36, 1), box-shadow .4s;
    transform-style: preserve-3d
}
.tilt-card:hover {
    transform: perspective(800px) rotateX(2deg) rotateY(-3deg) translateY(-4px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, .4), 0 0 30px rgba(6, 182, 212, .08)
}

/* ===== GRADIENTS & TEXT ===== */
.grad-text {
    background: linear-gradient(135deg, #06b6d4, #8b5cf6 50%, #facc15);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text
}
.hero-mesh {
    background: radial-gradient(ellipse 80% 50% at 20% 40%, rgba(6, 182, 212, .08) 0%, transparent 50%),
        radial-gradient(ellipse 60% 40% at 80% 20%, rgba(139, 92, 246, .06) 0%, transparent 50%),
        radial-gradient(ellipse 50% 50% at 50% 80%, rgba(250, 204, 21, .04) 0%, transparent 50%);
    animation: mesh-shift 12s ease-in-out infinite alternate;
}
@keyframes mesh-shift {
    0% { background-position: 0% 0%, 100% 0%, 50% 100% }
    100% { background-position: 100% 50%, 0% 100%, 80% 0% }
}

/* ===== CARD IMAGE OVERLAY ===== */
.card-img { position: relative; overflow: hidden }
.card-img::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(5, 5, 5, 0.95) 0%, rgba(5, 5, 5, 0.3) 60%, transparent)
}

/* ===== SCROLL CONTAINERS ===== */
.scroll-x {
    display: flex;
    gap: .75rem;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    cursor: grab
}
.scroll-x::-webkit-scrollbar { display: none }
.scroll-x>* { scroll-snap-align: start; flex-shrink: 0 }
.scroll-x:active { cursor: grabbing }

/* ===== GAME CARDS ===== */
.game-card-active {
    border-color: #06b6d4 !important;
    background: linear-gradient(to bottom, rgba(6, 182, 212, 0.15), transparent) !important;
    box-shadow: 0 0 25px rgba(6, 182, 212, 0.2), inset 0 0 15px rgba(6, 182, 212, 0.05)
}
.game-tooltip {
    position: absolute;
    bottom: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%) scale(0.9);
    background: rgba(13, 13, 13, .95);
    border: 1px solid rgba(255, 255, 255, .1);
    border-radius: 8px;
    padding: 6px 10px;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    transition: all .25s cubic-bezier(.22, 1, .36, 1);
    backdrop-filter: blur(12px);
    z-index: 50;
}
.game-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 5px solid transparent;
    border-top-color: rgba(255, 255, 255, .1);
}
.game-card:hover .game-tooltip { opacity: 1; transform: translateX(-50%) scale(1) }

/* ===== CROWN GLOW (rank #1) ===== */
.crown-card {
    border: 1px solid rgba(250, 204, 21, 0.25) !important;
    background: linear-gradient(135deg, rgba(250, 204, 21, 0.06), rgba(250, 204, 21, 0.02), transparent) !important;
    box-shadow: 0 0 20px rgba(250, 204, 21, 0.08);
}
.crown-card:hover { box-shadow: 0 0 35px rgba(250, 204, 21, 0.15); border-color: rgba(250, 204, 21, 0.4) !important }

/* ===== TIER BADGES ===== */
.tier-crown { background: rgba(250, 204, 21, .12); color: #facc15; border: 1px solid rgba(250, 204, 21, .25) }
.tier-ascendant { background: rgba(139, 92, 246, .12); color: #a78bfa; border: 1px solid rgba(139, 92, 246, .25) }
.tier-diamond { background: rgba(6, 182, 212, .12); color: #06b6d4; border: 1px solid rgba(6, 182, 212, .25) }
.tier-platinum { background: rgba(148, 163, 184, .12); color: #94a3b8; border: 1px solid rgba(148, 163, 184, .25) }
.tier-gold { background: rgba(234, 179, 8, .12); color: #eab308; border: 1px solid rgba(234, 179, 8, .25) }
.tier-silver { background: rgba(156, 163, 175, .12); color: #9ca3af; border: 1px solid rgba(156, 163, 175, .25) }

/* ===== ANIMATED PROGRESS BARS ===== */
.progress-fill { width: 0%; transition: width 1.2s cubic-bezier(.22, 1, .36, 1) }
.progress-fill.animate { width: var(--target-width) }

/* ===== SECTION NEON HEADER ===== */
.neon-line { position: relative }
.neon-line::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 2px;
    border-radius: 1px;
    background: linear-gradient(90deg, #06b6d4, transparent);
    transition: width .6s cubic-bezier(.22, 1, .36, 1);
}
.neon-line:hover::after { width: 100% }

/* ===== STAGGERED SCROLL REVEAL ===== */
.reveal { opacity: 0; transform: translateY(24px); transition: all .7s cubic-bezier(.22, 1, .36, 1) }
.reveal.visible { opacity: 1; transform: translateY(0) }
.reveal-delay-1 { transition-delay: .1s }
.reveal-delay-2 { transition-delay: .2s }
.reveal-delay-3 { transition-delay: .3s }
.reveal-delay-4 { transition-delay: .4s }

/* ===== TYPING CURSOR ===== */
.type-cursor::after { content: '|'; animation: blink 1s step-end infinite; color: #06b6d4 }
@keyframes blink { 0%, 100% { opacity: 1 } 50% { opacity: 0 } }

/* ===== PARTICLE CANVAS ===== */
#hero-particles { position: absolute; inset: 0; z-index: 1; pointer-events: none }

/* ===== FAB ===== */
.fab {
    position: fixed; bottom: 24px; right: 24px; z-index: 80;
    width: 56px; height: 56px; border-radius: 16px;
    background: linear-gradient(135deg, #06b6d4, #0891b2);
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 8px 32px rgba(6, 182, 212, .4);
    cursor: pointer; transition: all .3s cubic-bezier(.22, 1, .36, 1);
    transform: translateY(100px); opacity: 0;
}
.fab.visible { transform: translateY(0); opacity: 1 }
.fab:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 12px 40px rgba(6, 182, 212, .55) }
.fab::before {
    content: '';
    position: absolute;
    inset: -3px;
    border-radius: 19px;
    background: conic-gradient(from 0deg, rgba(6, 182, 212, .6), transparent 40%, rgba(139, 92, 246, .6) 60%, transparent);
    z-index: -1;
    animation: spin-border 3s linear infinite;
    opacity: .6;
}
.fab-label {
    position: absolute; right: calc(100% + 12px);
    white-space: nowrap;
    background: rgba(13, 13, 13, .95);
    border: 1px solid rgba(255, 255, 255, .1);
    border-radius: 8px; padding: 6px 12px;
    font-size: 12px; font-weight: 700; color: #06b6d4;
    opacity: 0; transform: translateX(8px);
    transition: all .25s; pointer-events: none;
    backdrop-filter: blur(12px);
}
.fab:hover .fab-label { opacity: 1; transform: translateX(0) }

/* ===== BACK TO TOP ===== */
.back-to-top {
    position: fixed; bottom: 90px; right: 28px; z-index: 79;
    width: 36px; height: 36px; border-radius: 10px;
    background: rgba(255, 255, 255, .05);
    border: 1px solid rgba(255, 255, 255, .1);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: all .3s;
    transform: translateY(80px); opacity: 0;
    backdrop-filter: blur(8px);
}
.back-to-top.visible { transform: translateY(0); opacity: 1 }
.back-to-top:hover { background: rgba(6, 182, 212, .15); border-color: rgba(6, 182, 212, .3) }

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar { width: 6px; height: 6px }
::-webkit-scrollbar-track { background: #0a0a0a }
::-webkit-scrollbar-thumb { background: #222; border-radius: 3px }
::-webkit-scrollbar-thumb:hover { background: #06b6d4 }

/* ===== SEARCH MODAL ===== */
.search-modal { display: none; position: fixed; inset: 0; z-index: 100; background: rgba(0, 0, 0, .85); backdrop-filter: blur(12px) }
.search-modal.active { display: flex }

/* ===== UTILITY ANIMATIONS ===== */
@keyframes fadeInUp { from { opacity: 0; transform: translateY(16px) } to { opacity: 1; transform: translateY(0) } }
.fade-in { animation: fadeInUp .5s ease-out both }
@keyframes float { 0%, 100% { transform: translateY(0) } 50% { transform: translateY(-6px) } }
.float-anim { animation: float 3s ease-in-out infinite }
@keyframes shimmer { 0% { background-position: -200% 0 } 100% { background-position: 200% 0 } }
.shimmer { background: linear-gradient(90deg, transparent 25%, rgba(255, 255, 255, .03) 50%, transparent 75%); background-size: 200% 100%; animation: shimmer 3s infinite }
.btn-arrow i:last-child { transition: transform .25s cubic-bezier(.22, 1, .36, 1) }
.btn-arrow:hover i:last-child { transform: translateX(4px) }
.social-icon { transition: all .3s; color: #6b7280 }
.social-icon:hover { color: #06b6d4; filter: drop-shadow(0 0 8px rgba(6, 182, 212, .5)); transform: translateY(-2px) }

/* ===== HERO CINEMATIC ENHANCEMENTS ===== */
.hero-grid-overlay {
    position: absolute; inset: 0;
    background-image: linear-gradient(rgba(6,182,212,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(6,182,212,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events: none; z-index: 1;
    mask-image: radial-gradient(ellipse at center, black 30%, transparent 75%);
    -webkit-mask-image: radial-gradient(ellipse at center, black 30%, transparent 75%);
}
.hero-vignette { position: absolute; inset: 0; background: radial-gradient(ellipse at center, transparent 30%, rgba(5,5,5,0.65) 100%); pointer-events: none; z-index: 2; }
.hero-scanline { position: absolute; inset: 0; background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.007) 2px, rgba(255,255,255,0.007) 4px); pointer-events: none; z-index: 2; }

/* Live activity ticker */
.activity-ticker-wrap {
    overflow: hidden;
    mask-image: linear-gradient(90deg, transparent, black 5%, black 95%, transparent);
    -webkit-mask-image: linear-gradient(90deg, transparent, black 5%, black 95%, transparent);
}
.activity-ticker {
    display: flex; gap: 2.5rem;
    animation: ticker-scroll 45s linear infinite;
    white-space: nowrap;
}
.activity-ticker:hover { animation-play-state: paused; }
@keyframes ticker-scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
.activity-dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; animation: activity-pulse 2s ease-in-out infinite; }
@keyframes activity-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

/* ===== RANKING TOP-3 HIGHLIGHT ===== */
.rank-row-gold { background: linear-gradient(90deg, rgba(250,204,21,0.06) 0%, transparent 60%); border: 1px solid rgba(250,204,21,0.15); border-radius: 12px; }
.rank-row-silver { background: linear-gradient(90deg, rgba(148,163,184,0.04) 0%, transparent 60%); border: 1px solid rgba(148,163,184,0.1); border-radius: 12px; }
.rank-row-bronze { background: linear-gradient(90deg, rgba(234,179,8,0.04) 0%, transparent 60%); border: 1px solid rgba(234,179,8,0.1); border-radius: 12px; }

/* ===== RANKING ROW HOVER (demo-style) ===== */
.rank-row { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
.rank-row:hover { transform: scale(1.01); background: linear-gradient(90deg, rgba(6,182,212,0.05), transparent); border-left: 2px solid #06b6d4; }
</style>
{% endblock %}

{% block content %}

<!-- ========== SEARCH MODAL ========== -->
<div id="search-modal" class="search-modal items-start justify-center pt-[15vh]" onclick="if(event.target===this)closeSearch()">
    <div class="w-full max-w-2xl mx-4 bg-dc-surface border border-white/10 rounded-2xl shadow-2xl overflow-hidden fade-in">
        <div class="p-4 border-b border-white/10 flex items-center gap-3">
            <i data-lucide="search" class="w-5 h-5 text-dc-cyan flex-shrink-0"></i>
            <input id="search-input" type="text" placeholder="Search teams, players, tournaments..." class="flex-1 bg-transparent text-white text-lg outline-none placeholder-gray-500">
            <button onclick="closeSearch()" class="hidden sm:flex items-center justify-center w-7 h-7 rounded-lg bg-white/5 border border-white/10 text-gray-500 hover:text-white hover:bg-white/10 transition-all flex-shrink-0" aria-label="Close search">
                <i data-lucide="x" class="w-3.5 h-3.5"></i>
            </button>
        </div>
        <div class="p-3 border-b border-white/10 flex items-center gap-2 flex-wrap">
            <span class="text-xs text-gray-500 uppercase tracking-wider mr-1">Filter:</span>
            <button class="search-filter active text-xs px-3 py-1 rounded-full font-semibold border transition-all bg-dc-cyan/15 border-dc-cyan/30 text-dc-cyan" data-filter="all">All</button>
            <button class="search-filter text-xs px-3 py-1 rounded-full font-semibold border transition-all bg-white/5 border-white/10 text-gray-400 hover:text-white" data-filter="teams">Teams</button>
            <button class="search-filter text-xs px-3 py-1 rounded-full font-semibold border transition-all bg-white/5 border-white/10 text-gray-400 hover:text-white" data-filter="players">Players</button>
            <button class="search-filter text-xs px-3 py-1 rounded-full font-semibold border transition-all bg-white/5 border-white/10 text-gray-400 hover:text-white" data-filter="tournaments">Tournaments</button>
        </div>
        <div class="p-4 max-h-[50vh] overflow-y-auto" id="search-results">
            <p class="text-xs text-gray-500 mb-3">TRENDING SEARCHES</p>
            <div class="space-y-2" id="search-trending">
                <p class="text-sm text-gray-500 text-center py-4">Type to search...</p>
            </div>
        </div>
    </div>
</div>

<!-- ========== HERO ========== -->
<section class="relative overflow-hidden" id="hero-section">
    <canvas id="hero-particles"></canvas>
    <div class="hero-mesh absolute inset-0"></div>
    <div class="absolute top-[-150px] left-1/4 w-[750px] h-[750px] bg-dc-cyan/[0.14] rounded-full blur-[220px] pointer-events-none"></div>
    <div class="absolute bottom-[-130px] right-[15%] w-[650px] h-[650px] bg-dc-purple/[0.11] rounded-full blur-[200px] pointer-events-none"></div>
    <div class="absolute top-[40%] left-[-120px] w-[450px] h-[450px] bg-dc-gold/[0.07] rounded-full blur-[160px] pointer-events-none"></div>
    <div class="absolute top-[10%] right-[-80px] w-[350px] h-[350px] bg-red-500/[0.04] rounded-full blur-[140px] pointer-events-none"></div>
    <div class="absolute bottom-0 left-0 w-full h-[2px] bg-gradient-to-r from-transparent via-dc-cyan/60 to-transparent"></div>
    <div class="hero-grid-overlay"></div>
    <div class="hero-vignette"></div>
    <div class="hero-scanline"></div>

    <div class="relative z-10 w-full max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-10 pt-8 sm:pt-12 pb-10">
        <div class="text-center max-w-3xl mx-auto">
            <div class="reveal inline-flex items-center gap-2 px-3.5 py-1.5 rounded-full bg-dc-purple/10 border border-dc-purple/25 text-dc-purple text-xs font-bold uppercase tracking-widest mb-5">
                <span class="w-2 h-2 rounded-full bg-dc-purple animate-pulse"></span>Season 1 Â· Now Live
            </div>
            <h1 class="reveal reveal-delay-1 font-display text-4xl sm:text-5xl lg:text-[3.8rem] font-black leading-[1.05] text-white mb-4">
                <span id="hero-typed"></span>
            </h1>
            <p class="reveal reveal-delay-2 text-gray-300 text-base sm:text-lg max-w-2xl mx-auto mb-7 leading-relaxed">
                Create a team in 30 seconds. Climb the DCRS tiers from Bronze to Crown. Earn real revenue, get scouted by organizations, and build a legacy that stays forever.
            </p>
            <div class="reveal reveal-delay-3 flex flex-col sm:flex-row gap-3 justify-center mb-5">
                {% if user.is_authenticated %}
                <a href="{% url 'organizations:team_create' %}" class="group relative px-8 py-4 bg-gradient-to-r from-dc-cyan to-cyan-400 text-dc-dark font-display font-bold rounded-xl hover:scale-[1.03] transition-all shadow-[0_0_30px_rgba(6,182,212,0.35)] hover:shadow-[0_0_50px_rgba(6,182,212,0.5)] overflow-hidden btn-arrow inline-flex items-center justify-center">
                    <div class="absolute inset-0 bg-gradient-to-r from-white/0 to-white/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <span class="relative flex items-center justify-center gap-2 text-sm"><i data-lucide="plus-circle" class="w-5 h-5"></i>CREATE YOUR TEAM<i data-lucide="arrow-right" class="w-4 h-4"></i></span>
                </a>
                {% else %}
                <a href="/accounts/signup/" class="group relative px-8 py-4 bg-gradient-to-r from-dc-cyan to-cyan-400 text-dc-dark font-display font-bold rounded-xl hover:scale-[1.03] transition-all shadow-[0_0_30px_rgba(6,182,212,0.35)] hover:shadow-[0_0_50px_rgba(6,182,212,0.5)] overflow-hidden btn-arrow inline-flex items-center justify-center">
                    <div class="absolute inset-0 bg-gradient-to-r from-white/0 to-white/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <span class="relative flex items-center justify-center gap-2 text-sm"><i data-lucide="plus-circle" class="w-5 h-5"></i>JOIN & CREATE YOUR TEAM<i data-lucide="arrow-right" class="w-4 h-4"></i></span>
                </a>
                {% endif %}
                <button onclick="openSearch()" class="px-8 py-4 bg-white/[0.06] border border-white/15 text-white font-semibold rounded-xl hover:bg-white/12 hover:border-white/25 transition-all flex items-center justify-center gap-2 text-sm backdrop-blur-sm btn-arrow">
                    <i data-lucide="search" class="w-4 h-4 text-dc-cyan"></i>Find a Squad
                </button>
            </div>
            <!-- Inline stats ticker -->
            <div class="reveal reveal-delay-4 flex flex-wrap items-center justify-center gap-x-6 gap-y-2 text-sm">
                <span class="flex items-center gap-1.5 text-gray-400"><span class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></span><span class="font-bold text-white counter" data-target="{{ stats.teams_active|default:'0' }}">0</span>+ Active Teams</span>
                <span class="w-1 h-1 bg-gray-600 rounded-full hidden sm:block"></span>
                <span class="flex items-center gap-1.5 text-gray-400"><i data-lucide="trophy" class="w-3.5 h-3.5 text-dc-gold"></i><span class="font-bold text-dc-cyan">à§³<span class="counter" data-target="{{ stats.total_prize_pool|default:'0' }}">0</span>K</span> Prize Pool</span>
                <span class="w-1 h-1 bg-gray-600 rounded-full hidden sm:block"></span>
                <span class="flex items-center gap-1.5 text-gray-400"><i data-lucide="zap" class="w-3.5 h-3.5 text-dc-purple"></i>Under 30 seconds to start</span>
            </div>
        </div>

        <!-- Live Activity Ticker -->
        <div class="mt-8 pt-5 border-t border-white/[0.06]">
            <div class="flex items-center gap-2.5 mb-3">
                <span class="activity-dot bg-green-400"></span>
                <p class="text-xs text-gray-400 uppercase tracking-[0.15em] font-bold">Live Activity</p>
                <span class="text-xs text-gray-500 ml-1">â€” updates in real-time</span>
            </div>
            <div class="activity-ticker-wrap">
                <div class="activity-ticker" id="live-ticker">
                    <span class="text-xs text-gray-500">Loading activity feed...</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ========== COMBAT ZONE â€“ GAME SELECTOR ========== -->
<section class="w-full max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-10 py-5">
    <div class="flex items-center justify-between mb-5">
        <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider flex items-center gap-2">
            <i data-lucide="crosshair" class="w-4 h-4 text-dc-cyan"></i>Select Combat Zone
        </h3>
        <div class="flex items-center gap-3">
            <span id="game-filter-indicator" class="text-xs text-dc-cyan font-semibold flex items-center gap-1.5 bg-dc-cyan/10 border border-dc-cyan/20 px-3 py-1 rounded-full">
                <i data-lucide="filter" class="w-3 h-3"></i>Showing: Global Â· All Games
            </span>
            <span class="text-xs text-gray-500">{{ available_games.count|add:1 }} Filters</span>
        </div>
    </div>
    <div class="flex gap-3 overflow-x-auto pb-2 scroll-x" id="game-grid">
        <!-- "All Games" button -->
        <button class="game-card {% if selected_game_slug == 'all' %}game-card-active{% endif %} group relative rounded-2xl overflow-hidden border border-white/10 bg-gradient-to-b from-dc-cyan/20 to-dc-dark flex-shrink-0 w-[100px] h-[120px] transition-all duration-300 hover:scale-105 hover:border-dc-cyan/50"
                data-game="all" onclick="selectGame('all', this)">
            <div class="absolute inset-0 flex flex-col items-center justify-center gap-2">
                <div class="w-12 h-12 rounded-xl bg-dc-cyan/15 border border-dc-cyan/25 flex items-center justify-center">
                    <i data-lucide="layout-grid" class="w-6 h-6 text-dc-cyan"></i>
                </div>
                <span class="text-xs text-white font-bold">All Games</span>
            </div>
        </button>
        {% for game in available_games %}
        <button class="game-card group relative rounded-2xl overflow-hidden border border-white/10 flex-shrink-0 w-[100px] h-[120px] transition-all duration-300 hover:scale-105 hover:border-dc-cyan/50 {% if selected_game_slug == game.slug %}game-card-active{% endif %}"
                data-game="{{ game.slug }}" onclick="selectGame('{{ game.slug }}', this)" style="{% if game.primary_color %}--gc: {{ game.primary_color }}{% endif %}">
            <!-- Blurred cover background -->
            {% if game.card_image %}
            <img src="{{ game.card_image.url }}" class="absolute inset-0 w-full h-full object-cover opacity-30 blur-[2px] group-hover:opacity-50 transition-opacity" alt="" loading="lazy">
            {% elif game.banner %}
            <img src="{{ game.banner.url }}" class="absolute inset-0 w-full h-full object-cover opacity-30 blur-[2px] group-hover:opacity-50 transition-opacity" alt="" loading="lazy">
            {% else %}
            <div class="absolute inset-0 bg-gradient-to-b from-gray-800 to-dc-dark"></div>
            {% endif %}
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div>
            <!-- Content -->
            <div class="relative h-full flex flex-col items-center justify-center gap-1.5 p-2">
                {% if game.logo %}
                <img src="{{ game.logo.url }}" alt="{{ game.display_name }}" class="w-10 h-10 object-contain drop-shadow-lg" loading="lazy">
                {% elif game.icon %}
                <img src="{{ game.icon.url }}" alt="{{ game.display_name }}" class="w-10 h-10 object-contain drop-shadow-lg" loading="lazy">
                {% else %}
                <div class="w-10 h-10 rounded-lg flex items-center justify-center text-xl">ðŸŽ®</div>
                {% endif %}
                <span class="font-display font-black text-white text-xs leading-none drop-shadow-lg text-center">{{ game.short_code }}</span>
                <span class="text-[8px] text-gray-300 text-center leading-tight opacity-80">{{ game.display_name }}</span>
            </div>
        </button>
        {% endfor %}
    </div>
</section>

<!-- ========== MAIN CONTENT ========== -->
<div class="w-full max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-10 py-10">
    <div class="grid grid-cols-1 lg:grid-cols-[1fr_420px] gap-10">

        <!-- LEFT COLUMN -->
        <div class="space-y-10">

            <!-- TOURNAMENT ARENA -->
            <div class="reveal">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="font-display text-2xl font-bold text-white flex items-center gap-2 neon-line">
                        <span class="w-1.5 h-7 bg-dc-cyan rounded-full"></span>Tournament Arena
                    </h2>
                    <a href="/tournaments" class="text-sm text-gray-400 hover:text-white flex items-center gap-1 transition-colors btn-arrow">View All <i data-lucide="arrow-right" class="w-3.5 h-3.5"></i></a>
                </div>
                {% if featured_tournament %}
                <div class="glass rounded-2xl overflow-hidden relative" style="transform:none!important">
                    {% if featured_tournament.status == 'live' %}
                    <span class="absolute top-3 right-3 z-20 bg-red-500/20 text-red-400 border border-red-500/40 text-xs font-bold px-2.5 py-1 rounded-full animate-pulse">LIVE NOW</span>
                    {% elif featured_tournament.status == 'registration_open' %}
                    <span class="absolute top-3 right-3 z-20 bg-green-500/20 text-green-400 border border-green-500/40 text-xs font-bold px-2.5 py-1 rounded-full">OPEN</span>
                    {% else %}
                    <span class="absolute top-3 right-3 z-20 bg-dc-cyan/20 text-dc-cyan border border-dc-cyan/40 text-xs font-bold px-2.5 py-1 rounded-full">UPCOMING</span>
                    {% endif %}
                    <div class="grid md:grid-cols-3 h-full">
                        <div class="relative h-44 md:h-full bg-gray-900">
                            {% if featured_tournament.banner_image %}
                            <img src="{{ featured_tournament.banner_image.url }}" class="w-full h-full object-cover opacity-60" alt="{{ featured_tournament.name }}" loading="lazy">
                            {% elif featured_tournament.game.card_image %}
                            <img src="{{ featured_tournament.game.card_image.url }}" class="w-full h-full object-cover opacity-60" alt="{{ featured_tournament.game.display_name }}" loading="lazy">
                            {% elif featured_tournament.game.banner %}
                            <img src="{{ featured_tournament.game.banner.url }}" class="w-full h-full object-cover opacity-60" alt="{{ featured_tournament.game.display_name }}" loading="lazy">
                            {% else %}
                            <div class="w-full h-full bg-gradient-to-br from-dc-cyan/20 to-dc-purple/20 flex items-center justify-center">
                                <i data-lucide="trophy" class="w-12 h-12 text-gray-700"></i>
                            </div>
                            {% endif %}
                        </div>
                        <div class="md:col-span-2 p-6 flex flex-col justify-between relative">
                            <div>
                                <div class="flex items-center gap-2 mb-2 text-xs font-bold text-dc-cyan tracking-wider uppercase">
                                    <span>{{ featured_tournament.get_format_display|upper }}</span>
                                    <span class="w-1 h-1 bg-gray-600 rounded-full"></span>
                                    <span>{{ featured_tournament.game.name }}</span>
                                </div>
                                <h3 class="text-2xl font-display font-black text-white mb-1">{{ featured_tournament.name }}</h3>
                                <p class="text-gray-300 text-sm mb-4 line-clamp-2">{{ featured_tournament.description|striptags|truncatewords:30 }}</p>
                                <div class="flex items-center gap-6 text-sm">
                                    <div>
                                        <p class="text-xs text-gray-500 uppercase">Prize</p>
                                        <p class="font-bold text-white">à§³{{ featured_tournament.prize_pool|intcomma }}</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 uppercase">Slots</p>
                                        <p class="font-bold text-white">{{ featured_tournament.total_registrations|default:"0" }}<span class="text-gray-400 text-xs font-normal">/{{ featured_tournament.max_participants }}</span></p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 uppercase">Entry</p>
                                        {% if featured_tournament.has_entry_fee %}
                                        <p class="font-bold text-dc-gold">à§³{{ featured_tournament.entry_fee_amount|intcomma }}</p>
                                        {% else %}
                                        <p class="font-bold text-green-400">FREE</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="flex gap-2 mt-4">
                                {% if featured_tournament.status == 'live' %}
                                <a href="/tournaments/{{ featured_tournament.slug }}/#matches" class="flex-1 bg-gradient-to-r from-red-500 to-rose-500 text-white font-bold py-2.5 rounded-lg hover:shadow-[0_0_20px_rgba(239,68,68,0.4)] transition-all text-sm text-center flex items-center justify-center gap-2">
                                    <span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-white"></span></span> Watch Live
                                </a>
                                {% elif featured_tournament.status == 'registration_open' %}
                                <a href="/tournaments/{{ featured_tournament.slug }}/register/{% if featured_tournament.participation_type == 'team' %}team/{% endif %}" class="flex-1 bg-gradient-to-r from-emerald-500 to-green-500 text-white font-bold py-2.5 rounded-lg hover:shadow-[0_0_20px_rgba(16,185,129,0.4)] transition-all text-sm text-center">Register Now</a>
                                {% elif featured_tournament.status == 'completed' %}
                                <a href="/tournaments/{{ featured_tournament.slug }}/#standings" class="flex-1 bg-gradient-to-r from-dc-gold to-amber-400 text-dc-dark font-bold py-2.5 rounded-lg hover:shadow-[0_0_20px_rgba(250,204,21,0.4)] transition-all text-sm text-center">View Results</a>
                                {% else %}
                                <a href="/tournaments/{{ featured_tournament.slug }}/" class="flex-1 bg-gradient-to-r from-dc-cyan to-cyan-400 text-dc-dark font-bold py-2.5 rounded-lg hover:shadow-[0_0_20px_rgba(6,182,212,0.4)] transition-all text-sm text-center">View Tournament</a>
                                {% endif %}
                                <a href="/tournaments/{{ featured_tournament.slug }}/" class="px-3 py-2.5 glass rounded-lg hover:bg-white/10 transition-colors" title="Tournament Details">
                                    <i data-lucide="info" class="w-4 h-4 text-gray-400"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <!-- No Featured Tournament â€” Empty State -->
                <div class="glass rounded-2xl p-10 text-center" style="transform:none!important">
                    <i data-lucide="trophy" class="w-8 h-8 text-gray-700 mx-auto mb-3"></i>
                    <p class="text-base text-gray-400 mb-1">No active tournaments right now</p>
                    <p class="text-sm text-gray-500">Check back soon or browse all tournaments</p>
                    <a href="/tournaments" class="mt-3 inline-block text-sm text-dc-cyan hover:underline">Browse Tournaments â†’</a>
                </div>
                {% endif %}

                {% if upcoming_tournament %}
                <a href="/tournaments/{{ upcoming_tournament.slug }}/" class="glass p-3.5 rounded-xl flex items-center justify-between mt-3 cursor-pointer hover:bg-white/5 hover:border-white/20 block" style="transition: background .3s, border-color .3s; transform:none!important; text-decoration:none;">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-dc-surface border border-white/10 flex items-center justify-center overflow-hidden">
                            {% if upcoming_tournament.game.icon %}
                            <img src="{{ upcoming_tournament.game.icon.url }}" class="w-full h-full object-cover" alt="{{ upcoming_tournament.game.display_name }}" loading="lazy">
                            {% else %}
                            <i data-lucide="trophy" class="w-4 h-4 text-dc-purple"></i>
                            {% endif %}
                        </div>
                        <div>
                            <h4 class="font-bold text-white text-sm">{{ upcoming_tournament.name }}</h4>
                            <p class="text-xs text-gray-400">
                                {{ upcoming_tournament.get_participation_type_display }} Â· à§³{{ upcoming_tournament.prize_pool|intcomma }}
                            </p>
                        </div>
                    </div>
                    <span class="bg-dc-cyan/10 text-dc-cyan text-xs font-bold px-2.5 py-1 rounded-full border border-dc-cyan/20">UPCOMING</span>
                </a>
                {% endif %}
            </div>

            <!-- GLOBAL STANDINGS -->
            <div class="reveal">
                <div class="glass rounded-2xl p-0 overflow-hidden border-t-4 border-t-dc-gold">
                    <div class="p-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-gradient-to-b from-white/5 to-transparent">
                        <div>
                            <h2 class="font-display text-2xl font-bold text-white flex items-center gap-2">
                                <i data-lucide="crown" class="w-6 h-6 text-dc-gold fill-dc-gold/30"></i>
                                {% if selected_game and selected_game_slug != 'all' %}{{ selected_game.display_name }} Rankings{% else %}Global Standings{% endif %}
                            </h2>
                            <p class="text-sm text-gray-400 mt-1">Top teams {% if selected_game and selected_game_slug != 'all' %}in {{ selected_game.display_name }}{% else %}across all titles{% endif %} based on Crown Points (CP).</p>
                        </div>
                        <div class="flex gap-3">
                            <a href="{% url 'competition:ranking_about' %}" class="text-xs font-bold text-gray-400 hover:text-white px-3 py-1.5 rounded-lg border border-white/10 hover:border-white/30 transition-colors">Ranking Policy</a>
                            <a href="{% url 'competition:rankings_global' %}" class="text-xs font-bold bg-dc-cyan/10 text-dc-cyan px-3 py-1.5 rounded-lg border border-dc-cyan/30 hover:bg-dc-cyan/20 transition-colors">View All</a>
                        </div>
                    </div>

                    <!-- Table Header -->
                    <div class="grid grid-cols-12 gap-4 px-6 py-3 bg-white/5 text-xs font-bold text-gray-500 uppercase tracking-wider">
                        <div class="col-span-1 text-center">#</div>
                        <div class="col-span-5">Team</div>
                        <div class="col-span-2 text-center hidden sm:block">Tier</div>
                        <div class="col-span-2 text-right">Points</div>
                        <div class="col-span-2 text-center">Trend</div>
                    </div>

                    <!-- Table Body -->
                    <div class="divide-y divide-white/5" id="rankings-list">
                        {% if rankings_preview %}
                        {% for entry in rankings_preview %}
                        <div class="rank-row grid grid-cols-12 gap-4 px-6 {% if forloop.counter <= 3 %}py-4{% else %}py-3{% endif %} items-center {% if forloop.counter == 1 %}bg-gradient-to-r from-dc-gold/10 to-transparent{% endif %} relative group cursor-pointer">
                            <!-- Rank Number -->
                            <div class="col-span-1 text-center font-display font-bold {% if forloop.counter == 1 %}text-xl text-dc-gold{% elif forloop.counter == 2 %}text-lg text-gray-300{% elif forloop.counter == 3 %}text-lg text-orange-400{% else %}text-gray-500{% endif %}">
                                {{ forloop.counter }}
                            </div>
                            <!-- Team Info -->
                            <div class="col-span-5 flex items-center gap-3 sm:gap-4">
                                {% if entry.team_logo_url %}
                                <img src="{{ entry.team_logo_url }}" class="{% if forloop.counter <= 3 %}w-10 h-10{% else %}w-8 h-8{% endif %} rounded-lg object-cover flex-shrink-0 border {% if forloop.counter == 1 %}border-dc-gold/50{% else %}border-white/10{% endif %}" alt="{{ entry.team_name }}" loading="lazy">
                                {% else %}
                                <div class="{% if forloop.counter <= 3 %}w-10 h-10{% else %}w-8 h-8{% endif %} rounded-lg bg-dc-dark border {% if forloop.counter == 1 %}border-dc-gold/50{% else %}border-white/10{% endif %} flex items-center justify-center overflow-hidden flex-shrink-0">
                                    {% if forloop.counter == 1 %}<div class="absolute inset-0 bg-dc-gold/20"></div>{% endif %}
                                    <span class="font-bold {% if forloop.counter == 1 %}text-dc-gold{% else %}text-gray-400{% endif %} relative z-10 text-xs">{{ entry.team_tag|default:entry.team_name|truncatechars:3 }}</span>
                                </div>
                                {% endif %}
                                <div class="min-w-0">
                                    <div class="flex items-center gap-2">
                                        <a href="{{ entry.team_url|default:'#' }}" class="{% if forloop.counter <= 3 %}text-sm{% else %}text-sm{% endif %} font-bold text-white group-hover:text-dc-cyan transition-colors truncate">{{ entry.team_name }}</a>
                                    </div>
                                    {% if entry.organization_name %}
                                    <p class="text-xs text-gray-500 truncate">{{ entry.organization_name }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            <!-- Tier (hidden on mobile) -->
                            <div class="col-span-2 text-center hidden sm:block">
                                <span class="text-[10px] px-2 py-0.5 rounded-full font-bold {% if entry.tier == 'CROWN' %}tier-crown{% elif entry.tier == 'ASCENDANT' %}tier-ascendant{% elif entry.tier == 'DIAMOND' %}tier-diamond{% elif entry.tier == 'PLATINUM' %}tier-platinum{% elif entry.tier == 'GOLD' %}tier-gold{% else %}tier-silver{% endif %}">{{ entry.tier|default:"UNRANKED" }}</span>
                            </div>
                            <!-- Points -->
                            <div class="col-span-2 text-right font-display font-bold {% if forloop.counter <= 3 %}text-white text-lg{% else %}text-gray-300{% endif %}">{{ entry.score|intcomma }}</div>
                            <!-- Trend -->
                            <div class="col-span-2 flex justify-center text-gray-500 text-xs">â€”</div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <!-- Empty State -->
                        <div class="text-center py-10">
                            <i data-lucide="bar-chart-3" class="w-7 h-7 text-gray-700 mx-auto mb-2"></i>
                            <p class="text-sm text-gray-500">Rankings will appear once teams start competing</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- SCOUTING GROUNDS -->
            <div class="reveal">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="font-display text-2xl font-bold text-white flex items-center gap-2 neon-line">
                        <span class="w-1.5 h-7 bg-dc-purple rounded-full"></span>Scouting Grounds
                    </h2>
                    <div class="flex gap-2">
                        <a href="/teams?filter=recruiting" class="text-sm bg-dc-purple/15 text-dc-purple px-3 py-1 rounded-lg border border-dc-purple/30 font-bold hover:bg-dc-purple/25 transition-colors">Find Team</a>
                    </div>
                </div>
                <div class="grid sm:grid-cols-2 gap-5" id="scouting-list">
                    {% if recruiting_teams %}
                    {% for team in recruiting_teams %}
                    <div class="group relative rounded-2xl overflow-hidden border border-white/[0.06] hover:border-dc-cyan/30 transition-all duration-300 hover:-translate-y-1">
                        <!-- Top gradient bar -->
                        <div class="h-1 w-full bg-gradient-to-r from-dc-cyan via-dc-purple to-dc-cyan"></div>
                        <div class="p-5 bg-gradient-to-b from-white/[0.04] to-transparent">
                            <div class="flex items-start gap-3.5 mb-3.5">
                                {% if team.logo %}
                                <img src="{{ team.logo.url }}" class="w-12 h-12 rounded-xl object-cover border border-white/10 flex-shrink-0 group-hover:border-dc-cyan/30 transition-colors" alt="{{ team.name }}" loading="lazy">
                                {% else %}
                                <div class="w-12 h-12 rounded-xl border border-white/10 bg-gradient-to-br from-dc-cyan/20 to-dc-purple/20 flex items-center justify-center text-sm font-bold text-white flex-shrink-0 group-hover:border-dc-cyan/30 transition-colors">{{ team.tag|default:team.name|truncatechars:2 }}</div>
                                {% endif %}
                                <div class="flex-1 min-w-0">
                                    <h4 class="font-bold text-white text-sm group-hover:text-dc-cyan transition-colors truncate">{{ team.name }}</h4>
                                    <p class="text-xs text-gray-500 mt-0.5">{{ team.get_game_display|default:"Unknown Game" }}</p>
                                </div>
                                <span class="text-[10px] font-bold bg-green-400/10 text-green-400 px-2 py-0.5 rounded-full border border-green-400/20 flex-shrink-0">OPEN</span>
                            </div>
                            <p class="text-sm text-gray-400 mb-4 line-clamp-2 leading-relaxed">{{ team.description|truncatewords:20|default:"Looking for skilled players to join the roster." }}</p>
                            <a href="{% url 'organizations:team_detail' team.slug %}" class="w-full py-2.5 bg-dc-cyan/10 hover:bg-dc-cyan/20 text-dc-cyan border border-dc-cyan/20 hover:border-dc-cyan/40 rounded-xl text-xs font-bold transition-all flex items-center justify-center gap-1.5">
                                <i data-lucide="user-plus" class="w-3.5 h-3.5"></i> View & Apply
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="col-span-2 text-center py-8">
                        <i data-lucide="radar" class="w-7 h-7 text-gray-500 mx-auto mb-2"></i>
                        <p class="text-sm text-gray-500">No teams actively recruiting right now</p>
                    </div>
                    {% endif %}
                </div>
                {% if recruiting_teams %}
                <div class="mt-3 text-center">
                    <a href="/teams?filter=recruiting" class="text-xs font-semibold text-gray-500 hover:text-dc-cyan transition-colors">Show more teams recruiting â†’</a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- RIGHT SIDEBAR (1/3) -->
        <div class="space-y-6">

            <!-- MY TEAMS WIDGET -->
            <div class="glass rounded-2xl p-6" id="my-teams-widget">
                <div class="flex items-center justify-between mb-5">
                    <h3 class="font-display font-bold text-white text-lg flex items-center gap-2">
                        <i data-lucide="users" class="w-5 h-5 text-dc-cyan"></i>My Teams
                    </h3>
                    {% if user.is_authenticated and user_teams %}
                    <a href="/dashboard/teams" class="text-sm text-gray-400 hover:text-dc-cyan transition-colors font-semibold">Manage</a>
                    {% endif %}
                </div>

                {% if user.is_authenticated %}
                    {% if user_teams %}

                    <!-- Primary Team Card -->
                    {% with primary=user_teams.0 %}
                    <a href="{% url 'organizations:team_detail' primary.team.slug %}" class="block mb-4 rounded-xl overflow-hidden border {% if user_profile_primary_team and primary.team.id == user_profile_primary_team.id %}border-dc-cyan/40{% else %}border-white/10{% endif %} bg-gradient-to-br from-white/[0.04] to-transparent hover:from-dc-cyan/10 hover:border-dc-cyan/50 transition-all group">
                        <div class="h-20 relative bg-gradient-to-r from-dc-cyan/20 via-dc-purple/15 to-dc-cyan/10">
                            {% if primary.team.banner %}
                            <img src="{{ primary.team.banner.url }}" class="w-full h-full object-cover opacity-60" alt="{{ primary.team.name }}" loading="lazy">
                            {% endif %}
                            {% if user_profile_primary_team and primary.team.id == user_profile_primary_team.id %}
                            <span class="absolute top-2 right-2 text-[10px] font-bold bg-dc-cyan/20 text-dc-cyan border border-dc-cyan/30 px-2 py-0.5 rounded-full">â˜… PRIMARY</span>
                            {% endif %}
                        </div>
                        <div class="p-3.5 flex items-center gap-3">
                            {% if primary.team.logo %}
                            <img src="{{ primary.team.logo.url }}" class="w-11 h-11 rounded-xl object-cover border border-white/10 -mt-8 relative z-10 bg-dc-dark flex-shrink-0" alt="{{ primary.team.name }}" loading="lazy">
                            {% else %}
                            <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-dc-cyan to-dc-purple flex items-center justify-center text-sm font-bold text-white -mt-8 relative z-10 border border-white/10 flex-shrink-0">{{ primary.team.tag|default:primary.team.name|truncatechars:2 }}</div>
                            {% endif %}
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-bold text-white truncate group-hover:text-dc-cyan transition-colors">{{ primary.team.name }}</p>
                                <p class="text-xs text-gray-400">{{ primary.team.get_game_display|default:"Unknown" }} Â· <span class="text-gray-500">{{ primary.role }}</span></p>
                            </div>
                            <i data-lucide="chevron-right" class="w-4 h-4 text-gray-500 group-hover:text-dc-cyan transition-colors flex-shrink-0"></i>
                        </div>
                    </a>
                    {% endwith %}

                    <!-- Other Teams Grid (logo + name) -->
                    {% if user_teams|length > 1 %}
                    <div class="grid grid-cols-2 gap-2" id="my-teams-grid">
                        {% for membership in user_teams %}
                        {% if not forloop.first %}
                        <a href="{% url 'organizations:team_detail' membership.team.slug %}" class="flex items-center gap-2.5 p-2.5 rounded-xl bg-white/[0.02] border border-white/5 hover:border-dc-cyan/30 hover:bg-dc-cyan/5 transition-all group">
                            {% if membership.team.logo %}
                            <img src="{{ membership.team.logo.url }}" class="w-8 h-8 rounded-lg object-cover flex-shrink-0 border border-white/10" alt="{{ membership.team.name }}" loading="lazy">
                            {% else %}
                            <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-dc-cyan to-dc-purple flex items-center justify-center text-[10px] font-bold text-white flex-shrink-0">{{ membership.team.tag|default:membership.team.name|truncatechars:2 }}</div>
                            {% endif %}
                            <div class="min-w-0">
                                <p class="text-xs font-bold text-white truncate group-hover:text-dc-cyan transition-colors">{{ membership.team.name }}</p>
                                <p class="text-[10px] text-gray-500">{{ membership.role }}</p>
                            </div>
                        </a>
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% else %}
                    <!-- New user â€” no teams yet (creative onboarding) -->
                    <div class="relative text-center py-6">
                        <div class="absolute inset-0 bg-gradient-to-b from-dc-cyan/5 via-transparent to-dc-purple/5 rounded-xl pointer-events-none"></div>
                        <div class="relative">
                            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-dc-cyan/20 to-dc-purple/20 border border-dc-cyan/20 flex items-center justify-center mx-auto mb-4 animate-pulse-glow">
                                <i data-lucide="shield" class="w-7 h-7 text-dc-cyan"></i>
                            </div>
                            <h4 class="font-display font-bold text-white text-base mb-1">Your Arena Awaits</h4>
                            <p class="text-sm text-gray-400 mb-1">No active rosters yet.</p>
                            <p class="text-xs text-gray-500 mb-5">Create a team, invite friends, and start competing in tournaments. Your stats and trophies are permanent.</p>
                            <a href="{% url 'organizations:team_create' %}" class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-dc-cyan to-cyan-400 text-dc-dark font-bold text-sm rounded-xl hover:shadow-[0_0_20px_rgba(6,182,212,0.4)] transition-all">
                                <i data-lucide="plus-circle" class="w-4 h-4"></i>Create Your First Team
                            </a>
                            <div class="flex items-center justify-center gap-4 mt-4 text-xs text-gray-500">
                                <span class="flex items-center gap-1"><i data-lucide="clock" class="w-3 h-3"></i>30 sec setup</span>
                                <span class="flex items-center gap-1"><i data-lucide="trophy" class="w-3 h-3"></i>Free to start</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% else %}
                <!-- Guest state â€” sign in prompt -->
                <div class="text-center py-5">
                    <i data-lucide="log-in" class="w-7 h-7 text-gray-500 mx-auto mb-2"></i>
                    <p class="text-sm text-gray-400 mb-3">Sign in to view your teams</p>
                    <a href="/accounts/login/" class="inline-block px-6 py-2.5 bg-gradient-to-r from-dc-cyan to-dc-purple text-white text-sm font-bold rounded-lg hover:shadow-lg hover:shadow-dc-cyan/30 transition-all">Sign In</a>
                </div>
                {% endif %}
            </div>

            <!-- OPEN CHALLENGES -->
            <div class="glass rounded-2xl p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-dc-purple/5 rounded-full blur-2xl -mr-10 -mt-10 pointer-events-none"></div>
                <div class="flex items-center justify-between mb-5">
                    <h3 class="font-display font-bold text-white text-lg flex items-center gap-2">
                        <i data-lucide="swords" class="w-5 h-5 text-dc-purple"></i>Open Challenges
                    </h3>
                    <a href="/competition/challenges/" class="text-sm text-gray-400 hover:text-white transition-colors font-semibold">Challenge Hub</a>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="text-xs bg-white/5 border border-white/10 text-gray-400 px-2.5 py-1 rounded-full font-semibold">Scrims</span>
                    <span class="text-xs bg-white/5 border border-white/10 text-gray-400 px-2.5 py-1 rounded-full font-semibold">Wagers</span>
                    <span class="text-xs bg-white/5 border border-white/10 text-gray-400 px-2.5 py-1 rounded-full font-semibold">Ranked</span>
                    <span class="text-xs bg-white/5 border border-white/10 text-gray-400 px-2.5 py-1 rounded-full font-semibold">Open</span>
                </div>
                <div class="space-y-2.5" id="challenges-list">
                    {% if open_challenges %}
                    {% for challenge in open_challenges %}
                    <div class="bg-dc-dark/60 rounded-xl border border-white/5 hover:border-white/15 transition-all cursor-pointer overflow-hidden">
                        <div class="flex items-center gap-3 p-3.5">
                            <div class="flex items-center gap-2.5 flex-1 min-w-0">
                                <div class="w-9 h-9 rounded-lg bg-dc-cyan flex items-center justify-center text-xs font-bold text-white flex-shrink-0">{{ challenge.challenger_team.tag|default:challenge.challenger_team.name|truncatechars:2 }}</div>
                                <span class="text-sm font-bold text-white truncate">{{ challenge.challenger_team.name }}</span>
                            </div>
                            <div class="flex flex-col items-center flex-shrink-0 px-1">
                                <span class="text-[10px] font-black text-gray-400">VS</span>
                            </div>
                            <div class="flex items-center gap-2.5 flex-1 min-w-0 justify-end">
                                <span class="text-sm font-bold text-gray-400 truncate">{{ challenge.challenged_team.name|default:"Open Slot" }}</span>
                                <div class="w-9 h-9 rounded-lg bg-gray-700 flex items-center justify-center text-xs font-bold text-white flex-shrink-0">{{ challenge.challenged_team.tag|default:"?" }}</div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between px-3.5 pb-3 gap-2">
                            <div class="flex items-center gap-2.5">
                                <span class="text-xs bg-dc-cyan/10 border border-dc-cyan/20 rounded px-2 py-0.5 text-dc-cyan font-bold uppercase">{{ challenge.challenge_type }}</span>
                                <span class="text-xs text-gray-400">BO{{ challenge.best_of }}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                {% if challenge.prize_amount %}
                                <span class="text-xs font-bold text-dc-gold">à§³{{ challenge.prize_amount|intcomma }}</span>
                                {% endif %}
                                <a href="/challenges/{{ challenge.id }}/" class="text-xs font-bold text-dc-cyan bg-dc-cyan/10 border border-dc-cyan/25 px-2 py-0.5 rounded">VIEW</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="text-center py-6">
                        <i data-lucide="swords" class="w-6 h-6 text-gray-700 mx-auto mb-2"></i>
                        <p class="text-xs text-gray-500">No open challenges right now</p>
                        <p class="text-xs text-gray-500 mt-0.5">Be the first to issue one!</p>
                    </div>
                    {% endif %}
                </div>
                {% if user.is_authenticated and user_teams %}
                <a href="{% url 'organizations:team_detail' user_teams.0.team.slug %}manage/#training" class="w-full mt-3 py-2.5 border border-dashed border-gray-700 text-gray-400 rounded-xl text-xs font-bold hover:border-dc-cyan hover:text-dc-cyan transition-all flex items-center justify-center gap-1.5">
                    <i data-lucide="plus" class="w-3.5 h-3.5"></i> Issue New Challenge
                </a>
                {% elif user.is_authenticated %}
                <div class="mt-3 bg-amber-500/10 border border-amber-500/20 rounded-lg px-3 py-2">
                    <p class="text-xs text-amber-400 font-semibold flex items-center gap-1.5">
                        <i data-lucide="info" class="w-3 h-3"></i>You need a team to issue challenges
                    </p>
                    <a href="{% url 'organizations:team_create' %}" class="text-xs text-dc-cyan hover:underline mt-0.5 inline-block">Create a team â†’</a>
                </div>
                {% endif %}
            </div>

            <!-- TOP ORGANIZATIONS -->
            <div class="glass rounded-2xl p-6">
                <div class="flex items-center justify-between mb-5">
                    <h3 class="font-display font-bold text-white text-lg flex items-center gap-2">
                        <i data-lucide="building-2" class="w-5 h-5 text-dc-purple"></i>Organizations
                    </h3>
                    <a href="{% url 'organizations:org_directory' %}" class="text-sm text-dc-cyan font-semibold hover:underline flex items-center gap-1">View All <i data-lucide="arrow-right" class="w-3 h-3"></i></a>
                </div>

                {% if user_organization %}
                <!-- My Organization -->
                <div class="mb-4 rounded-xl overflow-hidden border border-dc-purple/30 bg-gradient-to-br from-dc-purple/10 to-transparent">
                    <div class="p-4 flex items-center gap-3">
                        {% if user_organization.logo %}
                        <img src="{{ user_organization.logo.url }}" class="w-12 h-12 rounded-xl object-cover border border-white/10 flex-shrink-0" alt="{{ user_organization.name }}" loading="lazy">
                        {% else %}
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-dc-purple to-violet-600 flex items-center justify-center text-sm font-bold text-white flex-shrink-0">{{ user_organization.name|truncatechars:2 }}</div>
                        {% endif %}
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2">
                                <p class="text-sm font-bold text-white truncate">{{ user_organization.name }}</p>
                                {% if user_organization.is_verified %}<span class="text-green-400 text-xs">âœ“</span>{% endif %}
                            </div>
                            <p class="text-xs text-gray-400">{{ user_org_role }} {% if user_organization.ranking %}Â· {{ user_organization.ranking.empire_score }} Empire Score{% endif %}</p>
                        </div>
                    </div>
                    <div class="px-4 pb-3 flex gap-2">
                        <a href="{% url 'organizations:organization_detail' user_organization.slug %}" class="flex-1 py-2 text-center text-xs font-bold bg-dc-purple/15 text-dc-purple border border-dc-purple/25 rounded-lg hover:bg-dc-purple/25 transition-colors">View Org</a>
                        {% if user_org_role == 'CEO' or user_org_role == 'MANAGER' %}
                        <a href="{% url 'organizations:org_control_plane' user_organization.slug %}" class="flex-1 py-2 text-center text-xs font-bold bg-white/5 text-gray-300 border border-white/10 rounded-lg hover:bg-white/10 transition-colors">Manage</a>
                        {% endif %}
                    </div>
                </div>
                <div class="border-t border-white/5 pt-4 mb-1">
                    <p class="text-xs text-gray-500 uppercase tracking-wider font-bold mb-3">Top Organizations</p>
                </div>
                {% endif %}

                <div class="space-y-2.5" id="orgs-list">
                    {% if top_organizations %}
                    {% for org in top_organizations %}
                    <a href="{% url 'organizations:organization_detail' org.slug %}" class="flex items-center justify-between p-2.5 bg-white/[0.02] rounded-lg border border-white/5 hover:border-white/10 transition-colors group">
                        <div class="flex items-center gap-2.5">
                            {% if org.logo %}
                            <img src="{{ org.logo.url }}" class="w-8 h-8 rounded object-cover" alt="{{ org.name }}" loading="lazy">
                            {% else %}
                            <div class="w-8 h-8 rounded bg-dc-purple text-xs font-bold flex items-center justify-center text-white">{{ org.name|truncatechars:2 }}</div>
                            {% endif %}
                            <span class="text-sm text-gray-300 font-medium group-hover:text-white transition-colors">{{ org.name }}</span>
                            {% if org.is_verified %}<span class="text-green-400 text-xs">âœ“</span>{% endif %}
                        </div>
                        {% if org.ranking %}
                        <span class="text-xs text-dc-cyan font-bold">{{ org.ranking.empire_score }} ES</span>
                        {% endif %}
                    </a>
                    {% endfor %}
                    {% else %}
                    <div class="text-center py-4">
                        <i data-lucide="building-2" class="w-5 h-5 text-gray-700 mx-auto mb-2"></i>
                        <p class="text-xs text-gray-500">No organizations yet</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- MATCH FINDER -->
            <div class="glass rounded-2xl overflow-hidden" id="quick-scrim-widget">
                <div class="h-1 w-full bg-gradient-to-r from-dc-cyan via-dc-purple to-dc-cyan"></div>
                <div class="p-6">
                    <div class="flex items-center justify-between mb-5">
                        <h3 class="font-display font-bold text-white text-lg flex items-center gap-2">
                            <i data-lucide="crosshair" class="w-5 h-5 text-dc-cyan"></i>Match Finder
                        </h3>
                        <span id="match-finder-game-label" class="text-xs text-dc-cyan font-semibold bg-dc-cyan/10 border border-dc-cyan/20 px-2.5 py-1 rounded-full">
                            {% if selected_game and selected_game_slug != 'all' %}{{ selected_game.display_name }}{% else %}All Games{% endif %}
                        </span>
                    </div>

                    <!-- Match Type Selector -->
                    <div class="flex gap-2 mb-5" id="scrim-type-tabs">
                        <button class="scrim-tab active flex-1 py-2.5 px-3 rounded-lg text-xs font-bold text-center transition-all bg-dc-cyan/15 border border-dc-cyan/30 text-dc-cyan" data-type="RANKED">
                            <i data-lucide="trophy" class="w-3.5 h-3.5 inline mr-1"></i>Ranked
                        </button>
                        <button class="scrim-tab flex-1 py-2.5 px-3 rounded-lg text-xs font-bold text-center transition-all bg-white/5 border border-white/10 text-gray-400 hover:text-white" data-type="SCRIM">
                            <i data-lucide="swords" class="w-3.5 h-3.5 inline mr-1"></i>Scrim
                        </button>
                        <button class="scrim-tab flex-1 py-2.5 px-3 rounded-lg text-xs font-bold text-center transition-all bg-white/5 border border-white/10 text-gray-400 hover:text-white" data-type="OPEN">
                            <i data-lucide="handshake" class="w-3.5 h-3.5 inline mr-1"></i>Casual
                        </button>
                    </div>

                    <!-- Game Dropdown (syncs with Combat Zone) -->
                    <label class="text-xs text-gray-400 font-bold uppercase tracking-wider mb-1.5 block">Game</label>
                    <select id="scrim-game-select" class="w-full bg-dc-dark border border-white/10 text-white text-sm font-semibold rounded-xl px-4 py-3 outline-none mb-4 hover:border-white/20 focus:border-dc-cyan/50 transition-colors appearance-none cursor-pointer" style="background-image: url('data:image/svg+xml,{% autoescape off %}<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;12&quot; height=&quot;12&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%236b7280&quot; stroke-width=&quot;2&quot;><polyline points=&quot;6 9 12 15 18 9&quot;></polyline></svg>{% endautoescape %}'); background-repeat: no-repeat; background-position: right 12px center; padding-right: 36px;">
                        {% for game in available_games %}
                        <option value="{{ game.slug }}" data-category="{{ game.category }}" data-type="{{ game.game_type }}" {% if selected_game and selected_game.slug == game.slug %}selected{% elif forloop.first and not selected_game %}selected{% endif %}>{{ game.display_name }}</option>
                        {% endfor %}
                    </select>

                    <!-- Format & Region -->
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div>
                            <label class="text-xs text-gray-400 font-bold uppercase tracking-wider mb-1.5 block">Format</label>
                            <select id="scrim-format" class="w-full bg-dc-dark border border-white/10 text-white text-sm font-semibold rounded-xl px-4 py-3 outline-none hover:border-white/20 focus:border-dc-cyan/50 transition-colors">
                                <option value="5v5">5v5</option>
                                <option value="4v4">4v4</option>
                                <option value="3v3">3v3</option>
                                <option value="2v2">2v2</option>
                                <option value="1v1">1v1</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 font-bold uppercase tracking-wider mb-1.5 block">Best Of</label>
                            <select id="scrim-bestof" class="w-full bg-dc-dark border border-white/10 text-white text-sm font-semibold rounded-xl px-4 py-3 outline-none hover:border-white/20 focus:border-dc-cyan/50 transition-colors">
                                <option value="1">BO1</option>
                                <option value="3">BO3</option>
                                <option value="5">BO5</option>
                            </select>
                        </div>
                    </div>

                    <!-- Role-Based States -->
                    {% if user.is_authenticated and not user_teams %}
                    <div class="bg-amber-500/10 border border-amber-500/20 rounded-xl px-4 py-3 mb-4">
                        <p class="text-xs text-amber-400 font-semibold flex items-center gap-1.5">
                            <i data-lucide="alert-triangle" class="w-3.5 h-3.5"></i>You must be in a team to queue
                        </p>
                        <a href="{% url 'organizations:team_create' %}" class="text-xs text-dc-cyan hover:underline mt-1 inline-block">Create or join a team â†’</a>
                    </div>
                    {% elif not user.is_authenticated %}
                    <div class="bg-white/5 border border-white/10 rounded-xl px-4 py-3 mb-4">
                        <p class="text-xs text-gray-400 font-semibold flex items-center gap-1.5">
                            <i data-lucide="log-in" class="w-3.5 h-3.5"></i>Sign in to find matches
                        </p>
                    </div>
                    {% endif %}

                    {% if user.is_authenticated and user_teams %}
                    <button id="scrim-find-btn" class="w-full py-3.5 bg-gradient-to-r from-dc-cyan to-cyan-400 text-dc-dark font-display font-bold text-sm rounded-xl hover:shadow-[0_0_25px_rgba(6,182,212,0.4)] transition-all flex items-center justify-center gap-2">
                        <i data-lucide="zap" class="w-4 h-4"></i> Find Match
                    </button>
                    {% elif user.is_authenticated %}
                    <a href="{% url 'organizations:team_create' %}" class="block w-full py-3.5 bg-gradient-to-r from-dc-cyan/50 to-cyan-400/50 text-dc-dark font-display font-bold text-sm rounded-xl transition-all text-center flex items-center justify-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i> Create Team First
                    </a>
                    {% else %}
                    <a href="/accounts/login/" class="block w-full py-3.5 bg-gradient-to-r from-dc-cyan/50 to-cyan-400/50 text-dc-dark font-display font-bold text-sm rounded-xl transition-all text-center flex items-center justify-center gap-2">
                        <i data-lucide="log-in" class="w-4 h-4"></i> Sign In to Play
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========== GRASSROOTS TO GLORY ========== -->
<section class="border-t border-white/10 bg-dc-surface py-10">
    <div class="w-full max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-10">
        <div class="text-center mb-8">
            <h2 class="font-display text-2xl sm:text-3xl font-black text-white mb-2">The Path to <span class="grad-text">Pro</span></h2>
            <p class="text-gray-300 text-sm">Reach Diamond to unlock Direct Invites (à§³0 Entry Fees). Your stats and trophies are permanent.</p>
        </div>
        <div class="relative flex flex-col md:flex-row justify-between items-center max-w-4xl mx-auto gap-6 md:gap-0">
            <div class="hidden md:block absolute top-1/2 left-0 w-full h-0.5 bg-gradient-to-r from-gray-800 via-dc-cyan to-dc-gold -z-0 -translate-y-1/2"></div>
            <div class="flex flex-col items-center bg-dc-surface p-3 z-10 relative">
                <div class="w-14 h-14 rounded-full bg-gray-800 border-2 border-gray-600 flex items-center justify-center text-xl mb-2">ðŸ</div>
                <h3 class="font-bold text-white text-sm">Create</h3>
                <p class="text-xs text-gray-400">Unranked</p>
            </div>
            <div class="flex flex-col items-center bg-dc-surface p-3 z-10 relative">
                <div class="w-14 h-14 rounded-full bg-dc-cyan/15 border-2 border-dc-cyan flex items-center justify-center text-xl mb-2 shadow-[0_0_12px_rgba(6,182,212,0.3)]">âš”ï¸</div>
                <h3 class="font-bold text-white text-sm">Compete</h3>
                <p class="text-xs text-gray-400">Earn CP</p>
            </div>
            <div class="flex flex-col items-center bg-dc-surface p-3 z-10 relative">
                <div class="w-14 h-14 rounded-full bg-dc-purple/15 border-2 border-dc-purple flex items-center justify-center text-xl mb-2 shadow-[0_0_12px_rgba(139,92,246,0.3)]">ðŸ’Ž</div>
                <h3 class="font-bold text-white text-sm">Diamond</h3>
                <p class="text-xs text-gray-400">Direct Invites</p>
            </div>
            <div class="flex flex-col items-center bg-dc-surface p-3 z-10 relative">
                <div class="w-14 h-14 rounded-full bg-dc-gold/15 border-2 border-dc-gold flex items-center justify-center text-xl mb-2 shadow-[0_0_15px_rgba(250,204,21,0.4)] animate-pulse-glow">ðŸ‘‘</div>
                <h3 class="font-bold text-dc-gold text-sm">Crown</h3>
                <p class="text-xs text-gray-400">Sponsorships</p>
            </div>
        </div>
        <div class="text-center mt-6">
            <a href="/ranking-policy" class="text-sm text-dc-cyan hover:underline">View DCRS Ranking Rules â†’</a>
        </div>
    </div>
</section>

<!-- ========== CINEMATIC CTA ========== -->
<section class="relative py-16 overflow-hidden">
    <div class="absolute inset-0 opacity-15">
        <div class="absolute top-0 left-1/4 w-[500px] h-[500px] bg-dc-cyan rounded-full blur-[150px]"></div>
        <div class="absolute bottom-0 right-1/4 w-[500px] h-[500px] bg-dc-purple rounded-full blur-[150px]"></div>
    </div>
    <div class="relative z-10 w-full max-w-3xl mx-auto px-4 sm:px-6 lg:px-10 text-center">
        <h2 class="font-display text-3xl sm:text-4xl font-black text-white mb-4">Don't Just Watch.<br><span class="grad-text">Compete.</span></h2>
        <p class="text-gray-200 text-sm sm:text-base mb-3 max-w-xl mx-auto leading-relaxed">Every champion started with a roster of one. Create your team, compete in tournaments, climb the DCRS Rankings, and build a legacy that lasts. Your stats, trophies, and match history are permanent â€” this isn't casual, this is your career.</p>
        <p class="text-gray-400 text-sm mb-6">Independent teams can be scouted and acquired by Organizations â€” turning your passion into a profession.</p>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
            {% if user.is_authenticated %}
            <a href="{% url 'organizations:team_create' %}" class="group px-8 py-4 bg-gradient-to-r from-dc-cyan to-cyan-400 text-dc-dark font-display font-bold rounded-xl hover:shadow-2xl hover:shadow-dc-cyan/40 transition-all hover:scale-[1.03] flex items-center gap-2 text-sm">
                <i data-lucide="rocket" class="w-4 h-4"></i>Start Your Legacy
                <i data-lucide="arrow-right" class="w-4 h-4 group-hover:translate-x-1 transition-transform"></i>
            </a>
            {% else %}
            <a href="/accounts/signup/" class="group px-8 py-4 bg-gradient-to-r from-dc-cyan to-cyan-400 text-dc-dark font-display font-bold rounded-xl hover:shadow-2xl hover:shadow-dc-cyan/40 transition-all hover:scale-[1.03] flex items-center gap-2 text-sm">
                <i data-lucide="rocket" class="w-4 h-4"></i>Start Your Legacy
                <i data-lucide="arrow-right" class="w-4 h-4 group-hover:translate-x-1 transition-transform"></i>
            </a>
            {% endif %}
            <a href="/team-guide" class="px-8 py-3.5 bg-white/5 border border-white/10 text-gray-300 font-semibold rounded-xl hover:bg-white/10 transition-all text-sm">Read the Team Guide</a>
        </div>
    </div>
</section>

<!-- ========== PLATFORM RULES STRIP ========== -->
<section class="border-t border-white/10 bg-dc-surface py-8">
    <div class="w-full max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-10">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="glass p-4 rounded-xl text-center" style="transform:none!important">
                <i data-lucide="shield-check" class="w-5 h-5 text-green-400 mx-auto mb-2"></i>
                <p class="text-sm font-bold text-white mb-0.5">Admin Verified</p>
                <p class="text-sm text-gray-400">All results confirmed</p>
            </div>
            <div class="glass p-4 rounded-xl text-center" style="transform:none!important">
                <i data-lucide="lock" class="w-5 h-5 text-dc-cyan mx-auto mb-2"></i>
                <p class="text-sm font-bold text-white mb-0.5">Roster Locks</p>
                <p class="text-sm text-gray-400">No mid-tourney swaps</p>
            </div>
            <div class="glass p-4 rounded-xl text-center" style="transform:none!important">
                <i data-lucide="users" class="w-5 h-5 text-dc-purple mx-auto mb-2"></i>
                <p class="text-sm font-bold text-white mb-0.5">One Team Rule</p>
                <p class="text-sm text-gray-400">1 roster per game</p>
            </div>
            <div class="glass p-4 rounded-xl text-center" style="transform:none!important">
                <i data-lucide="headphones" class="w-5 h-5 text-dc-gold mx-auto mb-2"></i>
                <p class="text-sm font-bold text-white mb-0.5">Instant Support</p>
                <p class="text-sm text-gray-400">24/7 admin response</p>
            </div>
        </div>
    </div>
</section>

<!-- ========== FOOTER ========== -->
<footer class="bg-dc-dark border-t border-white/[0.06] pt-12 pb-6">
    <div class="w-full max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-10">
        <!-- Top: Brand + Links -->
        <div class="grid grid-cols-1 md:grid-cols-[1.3fr_1fr_1fr_1fr] gap-10 mb-10">
            <!-- Brand Column -->
            <div>
                <div class="flex items-center gap-3 mb-4">
                    <img src="{% static 'img/deltaCrown_logos/logo_animated.svg' %}" alt="DeltaCrown" class="h-10 w-10 drop-shadow-lg">
                    <img src="{% static 'siteui/svg/Logos/DeltaCrown_Teal-Purple-Gold.svg' %}" alt="DeltaCrown" class="h-7 w-auto">
                </div>
                <p class="text-sm text-gray-400 leading-relaxed mb-5 max-w-xs">Bangladesh's premier competitive esports platform. Build teams, prove dominance, claim the Crown.</p>
                <!-- Social Icons -->
                <div class="flex items-center gap-3">
                    <a href="https://discord.gg/deltacrown" target="_blank" rel="noopener" class="w-9 h-9 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center text-gray-400 hover:text-[#5865F2] hover:bg-[#5865F2]/10 hover:border-[#5865F2]/30 transition-all" title="Discord">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 00-4.885-1.515.074.074 0 00-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 00-5.487 0 12.64 12.64 0 00-.617-1.25.077.077 0 00-.079-.037A19.736 19.736 0 003.677 4.37a.07.07 0 00-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 00.031.057 19.9 19.9 0 005.993 3.03.078.078 0 00.084-.028 14.09 14.09 0 001.226-1.994.076.076 0 00-.041-.106 13.107 13.107 0 01-1.872-.892.077.077 0 01-.008-.128c.126-.094.252-.192.372-.292a.074.074 0 01.077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 01.078.009c.12.1.246.198.373.292a.077.077 0 01-.006.127 12.299 12.299 0 01-1.873.892.077.077 0 00-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 00.084.028 19.839 19.839 0 006.002-3.03.077.077 0 00.032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 00-.031-.03z"/></svg>
                    </a>
                    <a href="https://facebook.com/deltacrown" target="_blank" rel="noopener" class="w-9 h-9 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center text-gray-400 hover:text-[#1877F2] hover:bg-[#1877F2]/10 hover:border-[#1877F2]/30 transition-all" title="Facebook">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                    </a>
                    <a href="https://youtube.com/@deltacrown" target="_blank" rel="noopener" class="w-9 h-9 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center text-gray-400 hover:text-[#FF0000] hover:bg-[#FF0000]/10 hover:border-[#FF0000]/30 transition-all" title="YouTube">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 00-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 00.502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 002.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 002.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                    </a>
                    <a href="https://instagram.com/deltacrown" target="_blank" rel="noopener" class="w-9 h-9 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center text-gray-400 hover:text-[#E4405F] hover:bg-[#E4405F]/10 hover:border-[#E4405F]/30 transition-all" title="Instagram">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
                    </a>
                </div>
            </div>

            <!-- Platform Column -->
            <div>
                <h4 class="font-bold text-white text-xs mb-4 uppercase tracking-widest">Hub</h4>
                <ul class="space-y-2.5 text-sm text-gray-400">
                    <li><a href="/competition/rankings/" class="hover:text-dc-cyan transition-colors flex items-center gap-1.5"><i data-lucide="bar-chart-3" class="w-3.5 h-3.5 text-gray-600"></i>Rankings</a></li>
                    <li><a href="/orgs/" class="hover:text-dc-cyan transition-colors flex items-center gap-1.5"><i data-lucide="building-2" class="w-3.5 h-3.5 text-gray-600"></i>Organizations</a></li>
                    <li><a href="/teams/" class="hover:text-dc-cyan transition-colors flex items-center gap-1.5"><i data-lucide="users" class="w-3.5 h-3.5 text-gray-600"></i>Team Directory</a></li>
                    <li><a href="/tournaments/" class="hover:text-dc-cyan transition-colors flex items-center gap-1.5"><i data-lucide="trophy" class="w-3.5 h-3.5 text-gray-600"></i>Tournaments</a></li>
                    <li><a href="/about/" class="hover:text-dc-cyan transition-colors flex items-center gap-1.5"><i data-lucide="info" class="w-3.5 h-3.5 text-gray-600"></i>About DeltaCrown</a></li>
                </ul>
            </div>

            <!-- Help & Support Column -->
            <div>
                <h4 class="font-bold text-white text-xs mb-4 uppercase tracking-widest">Support</h4>
                <ul class="space-y-2.5 text-sm text-gray-400">
                    <li><a href="/faq/" class="hover:text-dc-cyan transition-colors">FAQ</a></li>
                    <li><a href="/contact/" class="hover:text-dc-cyan transition-colors">Contact Us</a></li>
                    <li><a href="/rules/" class="hover:text-dc-cyan transition-colors">Platform Rules</a></li>
                    <li><a href="/moderation/" class="hover:text-dc-cyan transition-colors">Moderation Policy</a></li>
                    <li><a href="/about/" class="hover:text-dc-cyan transition-colors">About DeltaCrown</a></li>
                </ul>
            </div>

            <!-- Legal Column -->
            <div>
                <h4 class="font-bold text-white text-xs mb-4 uppercase tracking-widest">Legal</h4>
                <ul class="space-y-2.5 text-sm text-gray-400">
                    <li><a href="/terms/" class="hover:text-dc-cyan transition-colors">Terms of Service</a></li>
                    <li><a href="/privacy/" class="hover:text-dc-cyan transition-colors">Privacy Policy</a></li>
                    <li><a href="/cookies/" class="hover:text-dc-cyan transition-colors">Cookie Policy</a></li>
                </ul>
            </div>
        </div>

        <!-- Bottom bar -->
        <div class="border-t border-white/[0.06] pt-5">
            <div class="flex flex-col sm:flex-row justify-between items-center gap-3">
                <p class="text-xs text-gray-600">&copy; {% now "Y" %} DeltaCrown. All rights reserved.</p>
                <p class="text-xs text-gray-600">From the Delta to the Crown ðŸ‘‘</p>
            </div>
        </div>
    </div>
</footer>

<!-- ========== BACK TO TOP ========== -->
<button class="back-to-top" id="back-to-top" onclick="window.scrollTo({top:0,behavior:'smooth'})">
    <i data-lucide="chevron-up" class="w-4 h-4 text-gray-400"></i>
</button>
{% endblock %}

{% block footer %}{% endblock %}

{% block extra_js %}
<script>
// === INIT ===
lucide.createIcons();

// === PARTICLE SYSTEM ===
(function initParticles() {
    const canvas = document.getElementById('hero-particles');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    let particles = [], w, h, mouse = { x: null, y: null };
    function resize() { const r = canvas.parentElement.getBoundingClientRect(); w = canvas.width = r.width; h = canvas.height = r.height }
    resize(); window.addEventListener('resize', resize);
    canvas.parentElement.addEventListener('mousemove', e => { const r = canvas.parentElement.getBoundingClientRect(); mouse.x = e.clientX - r.left; mouse.y = e.clientY - r.top });
    canvas.parentElement.addEventListener('mouseleave', () => { mouse.x = null; mouse.y = null });
    for (let i = 0; i < 40; i++) particles.push({ x: Math.random() * w, y: Math.random() * h, vx: (Math.random() - .5) * .3, vy: (Math.random() - .5) * .3, r: Math.random() * 1.5 + .5, o: Math.random() * .4 + .1 });
    function draw() {
        ctx.clearRect(0, 0, w, h);
        particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy;
            if (p.x < 0 || p.x > w) p.vx *= -1;
            if (p.y < 0 || p.y > h) p.vy *= -1;
            if (mouse.x !== null) { const dx = mouse.x - p.x, dy = mouse.y - p.y, d = Math.sqrt(dx * dx + dy * dy); if (d < 150) { p.vx += dx * .0003; p.vy += dy * .0003 } }
            ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(6,182,212,${p.o})`; ctx.fill();
            for (let j = i + 1; j < particles.length; j++) {
                const dx = p.x - particles[j].x, dy = p.y - particles[j].y, d = Math.sqrt(dx * dx + dy * dy);
                if (d < 100) { ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(particles[j].x, particles[j].y); ctx.strokeStyle = `rgba(6,182,212,${.06 * (1 - d / 100)})`; ctx.stroke() }
            }
        });
        requestAnimationFrame(draw);
    }
    draw();
})();

// === TYPING EFFECT ===
(function typeHero() {
    const el = document.getElementById('hero-typed');
    if (!el) return;
    const lines = ['YOUR TEAM.', 'YOUR KINGDOM.'];
    let lineIdx = 0, charIdx = 0;
    function type() {
        const current = lines[lineIdx];
        const typed = current.substring(0, charIdx + 1);
        el.innerHTML = lineIdx === 0 ? typed : `YOUR TEAM.<br>${typed.includes('KINGDOM') ? typed.replace('KINGDOM', '<span class="grad-text">KINGDOM</span>') : typed}`;
        el.classList.add('type-cursor');
        charIdx++;
        if (charIdx === current.length) {
            if (lineIdx === lines.length - 1) { el.classList.remove('type-cursor'); return; }
            setTimeout(() => { lineIdx++; charIdx = 0; type() }, 400);
            return;
        }
        setTimeout(type, 60 + Math.random() * 40);
    }
    setTimeout(type, 600);
})();

// === COUNTER ANIMATION ===
function animateCounters() {
    document.querySelectorAll('.counter').forEach(el => {
        if (el.dataset.animated) return;
        const target = parseFloat(el.dataset.target);
        if (isNaN(target) || target === 0) return;
        const isDecimal = el.dataset.decimal === 'true';
        const duration = 1500;
        const start = performance.now();
        el.dataset.animated = 'true';
        function update(now) {
            const p = Math.min((now - start) / duration, 1);
            const eased = 1 - Math.pow(1 - p, 3);
            const val = eased * target;
            el.textContent = isDecimal ? val.toFixed(1) : Math.floor(val);
            if (p < 1) requestAnimationFrame(update);
        }
        requestAnimationFrame(update);
    });
}

// === LIVE TICKER (API-Driven) ===
async function loadTicker() {
    try {
        const res = await fetch('/api/vnext/system/ticker/');
        if (!res.ok) return;
        const json = await res.json();
        if (!json.ok || !json.data || !json.data.items || json.data.items.length === 0) return;

        const ticker = document.getElementById('live-ticker');
        if (!ticker) return;

        const items = json.data.items;
        const colors = { rank_change: 'dc-gold', team_created: 'green-400', member_joined: 'dc-purple', match_result: 'dc-cyan' };
        const html = items.map(i => {
            const c = colors[i.type] || 'gray-400';
            return `<span class="text-xs text-gray-500 flex items-center gap-2"><span class="w-1.5 h-1.5 rounded-full bg-${c}"></span><span class="text-${c} font-semibold">${i.title}</span>${i.subtitle || ''}</span>`;
        }).join('');
        // Duplicate for seamless loop
        ticker.innerHTML = html + html;
    } catch (e) {
        console.warn('[Hub] Ticker load failed:', e);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    lucide.createIcons();

    // Load ticker
    loadTicker();

    // === SCROLL REVEAL SYSTEM ===
    const revealObserver = new IntersectionObserver(entries => {
        entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('visible'); revealObserver.unobserve(e.target) } });
    }, { threshold: 0.08, rootMargin: '0px 0px -40px 0px' });
    document.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));

    // Glass scroll animation
    const io = new IntersectionObserver(es => es.forEach(e => { if (e.isIntersecting) { e.target.style.opacity = '1'; e.target.style.transform = 'translateY(0)' } }), { threshold: 0.08 });
    document.querySelectorAll('.glass:not(.reveal)').forEach(el => {
        if (el.closest('header') || el.closest('nav') || el.closest('#search-modal') || el.closest('.reveal')) return;
        if (el.style.transform === 'none') return; // Skip elements that opt out
        el.style.opacity = '0'; el.style.transform = 'translateY(12px)'; el.style.transition = 'all 0.5s cubic-bezier(.22,1,.36,1)'; io.observe(el);
    });

    // Counter animation on scroll
    const counterObserver = new IntersectionObserver(entries => {
        entries.forEach(e => { if (e.isIntersecting) { animateCounters(); counterObserver.unobserve(e.target) } });
    }, { threshold: 0.3 });
    const statsEl = document.getElementById('hero-stats');
    if (statsEl) counterObserver.observe(statsEl);

    // Progress bar animation
    const progressObserver = new IntersectionObserver(entries => {
        entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('animate'); progressObserver.unobserve(e.target) } });
    }, { threshold: 0.5 });
    document.querySelectorAll('.progress-fill').forEach(el => progressObserver.observe(el));

    // Back-to-top
    const btt = document.getElementById('back-to-top');
    window.addEventListener('scroll', () => {
        const y = window.scrollY;
        if (btt) btt.classList.toggle('visible', y > 800);
    });

    // Match Finder tab switching
    document.querySelectorAll('.scrim-tab').forEach(tab => {
        tab.onclick = function() {
            document.querySelectorAll('.scrim-tab').forEach(t => {
                t.className = 'scrim-tab flex-1 py-2 px-2 rounded-lg text-xs font-bold text-center transition-all bg-white/5 border border-white/10 text-gray-400 hover:text-white';
            });
            this.className = 'scrim-tab active flex-1 py-2 px-2 rounded-lg text-xs font-bold text-center transition-all bg-dc-cyan/15 border border-dc-cyan/30 text-dc-cyan';
        };
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', e => {
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') { e.preventDefault(); openSearch() }
        if (e.key === 'Escape') closeSearch();
    });

    // Search filter tabs
    document.querySelectorAll('.search-filter').forEach(b => b.onclick = function () {
        document.querySelectorAll('.search-filter').forEach(x => { x.className = 'search-filter text-xs px-3 py-1 rounded-full font-semibold border transition-all bg-white/5 border-white/10 text-gray-400 hover:text-white' });
        this.className = 'search-filter active text-xs px-3 py-1 rounded-full font-semibold border transition-all bg-dc-cyan/15 border-dc-cyan/30 text-dc-cyan';
    });
});

// === GAME CONFIG DATA (from backend) ===
const GAME_CONFIGS = {{ game_configs_json|safe }};

// Helper: generate format options based on game's max team size
function getFormatOptions(slug) {
    const cfg = GAME_CONFIGS[slug];
    if (!cfg) return [{v:'5v5',l:'5v5'},{v:'3v3',l:'3v3'},{v:'1v1',l:'1v1'}];
    const max = cfg.max_team_size;
    const opts = [];
    // For team games: show sizes from max down to 1v1
    for (let s = max; s >= 1; s--) {
        // Skip odd intermediate sizes that aren't standard
        if (s > 2 && s < max && s % 2 !== 0 && s !== 3) continue;
        opts.push({ v: `${s}v${s}`, l: `${s}v${s}` });
    }
    return opts.length ? opts : [{v:'5v5',l:'5v5'}];
}

// Sync Match Finder widget when Combat Zone game changes
function syncMatchFinder(slug) {
    const cfg = GAME_CONFIGS[slug];

    // Update game dropdown
    const gameSelect = document.getElementById('scrim-game-select');
    if (gameSelect) {
        for (let opt of gameSelect.options) {
            opt.selected = (opt.value === slug);
        }
    }

    // Update game label badge
    const label = document.getElementById('match-finder-game-label');
    if (label) label.textContent = cfg ? cfg.name : 'All Games';

    // Update format options based on roster config
    const formatSelect = document.getElementById('scrim-format');
    if (formatSelect) {
        const opts = getFormatOptions(slug);
        formatSelect.innerHTML = opts.map(o => `<option value="${o.v}">${o.l}</option>`).join('');
    }
}

// Also sync when user manually changes the Match Finder game dropdown
document.getElementById('scrim-game-select')?.addEventListener('change', function() {
    syncMatchFinder(this.value);
    // Trigger full Combat Zone sync
    const card = document.querySelector(`.game-card[data-game="${this.value}"]`);
    if (card) selectGame(this.value, card);
});

// === GAME FILTER (AJAX â€” no page reload) ===
let _filterAbort = null;
function selectGame(slug, el) {
    document.querySelectorAll('.game-card').forEach(c => c.classList.remove('game-card-active'));
    el.classList.add('game-card-active');

    // Sync the Match Finder widget
    syncMatchFinder(slug);

    // Update URL without reload (history push)
    const url = new URL(window.location);
    if (slug === 'all') { url.searchParams.delete('game'); } else { url.searchParams.set('game', slug); }
    history.pushState({ game: slug }, '', url);

    // Show loading state
    const rankList = document.getElementById('rankings-list');
    const scoutList = document.getElementById('scouting-list');
    const indicator = document.getElementById('game-filter-indicator');
    if (rankList) rankList.innerHTML = '<div class="text-center py-8"><div class="w-6 h-6 border-2 border-dc-cyan border-t-transparent rounded-full animate-spin mx-auto"></div></div>';
    if (scoutList) scoutList.innerHTML = '<div class="col-span-2 text-center py-8"><div class="w-6 h-6 border-2 border-dc-cyan border-t-transparent rounded-full animate-spin mx-auto"></div></div>';

    // Abort previous request
    if (_filterAbort) _filterAbort.abort();
    _filterAbort = new AbortController();

    fetch(`{% url 'organizations:vnext_hub_filter' %}?game=${encodeURIComponent(slug)}`, { signal: _filterAbort.signal })
        .then(r => r.json())
        .then(data => {
            if (!data.ok) return;

            // Update indicator
            if (indicator) {
                indicator.innerHTML = `<i data-lucide="filter" class="w-3 h-3"></i>Showing: ${data.game_display}`;
            }

            // Update standings heading
            const standingsH2 = document.querySelector('#rankings-list')?.closest('.glass')?.querySelector('h2');
            if (standingsH2) {
                standingsH2.innerHTML = slug === 'all'
                    ? 'ðŸ‘‘ Global Standings'
                    : `ðŸ‘‘ ${data.game_display} Rankings`;
            }
            const standingsP = document.querySelector('#rankings-list')?.closest('.glass')?.querySelector('p.text-sm.text-gray-400');
            if (standingsP) {
                standingsP.textContent = slug === 'all'
                    ? 'Top teams across all titles based on Crown Points (CP).'
                    : `Top teams in ${data.game_display} based on Crown Points (CP).`;
            }

            // Render rankings
            if (rankList) {
                if (data.rankings.length === 0) {
                    rankList.innerHTML = '<div class="text-center py-10"><i data-lucide="bar-chart-3" class="w-7 h-7 text-gray-700 mx-auto mb-2"></i><p class="text-sm text-gray-500">Rankings will appear once teams start competing</p></div>';
                } else {
                    rankList.innerHTML = data.rankings.map((e, i) => {
                        const idx = i + 1;
                        const rankCls = idx === 1 ? 'text-xl text-dc-gold' : idx === 2 ? 'text-lg text-gray-300' : idx === 3 ? 'text-lg text-orange-400' : 'text-gray-500';
                        const rowBg = idx === 1 ? 'bg-gradient-to-r from-dc-gold/10 to-transparent' : '';
                        const py = idx <= 3 ? 'py-4' : 'py-3';
                        const imgSize = idx <= 3 ? 'w-10 h-10' : 'w-8 h-8';
                        const imgBorder = idx === 1 ? 'border-dc-gold/50' : 'border-white/10';
                        const tierMap = { CROWN:'tier-crown', ASCENDANT:'tier-ascendant', DIAMOND:'tier-diamond', PLATINUM:'tier-platinum', GOLD:'tier-gold' };
                        const tierCls = tierMap[e.tier] || 'tier-silver';
                        const logo = e.team_logo_url
                            ? `<img src="${e.team_logo_url}" class="${imgSize} rounded-lg object-cover flex-shrink-0 border ${imgBorder}" alt="${e.team_name}" loading="lazy">`
                            : `<div class="${imgSize} rounded-lg bg-dc-dark border ${imgBorder} flex items-center justify-center text-xs font-bold text-gray-400 flex-shrink-0">${(e.team_tag||'??').substring(0,3)}</div>`;
                        const orgLine = e.organization_name ? `<p class="text-xs text-gray-500 truncate">${e.organization_name}</p>` : '';
                        const ptsCls = idx <= 3 ? 'text-white text-lg' : 'text-gray-300';
                        return `<div class="rank-row grid grid-cols-12 gap-4 px-6 ${py} items-center ${rowBg} relative group cursor-pointer">
                            <div class="col-span-1 text-center font-display font-bold ${rankCls}">${idx}</div>
                            <div class="col-span-5 flex items-center gap-3 sm:gap-4">${logo}<div class="min-w-0"><div class="flex items-center gap-2"><a href="${e.team_url}" class="text-sm font-bold text-white group-hover:text-dc-cyan transition-colors truncate">${e.team_name}</a></div>${orgLine}</div></div>
                            <div class="col-span-2 text-center hidden sm:block"><span class="text-[10px] px-2 py-0.5 rounded-full font-bold ${tierCls}">${e.tier}</span></div>
                            <div class="col-span-2 text-right font-display font-bold ${ptsCls}">${Number(e.score).toLocaleString()}</div>
                            <div class="col-span-2 flex justify-center text-gray-500 text-xs">â€”</div>
                        </div>`;
                    }).join('');
                }
            }

            // Render scouting grounds
            if (scoutList) {
                if (data.recruiting.length === 0) {
                    scoutList.innerHTML = '<div class="col-span-2 text-center py-8"><i data-lucide="radar" class="w-7 h-7 text-gray-500 mx-auto mb-2"></i><p class="text-sm text-gray-500">No teams actively recruiting right now</p></div>';
                } else {
                    scoutList.innerHTML = data.recruiting.map(t => {
                        const logo = t.logo_url
                            ? `<img src="${t.logo_url}" class="w-12 h-12 rounded-xl object-cover border border-white/10 flex-shrink-0 group-hover:border-dc-cyan/30 transition-colors" alt="${t.name}" loading="lazy">`
                            : `<div class="w-12 h-12 rounded-xl border border-white/10 bg-gradient-to-br from-dc-cyan/20 to-dc-purple/20 flex items-center justify-center text-sm font-bold text-white flex-shrink-0 group-hover:border-dc-cyan/30 transition-colors">${t.tag.substring(0,2)}</div>`;
                        return `<div class="group relative rounded-2xl overflow-hidden border border-white/[0.06] hover:border-dc-cyan/30 transition-all duration-300 hover:-translate-y-1">
                            <div class="h-1 w-full bg-gradient-to-r from-dc-cyan via-dc-purple to-dc-cyan"></div>
                            <div class="p-5 bg-gradient-to-b from-white/[0.04] to-transparent">
                                <div class="flex items-start gap-3.5 mb-3.5">
                                    ${logo}
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-bold text-white text-sm group-hover:text-dc-cyan transition-colors truncate">${t.name}</h4>
                                        <p class="text-xs text-gray-500 mt-0.5">${t.game}</p>
                                    </div>
                                    <span class="text-[10px] font-bold bg-green-400/10 text-green-400 px-2 py-0.5 rounded-full border border-green-400/20 flex-shrink-0">OPEN</span>
                                </div>
                                <p class="text-sm text-gray-400 mb-4 line-clamp-2 leading-relaxed">${t.description}</p>
                                <a href="${t.url}" class="w-full py-2.5 bg-dc-cyan/10 hover:bg-dc-cyan/20 text-dc-cyan border border-dc-cyan/20 hover:border-dc-cyan/40 rounded-xl text-xs font-bold transition-all flex items-center justify-center gap-1.5">
                                    <i data-lucide="user-plus" class="w-3.5 h-3.5"></i> View & Apply
                                </a>
                            </div>
                        </div>`;
                    }).join('');
                }
            }

            // Re-init lucide icons for new DOM
            lucide.createIcons();
        })
        .catch(err => {
            if (err.name === 'AbortError') return;
            console.warn('[Hub] Filter fetch failed:', err);
        });
}

// Handle browser back/forward
window.addEventListener('popstate', (e) => {
    if (e.state && e.state.game) {
        const slug = e.state.game;
        const card = document.querySelector(`.game-card[data-game="${slug}"]`);
        if (card) selectGame(slug, card);
    }
});

// === SEARCH MODAL ===
function openSearch() { document.getElementById('search-modal').classList.add('active'); document.getElementById('search-input').focus(); document.body.style.overflow = 'hidden' }
function closeSearch() { document.getElementById('search-modal').classList.remove('active'); document.body.style.overflow = '' }

// === SEARCH AUTOCOMPLETE ===
let searchTimeout;
const searchInput = document.getElementById('search-input');
if (searchInput) {
    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        const q = this.value.trim();
        if (q.length < 2) return;
        searchTimeout = setTimeout(async () => {
            try {
                const res = await fetch(`/api/vnext/system/teams/search/?q=${encodeURIComponent(q)}&limit=10`);
                if (!res.ok) return;
                const json = await res.json();
                const results = document.getElementById('search-results');
                if (!results || !json.ok) return;
                const teams = json.data.teams || [];
                if (teams.length === 0) {
                    results.innerHTML = '<p class="text-sm text-gray-500 text-center py-4">No results found</p>';
                    return;
                }
                results.innerHTML = '<p class="text-xs text-gray-500 mb-3">RESULTS</p><div class="space-y-2">' +
                    teams.map(t => `<a href="${t.url}" class="flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 transition-colors"><div class="w-8 h-8 rounded-lg bg-dc-surface border border-white/10 flex items-center justify-center text-xs font-bold text-white">${(t.name || '').substring(0,2)}</div><div><p class="text-sm text-gray-300 font-medium">${t.name}</p><p class="text-xs text-gray-500">${t.tier || 'Unranked'} Â· ${t.cp || 0} CP</p></div></a>`).join('') +
                    '</div>';
            } catch (e) { console.warn('[Hub] Search failed:', e); }
        }, 300);
    });
}
</script>
{% endblock %}
