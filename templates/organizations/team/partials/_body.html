{% load static %}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{# _body.html â€” Team Detail Page (Complete Rebuild from Demo Template)       #}
{# All hardcoded demo data replaced with Django context variables.           #}
{# Structure: Background â†’ Hero â†’ Subnav â†’ Main Grid (8+4) â†’ Partners       #}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}

{# â”€â”€ Background Effects â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<div class="fixed inset-0 z-0 pointer-events-none">
  <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.04]"></div>
  <div class="absolute -top-40 -right-40 w-[800px] h-[800px] rounded-full blur-[200px] opacity-10"
       style="background: var(--team-primary)"></div>
  <div class="absolute -bottom-56 -left-56 w-[900px] h-[900px] rounded-full blur-[220px] opacity-[0.06]"
       style="background: var(--team-primary)"></div>
</div>

<div class="relative z-10">

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{# HERO SECTION                                                              #}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
<header class="relative mb-16 md:mb-20">
  {# Banner Image #}
  <div class="relative w-full h-[420px] sm:h-[460px] md:h-[520px] overflow-hidden">
    <div class="absolute inset-0">
      {% if team.banner_url %}
      <img src="{{ team.banner_url }}"
           alt="{{ team.name }} banner"
           class="w-full h-full object-cover hero-mask opacity-80 scale-105 will-change-transform" />
      {% else %}
      <div class="w-full h-full hero-mask opacity-80"
           style="background: linear-gradient(135deg, rgba(10,10,15,1) 0%, color-mix(in srgb, var(--team-primary) 20%, black) 100%)"></div>
      {% endif %}
    </div>
    <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"></div>
    <div class="absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>
  </div>

  {# Team Card #}
  <div class="max-w-[1600px] mx-auto px-4 sm:px-6 relative -mt-24 md:-mt-28 z-20">
    <div class="liquid-glass team-card rounded-[2.5rem] p-5 sm:p-6 md:p-8 flex flex-col lg:flex-row gap-6 md:gap-8 items-stretch lg:items-center">

      {# Logo Slab #}
      <div class="relative shrink-0">
        <div class="logo-slab">
          <div class="logo-slab__inner">
            {% if team.logo_url %}
            <img src="{{ team.logo_url }}" alt="{{ team.name }}" class="w-full h-full object-cover drop-shadow-[0_0_28px_var(--team-glow)]" />
            {% else %}
            <svg class="w-20 h-20 md:w-24 md:h-24 text-white drop-shadow-[0_0_28px_var(--team-glow)]"
                 fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z"/>
            </svg>
            {% endif %}
          </div>
        </div>
        {# Verified Badge #}
        <div class="absolute -bottom-2 -right-2 verified-dot flex items-center justify-center has-tooltip"
             data-tooltip="Verified Team" aria-label="Verified Team">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
            <path fill-rule="evenodd"
                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                  clip-rule="evenodd"/>
          </svg>
        </div>
      </div>

      {# Team Identity #}
      <div class="flex-1 min-w-0">
        {# Name + Rank Badge #}
        <div class="flex flex-col md:flex-row md:items-center gap-3 md:gap-4">
          <h1 class="text-4xl sm:text-5xl font-display font-bold uppercase tracking-tight leading-none text-white one-line-title">
            {{ team.name }}
          </h1>
          {% if team.rank %}
          <span class="inline-flex items-center gap-1.5 h-8 px-3 rounded-lg bg-emerald-500/10 border border-emerald-500/30 backdrop-blur-sm">
            <svg class="w-3 h-3 text-emerald-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            <span class="text-emerald-400 text-[10px] font-bold uppercase tracking-widest font-mono">Rank #{{ team.rank }}</span>
          </span>
          {% else %}
          <span class="inline-flex items-center gap-1.5 h-8 px-3 rounded-lg bg-white/5 border border-white/10 backdrop-blur-sm">
            <span class="text-slate-500 text-[10px] font-bold uppercase tracking-widest font-mono">Unranked</span>
          </span>
          {% endif %}
        </div>

        {# Tagline / Motto #}
        {% if team.tagline %}
        <p id="dc-team-motto" class="mt-3 text-slate-400 text-sm leading-relaxed max-w-3xl line-clamp-2" data-max="120">
          {{ team.tagline }}
        </p>
        {% endif %}

        {# Smart Badges â€” Icon + Value only #}
        <div class="mt-4 flex flex-wrap items-center gap-2">
          {# a. Organization Identity Tag â€” Parent Entity, appears FIRST, gold/brand border, verified stamp #}
          {% if organization %}
          <a href="{{ organization.url }}" class="inline-flex items-center gap-2 h-8 pl-1 pr-3 rounded-full bg-[var(--team-primary)]/5 border border-[var(--team-primary)]/40 hover:border-[var(--team-primary)]/70 transition group" title="Part of {{ organization.name }}">
            {% if organization.logo_url %}
            <img src="{{ organization.logo_url }}" alt="{{ organization.name }}" class="w-6 h-6 rounded-full object-cover border border-[var(--team-primary)]/30" />
            {% else %}
            <span class="w-6 h-6 rounded-full bg-[var(--team-primary)]/20 border border-[var(--team-primary)]/30 flex items-center justify-center text-[8px] font-bold text-[var(--team-primary)]">{{ organization.name|truncatechars:2 }}</span>
            {% endif %}
            <span class="text-[10px] font-bold text-[var(--team-primary)] uppercase tracking-wider">{{ organization.name }}</span>
            {% if organization.is_verified %}
            <svg class="w-3.5 h-3.5 text-[var(--team-primary)] shrink-0" fill="currentColor" viewBox="0 0 24 24" title="Verified Organization"><path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
            {% endif %}
          </a>
          {% endif %}

          {# b. Competitive Discipline Tag â€” Game logo + uppercase name, glass effect #}
          {% if team.game %}
          <span class="inline-flex items-center gap-2 h-8 {% if team.game.logo_url %}pl-1{% else %}pl-3{% endif %} pr-3 rounded-full bg-white/[0.04] border border-white/10 backdrop-blur-sm">
            {% if team.game.logo_url %}
            <img src="{{ team.game.logo_url }}" alt="{{ team.game.name }}" class="w-6 h-6 rounded-full object-cover" />
            {% endif %}
            <span class="text-[10px] font-bold text-white uppercase tracking-wider">{{ team.game.name }}</span>
          </span>
          {% endif %}

          {% if team.platform %}
          <span class="inline-flex items-center gap-1.5 h-7 px-3 rounded-full bg-white/5 border border-white/10 text-[10px] font-mono text-white">
            <svg class="w-3.5 h-3.5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L8 21h8l-1.75-4M3 13h18M5 4h14a2 2 0 012 2v9H3V6a2 2 0 012-2z"/></svg>
            {{ team.platform|upper }}
          </span>
          {% endif %}

          {% if team.region %}
          <span class="inline-flex items-center gap-1.5 h-7 px-3 rounded-full bg-white/5 border border-white/10 text-[10px] font-mono text-white">
            <svg class="w-3.5 h-3.5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            {{ team.region }}
          </span>
          {% endif %}

          {% if team.founded_date %}
          <span class="inline-flex items-center gap-1.5 h-7 px-3 rounded-full bg-white/5 border border-white/10 text-[10px] font-mono text-slate-400">
            EST. {{ team.founded_date|date:"Y" }}
          </span>
          {% endif %}

          {% if team.is_recruiting %}
          <span class="tag tag--recruit">RECRUITING</span>
          {% endif %}
        </div>
      </div>

      {# Right Column â€” Actions + Stats Grid #}
      <div class="flex flex-col justify-between gap-5 lg:items-end">

        {# Action Buttons (clean: Primary + Team Chat + Menu) #}
        <div id="team-info-actions" class="flex items-center gap-3 lg:justify-end">
          {# PUBLIC: Follow + Share #}
          <button type="button" data-role-show="PUBLIC"
                  class="h-11 px-6 bg-[var(--team-primary)] text-black font-bold uppercase text-[10px] tracking-[0.18em]
                         rounded-xl hover:brightness-110 transition shadow-[0_0_22px_var(--team-glow)] flex items-center gap-2"
                  title="Follow this team">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
            </svg>
            <span>FOLLOW</span>
          </button>
          <button type="button" data-role-show="PUBLIC"
                  class="h-11 w-11 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-center text-slate-200"
                  title="Share team profile">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
            </svg>
          </button>

          {# MEMBER/STAFF/OWNER: Team Chat link â€” goes to manage page Discord section #}
          <a href="{% url 'organizations:team_manage' team.slug %}#discord" data-role-show="TEAM"
             class="h-11 px-5 bg-[#5865F2] text-white font-bold uppercase text-[10px] tracking-[0.18em]
                    rounded-xl hover:bg-[#4752C4] transition shadow-[0_0_22px_rgba(88,101,242,0.4)] flex items-center gap-2"
             title="Team Chat">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.317 4.37a19.79 19.79 0 00-4.885-1.515.074.074 0 00-.079.037c-.21.375-.444.865-.608 1.25a18.27 18.27 0 00-5.487 0 12.64 12.64 0 00-.618-1.25.077.077 0 00-.079-.037A19.74 19.74 0 003.677 4.37a.07.07 0 00-.032.028C.533 9.046-.32 13.58.099 18.058a.082.082 0 00.031.056c2.053 1.508 4.041 2.423 5.993 3.03a.078.078 0 00.084-.028c.462-.63.873-1.295 1.226-1.994a.076.076 0 00-.041-.106 13.11 13.11 0 01-1.872-.892.077.077 0 01-.008-.128c.126-.094.252-.192.372-.291a.074.074 0 01.078-.01c3.928 1.793 8.18 1.793 12.061 0a.074.074 0 01.079.01c.12.099.245.197.372.291a.077.077 0 01-.006.128 12.3 12.3 0 01-1.873.891.076.076 0 00-.041.107c.36.698.772 1.363 1.225 1.993a.076.076 0 00.084.028c1.961-.607 3.95-1.522 6.002-3.029a.077.077 0 00.031-.055c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 00-.031-.029z"/>
            </svg>
            <span>TEAM CHAT</span>
          </a>

          {# OWNER: Manage (primary action) #}
          <a href="{% url 'organizations:team_manage' team.slug %}" data-role-show="OWNER"
             class="h-11 px-6 bg-[var(--team-primary)] text-black font-bold uppercase text-[10px] tracking-[0.18em]
                    rounded-xl hover:brightness-110 transition shadow-[0_0_22px_var(--team-glow)] flex items-center gap-2"
             title="Open control plane">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            <span>MANAGE</span>
          </a>

          {# STAFF/OWNER: Menu dropdown for secondary actions #}
          <div class="relative" data-role-show="STAFF">
            <button type="button" id="dc-menu-toggle"
                    class="h-11 w-11 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center justify-center text-slate-200"
                    title="More actions">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path>
              </svg>
            </button>
            <div id="dc-menu-dropdown" class="hidden absolute right-0 top-full mt-2 w-52 bg-[#0A0A0F] border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden">
              <a href="{% url 'organizations:team_manage' team.slug %}#roster" class="flex items-center gap-3 px-4 py-3 text-xs text-slate-300 hover:bg-white/5 hover:text-white transition">
                <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                Review Applications
              </a>
              <a href="{% url 'organizations:team_manage' team.slug %}#roster" class="flex items-center gap-3 px-4 py-3 text-xs text-slate-300 hover:bg-white/5 hover:text-white transition">
                <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                Roster Management
              </a>
              <div class="border-t border-white/5" data-role-show="OWNER"></div>
              <a href="{% url 'organizations:team_manage' team.slug %}#treasury" class="flex items-center gap-3 px-4 py-3 text-xs text-slate-300 hover:bg-white/5 hover:text-white transition" data-role-show="OWNER">
                <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
                Team Wallet
              </a>
              <a href="{% url 'organizations:team_manage' team.slug %}#competition" class="flex items-center gap-3 px-4 py-3 text-xs text-slate-300 hover:bg-white/5 hover:text-white transition" data-role-show="OWNER">
                <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                Match History
              </a>
            </div>
          </div>
        </div>

        {# Stats Grid #}
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-x-8 gap-y-4 lg:gap-x-10">
          <div class="text-right">
            <div class="text-[9px] font-mono uppercase text-slate-500 tracking-wider">Crown Points</div>
            <div class="text-2xl font-display font-bold text-white">{{ team.crown_points|default:"0" }}</div>
          </div>
          <div class="text-right">
            <div class="text-[9px] font-mono uppercase text-slate-500 tracking-wider">Trophies</div>
            <div class="text-2xl font-display font-bold text-[var(--team-primary)]">
              {{ leaderboard_stats.trophies_count|default:"0" }}
              <span class="text-xs text-slate-500 ml-1">Season</span>
            </div>
          </div>
          <div class="text-right">
            <div class="text-[9px] font-mono uppercase text-slate-500 tracking-wider">Win Rate</div>
            <div class="text-2xl font-display font-bold text-white">{{ leaderboard_stats.win_rate|default:"0" }}%</div>
          </div>
          <div class="text-right">
            <div class="text-[9px] font-mono uppercase text-slate-500 tracking-wider">Matches</div>
            <div class="text-2xl font-display font-bold text-white">{{ leaderboard_stats.matches_played|default:"0" }}</div>
          </div>
        </div>
      </div>

    </div>{# /team-card #}
  </div>
</header>

{# Motto truncation #}
<script>
  window.addEventListener("DOMContentLoaded", () => {
    const el = document.getElementById("dc-team-motto");
    if (!el) return;
    const max = Number(el.getAttribute("data-max") || 120);
    const raw = (el.textContent || "").trim();
    el.textContent = raw.length > max ? raw.slice(0, max - 1).trim() + "â€¦" : raw;
  });
</script>

{# Sub-nav removed â€” single-scroll page with smooth sections #}

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{# MAIN CONTENT GRID (8 + 4)                                                 #}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
<main class="max-w-[1600px] mx-auto px-4 sm:px-6 pb-24">
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 xl:gap-12 items-start">

    {# â”€â”€ LEFT COLUMN (8 cols) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
    <div class="lg:col-span-8 flex flex-col gap-10" style="min-height: 100vh;">

      {# â”€â”€ OVERVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <section id="overview">
        <div class="flex flex-col md:flex-row gap-6 md:gap-10 items-start">
          <div class="flex-1">
            <h3 class="text-white font-display font-bold text-lg mb-3 flex items-center gap-2">
              <span class="w-1 h-5 bg-[var(--team-primary)] rounded-full"></span>
              Mission & Identity
            </h3>
            {% if team.description %}
            <p class="text-slate-400 text-sm leading-7">
              {{ team.description|linebreaksbr }}
            </p>
            {% else %}
            <p class="text-slate-500 text-sm italic">No team description set yet.</p>
            {% endif %}

            {# Playstyle Chips â€” always show all three #}
            <div class="flex flex-wrap gap-2 mt-4">
              <div class="px-3 py-1 rounded bg-white/5 border border-white/10 text-[10px] font-mono uppercase tracking-wider text-slate-300">
                Style: <span class="text-white font-bold">{{ team.playstyle|default:"Not Set" }}</span>
              </div>
              <div class="px-3 py-1 rounded bg-white/5 border border-white/10 text-[10px] font-mono uppercase tracking-wider text-slate-300">
                Pace: <span class="text-white font-bold">{{ team.playpace|default:"Not Set" }}</span>
              </div>
              <div class="px-3 py-1 rounded bg-white/5 border border-white/10 text-[10px] font-mono uppercase tracking-wider text-slate-300">
                Focus: <span class="text-white font-bold">{{ team.playfocus|default:"Not Set" }}</span>
              </div>
            </div>
          </div>

          {# Streak + Rank micro-cards #}
          <div class="w-full md:w-auto shrink-0 grid grid-cols-2 gap-3">
            <div class="p-4 rounded-2xl bg-[#0A0A0F] border border-white/10 min-w-[140px]">
              <div class="text-[9px] uppercase tracking-widest text-slate-500 mb-1">Current Streak</div>
              <div class="text-2xl font-display font-bold {% if leaderboard_stats.streak_type == 'W' %}text-[#00FF41]{% else %}text-red-400{% endif %}">
                {{ leaderboard_stats.current_streak|default:"0" }} {{ leaderboard_stats.streak_type|default:"" }}
              </div>
            </div>
            <div class="p-4 rounded-2xl bg-[#0A0A0F] border border-white/10 min-w-[140px]">
              <div class="text-[9px] uppercase tracking-widest text-slate-500 mb-1">Global Rank</div>
              <div class="text-2xl font-display font-bold text-white">#{{ team.rank|default:"â€”" }}</div>
            </div>
          </div>
        </div>
      </section>

      {# â”€â”€ ROSTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <section id="roster" class="transition-smooth">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-white font-display font-bold text-lg flex items-center gap-2">
            <span class="w-1 h-5 bg-[var(--team-primary)] rounded-full"></span>
            Active Roster
            <span class="ml-2 px-2 py-0.5 rounded-full bg-[var(--team-primary)]/10 border border-[var(--team-primary)]/20 text-[var(--team-primary)] text-[9px] font-bold">{{ roster.count|default:"0" }}</span>
          </h3>
          {% if roster.count > roster.starting_lineup_size %}
          <button id="dc-roster-toggle"
                  class="text-[10px] font-mono font-bold uppercase tracking-widest text-slate-500 hover:text-[var(--team-primary)] transition-smooth flex items-center gap-1">
            View Full Squad
            <svg class="w-3 h-3 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
          </button>
          {% endif %}
        </div>

        {% if roster.items %}
        {# Starting Lineup Label #}
        <div class="flex items-center gap-2 mb-3">
          <span class="text-[9px] font-mono font-bold uppercase tracking-widest text-slate-500">Starting Lineup ({{ roster.starting_lineup_size }}v{{ roster.starting_lineup_size }})</span>
          <div class="flex-1 h-px bg-white/5"></div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-5 gap-4" id="dc-roster-grid">
          {% for member in roster.items %}
          <div class="group relative h-[320px] rounded-2xl overflow-hidden bg-[#0A0A0F] border border-white/10 hover-lift hover-glow cursor-pointer dc-roster-card {% if forloop.counter > roster.starting_lineup_size %}dc-bench-player hidden{% endif %}"
               {% if forloop.counter == roster.starting_lineup_size|add:1 %}id="dc-bench-start"{% endif %}
               data-player-name="{{ member.display_name }}"
               data-player-username="{{ member.username }}"
               data-player-avatar="{{ member.avatar_url|default:'' }}"
               data-player-role="{{ member.player_role|default:'' }}"
               data-player-country="{{ member.country|default:'' }}"
               data-player-captain="{% if member.is_captain %}1{% endif %}"
               data-player-ign="{{ member.game_passport.ign|default:'' }}"
               data-player-rank="{{ member.game_passport.rank|default:'' }}"
               data-player-profile-url="{{ member.profile_url|default:'' }}"
               onclick="dcOpenPlayerPopup(this)">
            {% if member.avatar_url %}
            <img src="{{ member.avatar_url }}" class="absolute inset-0 w-full h-full object-cover opacity-60 group-hover:opacity-80 group-hover:scale-105 transition-smooth" alt="{{ member.display_name }}" loading="lazy">
            {% else %}
            <div class="absolute inset-0 w-full h-full bg-gradient-to-b from-slate-800 to-slate-900 opacity-60"></div>
            {% endif %}
            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"></div>

            {# Captain / Starter badge #}
            <div class="absolute top-3 left-3">
              {% if member.is_captain %}
              <span class="px-2 py-0.5 rounded bg-[var(--team-primary)]/20 border border-[var(--team-primary)]/30 text-[var(--team-primary)] text-[8px] font-bold uppercase tracking-wider">Captain</span>
              {% elif forloop.counter > roster.starting_lineup_size %}
              <span class="px-2 py-0.5 rounded bg-white/10 border border-white/10 text-slate-400 text-[8px] font-bold uppercase tracking-wider">Bench</span>
              {% endif %}
            </div>

            <div class="absolute top-3 right-3 w-8 h-8 rounded-full bg-black/50 backdrop-blur border border-white/10 flex items-center justify-center text-[var(--team-primary)]">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 22h20L12 2zm0 3.5l6.5 13h-13L12 5.5z"/></svg>
            </div>

            <div class="absolute bottom-0 left-0 w-full p-4">
              {% if member.player_role %}
              <div class="text-[9px] font-mono font-bold uppercase text-[var(--team-primary)] mb-0.5">{{ member.player_role }}</div>
              {% endif %}
              <h4 class="text-xl font-display font-bold text-white mb-1">{{ member.display_name|upper }}</h4>
              <div class="flex items-center gap-2 text-[10px] text-slate-400 font-mono">
                {% if member.country %}
                <img src="https://flagcdn.com/{{ member.country|lower }}.svg" class="w-3.5 h-2.5 rounded-[1px] object-cover" alt="{{ member.country }}">
                {% endif %}
                <span>{{ member.username }}</span>
              </div>
              {% if member.game_passport %}
              <div class="grid grid-cols-2 gap-2 mt-3 pt-3 border-t border-white/10 opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 transition-all duration-300">
                <div>
                  <div class="text-[8px] uppercase text-slate-500">IGN</div>
                  <div class="text-sm font-bold text-white">{{ member.game_passport.ign|default:"â€”" }}</div>
                </div>
                <div class="text-right">
                  <div class="text-[8px] uppercase text-slate-500">Rank</div>
                  <div class="text-sm font-bold text-[var(--team-primary)]">{{ member.game_passport.rank|default:"â€”" }}</div>
                </div>
              </div>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>

        {# Bench separator (shown when expanded) #}
        {% if roster.count > roster.starting_lineup_size %}
        <div id="dc-bench-label" class="hidden flex items-center gap-2 mt-6 mb-3">
          <span class="text-[9px] font-mono font-bold uppercase tracking-widest text-slate-500">Bench / Substitutes</span>
          <div class="flex-1 h-px bg-white/5"></div>
        </div>
        {% endif %}

        {% else %}
        <div class="empty-state">
          <div class="text-3xl mb-3 opacity-30">ğŸ‘¥</div>
          <p class="text-sm text-slate-500">No roster members yet</p>
        </div>
        {% endif %}
      </section>

      {# â”€â”€ OPERATIONS (Staff/Owner only) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      {% if permissions.can_view_operations %}
      <section id="operations">
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
          <div>
            <h3 class="text-white font-display font-bold text-lg flex items-center gap-2">
              <span class="w-1 h-5 bg-blue-500 rounded-full"></span>
              Team Status & Recent Activity
            </h3>
            <p class="text-xs text-slate-400 mt-1">Live updates from {{ team.name }}</p>
          </div>
        </div>
        <div class="bg-[#0A0A0F] border border-white/10 rounded-2xl overflow-hidden">
          <div class="px-5 py-4 border-b border-white/5 flex items-center justify-between bg-white/[0.02]">
            <h4 class="text-xs font-bold text-white uppercase tracking-wider flex items-center gap-2">
              <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
              Operations Log
            </h4>
            <span class="text-[10px] font-mono text-slate-500">SYNCED: LIVE</span>
          </div>
          <div class="overflow-x-auto">
            {% if operations_log %}
            <table class="w-full text-left border-collapse">
              <thead>
                <tr class="text-[9px] font-bold text-slate-500 uppercase tracking-wider border-b border-white/5">
                  <th class="px-5 py-3 font-mono">Status</th>
                  <th class="px-5 py-3 font-mono">Squad</th>
                  <th class="px-5 py-3 font-mono">Event</th>
                  <th class="px-5 py-3 font-mono text-right">Result</th>
                  <th class="px-5 py-3 font-mono text-right hidden sm:table-cell">Prize</th>
                </tr>
              </thead>
              <tbody class="text-xs text-slate-300">
                {% for op in operations_log %}
                <tr class="group hover:bg-white/[0.02] transition-colors border-b border-white/5">
                  <td class="px-5 py-3">
                    {% if op.status == 'live' %}
                    <span class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded bg-red-500/10 text-red-500 border border-red-500/20 text-[9px] font-bold uppercase tracking-wide animate-pulse">
                      <span class="w-1 h-1 rounded-full bg-red-500"></span> Live
                    </span>
                    {% else %}
                    <span class="inline-flex items-center px-2 py-0.5 rounded bg-slate-800 text-slate-400 border border-white/5 text-[9px] font-bold uppercase tracking-wide">
                      {{ op.status|default:"Finished" }}
                    </span>
                    {% endif %}
                  </td>
                  <td class="px-5 py-3 font-bold {% if op.status == 'live' %}text-white{% else %}text-slate-300{% endif %}">{{ op.squad_name|default:team.name }}</td>
                  <td class="px-5 py-3">
                    <div class="flex flex-col">
                      <span class="{% if op.status == 'live' %}text-white{% else %}text-slate-300{% endif %}">{{ op.event_name }}</span>
                      {% if op.opponent %}<span class="text-[10px] text-slate-500">vs {{ op.opponent }}</span>{% endif %}
                    </div>
                  </td>
                  <td class="px-5 py-3 text-right">
                    {% if op.result == 'win' %}
                    <span class="text-[var(--team-primary)] font-bold">WIN {{ op.score }}</span>
                    {% elif op.result == 'loss' %}
                    <span class="text-red-500 font-bold">LOSS {{ op.score }}</span>
                    {% else %}
                    <span class="font-mono text-white">{{ op.score|default:"â€”" }}</span>
                    {% endif %}
                  </td>
                  <td class="px-5 py-3 text-right font-mono hidden sm:table-cell {% if op.prize %}text-[#00FF41]{% else %}text-slate-600{% endif %}">{{ op.prize|default:"-" }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% else %}
            <div class="p-6 text-center text-sm text-slate-500">
              <p>Operations data will appear here when available.</p>
            </div>
            {% endif %}
          </div>
        </div>
      </section>
      {% endif %}

      {# â”€â”€ MATCHES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <section id="matches">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-white font-display font-bold text-lg flex items-center gap-2">
            <span class="w-1 h-5 bg-[var(--team-primary)] rounded-full"></span>
            Match Schedule
          </h3>
          <div class="flex gap-2">
            <button class="px-3 py-1.5 rounded-lg bg-white/10 text-white text-[10px] font-bold uppercase tracking-widest transition-colors dc-match-filter" data-filter="upcoming">Upcoming</button>
            <button class="px-3 py-1.5 rounded-lg text-slate-500 hover:bg-white/5 text-[10px] font-bold uppercase tracking-widest transition-colors dc-match-filter" data-filter="results">Results</button>
          </div>
        </div>

        <div class="space-y-4">
          {% if upcoming_matches %}
            {% for match in upcoming_matches %}
            <div class="relative group p-5 rounded-2xl bg-gradient-to-br from-[#0A0A0F] to-[#121216] border border-[var(--team-primary)]/30 hover:border-[var(--team-primary)]/60 transition-all">
              {% if match.time_label %}
              <div class="absolute top-3 right-3">
                <span class="px-2 py-1 rounded bg-[var(--team-primary)]/10 border border-[var(--team-primary)]/20 text-[var(--team-primary)] text-[9px] font-bold uppercase tracking-widest">{{ match.time_label }}</span>
              </div>
              {% endif %}
              <div class="flex flex-col md:flex-row items-center gap-6">
                <div class="flex-1 flex items-center justify-between gap-6">
                  <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl bg-[var(--team-primary)]/10 border border-[var(--team-primary)]/30 flex items-center justify-center">
                      {% if team.logo_url %}
                      <img src="{{ team.logo_url }}" class="w-8 h-8 object-contain" alt="{{ team.tag }}">
                      {% else %}
                      <span class="font-display font-bold text-[var(--team-primary)] text-sm">{{ team.tag|default:team.name|truncatechars:3 }}</span>
                      {% endif %}
                    </div>
                    <div>
                      <div class="font-bold text-white text-sm">{{ team.name }}</div>
                      {% if team.rank %}<div class="text-[10px] text-slate-500">Rank #{{ team.rank }}</div>{% endif %}
                    </div>
                  </div>

                  <div class="text-center">
                    <div class="text-xs font-mono text-slate-500 mb-1">{{ match.format|default:"BO3" }}</div>
                    <div class="text-2xl font-display font-bold text-white">VS</div>
                    {% if match.scheduled_time %}
                    <div class="text-xs font-mono text-slate-400 mt-1">{{ match.scheduled_time|date:"H:i" }}</div>
                    {% endif %}
                  </div>

                  <div class="flex items-center gap-3">
                    <div>
                      <div class="font-bold text-white text-sm text-right">{{ match.opponent_name|default:"TBD" }}</div>
                      {% if match.opponent_rank %}<div class="text-[10px] text-slate-500 text-right">Rank #{{ match.opponent_rank }}</div>{% endif %}
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center">
                      <span class="font-display font-bold text-slate-400 text-sm">{{ match.opponent_name|truncatechars:3|upper }}</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mt-4 pt-4 border-t border-white/5 flex items-center justify-between">
                <div class="text-xs text-slate-400">
                  <span class="font-bold text-white">{{ match.tournament_name|default:"Tournament" }}</span>{% if match.stage %} &bull; {{ match.stage }}{% endif %}
                </div>
                <button class="text-[10px] font-bold text-[var(--team-primary)] hover:text-white transition-colors uppercase tracking-widest">Match Details &rarr;</button>
              </div>
            </div>
            {% endfor %}
          {% else %}
            <div class="empty-state">
              <div class="text-3xl mb-3 opacity-30">ğŸ“…</div>
              <p class="text-sm text-slate-500">No upcoming matches scheduled</p>
            </div>
          {% endif %}
        </div>
      </section>

      {# â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <section id="stats">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-white font-display font-bold text-lg flex items-center gap-2">
            <span class="w-1 h-5 bg-[var(--team-primary)] rounded-full"></span>
            Team Statistics & Performance
          </h3>
          <div class="flex items-center gap-2">
            <span class="text-[10px] uppercase text-slate-500 font-bold tracking-wider">Season {{ leaderboard_stats.season|default:"5" }} &bull; {{ leaderboard_stats.season_year|default:"2026" }}</span>
            <button class="w-6 h-6 rounded bg-white/5 flex items-center justify-center text-slate-400 hover:text-white hover:bg-white/10 transition">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
            </button>
          </div>
        </div>

        {# Recent Form #}
        <div class="mb-6 p-6 rounded-2xl bg-[#0A0A0F] border border-white/10">
          <h4 class="text-xs font-bold text-white uppercase tracking-wider mb-4 flex items-center gap-2">
            <svg class="w-4 h-4 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
            Recent Form (Last 10 Matches)
          </h4>

          <div class="flex items-center justify-between mb-6">
            <div class="flex gap-2">
              {% for result in leaderboard_stats.recent_form %}
              {% if result == "W" %}
              <div class="w-8 h-8 rounded bg-emerald-500/20 border border-emerald-500/30 flex items-center justify-center text-xs font-bold text-emerald-400" title="Win">W</div>
              {% elif result == "L" %}
              <div class="w-8 h-8 rounded bg-red-500/20 border border-red-500/30 flex items-center justify-center text-xs font-bold text-red-400" title="Loss">L</div>
              {% else %}
              <div class="w-8 h-8 rounded bg-slate-500/20 border border-slate-500/30 flex items-center justify-center text-xs font-bold text-slate-400" title="Draw">D</div>
              {% endif %}
              {% empty %}
              <span class="text-sm text-slate-500">No recent matches</span>
              {% endfor %}
            </div>

            <div class="text-right">
              <div class="text-2xl font-display font-bold text-emerald-400">{{ leaderboard_stats.win_rate|default:"0" }}%</div>
              <div class="text-[10px] text-slate-500 font-mono uppercase">Win Rate</div>
            </div>
          </div>

          <div class="grid grid-cols-4 gap-4">
            <div class="bg-white/[0.03] rounded-xl p-4 border border-white/5">
              <div class="text-[10px] uppercase text-slate-500 mb-1 font-bold">Total Played</div>
              <div class="text-2xl font-display font-bold text-white">{{ leaderboard_stats.matches_played|default:"0" }}</div>
              <div class="text-[9px] text-slate-600 font-mono mt-1">Official Matches</div>
            </div>
            <div class="bg-white/[0.03] rounded-xl p-4 border border-white/5">
              <div class="text-[10px] uppercase text-slate-500 mb-1 font-bold">Current Streak</div>
              <div class="text-2xl font-display font-bold {% if leaderboard_stats.streak_type == 'W' %}text-emerald-400{% else %}text-red-400{% endif %}">
                {{ leaderboard_stats.current_streak|default:"0" }}{{ leaderboard_stats.streak_type|default:"" }}
              </div>
              <div class="text-[9px] text-emerald-600 font-mono mt-1">Best: {{ leaderboard_stats.longest_win_streak|default:"0" }}W</div>
            </div>
            <div class="bg-white/[0.03] rounded-xl p-4 border border-white/5">
              <div class="text-[10px] uppercase text-slate-500 mb-1 font-bold">Matches Won</div>
              <div class="text-2xl font-display font-bold text-white">{{ leaderboard_stats.matches_won|default:"0" }}</div>
              <div class="text-[9px] text-slate-600 font-mono mt-1">Total Wins</div>
            </div>
            <div class="bg-white/[0.03] rounded-xl p-4 border border-white/5">
              <div class="text-[10px] uppercase text-slate-500 mb-1 font-bold">ELO Rating</div>
              <div class="text-2xl font-display font-bold text-[var(--team-primary)]">{{ leaderboard_stats.elo_rating|default:"â€”" }}</div>
              <div class="text-[9px] text-slate-600 font-mono mt-1">Current</div>
            </div>
          </div>
        </div>

        {# Map Pool / Hero Pool / Drop Zones â€” game-type dynamic label #}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          {# Map Pool Strength #}
          <div class="p-5 rounded-2xl bg-[#0A0A0F] border border-white/10 flex flex-col gap-4">
            <div class="flex items-center justify-between">
              <h4 class="text-xs font-bold text-white uppercase tracking-wider">
                {% if team.game.category == 'MOBA' %}Hero Pool{% elif team.game.category == 'BR' %}Drop Zones{% elif team.game.category == 'FIGHTING' %}Arena Knowledge{% elif team.game.category == 'CCG' %}Deck Matchups{% elif team.game.category == 'STRATEGY' %}Map Control{% else %}Map Pool Strength{% endif %}
              </h4>
              <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
            </div>
            <div class="space-y-4">
              {% if leaderboard_stats.map_pool %}
                {% for map in leaderboard_stats.map_pool %}
                <div>
                  <div class="flex justify-between text-[10px] uppercase font-bold mb-1.5">
                    <span class="text-slate-300">{{ map.name }}</span>
                    <span class="{% if map.win_rate >= 60 %}text-[var(--team-primary)]{% elif map.win_rate >= 50 %}text-emerald-400{% else %}text-red-400{% endif %}">{{ map.win_rate }}% Win</span>
                  </div>
                  <div class="h-1.5 w-full bg-white/5 rounded-full overflow-hidden">
                    <div class="h-full {% if map.win_rate >= 60 %}bg-[var(--team-primary)]{% elif map.win_rate >= 50 %}bg-emerald-400{% else %}bg-red-400{% endif %} rounded-full" style="width: {{ map.win_rate }}%"></div>
                  </div>
                  <div class="flex justify-between mt-1 text-[9px] font-mono text-slate-600">
                    <span>{{ map.played }} Played</span>
                    <span>{{ map.wins }}W - {{ map.losses }}L</span>
                  </div>
                </div>
                {% endfor %}
              {% else %}
                <p class="text-sm text-slate-500 italic">Map data not yet available</p>
              {% endif %}
            </div>
          </div>

          {# Comp Preference & Playstyle â€” game-type dynamic label #}
          <div class="p-5 rounded-2xl bg-[#0A0A0F] border border-white/10 flex flex-col gap-4">
            <div class="flex items-center justify-between">
              <h4 class="text-xs font-bold text-white uppercase tracking-wider">
                {% if team.game.category == 'MOBA' %}Draft Meta{% elif team.game.category == 'BR' %}Squad Setup{% elif team.game.category == 'FIGHTING' %}Character Pool{% elif team.game.category == 'CCG' %}Deck Archetype{% elif team.game.category == 'STRATEGY' %}Build Order{% else %}Comp Preference{% endif %}
              </h4>
              <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
            </div>
            <div class="grid grid-cols-2 gap-3 h-full">
              <div class="bg-white/[0.03] rounded-xl p-3 flex flex-col justify-center items-center text-center border border-white/5">
                <div class="text-[10px] uppercase text-slate-500 mb-1 font-bold">Standard</div>
                <div class="text-xl font-display font-bold text-white">{{ leaderboard_stats.comp_setup|default:"Double" }}</div>
                <div class="text-[9px] text-[var(--team-primary)] font-mono uppercase mt-1">{{ leaderboard_stats.comp_emphasis|default:"Initiator" }}</div>
              </div>
              <div class="bg-white/[0.03] rounded-xl p-3 flex flex-col justify-center items-center text-center border border-white/5">
                <div class="text-[10px] uppercase text-slate-500 mb-1 font-bold">Pace</div>
                <div class="text-xl font-display font-bold text-white">{{ team.playpace|default:"Fast" }}</div>
                <div class="text-[9px] text-slate-400 font-mono uppercase mt-1">{{ team.playfocus|default:"Execute" }}</div>
              </div>
              <div class="col-span-2 bg-white/[0.03] rounded-xl p-3 border border-white/5 flex items-center justify-between">
                <div class="text-xs font-bold text-slate-300">Utility Efficiency</div>
                <div class="text-lg font-display font-bold text-emerald-400">{{ leaderboard_stats.utility_grade|default:"â€”" }}</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      {# â”€â”€ THE JOURNEY â€” Curated Hall of Fame Timeline â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      {% if journey %}
      <section id="journey">
        <h3 class="text-white font-display font-bold text-lg mb-8 flex items-center gap-2">
          <span class="w-1 h-5 bg-[var(--team-primary)] rounded-full"></span>
          The Journey
        </h3>

        <div class="relative ml-4 sm:ml-6 pb-4">
          {# Vertical line #}
          <div class="absolute left-0 top-0 bottom-0 w-px bg-gradient-to-b from-[var(--team-primary)]/40 via-white/10 to-transparent"></div>

          <div class="space-y-8">
          {% for entry in journey %}
          <div class="relative pl-8 sm:pl-10 group">
            {# Timeline dot â€” color-coded by type #}
            {% if entry.milestone_type == 'TROPHY' or entry.milestone_type == 'trophy' %}
            <div class="absolute -left-[6px] top-1 w-3 h-3 rounded-full bg-amber-400 shadow-[0_0_12px_rgba(251,191,36,0.5)] ring-4 ring-[#0A0A0F]"></div>
            {% elif entry.milestone_type == 'TRANSFER' or entry.milestone_type == 'transfer' %}
            <div class="absolute -left-[6px] top-1 w-3 h-3 rounded-full bg-blue-400 shadow-[0_0_12px_rgba(96,165,250,0.4)] ring-4 ring-[#0A0A0F]"></div>
            {% elif entry.milestone_type == 'FOUNDED' or entry.milestone_type == 'founded' %}
            <div class="absolute -left-[6px] top-1 w-3 h-3 rounded-full bg-emerald-400 shadow-[0_0_12px_rgba(52,211,153,0.4)] ring-4 ring-[#0A0A0F]"></div>
            {% elif entry.milestone_type == 'RANK_UP' %}
            <div class="absolute -left-[6px] top-1 w-3 h-3 rounded-full bg-purple-400 shadow-[0_0_12px_rgba(192,132,252,0.4)] ring-4 ring-[#0A0A0F]"></div>
            {% else %}
            <div class="absolute -left-[6px] top-1 w-3 h-3 rounded-full bg-[var(--team-primary)] shadow-[0_0_10px_var(--team-glow)] ring-4 ring-[#0A0A0F] group-hover:scale-125 transition-transform"></div>
            {% endif %}

            {# Milestone icon badge #}
            <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 items-start sm:items-center">
              <span class="text-[10px] font-mono font-bold uppercase tracking-wider shrink-0
                {% if forloop.first %}text-[var(--team-primary)] bg-[var(--team-primary)]/10 px-2.5 py-1 rounded-lg
                {% else %}text-slate-500{% endif %}">
                {{ entry.timestamp|date:"M d, Y" }}
              </span>
              {% if not forloop.first %}<div class="h-px w-6 bg-white/10 hidden sm:block shrink-0"></div>{% endif %}
              <div class="flex items-center gap-2">
                {% if entry.milestone_type == 'TROPHY' or entry.milestone_type == 'trophy' %}
                <span class="text-amber-400">ğŸ†</span>
                {% elif entry.milestone_type == 'TRANSFER' or entry.milestone_type == 'transfer' %}
                <span class="text-blue-400">ğŸ‘¤</span>
                {% elif entry.milestone_type == 'FOUNDED' or entry.milestone_type == 'founded' %}
                <span class="text-emerald-400">ğŸš©</span>
                {% elif entry.milestone_type == 'RANK_UP' %}
                <span class="text-purple-400">ğŸ“ˆ</span>
                {% elif entry.milestone_type == 'CUSTOM' %}
                <span class="text-[var(--team-primary)]">â­</span>
                {% endif %}
                <h4 class="{% if forloop.first %}text-white text-base{% else %}text-slate-200 text-sm{% endif %} font-bold">{{ entry.title }}</h4>
              </div>
            </div>
            {% if entry.description %}
            <p class="text-sm {% if forloop.first %}text-slate-400{% else %}text-slate-500{% endif %} mt-2 max-w-2xl leading-relaxed">
              {{ entry.description }}
            </p>
            {% endif %}
          </div>
          {% endfor %}
          </div>
        </div>
      </section>
      {% endif %}

      {# â”€â”€ COMMUNITY / ANNOUNCEMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      {% if announcements %}
      <section id="community" class="animate-fade-in-up delay-300">
        <div class="mb-8">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-white font-display font-bold text-lg flex items-center gap-2">
              <span class="w-1 h-5 bg-[#5865F2] rounded-full"></span>
              Team Transmission
            </h3>
            <button class="text-[10px] font-mono font-bold uppercase tracking-widest text-slate-500 hover:text-white transition-colors flex items-center gap-1">
              Open Community App
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
            </button>
          </div>

          <div class="flex flex-col gap-3">
            {% for ann in announcements %}
            <div class="p-5 rounded-2xl bg-[#0A0A0F] border border-white/10 hover:border-white/20 transition-colors">
              <div class="flex gap-4">
                <div class="shrink-0 relative">
                  {% if ann.author_avatar %}
                  <img src="{{ ann.author_avatar }}" class="w-10 h-10 rounded-xl border border-white/10 object-cover" alt="{{ ann.author_name }}">
                  {% else %}
                  <div class="w-10 h-10 rounded-xl bg-black border border-white/10 flex items-center justify-center text-[var(--team-primary)]">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z"/></svg>
                  </div>
                  {% endif %}
                </div>
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-1">
                    <span class="font-bold text-white text-sm">{{ ann.author_name|default:team.name }}</span>
                    <svg class="w-3 h-3 text-[var(--team-primary)]" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                    <span class="text-[10px] text-slate-500 font-mono">{{ ann.created_at|timesince }} ago</span>
                    {% if ann.pinned %}
                    <span class="ml-auto flex items-center gap-1 text-[9px] font-bold text-slate-400 bg-white/5 px-2 py-0.5 rounded-full uppercase tracking-wide">
                      <svg class="w-2.5 h-2.5" fill="currentColor" viewBox="0 0 20 20"><path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"/></svg> Pinned
                    </span>
                    {% endif %}
                  </div>
                  <p class="text-sm text-slate-300 leading-relaxed mb-3">{{ ann.content }}</p>

                  {% if ann.image %}
                  <div class="relative w-full h-48 rounded-xl overflow-hidden mb-3 border border-white/5 group-hover:border-white/10 transition-colors">
                    <img src="{{ ann.image }}" class="absolute inset-0 w-full h-full object-cover" alt="Announcement media">
                    <div class="absolute inset-0 bg-black/20"></div>
                  </div>
                  {% endif %}

                  <div class="flex items-center gap-6 text-slate-500 text-xs font-mono">
                    <button class="flex items-center gap-2 hover:text-[var(--team-primary)] transition-colors">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
                      <span>{{ ann.likes_count|default:"0" }}</span>
                    </button>
                    <button class="flex items-center gap-2 hover:text-white transition-colors">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                      <span>{{ ann.comments_count|default:"0" }}</span>
                    </button>
                    <button class="flex items-center gap-2 hover:text-green-400 transition-colors ml-auto">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
                      <span>Share</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </section>
      {% endif %}

      {# â”€â”€ UP NEXT (moved to main column) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      {% if upcoming_matches %}
      {% with next_match=upcoming_matches.0 %}
      <section id="up-next">
        <div class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-[#0A0A0F] to-[#121216] border border-[var(--team-primary)]/20 hover:border-[var(--team-primary)]/40 transition-all p-5 md:p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-white font-display font-bold text-lg flex items-center gap-2">
              <span class="w-1 h-5 bg-[var(--team-primary)] rounded-full"></span>
              Up Next
            </h3>
            {% if next_match.scheduled_time %}
            <span class="px-3 py-1 rounded-full bg-[var(--team-primary)]/10 border border-[var(--team-primary)]/20 text-[var(--team-primary)] text-[10px] font-bold uppercase tracking-widest">{{ next_match.scheduled_time|date:"D, M d Â· H:i" }}</span>
            {% endif %}
          </div>
          <div class="flex flex-col md:flex-row items-center gap-6">
            <div class="flex-1 flex items-center justify-between gap-6">
              <div class="flex items-center gap-3">
                <div class="w-14 h-14 rounded-xl bg-[var(--team-primary)]/10 border border-[var(--team-primary)]/30 flex items-center justify-center p-2">
                  {% if team.logo_url %}
                  <img src="{{ team.logo_url }}" class="w-10 h-10 object-contain" alt="{{ team.name }}">
                  {% else %}
                  <svg class="w-10 h-10 text-[var(--team-primary)]" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z"/></svg>
                  {% endif %}
                </div>
                <div>
                  <div class="font-bold text-white text-sm">{{ team.name }}</div>
                  {% if team.rank %}<div class="text-[10px] text-slate-500 font-mono">Rank #{{ team.rank }}</div>{% endif %}
                </div>
              </div>
              <div class="text-center">
                <div class="text-xs font-mono text-slate-500 mb-1">{{ next_match.format|default:"BO3" }}</div>
                <div class="text-2xl font-display font-bold text-white">VS</div>
              </div>
              <div class="flex items-center gap-3">
                <div>
                  <div class="font-bold text-white text-sm text-right">{{ next_match.opponent_name|default:"TBD" }}</div>
                  {% if next_match.opponent_rank %}<div class="text-[10px] text-slate-500 text-right font-mono">Rank #{{ next_match.opponent_rank }}</div>{% endif %}
                </div>
                <div class="w-14 h-14 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center p-2">
                  <div class="w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center text-red-500 font-bold text-xs">{{ next_match.opponent_name|truncatechars:3|upper }}</div>
                </div>
              </div>
            </div>
            <div class="shrink-0 flex flex-col items-center gap-2">
              <div class="text-xs text-slate-400">{{ next_match.tournament_name|default:"Tournament" }}</div>
              <button class="px-6 py-2.5 rounded-xl bg-white text-black font-bold uppercase text-[10px] tracking-widest hover:bg-slate-200 transition dc-set-reminder"
                      data-match-id="{{ next_match.id|default:'' }}">
                Set Reminder
              </button>
            </div>
          </div>
        </div>
      </section>
      {% endwith %}
      {% endif %}

      {# â”€â”€ MATCH HISTORY (moved to main column) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      {% if match_history %}
      <section id="match-history">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-white font-display font-bold text-lg flex items-center gap-2">
            <span class="w-1 h-5 bg-[var(--team-primary)] rounded-full"></span>
            Match History
          </h3>
          <div class="flex bg-[#0A0A0F] border border-white/10 rounded-lg p-1 gap-1">
            <button class="px-3 py-1 rounded-md bg-white/10 text-[10px] font-bold text-white uppercase tracking-wider shadow-sm transition-all dc-history-filter" data-filter="all">All</button>
            <button class="px-3 py-1 rounded-md hover:bg-white/5 text-[10px] font-bold text-slate-500 hover:text-white uppercase tracking-wider transition-colors dc-history-filter" data-filter="official">Official</button>
            <button class="px-3 py-1 rounded-md hover:bg-white/5 text-[10px] font-bold text-slate-500 hover:text-white uppercase tracking-wider transition-colors dc-history-filter" data-filter="scrims">Scrims</button>
          </div>
        </div>

        <div class="flex flex-col gap-3">
          {% for match in match_history %}
          {% with is_win=match.result|lower %}
          {% with is_finals=match.match_type|lower %}
          <div class="relative group rounded-xl border {% if is_finals == 'finals' %}border-[var(--team-primary)]/20{% else %}border-white/5{% endif %} bg-[#0E0E12] overflow-hidden {% if is_win == 'win' %}hover:border-emerald-500/30{% else %}hover:border-red-500/30{% endif %} transition-smooth hover-lift"
               data-match-type="{{ match.match_type|default:'official'|lower }}">
            <div class="absolute inset-0 bg-gradient-to-r {% if is_win == 'win' %}from-emerald-500/10{% else %}from-red-500/10{% endif %} via-transparent to-transparent opacity-50 group-hover:opacity-100 transition-opacity"></div>
            <div class="absolute left-0 top-0 bottom-0 w-1 {% if is_finals == 'finals' %}bg-[var(--team-primary)]{% elif is_win == 'win' %}bg-emerald-500{% else %}bg-red-500{% endif %}"></div>

            <div class="relative p-3 md:p-4 flex flex-col md:flex-row items-center gap-4">
              <div class="w-full md:w-28 shrink-0 flex flex-row md:flex-col justify-between md:justify-center items-center md:items-start gap-1">
                {% if match.match_type %}
                <div class="flex items-center gap-2 mb-0.5">
                  <span class="px-1.5 py-0.5 rounded-[4px] {% if is_finals == 'finals' %}bg-[var(--team-primary)] text-black border-[var(--team-primary)]{% else %}bg-white/10 text-white border-white/5{% endif %} text-[9px] font-bold border">{{ match.match_type|upper }}</span>
                </div>
                {% endif %}
                {% if match.tournament_name %}
                <div class="text-xs font-bold text-white leading-tight">{{ match.tournament_name }}</div>
                {% endif %}
                {% if match.date %}
                <div class="text-[10px] text-slate-500 font-mono mt-0.5">{{ match.date|timesince }} ago</div>
                {% endif %}
              </div>

              <div class="flex-1 flex items-center justify-center w-full md:w-auto border-t md:border-t-0 md:border-l border-white/5 pt-3 md:pt-0 md:pl-4 md:pr-4">
                <div class="flex flex-col items-center justify-center gap-1 w-20 text-center">
                  <div class="w-10 h-10 rounded bg-[#0A0A0F] border border-white/10 p-1.5 shrink-0 {% if is_win != 'win' %}grayscale opacity-70{% endif %} {% if is_finals == 'finals' and is_win == 'win' %}shadow-[0_0_15px_rgba(255,215,0,0.4)]{% elif is_win == 'win' %}shadow-[0_0_15px_rgba(0,0,0,0.5)]{% endif %} relative z-10">
                    {% if team.logo_url %}
                    <img src="{{ team.logo_url }}" class="w-full h-full object-contain" alt="{{ team.tag }}">
                    {% else %}
                    <svg class="w-full h-full text-[var(--team-primary)]" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z"/></svg>
                    {% endif %}
                  </div>
                  <span class="text-[10px] font-bold {% if is_win == 'win' %}text-white{% else %}text-slate-400{% endif %} uppercase tracking-tight leading-none">{{ team.tag|default:team.name|truncatechars:6 }}</span>
                </div>

                <div class="px-2 md:px-4">
                  <div class="text-2xl font-display font-bold text-white tracking-widest leading-none bg-[#000]/40 px-3 py-1 rounded {% if is_finals == 'finals' %}border border-[var(--team-primary)]/30 shadow-[0_0_15px_var(--team-glow)]{% else %}border border-white/10{% endif %} backdrop-blur-sm">
                    {% if match.score_parts %}
                    <span class="{% if is_win == 'win' %}text-emerald-400 drop-shadow-[0_0_8px_rgba(52,211,153,0.4)]{% elif is_finals == 'finals' %}text-[var(--team-primary)]{% else %}text-slate-600{% endif %}">{{ match.score_parts.0 }}</span>:<span class="{% if is_win == 'win' %}text-slate-600{% else %}text-white{% endif %}">{{ match.score_parts.1 }}</span>
                    {% else %}
                    {{ match.score|default:"â€”" }}
                    {% endif %}
                  </div>
                </div>

                <div class="flex flex-col items-center justify-center gap-1 w-20 text-center">
                  <div class="w-10 h-10 rounded bg-[#0A0A0F] border border-white/10 flex items-center justify-center font-display font-bold text-xs {% if is_win == 'win' %}text-slate-500{% else %}text-white{% endif %} shrink-0 relative z-10">
                    {{ match.opponent_name|truncatechars:3|upper }}
                  </div>
                  <span class="text-[10px] font-bold {% if is_win == 'win' %}text-slate-500{% else %}text-white{% endif %} uppercase tracking-tight leading-none">{{ match.opponent_name|truncatechars:8 }}</span>
                </div>
              </div>

              {# Per-map score breakdowns #}
              {% if match.maps %}
              <div class="w-full md:w-auto flex flex-row md:flex-col gap-2 md:gap-1 justify-center items-center md:items-end md:pl-4 md:border-l border-white/5 pt-3 md:pt-0 border-t md:border-t-0 shrink-0">
                {% for map in match.maps %}
                <div class="flex items-center gap-2">
                  <span class="text-[9px] uppercase tracking-wider text-slate-500 font-mono hidden sm:inline">{{ map.name }}</span>
                  <span class="text-[10px] font-bold {% if map.won %}text-emerald-400 bg-emerald-400/10 border-emerald-400/20{% else %}text-red-400 bg-red-400/10 border-red-400/20{% endif %} px-1.5 rounded border">{{ map.score }}</span>
                </div>
                {% endfor %}
              </div>
              {% elif is_finals == 'finals' and is_win == 'win' %}
              <div class="w-full md:w-auto flex flex-row md:flex-col gap-2 md:gap-1 justify-center items-center md:items-end md:pl-4 md:border-l border-white/5 pt-3 md:pt-0 border-t md:border-t-0 shrink-0">
                <span class="text-[9px] font-bold text-[var(--team-primary)] uppercase tracking-widest">ğŸ† WON SERIES</span>
              </div>
              {% endif %}
            </div>
          </div>
          {% endwith %}
          {% endwith %}
          {% endfor %}
        </div>

        <button class="w-full mt-4 py-4 rounded-xl border border-dashed border-white/10 text-[10px] font-mono uppercase tracking-widest text-slate-500 hover:text-white hover:border-white/30 hover:bg-white/5 transition flex items-center justify-center gap-2 group dc-view-full-history"
                data-team-slug="{{ team.slug }}">
          View Complete Match History
          <svg class="w-3 h-3 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
        </button>
      </section>
      {% endif %}

      {# Trophy Cabinet + Challenge Hub moved to right sidebar #}

      {# â”€â”€ MEDIA & HIGHLIGHTS (moved to main column) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      {% if media_highlights.has_content %}
      <section id="media">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-white font-display font-bold text-lg flex items-center gap-2">
            <span class="w-1 h-5 bg-[var(--team-primary)] rounded-full"></span>
            Highlights & Media
          </h3>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4" style="min-height:280px">
          {# Featured highlights span 2 cols #}
          {% for highlight in media_highlights.highlights %}
          <div class="{% if forloop.first %}md:col-span-2 min-h-[280px] md:min-h-[340px]{% else %}min-h-[160px]{% endif %} relative group rounded-2xl overflow-hidden bg-[#0A0A0F] border border-white/10 cursor-pointer hover:border-[var(--team-primary)]/40 transition-colors dc-media-item"
               data-media-type="video" data-media-url="{{ highlight.url }}" data-media-title="{{ highlight.title|default:'Highlight' }}" data-media-thumb="{{ highlight.thumbnail|default:'' }}">
            {% if highlight.thumbnail %}
            <img src="{{ highlight.thumbnail }}" class="absolute inset-0 w-full h-full object-cover opacity-60 group-hover:opacity-80 group-hover:scale-105 transition-all duration-700" alt="{{ highlight.title }}" loading="lazy">
            {% endif %}
            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/30 to-transparent"></div>
            {# Play button #}
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-[var(--team-primary)]/20 backdrop-blur-sm border border-[var(--team-primary)]/60 flex items-center justify-center group-hover:scale-110 group-hover:bg-[var(--team-primary)]/30 transition-all duration-300 shadow-[0_0_30px_var(--team-glow)]">
                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-[var(--team-primary)] ml-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
              </div>
            </div>
            <div class="absolute bottom-0 left-0 w-full p-4 {% if forloop.first %}sm:p-6{% endif %}">
              {% if highlight.badge %}
              <div class="inline-flex items-center gap-2 px-2 py-1 rounded bg-red-600 text-white text-[9px] font-bold uppercase tracking-wider mb-2">
                <span class="animate-pulse w-1.5 h-1.5 rounded-full bg-white"></span> {{ highlight.badge }}
              </div>
              {% endif %}
              <h4 class="{% if forloop.first %}text-lg sm:text-2xl{% else %}text-sm{% endif %} font-display font-bold text-white leading-tight {% if forloop.first %}mb-1{% endif %}">{{ highlight.title }}</h4>
              {% if highlight.description and forloop.first %}
              <p class="text-xs text-slate-300 line-clamp-1 mt-1">{{ highlight.description }}</p>
              {% endif %}
            </div>
            {% if highlight.duration %}
            <div class="absolute top-2 right-2 px-1.5 py-0.5 rounded bg-black/60 text-[9px] font-mono font-bold text-white border border-white/10">{{ highlight.duration }}</div>
            {% endif %}
          </div>
          {% endfor %}

          {# Media clips column (images/uploads) #}
          {% if media_highlights.media %}
          <div class="flex flex-col gap-4 {% if not media_highlights.highlights %}md:col-span-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3{% endif %}">
            {% for item in media_highlights.media %}
            <div class="{% if media_highlights.highlights %}flex-1{% endif %} relative group rounded-xl overflow-hidden bg-[#0A0A0F] border border-white/10 cursor-pointer hover:border-white/20 transition-colors min-h-[140px] dc-media-item"
                 data-media-type="{{ item.file_type|default:'image' }}" data-media-url="{{ item.url }}" data-media-title="{{ item.title|default:'Media' }}">
              {% if item.url %}
                {% if item.file_type == 'video' %}
                <video src="{{ item.url }}" class="absolute inset-0 w-full h-full object-cover opacity-50 group-hover:opacity-70 transition-opacity" muted preload="metadata"></video>
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                  <div class="w-10 h-10 rounded-full bg-white/10 backdrop-blur-sm border border-white/20 flex items-center justify-center">
                    <svg class="w-4 h-4 text-white ml-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                  </div>
                </div>
                {% else %}
                <img src="{{ item.url }}" class="absolute inset-0 w-full h-full object-cover opacity-50 group-hover:opacity-70 transition-opacity" alt="{{ item.title|default:'Media' }}" loading="lazy">
                {% endif %}
              {% endif %}
              <div class="absolute inset-0 bg-gradient-to-t from-black/90 to-transparent"></div>
              <div class="absolute bottom-0 left-0 p-3">
                {% if item.category %}
                <div class="text-[9px] font-mono text-[var(--team-primary)] mb-0.5">{{ item.category|upper }}</div>
                {% endif %}
                <div class="text-sm font-bold text-white">{{ item.title|default:"Media" }}</div>
              </div>
              {% if item.duration %}
              <div class="absolute top-2 right-2 px-1.5 py-0.5 rounded bg-black/60 text-[9px] font-mono font-bold text-white border border-white/10">{{ item.duration }}</div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </section>
      {% endif %}

    </div>{# /lg:col-span-8 #}

    {# â”€â”€ RIGHT SIDEBAR (4 cols) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
    <div class="lg:col-span-4 flex flex-col gap-6">

      {# â”€â”€ UPCOMING MATCH (Up Next) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      {% if upcoming_matches %}
      {% with match=upcoming_matches.0 %}
      <div class="relative overflow-hidden rounded-3xl bg-[#0A0A0F] border border-white/10 hover:border-[var(--team-primary)]/30 transition-colors">
        <div class="relative bg-white/5 px-5 py-3 flex items-center justify-between border-b border-white/10">
          <span class="text-[10px] font-mono font-bold uppercase tracking-widest text-[var(--team-primary)]">Up Next</span>
          {% if match.scheduled_time %}
          <span class="text-[10px] text-slate-400">{{ match.scheduled_time|date:"M d, H:i" }}</span>
          {% endif %}
        </div>
        <div class="p-5 sm:p-6 flex flex-col items-center">
          <div class="flex items-center gap-4 sm:gap-6 w-full justify-center mb-4">
            {# Our team #}
            <div class="flex flex-col items-center gap-2">
              <div class="w-14 h-14 sm:w-16 sm:h-16 rounded-2xl bg-white/5 border border-white/10 grid place-items-center p-2 overflow-hidden">
                {% if team.logo %}
                <img src="{{ team.logo.url }}" alt="{{ team.name }}" class="w-full h-full object-contain">
                {% else %}
                <span class="text-lg font-bold text-[var(--team-primary)]">{{ team.tag|default:team.name|truncatechars:3 }}</span>
                {% endif %}
              </div>
              <span class="text-[9px] text-white/60 font-bold uppercase truncate max-w-[80px]">{{ team.tag|default:team.name|truncatechars:8 }}</span>
            </div>
            <div class="text-xs font-mono text-slate-500 font-bold">VS</div>
            {# Opponent #}
            <div class="flex flex-col items-center gap-2">
              <div class="w-14 h-14 sm:w-16 sm:h-16 rounded-2xl bg-white/5 border border-white/10 grid place-items-center p-2">
                <span class="text-base font-bold text-red-400">{{ match.opponent_name|truncatechars:4 }}</span>
              </div>
              <span class="text-[9px] text-white/60 font-bold uppercase truncate max-w-[80px]">{{ match.opponent_name|truncatechars:8 }}</span>
            </div>
          </div>
          {% if match.tournament_name %}
          <h4 class="text-white font-display font-bold text-base sm:text-lg text-center mb-1">{{ match.tournament_name|truncatechars:40 }}</h4>
          {% endif %}
          <p class="text-[10px] text-slate-500 mb-5">{{ match.format|default:"BO1" }}</p>
          {% if match.stream_url %}
          <a href="{{ match.stream_url }}" target="_blank" rel="noopener"
             class="w-full py-2.5 rounded-xl bg-white text-black font-bold uppercase text-[10px] tracking-widest hover:bg-slate-200 transition text-center">
            Watch Live
          </a>
          {% else %}
          <button class="w-full py-2.5 rounded-xl bg-white/10 text-slate-300 font-bold uppercase text-[10px] tracking-widest hover:bg-white/15 transition cursor-default">
            Coming Soon
          </button>
          {% endif %}
        </div>
      </div>
      {% endwith %}
      {% endif %}

      {# â”€â”€ TRYOUTS OPEN (Recruitment) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      {# Hide the entire tryouts card from team members â€” only public visitors see it #}
      {% if team.is_recruiting and recruitment.positions and viewer.role == 'PUBLIC' %}
      <div class="relative group bg-[#0A0A0F] border border-[var(--team-primary)]/30 hover:border-[var(--team-primary)]/50 rounded-3xl p-6 transition-all overflow-hidden">
        <div class="absolute -right-4 -bottom-4 opacity-10 text-[var(--team-primary)] transform -rotate-12 group-hover:scale-110 transition-transform">
          <svg class="w-32 h-32" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
        </div>
        <div class="relative z-10 flex flex-col h-full justify-between">
          <div>
            <div class="flex items-center justify-between mb-3">
              <h4 class="text-white font-display font-bold text-lg">Tryouts Open</h4>
              <span class="px-2 py-0.5 rounded bg-[#00FF41]/10 border border-[#00FF41]/20 text-[#00FF41] text-[9px] font-bold uppercase tracking-widest animate-pulse">Recruiting</span>
            </div>
            {% if recruitment.positions.0.short_pitch %}
            <p class="text-xs text-slate-400 leading-relaxed mb-4">{{ recruitment.positions.0.short_pitch }}</p>
            {% else %}
            <p class="text-xs text-slate-400 leading-relaxed mb-4">{{ team.name }} is looking for new members. Think you have what it takes? Apply now!</p>
            {% endif %}
            <div class="flex flex-wrap gap-2 mb-6">
              {% for pos in recruitment.positions %}
              <span class="px-2 py-1 bg-white/5 border border-white/10 text-[9px] text-slate-300 font-mono rounded uppercase">{{ pos.title|default:pos.role_category }}</span>
              {% if pos.rank_requirement %}
              <span class="px-2 py-1 bg-[var(--team-primary)]/10 border border-[var(--team-primary)]/20 text-[9px] text-[var(--team-primary)] font-mono rounded uppercase">{{ pos.rank_requirement }}</span>
              {% endif %}
              {% endfor %}
            </div>
          </div>

          {% if pending_actions.can_request_to_join %}
          <button class="w-full py-3 rounded-xl bg-[var(--team-primary)] text-black font-bold uppercase text-[10px] tracking-widest hover:brightness-110 transition shadow-[0_0_15px_var(--team-glow)] dc-apply-btn"
                  data-team-slug="{{ team.slug }}">
            <svg class="w-4 h-4 inline -mt-0.5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
            Apply for Tryout
          </button>
          {% elif pending_actions.has_pending_request %}
          <div class="w-full py-3 rounded-xl bg-white/10 text-slate-400 font-bold uppercase text-[10px] tracking-widest text-center">
            <svg class="w-4 h-4 inline -mt-0.5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            Application Pending
          </div>
          {% elif pending_actions.has_pending_invite %}
          <div class="flex gap-2">
            <button class="flex-1 py-3 rounded-xl bg-[var(--team-primary)] text-black font-bold uppercase text-[10px] tracking-widest hover:brightness-110 transition dc-invite-accept"
                    data-invite-id="{{ pending_actions.pending_invite_id }}">Accept</button>
            <button class="flex-1 py-3 rounded-xl bg-white/10 text-slate-400 font-bold uppercase text-[10px] tracking-widest hover:bg-white/20 transition dc-invite-decline"
                    data-invite-id="{{ pending_actions.pending_invite_id }}">Decline</button>
          </div>
          {% else %}
          {# Non-member / non-logged-in user â€” show sign-in or generic tryout CTA #}
          {% if user.is_authenticated and pending_actions.can_request_to_join %}
          <button class="w-full py-3 rounded-xl bg-[var(--team-primary)] text-black font-bold uppercase text-[10px] tracking-widest hover:brightness-110 transition shadow-[0_0_15px_var(--team-glow)] dc-apply-btn"
                  data-team-slug="{{ team.slug }}">
            <svg class="w-4 h-4 inline -mt-0.5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
            Apply for Tryout
          </button>
          {% else %}
          <a href="{% url 'account_login' %}?next={{ request.path }}"
             class="w-full py-3 rounded-xl bg-[var(--team-primary)] text-black font-bold uppercase text-[10px] tracking-widest hover:brightness-110 transition shadow-[0_0_15px_var(--team-glow)] text-center block">
            <svg class="w-4 h-4 inline -mt-0.5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
            Sign In to Apply
          </a>
          {% endif %}
          {% endif %}
        </div>
      </div>
      {% elif team.is_recruiting and viewer.role == 'PUBLIC' %}
      {# Recruiting but no positions defined yet â€” simple card (public only) #}
      <div class="rounded-3xl bg-[#0A0A0F] border border-emerald-500/20 p-5 text-center">
        <div class="w-10 h-10 rounded-xl bg-emerald-500/10 grid place-items-center mx-auto mb-3">
          <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
        </div>
        <h4 class="text-white font-bold text-sm mb-1">We're Recruiting!</h4>
        <p class="text-[10px] text-slate-400">{{ team.name }} is looking for new talent.</p>
      </div>
      {% endif %}

      {# â”€â”€ CHALLENGE HUB (sidebar) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <div class="rounded-3xl bg-gradient-to-br from-[#0A0A0F] to-[#1a1015] border border-red-500/20 overflow-hidden">
        <div class="bg-gradient-to-r from-red-600/10 to-orange-600/10 px-5 py-4 border-b border-red-500/20">
          <div class="flex items-center justify-between mb-1">
            <h4 class="text-white font-display font-bold text-sm flex items-center gap-2">
              <svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
              Challenge Hub
            </h4>
            {% if challenges.open_count %}
            <span class="px-2 py-0.5 rounded-full bg-green-500/10 border border-green-500/30 text-green-400 text-[8px] font-bold uppercase tracking-wider animate-pulse">
              <span class="inline-block w-1 h-1 rounded-full bg-green-400 mr-1"></span>{{ challenges.open_count }} Open
            </span>
            {% endif %}
          </div>
          <p class="text-[10px] text-slate-400">Compete for prizes & reputation</p>
        </div>

        <div class="p-4 space-y-3">
          {% if challenges.items %}
          {% for challenge in challenges.items %}
          <div class="relative group p-4 rounded-xl bg-gradient-to-br from-red-950/30 to-orange-950/20 border border-red-500/30 hover:border-red-500/50 transition-all cursor-pointer">
            <div class="absolute top-2 right-2">
              <span class="px-1.5 py-0.5 rounded bg-green-500/20 border border-green-500/30 text-green-400 text-[8px] font-bold uppercase">{{ challenge.status|default:"Open" }}</span>
            </div>

            <div class="mb-3">
              <div class="flex items-center gap-2 mb-1">
                {% if challenge.category %}
                <div class="px-1.5 py-0.5 rounded {% if challenge.category == 'wager' %}bg-yellow-500/10 border border-yellow-500/20 text-yellow-400{% elif challenge.category == 'community' %}bg-purple-500/10 border border-purple-500/20 text-purple-400{% else %}bg-white/10 border border-white/10 text-white{% endif %} text-[8px] font-bold uppercase tracking-wider">
                  {% if challenge.category == 'wager' %}ğŸ’° Wager{% elif challenge.category == 'community' %}ğŸ¯ Community{% else %}âš”ï¸ {{ challenge.category|title }}{% endif %}
                </div>
                {% endif %}
                {% if challenge.format %}
                <div class="text-[9px] text-slate-500 font-mono">{{ challenge.format }}</div>
                {% endif %}
              </div>
              <h5 class="text-white font-bold text-sm mb-1">{{ challenge.title }}</h5>
              {% if challenge.description %}
              <p class="text-[10px] text-slate-400 leading-relaxed mb-2">{{ challenge.description|truncatewords:20 }}</p>
              {% endif %}
            </div>

            {% if challenge.prize_amount %}
            <div class="flex items-center justify-between text-[10px] mb-3">
              <div class="flex items-center gap-2">
                <div class="w-6 h-6 rounded bg-[var(--team-primary)]/20 border border-[var(--team-primary)]/30 flex items-center justify-center text-[8px] font-bold text-[var(--team-primary)]">{{ team.tag|truncatechars:2 }}</div>
                <span class="text-white font-mono">vs</span>
                <div class="w-6 h-6 rounded bg-white/5 border border-white/10 border-dashed flex items-center justify-center text-[8px] text-slate-500">?</div>
              </div>
              <div class="text-right">
                <div class="text-[8px] text-slate-500 uppercase font-bold">Prize{% if challenge.prize_type == 'cp' %} (CP){% endif %}</div>
                <div class="text-lg font-display font-bold text-yellow-400">{% if challenge.prize_type == 'cp' %}{{ challenge.prize_amount }} CP{% else %}${{ challenge.prize_amount }}{% endif %}</div>
              </div>
            </div>
            {% endif %}

            <div class="flex gap-2">
              <button class="flex-1 py-2 rounded-lg bg-red-600 hover:bg-red-500 text-white text-[9px] font-bold uppercase tracking-widest transition shadow-lg dc-challenge-accept" data-challenge-id="{{ challenge.id }}">
                Accept
              </button>
              <button class="px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition dc-challenge-info" data-challenge-id="{{ challenge.id }}">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </button>
            </div>

            {% if challenge.expires_at %}
            <div class="mt-3 pt-3 border-t border-red-500/10 flex items-center justify-between">
              <span class="text-[9px] text-slate-500 uppercase font-mono">Expires in</span>
              <span class="text-[9px] font-mono font-bold text-red-400 dc-countdown" data-expires="{{ challenge.expires_at|date:'c' }}">â€”</span>
            </div>
            {% endif %}
          </div>
          {% endfor %}

          {# Challenge Stats Summary #}
          {% if challenges.stats %}
          <div class="p-3 rounded-xl bg-white/[0.02] border border-white/5">
            <div class="grid grid-cols-3 gap-3 text-center">
              <div>
                <div class="text-lg font-display font-bold text-emerald-400">{{ challenges.stats.wins|default:"0" }}</div>
                <div class="text-[8px] text-slate-500 uppercase font-bold tracking-wider">Wins</div>
              </div>
              <div>
                <div class="text-lg font-display font-bold text-red-400">{{ challenges.stats.losses|default:"0" }}</div>
                <div class="text-[8px] text-slate-500 uppercase font-bold tracking-wider">Losses</div>
              </div>
              <div>
                <div class="text-lg font-display font-bold text-yellow-400">${{ challenges.stats.total_earned|default:"0" }}</div>
                <div class="text-[8px] text-slate-500 uppercase font-bold tracking-wider">Earned</div>
              </div>
            </div>
          </div>
          {% endif %}

          {% else %}
          {# Empty state #}
          <div class="py-6 text-center">
            <div class="text-3xl mb-3 opacity-30">âš”ï¸</div>
            <p class="text-xs text-slate-500 mb-1">No active challenges</p>
            <p class="text-[10px] text-slate-600 mb-3">Issue or accept challenges to compete.</p>
          </div>
          {% endif %}

          <button class="w-full py-2.5 rounded-lg bg-red-600/90 hover:bg-red-600 text-white text-[9px] font-bold uppercase tracking-wider transition shadow-[0_0_15px_rgba(220,38,38,0.3)] flex items-center justify-center gap-2 dc-issue-challenge" data-team-slug="{{ team.slug }}">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
            Issue Challenge
          </button>
        </div>
      </div>

      {# â”€â”€ TROPHY CABINET (sidebar) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <div class="rounded-3xl bg-[#0A0A0F] border border-white/10 overflow-hidden">
        <div class="px-5 py-4 border-b border-white/5">
          <h4 class="text-white font-display font-bold text-sm flex items-center gap-2">
            <span class="w-1 h-4 bg-[var(--team-primary)] rounded-full"></span>
            Trophy Cabinet
            {% if trophy_cabinet %}
            <span class="ml-auto text-[10px] font-mono text-slate-500">{{ trophy_cabinet|length }}</span>
            {% endif %}
          </h4>
        </div>
        <div class="p-4 space-y-3">
          {% if trophy_cabinet %}
          {% for trophy in trophy_cabinet %}
          <div class="relative group p-4 rounded-xl bg-gradient-to-br from-[#0A0A0F] to-[#1a1a20] border border-white/10 overflow-hidden hover:-translate-y-0.5 transition-transform duration-300">
            <div class="absolute top-0 right-0 w-16 h-16 {% if trophy.placement == 1 or trophy.placement_label == '1st Place' %}bg-[var(--team-primary)]{% elif trophy.placement == 2 or trophy.placement_label == '2nd Place' %}bg-slate-300{% elif trophy.placement == 3 or trophy.placement_label == '3rd Place' %}bg-orange-700{% else %}bg-[var(--team-primary)]{% endif %} blur-[40px] {% if trophy.placement == 1 or trophy.placement_label == '1st Place' %}opacity-10{% else %}opacity-5{% endif %} group-hover:opacity-20 transition-opacity"></div>

            <div class="relative z-10 flex items-center gap-3">
              <div class="text-2xl filter {% if trophy.placement == 1 or trophy.placement_label == '1st Place' %}drop-shadow-[0_0_8px_rgba(255,215,0,0.5)]{% elif trophy.placement == 3 or trophy.placement_label == '3rd Place' %}drop-shadow-[0_0_8px_rgba(205,127,50,0.2)]{% else %}drop-shadow-[0_0_8px_rgba(255,255,255,0.2)]{% endif %}">{{ trophy.emoji|default:"ğŸ†" }}</div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 mb-0.5">
                  <span class="px-1.5 py-0.5 rounded border {% if trophy.placement == 2 or trophy.placement_label == '2nd Place' %}border-slate-400/30 bg-slate-400/10 text-slate-300{% elif trophy.placement == 3 or trophy.placement_label == '3rd Place' %}border-orange-400/30 bg-orange-400/10 text-orange-400{% else %}border-[var(--team-primary)]/30 bg-[var(--team-primary)]/10 text-[var(--team-primary)]{% endif %} text-[8px] font-bold uppercase tracking-widest">{{ trophy.placement_label|default:"Winner" }}</span>
                </div>
                <h5 class="text-white font-bold text-xs leading-tight truncate">{{ trophy.tournament_name }}</h5>
                {% if trophy.date %}
                <p class="text-[9px] font-mono text-slate-500">{{ trophy.date|date:"Y" }}{% if trophy.prize %} Â· {{ trophy.prize }}{% endif %}</p>
                {% endif %}
              </div>
            </div>
          </div>
          {% endfor %}
          {% else %}
          <div class="py-6 text-center">
            <div class="text-3xl mb-3 opacity-30">ğŸ†</div>
            <p class="text-xs text-slate-500 mb-1">No trophies yet</p>
            <p class="text-[10px] text-slate-600">Compete in tournaments to earn placements.</p>
          </div>
          {% endif %}
        </div>
      </div>

      {# â”€â”€ CONNECT (social links) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      {% if streams %}
      <div class="rounded-3xl bg-[#0A0A0F] border border-white/10 p-6">
        <h4 class="text-xs font-mono font-bold uppercase tracking-widest text-slate-500 mb-4">Connect</h4>
        <div class="flex flex-wrap gap-2">
          {% for stream in streams %}
          <a href="{{ stream.url }}" target="_blank" rel="noopener noreferrer"
             class="flex-1 min-w-[44px] h-11 rounded-lg transition flex items-center justify-center text-white
                    {% if stream.platform == 'discord' %}bg-[#5865F2] hover:brightness-110{% elif stream.platform == 'twitter' or stream.platform == 'x' %}bg-[#000000] border border-white/20 hover:bg-white/10{% elif stream.platform == 'youtube' %}bg-[#FF0000] hover:brightness-110{% elif stream.platform == 'twitch' %}bg-[#9146FF] hover:brightness-110{% elif stream.platform == 'instagram' %}bg-gradient-to-br from-[#833AB4] via-[#FD1D1D] to-[#F77737] hover:brightness-110{% elif stream.platform == 'facebook' %}bg-[#1877F2] hover:brightness-110{% elif stream.platform == 'tiktok' %}bg-[#000000] border border-white/20 hover:bg-white/10{% elif stream.platform == 'website' %}bg-white/10 border border-white/20 hover:bg-white/20{% else %}bg-white/10 hover:bg-white/20{% endif %}"
             title="{{ stream.platform_name|default:stream.platform }}">
            {% if stream.platform == 'discord' %}
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
            {% elif stream.platform == 'twitter' or stream.platform == 'x' %}
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            {% elif stream.platform == 'youtube' %}
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.263-4.356 2.627-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>
            {% elif stream.platform == 'twitch' %}
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714z"/></svg>
            {% elif stream.platform == 'instagram' %}
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
            {% elif stream.platform == 'facebook' %}
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
            {% elif stream.platform == 'tiktok' %}
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>
            {% elif stream.platform == 'website' %}
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/></svg>
            {% else %}
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
            {% endif %}
          </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      {# â”€â”€ QUICK TEAM INFO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <div class="rounded-3xl bg-[#0A0A0F] border border-white/10 p-6">
        <h4 class="text-xs font-mono font-bold uppercase tracking-widest text-slate-500 mb-4">Team Info</h4>
        <div class="space-y-3 text-xs">
          {% if team.game %}
          <div class="flex items-center justify-between">
            <span class="text-slate-500">Game</span>
            <span class="text-white font-bold">{{ team.game.name }}</span>
          </div>
          {% endif %}
          {% if team.region %}
          <div class="flex items-center justify-between">
            <span class="text-slate-500">Region</span>
            <span class="text-white font-bold">{{ team.region }}</span>
          </div>
          {% endif %}
          {% if team.platform %}
          <div class="flex items-center justify-between">
            <span class="text-slate-500">Platform</span>
            <span class="text-white font-bold">{{ team.platform|upper }}</span>
          </div>
          {% endif %}
          <div class="flex items-center justify-between">
            <span class="text-slate-500">Members</span>
            <span class="text-white font-bold">{{ roster.count|default:"0" }}</span>
          </div>
          {% if team.founded_date %}
          <div class="flex items-center justify-between">
            <span class="text-slate-500">Founded</span>
            <span class="text-white font-bold">{{ team.founded_date|date:"M Y" }}</span>
          </div>
          {% endif %}
        </div>
      </div>

    </div>{# /lg:col-span-4 #}

  </div>{# /grid #}
</main>

{# Chat popup removed â€” use Team Chat link in header bar instead #}

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{# MEDIA LIGHTBOX â€” Inline video player + image viewer                       #}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
<div id="dc-media-lightbox" class="fixed inset-0 z-[200] bg-black/90 backdrop-blur-md hidden items-center justify-center"
     onclick="if(event.target===this)dcCloseLightbox()">
  <button onclick="dcCloseLightbox()" class="absolute top-4 right-4 z-10 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 border border-white/10 transition flex items-center justify-center" aria-label="Close">
    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
  </button>
  <div class="absolute top-4 left-4 z-10">
    <h4 id="dc-lightbox-title" class="text-white font-display font-bold text-base sm:text-lg"></h4>
  </div>
  <div id="dc-lightbox-content" class="w-full h-full flex items-center justify-center p-4 sm:p-8 md:p-16">
    {# Content injected by JS #}
  </div>
</div>

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{# PLAYER PROFILE POPUP                                                      #}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
<div id="dc-player-popup" class="fixed inset-0 z-[100] bg-black/70 backdrop-blur-md hidden items-center justify-center p-4"
     onclick="if(event.target===this)dcClosePlayerPopup()">
  <div class="bg-[#0A0A12] rounded-3xl border border-white/10 w-full max-w-sm shadow-2xl shadow-black/50 overflow-hidden transform transition-all duration-300 scale-95 opacity-0" id="dc-player-popup-card" onclick="event.stopPropagation()">
    {# Cover area #}
    <div class="relative h-48 bg-gradient-to-br from-[var(--team-primary)]/20 to-transparent overflow-hidden">
      <img id="pp-avatar" src="" alt="" class="absolute inset-0 w-full h-full object-cover opacity-70">
      <div class="absolute inset-0 bg-gradient-to-t from-[#0A0A12] via-[#0A0A12]/40 to-transparent"></div>
      <button onclick="dcClosePlayerPopup()" class="absolute top-3 right-3 w-8 h-8 rounded-full bg-black/40 hover:bg-black/60 border border-white/10 flex items-center justify-center transition">
        <svg class="w-4 h-4 text-white/70" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
      <div id="pp-badge" class="absolute top-3 left-3 px-2 py-0.5 rounded text-[8px] font-bold uppercase tracking-wider hidden"></div>
    </div>
    {# Info #}
    <div class="px-5 pb-5 -mt-8 relative z-10">
      <div class="mb-4">
        <div id="pp-role-tag" class="text-[9px] font-mono font-bold uppercase text-[var(--team-primary)] mb-0.5"></div>
        <h3 id="pp-display-name" class="text-xl font-display font-bold text-white"></h3>
        <div class="flex items-center gap-2 mt-1">
          <img id="pp-flag" src="" class="w-4 h-3 rounded-[2px] object-cover hidden" alt="">
          <span id="pp-username" class="text-xs text-slate-400 font-mono"></span>
        </div>
      </div>
      {# Game passport stats #}
      <div id="pp-passport" class="hidden grid grid-cols-2 gap-3 mb-4">
        <div class="p-3 rounded-xl bg-white/[0.03] border border-white/[0.06]">
          <div class="text-[8px] uppercase text-slate-500 font-bold tracking-wider mb-0.5">IGN</div>
          <div id="pp-ign" class="text-sm font-bold text-white"></div>
        </div>
        <div class="p-3 rounded-xl bg-white/[0.03] border border-white/[0.06]">
          <div class="text-[8px] uppercase text-slate-500 font-bold tracking-wider mb-0.5">Rank</div>
          <div id="pp-rank" class="text-sm font-bold text-[var(--team-primary)]"></div>
        </div>
      </div>
      {# Profile link #}
      <a id="pp-profile-link" href="#" class="w-full py-2.5 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition text-center text-xs font-bold text-white/80 uppercase tracking-wider flex items-center justify-center gap-2">
        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
        View Full Profile
      </a>
    </div>
  </div>
</div>

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{# PARTNERS / SPONSORS SECTION                                               #}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{% if sponsors %}
<section class="border-t border-white/10 bg-[#050507] py-12">
  <div class="max-w-[1600px] mx-auto px-4 sm:px-6">
    <p class="text-[10px] text-center text-slate-600 font-mono uppercase tracking-[0.2em] mb-8">Partners</p>
    <div class="flex flex-wrap justify-center items-center gap-8 md:gap-16 opacity-50 grayscale hover:grayscale-0 transition-all duration-500">
      {% for sponsor in sponsors %}
      <div class="text-xl font-display font-bold text-white tracking-tighter">{{ sponsor.name|default:sponsor }}</div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

</div>{# /relative z-10 #}