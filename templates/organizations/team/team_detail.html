{% load static %}
<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ team.name }} - Team Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-full">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Team Header -->
        <div class="bg-gray-800 rounded-lg shadow-xl overflow-hidden mb-6">
            {% if team.banner_url %}
            <div class="h-48 bg-cover bg-center" style="background-image: url('{{ team.banner_url }}');"></div>
            {% else %}
            <div class="h-48 bg-gradient-to-r from-blue-600 to-purple-600"></div>
            {% endif %}
            
            <div class="px-6 py-6">
                <div class="flex items-center gap-6">
                    <img src="{{ team.logo_url }}" alt="{{ team.name }}" class="w-24 h-24 rounded-lg border-4 border-gray-900 shadow-lg">
                    
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <h1 class="text-3xl font-bold text-white">{{ team.name }}</h1>
                            {% if team.is_organization_team %}
                            <span class="px-3 py-1 bg-purple-600 text-white text-xs font-bold rounded-full">ORG TEAM</span>
                            {% endif %}
                        </div>
                        
                        <div class="flex items-center gap-4 text-sm text-gray-400">
                            <span class="flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path>
                                </svg>
                                {{ team.region }}
                            </span>
                            
                            <span class="flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"></path>
                                </svg>
                                Game ID: {{ team.game_id }}
                            </span>
                            
                            {% if team.is_organization_team %}
                            <span class="flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                </svg>
                                <a href="/orgs/{{ team.organization_slug }}/" class="text-blue-400 hover:text-blue-300">{{ team.organization_name }}</a>
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                {% if team.description %}
                <p class="mt-4 text-gray-300">{{ team.description }}</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Error/Success Banners -->
        <div id="error-banner" class="hidden mb-4 bg-red-900 border border-red-700 text-red-100 px-6 py-4 rounded-lg shadow-lg">
            <div class="flex items-center justify-between">
                <span id="error-message"></span>
                <button onclick="document.getElementById('error-banner').classList.add('hidden')" class="text-red-300 hover:text-red-100">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
        
        <div id="success-banner" class="hidden mb-4 bg-green-900 border border-green-700 text-green-100 px-6 py-4 rounded-lg shadow-lg">
            <div class="flex items-center justify-between">
                <span id="success-message"></span>
                <button onclick="document.getElementById('success-banner').classList.add('hidden')" class="text-green-300 hover:text-green-100">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Tab Navigation -->
        <div class="bg-gray-800 rounded-lg shadow-xl mb-6">
            <div class="border-b border-gray-700">
                <nav class="flex gap-2 px-6">
                    <button id="tab-roster" class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-blue-500 text-blue-400">
                        Roster
                    </button>
                    <button id="tab-invites" class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-400 hover:text-gray-300">
                        Invites
                    </button>
                    <button id="tab-settings" class="tab-button px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-400 hover:text-gray-300">
                        Settings
                    </button>
                </nav>
            </div>
            
            <!-- Roster Tab -->
            <div id="content-roster" class="tab-content p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Team Roster</h2>
                    {% if can_manage %}
                    <button id="btn-add-member" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition">
                        + Add Member
                    </button>
                    {% endif %}
                </div>
                
                <div id="roster-list" class="space-y-4">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
            
            <!-- Invites Tab -->
            <div id="content-invites" class="tab-content hidden p-6">
                <h2 class="text-2xl font-bold mb-6">Pending Invitations</h2>
                <div id="invites-list" class="space-y-4">
                    <p class="text-gray-400">No pending invitations</p>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div id="content-settings" class="tab-content hidden p-6">
                <h2 class="text-2xl font-bold mb-6">Team Settings</h2>
                
                {% if can_manage %}
                <form id="settings-form" class="space-y-6 max-w-2xl">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Region</label>
                        <input type="text" id="input-region" value="{{ team.region }}" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Preferred Server</label>
                        <input type="text" id="input-server" value="{{ team.preferred_server|default:'' }}" placeholder="e.g., Singapore, Mumbai" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                        <textarea id="input-description" rows="4" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">{{ team.description }}</textarea>
                    </div>
                    
                    <button type="submit" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition">
                        Save Settings
                    </button>
                </form>
                {% else %}
                <p class="text-gray-400">You don't have permission to edit team settings.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Add Member Modal -->
    <div id="modal-add-member" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg shadow-2xl p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-white">Add Team Member</h3>
                <button id="close-add-member" class="text-gray-400 hover:text-gray-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="form-add-member" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">User (ID, Username, or Email)</label>
                    <input type="text" id="input-user-lookup" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Role</label>
                    <select id="input-role" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500">
                        <option value="PLAYER">Player</option>
                        <option value="SUBSTITUTE">Substitute</option>
                        <option value="COACH">Coach</option>
                        <option value="MANAGER">Manager</option>
                        <option value="ANALYST">Analyst</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Roster Slot (Optional)</label>
                    <select id="input-slot" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500">
                        <option value="">None</option>
                        <option value="STARTER">Starter</option>
                        <option value="SUBSTITUTE">Substitute</option>
                        <option value="COACH">Coach (Non-playing)</option>
                        <option value="ANALYST">Analyst (Non-playing)</option>
                    </select>
                </div>
                
                <div class="flex gap-3">
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition">
                        Add Member
                    </button>
                    <button type="button" id="cancel-add-member" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg transition">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Change Role Modal -->
    <div id="modal-change-role" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg shadow-2xl p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-white">Change Member Role</h3>
                <button id="close-change-role" class="text-gray-400 hover:text-gray-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="form-change-role" class="space-y-4">
                <p class="text-gray-300">Changing role for: <span id="change-role-username" class="font-semibold text-white"></span></p>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">New Role</label>
                    <select id="input-new-role" required class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500">
                        <option value="PLAYER">Player</option>
                        <option value="SUBSTITUTE">Substitute</option>
                        <option value="COACH">Coach</option>
                        <option value="MANAGER">Manager</option>
                        <option value="ANALYST">Analyst</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Roster Slot</label>
                    <select id="input-new-slot" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500">
                        <option value="">None</option>
                        <option value="STARTER">Starter</option>
                        <option value="SUBSTITUTE">Substitute</option>
                        <option value="COACH">Coach (Non-playing)</option>
                        <option value="ANALYST">Analyst (Non-playing)</option>
                    </select>
                </div>
                
                <div class="flex gap-3">
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition">
                        Update Role
                    </button>
                    <button type="button" id="cancel-change-role" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg transition">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Remove Member Modal -->
    <div id="modal-remove-member" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg shadow-2xl p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-white">Remove Member</h3>
                <button id="close-remove-member" class="text-gray-400 hover:text-gray-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <p class="text-gray-300 mb-6">
                Are you sure you want to remove <span id="remove-member-username" class="font-semibold text-white"></span> from the team?
            </p>
            
            <div class="flex gap-3">
                <button id="confirm-remove-member" class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition">
                    Remove Member
                </button>
                <button id="cancel-remove-member" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg transition">
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <!-- Pass data to JavaScript -->
    <script>
        window.TEAM_DATA = {{ team_data|safe }};
        window.CAN_MANAGE = {{ can_manage|yesno:"true,false" }};
        window.CSRF_TOKEN = '{{ csrf_token }}';
    </script>
    
    <!-- Load team management script -->
    <script src="{% static 'organizations/team_detail.js' %}"></script>
</body>
</html>
