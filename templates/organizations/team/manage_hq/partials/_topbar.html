{% comment %}
Topbar — Single-line smart header with breadcrumb, page title, quick actions, notifications.
{% endcomment %}
{% load static %}
<header class="sticky top-0 z-30 backdrop-blur-xl bg-[var(--bg0)]/80 border-b border-line">
    <div class="flex items-center h-12 px-3 lg:px-5 gap-2">
        {# Mobile hamburger #}
        <button id="openSidebar" aria-label="Open navigation menu"
            class="lg:hidden h-8 w-8 grid place-items-center rounded-lg bg-white/8 hover:bg-white/12 transition shrink-0">
            <i data-lucide="menu" class="w-4 h-4"></i>
        </button>

        {# ── DeltaCrown Brand Mark ── #}
        <a href="/" class="flex items-center gap-1.5 shrink-0 group" title="DeltaCrown Home">
            <img src="{% static 'img/deltaCrown_logos/logo_animated.svg' %}" alt="DeltaCrown" class="w-6 h-6 opacity-70 group-hover:opacity-100 transition" />
            <img src="{% static 'img/deltaCrown_logos/DeltaCrown_Teal-Purple-Gold.svg' %}" alt="DeltaCrown" class="h-4 opacity-40 group-hover:opacity-70 transition hidden sm:block" />
        </a>
        <div class="w-px h-5 bg-white/10 shrink-0 hidden sm:block"></div>

        {# ── Breadcrumb + Title (single line) ── #}
        <div class="flex items-center gap-1.5 min-w-0 flex-1 overflow-hidden">
            <a href="{% url 'organizations:team_detail' team.slug %}" class="text-[11px] text-white/35 hover:text-white/60 transition truncate shrink-0 hidden sm:block max-w-[100px]" title="{{ team.name }}">
                {{ team.name|truncatechars:14 }}
            </a>
            <i data-lucide="chevron-right" class="w-3 h-3 text-white/15 shrink-0 hidden sm:block"></i>
            <h2 id="pageTitle" class="text-sm font-bold truncate whitespace-nowrap">Command Center</h2>
            <span id="pageSub" class="text-[11px] text-white/40 truncate whitespace-nowrap hidden lg:block ml-1">Real-time team overview</span>
            <span id="breadcrumbSection" class="hidden">Command Center</span>
        </div>

        {# ── Dynamic Quick Actions ── #}
        <div id="topbarActions" class="hidden sm:flex items-center gap-1 shrink-0">
            {# Injected by JS per active route #}
        </div>

        {# ── Notification bell ── #}
        <div class="relative shrink-0" id="notifBellWrap">
            <button id="notifBellBtn"
                    aria-label="Notifications" aria-haspopup="true" aria-expanded="false" aria-controls="notifPanel"
                    class="relative h-8 w-8 grid place-items-center rounded-lg bg-white/8 hover:bg-white/12 transition"
                    onclick="ManageHQ.toggleNotifPanel()">
                <i data-lucide="bell" class="w-4 h-4 text-white/70"></i>
                <span id="notifBadge" aria-live="polite" aria-atomic="true"
                      class="hidden absolute -top-0.5 -right-0.5 min-w-[16px] h-[16px] rounded-full bg-red-500 text-[9px] font-bold text-white flex items-center justify-center px-0.5 pointer-events-none">
                    0
                </span>
            </button>
            <div id="notifPanel"
                 class="hidden absolute right-0 top-full mt-1 w-[calc(100vw-2rem)] sm:w-80 max-h-96 overflow-y-auto rounded-2xl border border-line bg-[var(--bg1)] shadow-2xl z-50"
                 role="region" aria-label="Notifications panel">
                <div class="flex items-center justify-between px-4 py-3 border-b border-line">
                    <span class="text-xs font-bold text-white/80">Notifications</span>
                    <button id="notifMarkAllRead" class="text-[10px] text-white/50 hover:text-white/80 transition"
                            onclick="ManageHQ.markAllNotifRead()">Mark all read</button>
                </div>
                <div id="notifList" class="divide-y divide-white/5">
                    <div class="px-4 py-6 text-center text-xs text-white/30">Loading…</div>
                </div>
                <a href="{% url 'notifications:list' %}"
                   class="block text-center text-[11px] font-semibold text-white/50 hover:text-white/80 py-2 border-t border-line transition">
                    View All Notifications
                </a>
            </div>
        </div>

        {# ── Back to team page ── #}
        <a href="{% url 'organizations:team_detail' team.slug %}" title="Back to {{ team.name }}"
           class="h-8 w-8 grid place-items-center rounded-lg bg-white/8 hover:bg-white/12 transition shrink-0">
            <i data-lucide="external-link" class="w-4 h-4 text-white/60"></i>
        </a>
    </div>
</header>
