{% comment %}
Roster Ops â€” Gaming-style roster with player-first priority, dual-role support,
tactical roles, roster lock, invite, role edit, remove. vNext organizations models.
Section 7.2 of the Master Plan.

DESIGN PHILOSOPHY:
- Players are the face of the team â€” they come FIRST
- Dual roles: Owner who plays appears in Players section with a subtle crown badge
- Staff (coaches/analysts/scouts) in separate section
- Manager-only actions hidden behind permission checks
- Game-specific role badges (Duelist, IGL, AWPer, etc.)
{% endcomment %}
<section id="roster" class="hq-section space-y-4" aria-label="Roster Operations">

    {# â”€â”€ Roster Lock Banner â”€â”€ #}
    {% if roster_locked %}
    <div class="rounded-2xl border border-red-500/30 bg-red-500/8 p-4 flex items-center gap-3">
        <div class="h-10 w-10 rounded-xl bg-red-500/15 grid place-items-center shrink-0">
            <i data-lucide="lock" class="w-5 h-5 text-red-400"></i>
        </div>
        <div class="min-w-0 flex-1">
            <p class="text-sm font-semibold text-red-400">Roster Locked</p>
            <p class="text-xs text-white/50">
                {% if roster_lock_source == 'organization' %}Locked by organization policy. Contact org admin.
                {% elif roster_lock_source == 'tournament' %}Locked due to active tournament registration.
                {% else %}Locked by team owner.{% endif %}
            </p>
        </div>
        {% if is_owner and roster_lock_source == 'owner' %}
        <button onclick="ManageHQ.toggleRosterLock(false)"
            class="shrink-0 text-xs px-3 py-1.5 rounded-lg border border-emerald-500/30 text-emerald-400 hover:bg-emerald-500/15 transition font-medium">
            Unlock
        </button>
        {% endif %}
    </div>
    {% endif %}

    {# â”€â”€ Manual Roster Lock Toggle (Owner only, when not org-locked) â”€â”€ #}
    {% if is_owner and roster_lock_source != 'organization' and not roster_locked %}
    <div class="rounded-2xl border border-white/10 bg-white/[0.03] p-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div class="h-9 w-9 rounded-xl bg-white/5 grid place-items-center shrink-0">
                <i data-lucide="shield-check" class="w-4 h-4 text-white/40"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-white/80">Roster Lock</p>
                <p class="text-xs text-white/40">Prevent all roster changes until you unlock</p>
            </div>
        </div>
        <button onclick="ManageHQ.toggleRosterLock(true)"
            class="text-xs px-3 py-1.5 rounded-lg border border-red-500/30 text-red-400 hover:bg-red-500/15 transition font-medium">
            <i data-lucide="lock" class="w-3 h-3 inline mr-1"></i>Lock Roster
        </button>
    </div>
    {% endif %}

    {# â”€â”€ Roster Summary Header â”€â”€ #}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4">
            <div>
                <h2 class="text-base font-bold flex items-center gap-2">
                    <i data-lucide="shield" class="w-4 h-4 text-blue-400"></i>
                    Roster Operations
                </h2>
                <p class="text-sm text-white/60 mt-0.5">{{ game_display }} Â· {{ current_roster_size }} / {{ max_roster_size }} slots</p>
            </div>
            {% if can_manage_roster and not roster_locked %}
            <button onclick="ManageHQ.openInviteModal()"
                class="rounded-xl px-4 py-2 text-sm font-medium border transition inline-flex items-center gap-1.5"
                style="background:linear-gradient(135deg,color-mix(in oklab,var(--team-primary) 60%,transparent),rgba(255,255,255,.06));border-color:color-mix(in oklab,var(--team-primary) 38%,rgba(255,255,255,.16))">
                <i data-lucide="user-plus" class="w-3.5 h-3.5"></i>
                Invite
            </button>
            {% endif %}
        </div>

        {# Roster config metrics #}
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-4">
            <div class="rounded-xl bg-white/5 border border-white/8 p-2.5 text-center">
                <div class="text-lg font-bold" style="color:var(--team-primary)">{{ max_team_size|default:max_roster_size }}</div>
                <div class="text-[10px] text-white/50 uppercase tracking-wide">Team Size</div>
            </div>
            <div class="rounded-xl bg-white/5 border border-white/8 p-2.5 text-center">
                <div class="text-lg font-bold text-emerald-400" id="starter-count-metric">0</div>
                <div class="text-[10px] text-white/50 uppercase tracking-wide">Starters</div>
            </div>
            <div class="rounded-xl bg-white/5 border border-white/8 p-2.5 text-center">
                <div class="text-lg font-bold text-blue-400" id="sub-count-metric">0</div>
                <div class="text-[10px] text-white/50 uppercase tracking-wide">Substitutes</div>
            </div>
            <div class="rounded-xl bg-white/5 border border-white/8 p-2.5 text-center">
                <div class="text-lg font-bold text-amber-400">{{ pending_invites.count }}</div>
                <div class="text-[10px] text-white/50 uppercase tracking-wide">Pending</div>
            </div>
        </div>

        {# Roster fill progress bar #}
        {% widthratio current_roster_size max_roster_size 100 as fill_pct %}
        <div class="h-1.5 rounded-full bg-white/10 overflow-hidden mb-1">
            <div class="h-full rounded-full transition-all duration-500 {% if fill_pct|add:0 >= 90 %}bg-red-500{% elif fill_pct|add:0 >= 70 %}bg-amber-500{% else %}bg-emerald-500{% endif %}"
                 style="width:{{ fill_pct }}%"></div>
        </div>
        <div class="flex justify-between text-[10px] text-white/40">
            <span>{{ current_roster_size }} filled</span>
            <span>{{ max_roster_size }} max</span>
        </div>
    </div>

    {% comment %}Players section â€” Gaming-Style Roster Cards{% endcomment %}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-sm font-bold flex items-center gap-2">
                <i data-lucide="swords" class="w-4 h-4 text-emerald-400"></i>
                Players
                <span class="text-[10px] px-1.5 py-0.5 rounded-full bg-emerald-500/15 text-emerald-400 font-semibold" id="player-total-count">0</span>
            </h3>
            <div class="flex items-center gap-2 text-[10px] text-white/40">
                <span class="inline-flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-emerald-500"></span> Starter</span>
                <span class="inline-flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-500"></span> Sub</span>
                <span class="inline-flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-amber-500"></span> Captain</span>
            </div>
        </div>

        {# â”€â”€ Starting Players Grid â”€â”€ #}
        <p class="text-[10px] text-white/45 uppercase tracking-wider font-semibold mb-2">Starting Lineup</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3 mb-5" id="roster-starters">
            {% for membership in members %}
            {% if membership.roster_slot == 'STARTER' or membership.role == 'PLAYER' and not membership.roster_slot or membership.role == 'OWNER' and not membership.roster_slot %}
            <div class="group relative rounded-2xl border border-white/10 bg-gradient-to-br from-white/[0.06] to-white/[0.02] overflow-hidden hover:border-white/20 hover:shadow-lg transition-all duration-300"
                 data-membership-id="{{ membership.id }}" data-slot="starter"
                 data-permissions='{{ membership.permissions|default:"{}" }}'>
                {# Top Accent Bar #}
                <div class="h-1 w-full" style="background:linear-gradient(90deg,var(--team-primary),var(--team-accent))"></div>

                <div class="p-4">
                    {# Avatar + Identity #}
                    <div class="flex items-start gap-3">
                        <div class="relative shrink-0">
                            <div class="h-14 w-14 rounded-xl border-2 overflow-hidden"
                                 style="border-color:color-mix(in oklab,var(--team-primary) 50%,rgba(255,255,255,.15))">
                                {% if membership.roster_image %}
                                <img src="{{ membership.roster_image.url }}" alt="" class="w-full h-full object-cover">
                                {% elif membership.user.profile.avatar %}
                                <img src="{{ membership.user.profile.avatar.url }}" alt="" class="w-full h-full object-cover">
                                {% else %}
                                <div class="w-full h-full grid place-items-center bg-white/10">
                                    <span class="font-bold text-lg" style="color:var(--team-primary)">{{ membership.user.username|slice:":1"|upper }}</span>
                                </div>
                                {% endif %}
                            </div>
                            {# Captain Crown #}
                            {% if membership.is_tournament_captain %}
                            <div class="absolute -top-1.5 -right-1.5 h-5 w-5 rounded-full bg-amber-500 grid place-items-center shadow-lg" title="Team Captain">
                                <i data-lucide="crown" class="w-3 h-3 text-black"></i>
                            </div>
                            {% endif %}
                            {# Online indicator #}
                            <div class="absolute -bottom-0.5 -right-0.5 h-3.5 w-3.5 rounded-full border-2 border-[var(--bg0)] bg-emerald-500"></div>
                        </div>
                        <div class="min-w-0 flex-1">
                            <div class="flex items-center gap-1.5 flex-wrap">
                                <span class="font-bold text-sm truncate text-white">{{ membership.display_name|default:membership.user.username }}</span>
                                {# Dual-role: show management role as subtle badge #}
                                {% if membership.role == 'OWNER' %}
                                <span class="text-[9px] px-1 py-0.5 rounded bg-amber-500/20 text-amber-300 font-bold leading-none" title="Team Owner">ğŸ‘‘</span>
                                {% elif membership.role == 'MANAGER' %}
                                <span class="text-[9px] px-1 py-0.5 rounded bg-indigo-500/20 text-indigo-300 font-bold leading-none" title="Manager">MGR</span>
                                {% elif membership.role == 'COACH' %}
                                <span class="text-[9px] px-1 py-0.5 rounded bg-purple-500/20 text-purple-300 font-bold leading-none" title="Coach">ğŸ“</span>
                                {% endif %}
                            </div>
                            <p class="text-xs text-white/50 truncate">@{{ membership.user.username }}</p>
                        </div>
                    </div>

                    {# Game Role & Status Row #}
                    <div class="mt-3 flex items-center gap-2 flex-wrap">
                        {% if membership.player_role %}
                        <span class="text-[10px] px-2 py-1 rounded-lg font-semibold border"
                              style="color:var(--team-primary);border-color:color-mix(in oklab,var(--team-primary) 30%,transparent);background:color-mix(in oklab,var(--team-primary) 10%,transparent)">
                            {{ membership.player_role }}
                        </span>
                        {% endif %}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-emerald-500/15 text-emerald-400 font-medium">STARTER</span>
                        {% if membership.is_tournament_captain %}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-amber-500/15 text-amber-300 font-medium">â­ Captain</span>
                        {% endif %}
                    </div>

                    {# Joined date #}
                    <div class="mt-2 text-[10px] text-white/35">Joined {{ membership.joined_at|timesince }} ago</div>
                </div>

                {# Hover Action Buttons (management only) #}
                {% if can_manage_roster and not roster_locked %}
                <div class="absolute top-3 right-3 flex items-center gap-1.5 opacity-100 lg:opacity-0 lg:group-hover:opacity-100 transition">
                    <button onclick="ManageHQ.openPlayerInfoModal({{ membership.user.id }}, '{{ membership.user.username|escapejs }}')"
                        class="h-7 w-7 rounded-lg border border-teal-500/30 bg-black/40 backdrop-blur-sm hover:bg-teal-500/20 transition grid place-items-center text-teal-400" title="Player Info">
                        <i data-lucide="info" class="w-3 h-3"></i>
                    </button>
                    {% if membership.role != 'OWNER' %}
                    <button onclick="ManageHQ.swapSlot({{ membership.id }}, 'SUBSTITUTE')"
                        class="h-7 w-7 rounded-lg border border-blue-500/30 bg-black/40 backdrop-blur-sm hover:bg-blue-500/20 transition grid place-items-center text-blue-400" title="Move to Bench">
                        <i data-lucide="arrow-down" class="w-3 h-3"></i>
                    </button>
                    {% endif %}
                    <button onclick="ManageHQ.openRoleModal({{ membership.id }}, '{{ membership.role }}', '{{ membership.user.username|escapejs }}', {{ membership.is_tournament_captain|yesno:'true,false' }}, '{{ membership.player_role|default:""|escapejs }}', '{{ membership.roster_slot|default:""|escapejs }}', '{{ membership.display_name|default:""|escapejs }}', '{% if membership.roster_image %}{{ membership.roster_image.url }}{% endif %}')"
                        class="h-7 w-7 rounded-lg border border-white/15 bg-black/40 backdrop-blur-sm hover:bg-white/15 transition grid place-items-center" title="Edit">
                        <i data-lucide="pencil" class="w-3 h-3"></i>
                    </button>
                    {% if membership.role != 'OWNER' %}
                    <button onclick="ManageHQ.openRemoveModal({{ membership.id }}, '{{ membership.user.username|escapejs }}')"
                        class="h-7 w-7 rounded-lg border border-red-500/30 bg-black/40 backdrop-blur-sm hover:bg-red-500/20 transition grid place-items-center text-red-400" title="Remove">
                        <i data-lucide="user-x" class="w-3 h-3"></i>
                    </button>
                    {% endif %}
                </div>
                {% elif membership.id == user_membership_id and not roster_locked %}
                {# Self-edit: any member can edit their own roster info #}
                <div class="absolute top-3 right-3 flex items-center gap-1.5 opacity-100 lg:opacity-0 lg:group-hover:opacity-100 transition">
                    <button onclick="ManageHQ.openSelfEditModal({{ membership.id }}, '{{ membership.user.username|escapejs }}', '{{ membership.player_role|default:""|escapejs }}', '{{ membership.roster_slot|default:""|escapejs }}', '{{ membership.display_name|default:""|escapejs }}', '{% if membership.roster_image %}{{ membership.roster_image.url }}{% endif %}')"
                        class="h-7 px-2 rounded-lg border border-cyan-500/30 bg-black/40 backdrop-blur-sm hover:bg-cyan-500/20 transition inline-flex items-center gap-1 text-cyan-400 text-[10px] font-medium" title="Edit your info">
                        <i data-lucide="pencil" class="w-3 h-3"></i> Edit
                    </button>
                </div>
                {% elif membership.role == 'OWNER' and is_owner and roster_locked %}
                <div class="absolute top-3 right-3">
                    <span class="text-[9px] text-white/30 bg-black/30 backdrop-blur-sm px-2 py-1 rounded-lg">You</span>
                </div>
                {% endif %}
            </div>
            {% endif %}
            {% endfor %}
        </div>

        {# â”€â”€ Substitutes â”€â”€ #}
        <p class="text-[10px] text-white/45 uppercase tracking-wider font-semibold mb-2">Substitutes</p>
        <div class="space-y-2 mb-4" id="roster-subs">
            {% for membership in members %}
            {% if membership.roster_slot == 'SUBSTITUTE' or membership.role == 'SUBSTITUTE' %}
            <div class="rounded-xl border border-white/8 bg-white/[0.03] p-3 flex items-center gap-3 group hover:bg-white/[0.06] transition"
                 data-membership-id="{{ membership.id }}" data-slot="substitute"
                 data-permissions='{{ membership.permissions|default:"{}" }}'>
                <div class="relative shrink-0">
                    <div class="h-10 w-10 rounded-lg border border-white/15 bg-white/5 grid place-items-center overflow-hidden">
                        {% if membership.roster_image %}
                        <img src="{{ membership.roster_image.url }}" alt="" class="w-full h-full object-cover">
                        {% elif membership.user.profile.avatar %}
                        <img src="{{ membership.user.profile.avatar.url }}" alt="" class="w-full h-full object-cover">
                        {% else %}
                        <span class="font-bold text-sm" style="color:var(--team-primary)">{{ membership.user.username|slice:":1"|upper }}</span>
                        {% endif %}
                    </div>
                    {% if membership.is_tournament_captain %}
                    <div class="absolute -top-1 -right-1 h-4 w-4 rounded-full bg-amber-500 grid place-items-center">
                        <i data-lucide="crown" class="w-2.5 h-2.5 text-black"></i>
                    </div>
                    {% endif %}
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 flex-wrap">
                        <span class="font-semibold text-sm truncate text-white/90">{{ membership.display_name|default:membership.user.username }}</span>
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-blue-500/15 text-blue-400 font-medium">SUB</span>
                        {% if membership.player_role %}
                        <span class="text-[10px] px-1.5 py-0.5 rounded-lg font-medium"
                              style="color:var(--team-primary);background:color-mix(in oklab,var(--team-primary) 10%,transparent)">{{ membership.player_role }}</span>
                        {% endif %}
                    </div>
                    <div class="text-[10px] text-white/40 mt-0.5">@{{ membership.user.username }} Â· Joined {{ membership.joined_at|timesince }} ago</div>
                </div>
                {% if can_manage_roster and not roster_locked %}
                <div class="flex items-center gap-1.5 opacity-100 lg:opacity-0 lg:group-hover:opacity-100 transition shrink-0">
                    <button onclick="ManageHQ.openPlayerInfoModal({{ membership.user.id }}, '{{ membership.user.username|escapejs }}')"
                        class="h-7 w-7 rounded-lg border border-teal-500/30 bg-teal-500/5 hover:bg-teal-500/15 transition grid place-items-center text-teal-400" title="Player Info">
                        <i data-lucide="info" class="w-3 h-3"></i>
                    </button>
                    <button onclick="ManageHQ.swapSlot({{ membership.id }}, 'STARTER')"
                        class="h-7 w-7 rounded-lg border border-emerald-500/30 bg-emerald-500/5 hover:bg-emerald-500/15 transition grid place-items-center text-emerald-400" title="Promote to Starter">
                        <i data-lucide="arrow-up" class="w-3 h-3"></i>
                    </button>
                    <button onclick="ManageHQ.openRoleModal({{ membership.id }}, '{{ membership.role }}', '{{ membership.user.username|escapejs }}', {{ membership.is_tournament_captain|yesno:'true,false' }}, '{{ membership.player_role|default:""|escapejs }}', '{{ membership.roster_slot|default:""|escapejs }}', '{{ membership.display_name|default:""|escapejs }}', '{% if membership.roster_image %}{{ membership.roster_image.url }}{% endif %}')"
                        class="h-7 w-7 rounded-lg border border-line bg-white/5 hover:bg-white/10 transition grid place-items-center" title="Edit">
                        <i data-lucide="pencil" class="w-3 h-3"></i>
                    </button>
                    <button onclick="ManageHQ.openRemoveModal({{ membership.id }}, '{{ membership.user.username|escapejs }}')"
                        class="h-7 w-7 rounded-lg border border-red-500/30 bg-red-500/5 hover:bg-red-500/15 transition grid place-items-center text-red-400" title="Remove">
                        <i data-lucide="user-x" class="w-3 h-3"></i>
                    </button>
                </div>
                {% elif membership.id == user_membership_id and not roster_locked %}
                <div class="flex items-center gap-1.5 opacity-100 lg:opacity-0 lg:group-hover:opacity-100 transition shrink-0">
                    <button onclick="ManageHQ.openSelfEditModal({{ membership.id }}, '{{ membership.user.username|escapejs }}', '{{ membership.player_role|default:""|escapejs }}', '{{ membership.roster_slot|default:""|escapejs }}', '{{ membership.display_name|default:""|escapejs }}', '{% if membership.roster_image %}{{ membership.roster_image.url }}{% endif %}')"
                        class="h-7 px-2 rounded-lg border border-cyan-500/30 bg-cyan-500/5 hover:bg-cyan-500/15 transition inline-flex items-center gap-1 text-cyan-400 text-[10px] font-medium" title="Edit your info">
                        <i data-lucide="pencil" class="w-3 h-3"></i> Edit
                    </button>
                </div>
                {% endif %}
            </div>
            {% endif %}
            {% endfor %}
            <div id="subs-empty" class="rounded-xl border border-dashed border-white/10 bg-white/[0.02] p-4 text-center" style="display:none">
                <p class="text-xs text-white/40">No substitutes yet. Invite backup players for tournament flexibility.</p>
            </div>
        </div>
    </div>

    {% comment %}Staff section â€” Coaches, Analysts, Scouts, Managers{% endcomment %}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h3 class="text-sm font-bold mb-3 flex items-center gap-2">
            <i data-lucide="briefcase" class="w-4 h-4 text-purple-400"></i>
            Coaching & Staff
            <span class="text-[10px] px-1.5 py-0.5 rounded-full bg-purple-500/15 text-purple-400 font-semibold" id="staff-count">0</span>
        </h3>
        <div class="space-y-2" id="roster-staff">
            {% for membership in members %}
            {% if membership.role == 'MANAGER' or membership.role == 'COACH' or membership.role == 'ANALYST' or membership.role == 'SCOUT' %}
            <div class="rounded-xl border border-white/8 bg-white/[0.03] p-3 flex items-center gap-3 group hover:bg-white/[0.06] transition"
                 data-membership-id="{{ membership.id }}"
                 data-permissions='{{ membership.permissions|default:"{}" }}'>
                <div class="h-10 w-10 rounded-lg border border-white/15 bg-white/5 grid place-items-center shrink-0 overflow-hidden">
                    {% if membership.roster_image %}
                    <img src="{{ membership.roster_image.url }}" alt="" class="w-full h-full object-cover">
                    {% elif membership.user.profile.avatar %}
                    <img src="{{ membership.user.profile.avatar.url }}" alt="" class="w-full h-full object-cover">
                    {% else %}
                    <span class="font-bold text-sm">{{ membership.user.username|slice:":1"|upper }}</span>
                    {% endif %}
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 flex-wrap">
                        <span class="font-semibold text-sm truncate text-white/90">{{ membership.display_name|default:membership.user.username }}</span>
                        {% if membership.role == 'MANAGER' %}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-indigo-500/20 text-indigo-300 font-medium">MANAGER</span>
                        {% elif membership.role == 'COACH' %}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-purple-500/20 text-purple-300 font-medium">COACH</span>
                        {% elif membership.role == 'ANALYST' %}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-teal-500/20 text-teal-300 font-medium">ANALYST</span>
                        {% elif membership.role == 'SCOUT' %}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-cyan-500/20 text-cyan-300 font-medium">SCOUT</span>
                        {% endif %}
                        {% if membership.roster_slot == 'STARTER' or membership.roster_slot == 'SUBSTITUTE' %}
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-emerald-500/10 text-emerald-400/70 font-medium">Also Plays</span>
                        {% endif %}
                    </div>
                    <div class="text-[10px] text-white/40 mt-0.5">@{{ membership.user.username }} Â· Joined {{ membership.joined_at|timesince }} ago</div>
                </div>
                {% if can_manage_roster and not roster_locked %}
                <div class="flex items-center gap-1.5 opacity-100 lg:opacity-0 lg:group-hover:opacity-100 transition shrink-0">
                    <button onclick="ManageHQ.openRoleModal({{ membership.id }}, '{{ membership.role }}', '{{ membership.user.username|escapejs }}', false, '', '{{ membership.roster_slot|default:""|escapejs }}', '{{ membership.display_name|default:""|escapejs }}', '{% if membership.roster_image %}{{ membership.roster_image.url }}{% endif %}')"
                        class="h-7 w-7 rounded-lg border border-line bg-white/5 hover:bg-white/10 transition grid place-items-center" title="Edit">
                        <i data-lucide="pencil" class="w-3 h-3"></i>
                    </button>
                    <button onclick="ManageHQ.openRemoveModal({{ membership.id }}, '{{ membership.user.username|escapejs }}')"
                        class="h-7 w-7 rounded-lg border border-red-500/30 bg-red-500/5 hover:bg-red-500/15 transition grid place-items-center text-red-400" title="Remove">
                        <i data-lucide="user-x" class="w-3 h-3"></i>
                    </button>
                </div>
                {% endif %}
            </div>
            {% endif %}
            {% endfor %}
            <div id="staff-empty" class="rounded-xl border border-dashed border-white/10 bg-white/[0.02] p-4 text-center" style="display:none">
                <p class="text-xs text-white/40">No staff members yet. Invite coaches & analysts to strengthen operations.</p>
            </div>
        </div>
    </div>

    {# â”€â”€ Roster Guide â”€â”€ #}
    {% if can_manage_roster %}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h3 class="text-sm font-bold mb-3 flex items-center gap-2">
            <i data-lucide="info" class="w-4 h-4 text-white/40"></i>
            Roster Guide
        </h3>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div class="rounded-xl border border-white/8 bg-white/[0.02] p-3">
                <div class="flex items-center gap-2 mb-1.5">
                    <i data-lucide="layers" class="w-3.5 h-3.5 text-emerald-400"></i>
                    <span class="text-[11px] font-bold text-white/80">Dual Roles</span>
                </div>
                <p class="text-[10px] text-white/45 leading-relaxed">
                    An Owner or Manager can also play. Set their roster slot to STARTER/SUB and assign an in-game role.
                </p>
            </div>
            <div class="rounded-xl border border-white/8 bg-white/[0.02] p-3">
                <div class="flex items-center gap-2 mb-1.5">
                    <i data-lucide="gamepad-2" class="w-3.5 h-3.5 text-cyan-400"></i>
                    <span class="text-[11px] font-bold text-white/80">{{ game_display }} Roles</span>
                </div>
                <p class="text-[10px] text-white/45 leading-relaxed">
                    Assign game-specific tactical roles (e.g. Duelist, IGL, Controller) via the role editor pencil icon.
                </p>
            </div>
            <div class="rounded-xl border border-white/8 bg-white/[0.02] p-3">
                <div class="flex items-center gap-2 mb-1.5">
                    <i data-lucide="star" class="w-3.5 h-3.5 text-amber-400"></i>
                    <span class="text-[11px] font-bold text-white/80">Captain</span>
                </div>
                <p class="text-[10px] text-white/45 leading-relaxed">
                    Designate one player as Tournament Captain â­ for match check-ins and lobby admin duties.
                </p>
            </div>
        </div>
    </div>
    {% endif %}

    {# â”€â”€ Pending Invitations â”€â”€ #}
    <div id="pending-invites-section" class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6 {% if not pending_invites %}hidden{% endif %}">
        <h2 class="text-sm font-bold mb-3 flex items-center gap-2">
            <i data-lucide="mail" class="w-4 h-4 text-amber-400"></i>
            Pending Invitations
            <span class="text-[10px] px-1.5 py-0.5 rounded-full bg-amber-500/15 text-amber-300 font-semibold">{{ pending_invites.count }}</span>
        </h2>
        <div id="pending-invites-list" class="space-y-2">
            {% for invite in pending_invites %}
            <div id="invite-{{ invite.id }}" class="rounded-xl border border-amber-500/20 bg-amber-500/5 p-3 flex items-center justify-between">
                <div class="flex items-center gap-3 min-w-0">
                    <div class="h-9 w-9 rounded-lg bg-white/10 grid place-items-center text-xs font-bold shrink-0 overflow-hidden">
                        {% if invite.invited_user and invite.invited_user.profile.avatar %}
                        <img src="{{ invite.invited_user.profile.avatar.url }}" alt="" class="w-full h-full object-cover rounded-lg">
                        {% elif invite.invited_user %}
                        {{ invite.invited_user.username|slice:":1"|upper }}
                        {% else %}
                        ?
                        {% endif %}
                    </div>
                    <div class="min-w-0">
                        <div class="font-semibold text-sm truncate text-white/90">{{ invite.invited_user.username|default:"Unknown" }}</div>
                        <div class="text-xs text-white/50 truncate">
                            {{ invite.role }} Â· {{ invite.created_at|timesince }} ago
                            {% if invite.inviter %}Â· by {{ invite.inviter.username }}{% endif %}
                        </div>
                    </div>
                </div>
                {% if can_manage_roster and not roster_locked %}
                <button onclick="ManageHQ.cancelInvite({{ invite.id }}, this)"
                    class="text-xs px-3 py-1.5 rounded-lg border border-red-500/30 bg-red-500/10 text-red-400 hover:bg-red-500/20 transition shrink-0 ml-2">
                    Cancel
                </button>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

</section>

{% comment %}MODALS{% endcomment %}

{# â”€â”€ Invite Modal â”€â”€ #}
<div id="modal-invite" class="fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm hidden items-center justify-center p-4"
     role="dialog" aria-modal="true" aria-labelledby="modal-invite-title"
     onclick="if(event.target===this)ManageHQ.closeModal('modal-invite')">
    <div class="bg-[#0f1525] border border-white/15 rounded-2xl w-full max-w-md shadow-2xl" onclick="event.stopPropagation()">
        <div class="flex items-center justify-between p-4 border-b border-white/10">
            <h3 id="modal-invite-title" class="font-bold text-base">Invite Player</h3>
            <button onclick="ManageHQ.closeModal('modal-invite')" aria-label="Close" class="h-8 w-8 rounded-lg hover:bg-white/10 transition grid place-items-center">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>
        <form id="invite-form" class="p-4 space-y-4">
            <div id="invite-error" class="hidden text-sm text-red-400 bg-red-500/10 border border-red-500/20 rounded-lg p-3"></div>
            <div>
                <label class="block text-xs text-white/70 mb-1.5 font-medium">Username or Email</label>
                <div id="invite-search-wrapper" class="relative">
                    <input id="invite-username" type="text" placeholder="Start typing a username or emailâ€¦"
                        class="w-full px-3 py-2.5 rounded-xl bg-white/5 border border-white/15 text-sm placeholder-white/30 focus:border-cyan-500/40 focus:outline-none transition" required autocomplete="off">
                    <i data-lucide="search" class="w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-white/20 pointer-events-none"></i>
                </div>
            </div>
            <div>
                <label class="block text-xs text-white/70 mb-1.5 font-medium">Role</label>
                <select id="invite-role"
                    class="w-full px-3 py-2.5 rounded-xl bg-white/5 border border-white/15 text-sm focus:border-white/30 focus:outline-none transition">
                    {% for rc in role_choices %}
                    <option value="{{ rc.value }}" {% if rc.value == 'PLAYER' %}selected{% endif %}>{{ rc.label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="flex gap-2 pt-2">
                <button type="button" onclick="ManageHQ.closeModal('modal-invite')"
                    class="flex-1 px-4 py-2.5 rounded-xl border border-white/15 bg-white/5 hover:bg-white/10 transition text-sm font-medium">Cancel</button>
                <button id="invite-submit-btn" type="submit"
                    class="flex-1 px-4 py-2.5 rounded-xl text-sm font-medium text-white transition"
                    style="background:linear-gradient(135deg,color-mix(in oklab,var(--team-primary) 70%,transparent),rgba(255,255,255,.08))">Send Invite</button>
            </div>
        </form>
    </div>
</div>

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{# MODAL: Edit Member Role â€” Modern Responsive Redesign                 #}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
<div id="modal-role-edit"
     class="fixed inset-0 z-[100] bg-black/70 backdrop-blur-md hidden items-center justify-center p-0 sm:p-4"
     role="dialog" aria-modal="true" aria-labelledby="modal-role-edit-title"
     onclick="if(event.target===this)ManageHQ.closeModal('modal-role-edit')">

    <div class="bg-[#0A0A12] sm:rounded-3xl w-full h-full sm:h-auto sm:max-w-xl sm:max-h-[92vh] flex flex-col shadow-2xl shadow-black/50 border-0 sm:border sm:border-white/10 overflow-hidden"
         onclick="event.stopPropagation()">

        {# â”€â”€ Sticky Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
        <div class="shrink-0 bg-[#0A0A12]/95 backdrop-blur-xl border-b border-white/10 px-5 py-4 sm:px-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3 min-w-0">
                    <div id="role-header-avatar" class="w-10 h-10 rounded-xl bg-white/5 border border-white/10 overflow-hidden shrink-0 grid place-items-center">
                        <svg class="w-5 h-5 text-white/20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                    </div>
                    <div class="min-w-0">
                        <h3 id="modal-role-edit-title" class="font-display font-bold text-base text-white truncate">Edit Member</h3>
                        <p class="text-[10px] text-white/40 font-mono uppercase tracking-wider mt-0.5"><span id="role-username-display"></span></p>
                    </div>
                </div>
                <button onclick="ManageHQ.closeModal('modal-role-edit')" aria-label="Close"
                        class="h-9 w-9 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 transition grid place-items-center shrink-0">
                    <svg class="w-4 h-4 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
        </div>

        {# â”€â”€ Scrollable Body â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
        <form id="role-edit-form" class="flex-1 overflow-y-auto overscroll-contain">
            <input type="hidden" id="role-membership-id">

            {# Error Banner #}
            <div id="role-error" class="hidden mx-5 sm:mx-6 mt-4 text-sm text-red-300 bg-red-500/10 border border-red-500/20 rounded-xl p-3 flex items-start gap-2">
                <svg class="w-4 h-4 text-red-400 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4.5c-.77-.833-2.694-.833-3.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
                <span id="role-error-text"></span>
            </div>

            <div class="p-5 sm:p-6 space-y-5">

                {# â”€â”€ Section 1: Team Role â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
                <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-1">
                        <div class="w-6 h-6 rounded-lg bg-blue-500/15 grid place-items-center">
                            <svg class="w-3.5 h-3.5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                        </div>
                        <h4 class="text-xs font-bold text-white/80 uppercase tracking-wider">Team Role</h4>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div>
                            <label for="role-select" class="block text-[11px] text-white/50 mb-1.5 font-medium">Organizational Role</label>
                            <select id="role-select"
                                class="w-full px-3.5 py-2.5 rounded-xl bg-white/[0.04] border border-white/10 text-sm text-white focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 focus:outline-none transition appearance-none cursor-pointer"
                                style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 fill=%22none%22 viewBox=%220 0 24 24%22 stroke=%22%23666%22><path stroke-linecap=%22round%22 stroke-linejoin=%22round%22 stroke-width=%222%22 d=%22M19 9l-7 7-7-7%22/></svg>'); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px;">
                                {% for rc in role_choices %}
                                {% if rc.value != 'OWNER' or is_owner %}
                                <option value="{{ rc.value }}">{{ rc.label }}{% if rc.value == 'OWNER' %} âš ï¸ Transfer{% endif %}</option>
                                {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label for="role-roster-slot" class="block text-[11px] text-white/50 mb-1.5 font-medium">Roster Slot</label>
                            <select id="role-roster-slot"
                                class="w-full px-3.5 py-2.5 rounded-xl bg-white/[0.04] border border-white/10 text-sm text-white focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 focus:outline-none transition appearance-none cursor-pointer"
                                style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 fill=%22none%22 viewBox=%220 0 24 24%22 stroke=%22%23666%22><path stroke-linecap=%22round%22 stroke-linejoin=%22round%22 stroke-width=%222%22 d=%22M19 9l-7 7-7-7%22/></svg>'); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px;">
                                <option value="">Not Assigned</option>
                                <option value="STARTER">ğŸ® Starting Player</option>
                                <option value="SUBSTITUTE">ğŸ”„ Substitute</option>
                                <option value="COACH">ğŸ“‹ Coach</option>
                                <option value="ANALYST">ğŸ“Š Analyst</option>
                            </select>
                        </div>
                    </div>

                    {% if can_assign_captain_title %}
                    <label class="flex items-center gap-3 p-3 rounded-xl bg-amber-500/[0.04] border border-amber-500/15 hover:border-amber-500/30 cursor-pointer transition group">
                        <input id="role-captain-cb" type="checkbox"
                               class="w-4 h-4 rounded border-amber-500/30 accent-amber-400 cursor-pointer">
                        <div class="flex-1 min-w-0">
                            <span class="text-sm font-medium text-white/90 group-hover:text-white transition">Captain Title</span>
                            <span class="text-amber-400 ml-1">â­</span>
                            <p class="text-[10px] text-white/40 mt-0.5">Grants tournament check-in authority &amp; leadership badge</p>
                        </div>
                    </label>
                    {% endif %}
                </div>

                {# â”€â”€ Divider â”€â”€ #}
                <div class="border-t border-white/[0.06]"></div>

                {# â”€â”€ Section 2: In-Game Identity â”€â”€â”€â”€â”€â”€â”€â”€ #}
                <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-1">
                        <div class="w-6 h-6 rounded-lg bg-emerald-500/15 grid place-items-center">
                            <svg class="w-3.5 h-3.5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>
                        </div>
                        <h4 class="text-xs font-bold text-white/80 uppercase tracking-wider">In-Game Identity</h4>
                        <span class="text-[9px] text-white/30 font-mono ml-auto">{{ game_display }}</span>
                    </div>

                    <div>
                        <label for="role-player-role" class="block text-[11px] text-white/50 mb-1.5 font-medium">In-Game Role</label>
                        <select id="role-player-role"
                            class="w-full px-3.5 py-2.5 rounded-xl bg-white/[0.04] border border-white/10 text-sm text-white focus:border-emerald-500/50 focus:ring-1 focus:ring-emerald-500/20 focus:outline-none transition appearance-none cursor-pointer"
                            style="background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 fill=%22none%22 viewBox=%220 0 24 24%22 stroke=%22%23666%22><path stroke-linecap=%22round%22 stroke-linejoin=%22round%22 stroke-width=%222%22 d=%22M19 9l-7 7-7-7%22/></svg>'); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px;">
                            <option value="">â€” Select Role â€”</option>
                            {% for gr in game_roles %}
                            <option value="{{ gr.role_name }}" {% if gr.color %}data-color="{{ gr.color }}"{% endif %}>
                                {% if gr.icon %}{{ gr.icon }} {% endif %}{{ gr.role_name }}{% if gr.description %} â€” {{ gr.description|truncatechars:30 }}{% endif %}
                            </option>
                            {% endfor %}
                        </select>
                        {% if not game_roles %}
                        <p class="text-[10px] text-amber-400/60 mt-1.5 flex items-center gap-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            No roles configured for this game yet
                        </p>
                        {% endif %}
                    </div>

                    <div>
                        <label for="role-display-name" class="block text-[11px] text-white/50 mb-1.5 font-medium">Display Name <span class="text-white/30">(alias)</span></label>
                        <input id="role-display-name" type="text"
                               placeholder="Custom name for this rosterâ€¦"
                               maxlength="80"
                               class="w-full px-3.5 py-2.5 rounded-xl bg-white/[0.04] border border-white/10 text-sm text-white placeholder-white/20 focus:border-emerald-500/50 focus:ring-1 focus:ring-emerald-500/20 focus:outline-none transition">
                    </div>
                </div>

                {# â”€â”€ Divider â”€â”€ #}
                <div class="border-t border-white/[0.06]"></div>

                {# â”€â”€ Section 3: Roster Photo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
                <div class="space-y-3">
                    <div class="flex items-center gap-2 mb-1">
                        <div class="w-6 h-6 rounded-lg bg-pink-500/15 grid place-items-center">
                            <svg class="w-3.5 h-3.5 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                        </div>
                        <h4 class="text-xs font-bold text-white/80 uppercase tracking-wider">Roster Photo</h4>
                        <span class="text-[9px] text-white/30 ml-auto">Optional</span>
                    </div>

                    <div class="flex items-center gap-4 p-3 rounded-xl bg-white/[0.02] border border-white/[0.06]">
                        <div id="role-photo-preview" class="h-16 w-16 rounded-xl bg-white/5 border border-white/10 overflow-hidden shrink-0 grid place-items-center">
                            <svg class="w-6 h-6 text-white/15" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                        </div>
                        <div class="flex-1 min-w-0">
                            <label class="inline-flex items-center gap-2 px-3.5 py-2 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 cursor-pointer transition text-sm text-white/70 hover:text-white">
                                <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                                <span>Choose Photo</span>
                                <input id="role-photo-input" type="file" accept="image/jpeg,image/png,image/webp" class="hidden"
                                    onchange="(function(input){
                                        const preview = document.getElementById('role-photo-preview');
                                        if(input.files[0]){
                                            const reader = new FileReader();
                                            reader.onload = e => { preview.innerHTML = '<img src=\'' + e.target.result + '\' class=\'w-full h-full object-cover\'>'; };
                                            reader.readAsDataURL(input.files[0]);
                                        }
                                    })(this)">
                            </label>
                            <p class="text-[9px] text-white/25 mt-1.5">Max 5 MB Â· JPEG, PNG, WebP</p>
                        </div>
                    </div>
                </div>

                {# â”€â”€ Section 4: Advanced Permissions â”€â”€â”€â”€ #}
                <div id="role-permissions-section" class="hidden">
                    <div class="border-t border-white/[0.06] mb-5"></div>
                    <button type="button"
                            onclick="const g=document.getElementById('role-perm-grid');g.classList.toggle('hidden');this.querySelector('.perm-chevron')?.classList.toggle('rotate-90')"
                            class="flex items-center gap-2 w-full text-left text-xs font-bold text-white/50 hover:text-white/70 transition mb-3 uppercase tracking-wider">
                        <div class="w-6 h-6 rounded-lg bg-amber-500/15 grid place-items-center shrink-0">
                            <svg class="w-3.5 h-3.5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                        </div>
                        <span>Advanced Permissions</span>
                        <span class="text-[8px] px-1.5 py-0.5 rounded-full bg-amber-500/12 text-amber-400/80 border border-amber-500/15 ml-1">OVERRIDES</span>
                        <svg class="perm-chevron w-3.5 h-3.5 ml-auto transition-transform text-white/30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                    </button>

                    <div id="role-perm-grid" class="hidden rounded-xl bg-white/[0.02] border border-white/[0.06] p-4 space-y-2">
                        <p class="text-[10px] text-white/35 mb-3">Grant specific permissions beyond role defaults.</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-1.5">
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="register_tournaments" class="perm-cb w-4 h-4 rounded border-white/20 accent-teal-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">Register Tournaments</span>
                            </label>
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="edit_roster" class="perm-cb w-4 h-4 rounded border-white/20 accent-teal-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">Edit Roster</span>
                            </label>
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="edit_team" class="perm-cb w-4 h-4 rounded border-white/20 accent-teal-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">Edit Team</span>
                            </label>
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="schedule_scrims" class="perm-cb w-4 h-4 rounded border-white/20 accent-teal-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">Schedule Scrims</span>
                            </label>
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="edit_toc" class="perm-cb w-4 h-4 rounded border-white/20 accent-teal-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">Edit TOC</span>
                            </label>
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="view_analytics" class="perm-cb w-4 h-4 rounded border-white/20 accent-teal-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">View Analytics</span>
                            </label>
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="view_dashboard" class="perm-cb w-4 h-4 rounded border-white/20 accent-teal-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">View Dashboard</span>
                            </label>
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="view_player_stats" class="perm-cb w-4 h-4 rounded border-white/20 accent-teal-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">View Player Stats</span>
                            </label>
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="manage_bounties" class="perm-cb w-4 h-4 rounded border-white/20 accent-amber-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">Manage Bounties</span>
                            </label>
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="manage_economy" class="perm-cb w-4 h-4 rounded border-white/20 accent-amber-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">Manage Economy</span>
                            </label>
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="manage_media" class="perm-cb w-4 h-4 rounded border-white/20 accent-pink-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">Manage Media</span>
                            </label>
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="send_announcements" class="perm-cb w-4 h-4 rounded border-white/20 accent-blue-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">Send Announcements</span>
                            </label>
                            <label class="flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-white/[0.04] transition cursor-pointer group">
                                <input type="checkbox" data-perm="manage_discord" class="perm-cb w-4 h-4 rounded border-white/20 accent-indigo-400 cursor-pointer">
                                <span class="text-[11px] text-white/60 group-hover:text-white/80 transition">Manage Discord</span>
                            </label>
                        </div>
                        <p class="text-[9px] text-white/25 mt-3 pt-2 border-t border-white/[0.04]">Checked items are granted beyond role defaults. Unchecked uses defaults.</p>
                    </div>
                </div>

            </div>
        </form>

        {# â”€â”€ Sticky Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
        <div class="shrink-0 bg-[#0A0A12]/95 backdrop-blur-xl border-t border-white/10 px-5 py-4 sm:px-6">
            <div class="flex gap-3">
                <button type="button" onclick="ManageHQ.closeModal('modal-role-edit')"
                    class="flex-1 px-4 py-2.5 rounded-xl border border-white/10 bg-white/[0.03] hover:bg-white/[0.07] transition text-sm font-medium text-white/70 hover:text-white">
                    Cancel
                </button>
                <button id="role-submit-btn" type="button"
                    onclick="document.getElementById('role-edit-form').requestSubmit()"
                    class="flex-1 px-4 py-2.5 rounded-xl bg-blue-600 hover:bg-blue-500 active:bg-blue-700 transition text-sm font-bold text-white shadow-lg shadow-blue-600/20 flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                    Save Changes
                </button>
            </div>
        </div>

    </div>
</div>

{# â”€â”€ Remove Member Modal â”€â”€ #}
<div id="modal-remove" class="fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm hidden items-center justify-center p-4"
     role="dialog" aria-modal="true" aria-labelledby="modal-remove-title"
     onclick="if(event.target===this)ManageHQ.closeModal('modal-remove')">
    <div class="bg-[#0f1525] border border-red-500/25 rounded-2xl w-full max-w-md shadow-2xl" onclick="event.stopPropagation()">
        <div class="flex items-center justify-between p-4 border-b border-red-500/15">
            <h3 id="modal-remove-title" class="font-bold text-base text-red-400 flex items-center gap-2">
                <i data-lucide="alert-triangle" class="w-4 h-4"></i> Remove Member
            </h3>
            <button onclick="ManageHQ.closeModal('modal-remove')" aria-label="Close" class="h-8 w-8 rounded-lg hover:bg-white/10 transition grid place-items-center">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>
        <div class="p-4 space-y-4">
            <div id="remove-error" class="hidden text-sm text-red-400 bg-red-500/10 border border-red-500/20 rounded-lg p-3"></div>
            <input type="hidden" id="remove-membership-id">
            <p class="text-sm text-white/70">
                You are about to remove <strong id="remove-username-display" class="text-white"></strong> from the team. This action cannot be undone.
            </p>
            <div>
                <label class="block text-xs text-white/70 mb-1.5 font-medium">
                    Type <strong id="remove-confirm-target" class="text-red-400"></strong> to confirm
                </label>
                <input id="remove-confirm-input" type="text" placeholder="Type username to confirmâ€¦"
                    class="w-full px-3 py-2.5 rounded-xl bg-white/5 border border-red-500/25 text-sm placeholder-white/30 focus:border-red-500/40 focus:outline-none transition">
            </div>
            <div class="flex gap-2 pt-1">
                <button type="button" onclick="ManageHQ.closeModal('modal-remove')"
                    class="flex-1 px-4 py-2.5 rounded-xl border border-white/15 bg-white/5 hover:bg-white/10 transition text-sm font-medium">Cancel</button>
                <button id="remove-submit-btn" type="button" onclick="ManageHQ.confirmRemove()"
                    class="flex-1 px-4 py-2.5 rounded-xl bg-red-600 hover:bg-red-500 transition text-sm font-medium text-white">Remove Member</button>
            </div>
        </div>
    </div>
</div>

{# â”€â”€ Self-Edit Modal (Player edits own roster info) â”€â”€ #}
<div id="modal-self-edit" class="fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm hidden items-center justify-center p-4"
     role="dialog" aria-modal="true" aria-labelledby="modal-self-edit-title"
     onclick="if(event.target===this)ManageHQ.closeModal('modal-self-edit')">
    <div class="bg-[#0f1525] border border-cyan-500/25 rounded-2xl w-full max-w-md shadow-2xl" onclick="event.stopPropagation()">
        <div class="flex items-center justify-between p-4 border-b border-cyan-500/15">
            <h3 id="modal-self-edit-title" class="font-bold text-base text-cyan-400 flex items-center gap-2">
                <i data-lucide="user-cog" class="w-4 h-4"></i> Edit Your Roster Info
            </h3>
            <button onclick="ManageHQ.closeModal('modal-self-edit')" aria-label="Close" class="h-8 w-8 rounded-lg hover:bg-white/10 transition grid place-items-center">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>
        <form id="self-edit-form" class="p-4 space-y-4">
            <input type="hidden" id="self-edit-membership-id">
            <div id="self-edit-error" class="hidden text-sm text-red-400 bg-red-500/10 border border-red-500/20 rounded-lg p-3"></div>
            <div>
                <label class="block text-xs text-white/70 mb-1.5 font-medium">Display Name <span class="text-white/40">(optional)</span></label>
                <input id="self-edit-display-name" type="text" placeholder="Your custom name for this rosterâ€¦"
                    class="w-full px-3 py-2.5 rounded-xl bg-white/5 border border-white/15 text-sm placeholder-white/30 focus:border-cyan-500/40 focus:outline-none transition"
                    maxlength="80">
            </div>
            <div>
                <label class="block text-xs text-white/70 mb-1.5 font-medium">In-Game Role <span class="text-white/40">({{ game_display }})</span></label>
                <select id="self-edit-player-role"
                    class="w-full px-3 py-2.5 rounded-xl bg-white/5 border border-white/15 text-sm focus:border-cyan-500/40 focus:outline-none transition">
                    <option value="">â€” Select Role â€”</option>
                    {% for gr in game_roles %}
                    <option value="{{ gr.role_name }}">{{ gr.role_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-xs text-white/70 mb-1.5 font-medium">Roster Photo</label>
                <div class="flex items-center gap-3">
                    <div id="self-edit-photo-preview" class="h-14 w-14 rounded-xl border border-white/15 bg-white/5 grid place-items-center overflow-hidden shrink-0">
                        <i data-lucide="camera" class="w-5 h-5 text-white/20"></i>
                    </div>
                    <div class="flex-1">
                        <input id="self-edit-photo" type="file" accept="image/jpeg,image/png,image/webp" class="hidden"
                            onchange="ManageHQ.previewSelfPhoto(this)">
                        <button type="button" onclick="document.getElementById('self-edit-photo').click()"
                            class="text-xs px-3 py-1.5 rounded-lg border border-white/15 bg-white/5 hover:bg-white/10 transition">
                            Choose Photo
                        </button>
                        <p class="text-[10px] text-white/30 mt-1">JPEG, PNG, WebP Â· Max 5 MB</p>
                    </div>
                </div>
            </div>
            <div class="flex gap-2 pt-2">
                <button type="button" onclick="ManageHQ.closeModal('modal-self-edit')"
                    class="flex-1 px-4 py-2.5 rounded-xl border border-white/15 bg-white/5 hover:bg-white/10 transition text-sm font-medium">Cancel</button>
                <button id="self-edit-submit-btn" type="submit"
                    class="flex-1 px-4 py-2.5 rounded-xl text-sm font-medium text-white transition"
                    style="background:linear-gradient(135deg,color-mix(in oklab,var(--team-primary) 70%,transparent),rgba(255,255,255,.08))">Save Changes</button>
            </div>
        </form>
    </div>
</div>

{# â”€â”€ Player Info Modal (Comprehensive Profile Viewer) â”€â”€ #}
<div id="modal-player-info" class="fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm hidden items-center justify-center p-4"
     role="dialog" aria-modal="true" aria-labelledby="modal-player-info-title"
     onclick="if(event.target===this)ManageHQ.closeModal('modal-player-info')">
    <div class="bg-[#0f1525] border border-teal-500/25 rounded-2xl w-full max-w-lg shadow-2xl max-h-[90vh] flex flex-col" onclick="event.stopPropagation()">
        {# Header #}
        <div class="flex items-center justify-between p-4 border-b border-teal-500/15 shrink-0">
            <h3 id="modal-player-info-title" class="font-bold text-base text-teal-400 flex items-center gap-2">
                <i data-lucide="id-card" class="w-4 h-4"></i>
                <span id="player-info-username">Player Info</span>
            </h3>
            <button onclick="ManageHQ.closeModal('modal-player-info')" aria-label="Close" class="h-8 w-8 rounded-lg hover:bg-white/10 transition grid place-items-center">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>

        {# Scrollable Content #}
        <div id="player-info-content" class="p-4 overflow-y-auto flex-1 custom-scrollbar">
            {# Loading spinner #}
            <div id="player-info-loading" class="text-center py-8">
                <div class="animate-spin h-6 w-6 border-2 border-teal-400/30 border-t-teal-400 rounded-full mx-auto"></div>
                <p class="text-xs text-white/40 mt-2">Loading player profileâ€¦</p>
            </div>

            <div id="player-info-data" class="hidden space-y-4">

                {# â”€â”€â”€ Player Header Card â”€â”€â”€ #}
                <div id="pi-header-card" class="flex items-center gap-3 rounded-xl bg-white/[0.03] border border-white/10 p-3">
                    <div id="pi-avatar-wrap" class="w-12 h-12 rounded-full bg-teal-500/20 border border-teal-500/30 grid place-items-center overflow-hidden shrink-0">
                        <img id="pi-avatar" src="" alt="" class="w-full h-full object-cover hidden">
                        <i data-lucide="user" class="w-5 h-5 text-teal-400" id="pi-avatar-fallback"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p id="pi-display-name" class="font-semibold text-sm text-white truncate">â€”</p>
                        <p id="pi-header-meta" class="text-[10px] text-white/40 flex items-center gap-2 flex-wrap">
                            <span id="pi-role-badge" class="px-1.5 py-0.5 rounded bg-teal-500/15 text-teal-400 font-medium hidden"></span>
                            <span id="pi-joined-date" class="hidden">Joined â€”</span>
                            <span id="pi-level-badge" class="hidden">Lv. â€”</span>
                        </p>
                    </div>
                    <div id="pi-captain-badge" class="hidden shrink-0 px-2 py-1 rounded-lg bg-amber-500/15 border border-amber-500/25 text-[10px] font-bold text-amber-400">
                        <i data-lucide="crown" class="w-3 h-3 inline -mt-0.5"></i> Captain
                    </div>
                </div>

                {# â”€â”€â”€ Section: Game Passport â”€â”€â”€ #}
                <div class="rounded-xl bg-teal-500/5 border border-teal-500/15 overflow-hidden">
                    <div class="px-4 py-2.5 bg-teal-500/[0.07] border-b border-teal-500/10 flex items-center gap-1.5">
                        <i data-lucide="gamepad-2" class="w-3.5 h-3.5 text-teal-400"></i>
                        <span class="text-xs font-semibold text-teal-400">Game Passport â€” {{ game_display }}</span>
                    </div>
                    <div class="p-4 space-y-3">
                        {# Verification & Status Banner #}
                        <div id="pi-verification-banner" class="hidden flex items-center justify-between rounded-lg px-3 py-2 bg-white/[0.03] border border-white/10">
                            <div class="flex items-center gap-2">
                                <span id="pi-verified-icon" class="hidden text-green-400"><i data-lucide="shield-check" class="w-4 h-4"></i></span>
                                <span id="pi-unverified-icon" class="hidden text-white/30"><i data-lucide="shield" class="w-4 h-4"></i></span>
                                <span id="pi-verification-text" class="text-[10px] font-medium text-white/60">â€”</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span id="pi-passport-status" class="text-[10px] px-2 py-0.5 rounded-full bg-white/5 text-white/50">â€”</span>
                                <span id="pi-visibility-badge" class="text-[10px] px-2 py-0.5 rounded-full bg-white/5 text-white/50">â€”</span>
                            </div>
                        </div>

                        {# Identity Row #}
                        <div class="grid grid-cols-3 gap-3">
                            <div>
                                <p class="text-[10px] text-white/40 mb-0.5">IGN</p>
                                <p class="text-sm font-semibold text-white/90" id="pi-ign">â€”</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-white/40 mb-0.5">Tag / Disc.</p>
                                <p class="text-sm font-semibold text-white/90" id="pi-discriminator">â€”</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-white/40 mb-0.5">Platform</p>
                                <p class="text-sm text-white/70" id="pi-platform">â€”</p>
                            </div>
                        </div>
                        {# Extended Identity #}
                        <div id="pi-ext-identity-row" class="hidden grid grid-cols-3 gap-3">
                            <div>
                                <p class="text-[10px] text-white/40 mb-0.5">In-Game Name</p>
                                <p class="text-sm text-white/70" id="pi-in-game-name">â€”</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-white/40 mb-0.5">Display Name</p>
                                <p class="text-sm text-white/70" id="pi-game-display-name">â€”</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-white/40 mb-0.5">Identity Key</p>
                                <p class="text-sm text-white/70 font-mono text-[11px]" id="pi-identity-key">â€”</p>
                            </div>
                        </div>
                        {# Role & Region #}
                        <div class="grid grid-cols-3 gap-3">
                            <div>
                                <p class="text-[10px] text-white/40 mb-0.5">Primary Role</p>
                                <p class="text-sm text-white/70" id="pi-main-role">â€”</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-white/40 mb-0.5">Region</p>
                                <p class="text-sm text-white/70" id="pi-region">â€”</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-white/40 mb-0.5">LFT Status</p>
                                <p class="text-sm text-white/70" id="pi-lft">â€”</p>
                            </div>
                        </div>
                        {# Rank Row with Image #}
                        <div class="grid grid-cols-3 gap-3">
                            <div class="flex items-center gap-2">
                                <img id="pi-rank-image" src="" alt="" class="w-6 h-6 hidden">
                                <div>
                                    <p class="text-[10px] text-white/40 mb-0.5">Rank</p>
                                    <p class="text-sm font-semibold text-white/90" id="pi-rank">â€”</p>
                                </div>
                            </div>
                            <div>
                                <p class="text-[10px] text-white/40 mb-0.5">Rank Points</p>
                                <p class="text-sm text-white/70" id="pi-rank-points">â€”</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-white/40 mb-0.5">Peak Rank</p>
                                <p class="text-sm text-white/70" id="pi-peak-rank">â€”</p>
                            </div>
                        </div>
                        {# Rank Tier #}
                        <div id="pi-rank-tier-row" class="hidden grid grid-cols-3 gap-3">
                            <div>
                                <p class="text-[10px] text-white/40 mb-0.5">Rank Tier</p>
                                <p class="text-sm text-white/70" id="pi-rank-tier">â€”</p>
                            </div>
                        </div>
                        {# Statistics Row #}
                        <div class="grid grid-cols-4 gap-3 pt-2 border-t border-teal-500/10">
                            <div class="text-center">
                                <p class="text-lg font-bold text-teal-400" id="pi-matches">0</p>
                                <p class="text-[9px] text-white/40">Matches</p>
                            </div>
                            <div class="text-center">
                                <p class="text-lg font-bold text-green-400" id="pi-winrate">0%</p>
                                <p class="text-[9px] text-white/40">Win Rate</p>
                            </div>
                            <div class="text-center">
                                <p class="text-lg font-bold text-amber-400" id="pi-kd">â€”</p>
                                <p class="text-[9px] text-white/40">K/D Ratio</p>
                            </div>
                            <div class="text-center">
                                <p class="text-lg font-bold text-purple-400" id="pi-hours">â€”</p>
                                <p class="text-[9px] text-white/40">Hours</p>
                            </div>
                        </div>
                    </div>
                </div>

                {# â”€â”€â”€ Section: Personal Info â”€â”€â”€ #}
                <div id="pi-personal-section" class="rounded-xl bg-purple-500/5 border border-purple-500/15 overflow-hidden hidden">
                    <div class="px-4 py-2.5 bg-purple-500/[0.07] border-b border-purple-500/10 flex items-center gap-1.5">
                        <i data-lucide="user-circle" class="w-3.5 h-3.5 text-purple-400"></i>
                        <span class="text-xs font-semibold text-purple-400">Personal Info</span>
                    </div>
                    <div class="p-4 grid grid-cols-2 gap-x-4 gap-y-2.5">
                        <div id="pi-realname-row">
                            <p class="text-[10px] text-white/40 mb-0.5">Real Name</p>
                            <p class="text-sm text-white/80" id="pi-real-name">â€”</p>
                        </div>
                        <div id="pi-dob-row">
                            <p class="text-[10px] text-white/40 mb-0.5">Date of Birth</p>
                            <p class="text-sm text-white/80" id="pi-dob">â€”</p>
                        </div>
                        <div id="pi-nationality-row">
                            <p class="text-[10px] text-white/40 mb-0.5">Nationality</p>
                            <p class="text-sm text-white/80" id="pi-nationality">â€”</p>
                        </div>
                        <div id="pi-country-row">
                            <p class="text-[10px] text-white/40 mb-0.5">Country</p>
                            <p class="text-sm text-white/80" id="pi-country">â€”</p>
                        </div>
                        <div id="pi-city-row">
                            <p class="text-[10px] text-white/40 mb-0.5">City</p>
                            <p class="text-sm text-white/80" id="pi-city">â€”</p>
                        </div>
                        <div id="pi-gender-row">
                            <p class="text-[10px] text-white/40 mb-0.5">Gender</p>
                            <p class="text-sm text-white/80" id="pi-gender">â€”</p>
                        </div>
                        <div id="pi-pronouns-row">
                            <p class="text-[10px] text-white/40 mb-0.5">Pronouns</p>
                            <p class="text-sm text-white/80" id="pi-pronouns">â€”</p>
                        </div>
                        <div id="pi-timezone-row">
                            <p class="text-[10px] text-white/40 mb-0.5">Timezone</p>
                            <p class="text-sm text-white/80" id="pi-timezone">â€”</p>
                        </div>
                        <div id="pi-language-row">
                            <p class="text-[10px] text-white/40 mb-0.5">Language</p>
                            <p class="text-sm text-white/80" id="pi-language">â€”</p>
                        </div>
                    </div>
                </div>

                {# â”€â”€â”€ Section: Gaming Profile â”€â”€â”€ #}
                <div id="pi-gaming-section" class="rounded-xl bg-blue-500/5 border border-blue-500/15 overflow-hidden hidden">
                    <div class="px-4 py-2.5 bg-blue-500/[0.07] border-b border-blue-500/10 flex items-center gap-1.5">
                        <i data-lucide="monitor" class="w-3.5 h-3.5 text-blue-400"></i>
                        <span class="text-xs font-semibold text-blue-400">Gaming Profile</span>
                    </div>
                    <div class="p-4 grid grid-cols-2 gap-x-4 gap-y-2.5">
                        <div id="pi-goal-row">
                            <p class="text-[10px] text-white/40 mb-0.5">Competitive Goal</p>
                            <p class="text-sm text-white/80" id="pi-comp-goal">â€”</p>
                        </div>
                        <div id="pi-playstyle-row">
                            <p class="text-[10px] text-white/40 mb-0.5">Play Style</p>
                            <p class="text-sm text-white/80" id="pi-play-style">â€”</p>
                        </div>
                        <div id="pi-device-row">
                            <p class="text-[10px] text-white/40 mb-0.5">Device / Platform</p>
                            <p class="text-sm text-white/80" id="pi-device">â€”</p>
                        </div>
                        <div id="pi-activehours-row">
                            <p class="text-[10px] text-white/40 mb-0.5">Active Hours</p>
                            <p class="text-sm text-white/80" id="pi-active-hours">â€”</p>
                        </div>
                        <div id="pi-mainrole-row" class="col-span-2">
                            <p class="text-[10px] text-white/40 mb-0.5">Main Role / Secondary</p>
                            <p class="text-sm text-white/80" id="pi-roles">â€”</p>
                        </div>
                        <div id="pi-bio-row" class="col-span-2">
                            <p class="text-[10px] text-white/40 mb-0.5">Bio</p>
                            <p class="text-sm text-white/60 leading-relaxed" id="pi-bio">â€”</p>
                        </div>
                        {# Extra Gaming Stats #}
                        <div id="pi-lft-status-row">
                            <p class="text-[10px] text-white/40 mb-0.5">LFT Status</p>
                            <p class="text-sm text-white/80" id="pi-lft-status">â€”</p>
                        </div>
                        <div id="pi-lan-row">
                            <p class="text-[10px] text-white/40 mb-0.5">LAN Available</p>
                            <p class="text-sm text-white/80" id="pi-lan">â€”</p>
                        </div>
                    </div>
                    {# Reputation & XP Bar #}
                    <div id="pi-rep-xp-bar" class="hidden flex items-center gap-4 px-4 py-2.5 border-t border-blue-500/10">
                        <div class="flex items-center gap-1.5">
                            <i data-lucide="star" class="w-3.5 h-3.5 text-amber-400"></i>
                            <span class="text-[10px] text-white/40">Rep:</span>
                            <span class="text-sm font-semibold text-amber-400" id="pi-reputation">â€”</span>
                        </div>
                        <div class="flex items-center gap-1.5">
                            <i data-lucide="zap" class="w-3.5 h-3.5 text-cyan-400"></i>
                            <span class="text-[10px] text-white/40">XP:</span>
                            <span class="text-sm font-semibold text-cyan-400" id="pi-xp">â€”</span>
                        </div>
                    </div>
                </div>

                {# â”€â”€â”€ Section: Social Links â”€â”€â”€ #}
                <div id="pi-socials-section" class="rounded-xl bg-pink-500/5 border border-pink-500/15 overflow-hidden hidden">
                    <div class="px-4 py-2.5 bg-pink-500/[0.07] border-b border-pink-500/10 flex items-center gap-1.5">
                        <i data-lucide="link" class="w-3.5 h-3.5 text-pink-400"></i>
                        <span class="text-xs font-semibold text-pink-400">Social & Connect</span>
                    </div>
                    <div id="pi-socials-list" class="p-3 grid grid-cols-2 gap-2">
                        {# Populated by JS #}
                    </div>
                </div>

                {# â”€â”€â”€ Section: Membership Info â”€â”€â”€ #}
                <div id="pi-membership-section" class="rounded-xl bg-cyan-500/5 border border-cyan-500/15 overflow-hidden hidden">
                    <div class="px-4 py-2.5 bg-cyan-500/[0.07] border-b border-cyan-500/10 flex items-center gap-1.5">
                        <i data-lucide="users" class="w-3.5 h-3.5 text-cyan-400"></i>
                        <span class="text-xs font-semibold text-cyan-400">Team Membership</span>
                    </div>
                    <div class="p-4 grid grid-cols-2 gap-x-4 gap-y-2.5">
                        <div>
                            <p class="text-[10px] text-white/40 mb-0.5">Team Role</p>
                            <p class="text-sm text-white/80" id="pi-team-role">â€”</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-white/40 mb-0.5">Roster Slot</p>
                            <p class="text-sm text-white/80" id="pi-roster-slot">â€”</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-white/40 mb-0.5">Player Role</p>
                            <p class="text-sm text-white/80" id="pi-player-role">â€”</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-white/40 mb-0.5">Display Name</p>
                            <p class="text-sm text-white/80" id="pi-member-dn">â€”</p>
                        </div>
                    </div>
                </div>

                {# Passport Missing Warning #}
                <div id="pi-missing-warning" class="hidden rounded-xl bg-amber-500/5 border border-amber-500/20 p-3 flex items-start gap-2">
                    <i data-lucide="alert-triangle" class="w-4 h-4 text-amber-400 shrink-0 mt-0.5"></i>
                    <div>
                        <p class="text-xs text-amber-400 font-semibold">Game Passport Incomplete</p>
                        <p class="text-[10px] text-white/50 mt-0.5">This player hasn't completed their game passport for {{ game_display }}. They may not be eligible for tournaments.</p>
                        {% if can_manage_roster %}
                        <button id="pi-nudge-btn" type="button" onclick="ManageHQ.nudgePlayerPassport()"
                            class="mt-2 text-[10px] px-3 py-1.5 rounded-lg bg-amber-500/15 text-amber-400 hover:bg-amber-500/25 transition font-medium">
                            <i data-lucide="bell" class="w-3 h-3 inline -mt-0.5"></i> Send Reminder
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div id="player-info-error" class="hidden text-sm text-red-400 bg-red-500/10 border border-red-500/20 rounded-lg p-3"></div>
        </div>
    </div>
</div>

<script>
(function() {
    function updateCounts() {
        var starters = document.querySelectorAll('#roster-starters [data-membership-id]').length;
        var subs = document.querySelectorAll('#roster-subs [data-membership-id]').length;
        var staff = document.querySelectorAll('#roster-staff [data-membership-id]').length;
        var el;
        el = document.getElementById('starter-count-metric'); if (el) el.textContent = starters;
        el = document.getElementById('sub-count-metric'); if (el) el.textContent = subs;
        el = document.getElementById('staff-count'); if (el) el.textContent = staff;
        el = document.getElementById('player-total-count'); if (el) el.textContent = starters + subs;
        el = document.getElementById('subs-empty'); if (el) el.style.display = subs === 0 ? '' : 'none';
        el = document.getElementById('staff-empty'); if (el) el.style.display = staff === 0 ? '' : 'none';
    }
    document.readyState === 'loading' ? document.addEventListener('DOMContentLoaded', updateCounts) : updateCounts();
})();
</script>
