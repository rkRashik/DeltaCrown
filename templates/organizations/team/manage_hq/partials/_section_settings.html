{% comment %}
Settings & Security — Team visibility, status, temporary flag.
Danger zone for owner-only actions (transfer / delete).
Settings auto-save via AJAX.
{% endcomment %}
<section id="settings" class="hq-section space-y-4">

    {# ── Visibility ── #}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h2 class="text-base font-bold mb-1 flex items-center gap-2">
            <i data-lucide="eye" class="w-4 h-4 text-blue-400"></i>
            Visibility
        </h2>
        <p class="text-xs text-white/40 mb-5">Control who can discover and view your team page.</p>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3" id="visibility-options">
            {% for vis_val, vis_label in visibility_choices %}
            <label class="relative cursor-pointer">
                <input type="radio" name="visibility" value="{{ vis_val }}"
                    {% if team.visibility == vis_val %}checked{% endif %}
                    class="peer sr-only"
                    onchange="ManageHQ.toggleSetting('visibility', '{{ vis_val }}')">
                <div class="rounded-2xl border border-white/10 bg-white/5 p-4 text-center transition
                            peer-checked:border-blue-500/50 peer-checked:bg-blue-500/10 hover:bg-white/8">
                    <div class="text-xl mb-1">
                        {% if vis_val == 'PUBLIC' %}<i data-lucide="globe" class="w-5 h-5 mx-auto text-emerald-400"></i>
                        {% elif vis_val == 'PRIVATE' %}<i data-lucide="lock" class="w-5 h-5 mx-auto text-red-400"></i>
                        {% else %}<i data-lucide="eye-off" class="w-5 h-5 mx-auto text-amber-400"></i>{% endif %}
                    </div>
                    <p class="text-sm font-semibold mt-2">{{ vis_label }}</p>
                    <p class="text-xs text-white/40 mt-1">
                        {% if vis_val == 'PUBLIC' %}Anyone can find and view your team
                        {% elif vis_val == 'PRIVATE' %}Only members can see team details
                        {% else %}Visible via direct link only{% endif %}
                    </p>
                </div>
            </label>
            {% endfor %}
        </div>
    </div>

    {# ── Team Status ── #}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h2 class="text-base font-bold mb-1 flex items-center gap-2">
            <i data-lucide="shield" class="w-4 h-4 text-amber-400"></i>
            Team Status
        </h2>
        <p class="text-xs text-white/40 mb-5">Current operational status of your team.</p>

        <div class="flex items-center justify-between p-4 rounded-xl bg-white/5 border border-white/10">
            <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-xl grid place-items-center
                    {% if team.status == 'ACTIVE' %}bg-emerald-500/15 text-emerald-400
                    {% elif team.status == 'SUSPENDED' %}bg-red-500/15 text-red-400
                    {% else %}bg-amber-500/15 text-amber-400{% endif %}">
                    {% if team.status == 'ACTIVE' %}<i data-lucide="check-circle" class="w-5 h-5"></i>
                    {% elif team.status == 'SUSPENDED' %}<i data-lucide="ban" class="w-5 h-5"></i>
                    {% else %}<i data-lucide="clock" class="w-5 h-5"></i>{% endif %}
                </div>
                <div>
                    <p class="text-sm font-semibold">{{ team.status|title }}</p>
                    <p class="text-xs text-white/40">
                        {% if team.status == 'ACTIVE' %}Your team is fully operational and can join tournaments
                        {% elif team.status == 'SUSPENDED' %}Team is suspended — contact support for details
                        {% else %}{{ team.status|title }}{% endif %}
                    </p>
                </div>
            </div>
            <span class="text-xs px-3 py-1.5 rounded-full font-medium
                {% if team.status == 'ACTIVE' %}bg-emerald-500/15 text-emerald-400
                {% elif team.status == 'SUSPENDED' %}bg-red-500/15 text-red-400
                {% else %}bg-amber-500/15 text-amber-400{% endif %}">
                {{ team.status|title }}
            </span>
        </div>

        {# ── Temporary Team Toggle ── #}
        <div class="mt-4">
            {% include "organizations/team/manage_hq/partials/_toggle.html" with field="is_temporary" label="Temporary Team" desc="Mark this team as temporary (e.g., created for a specific tournament). Temporary teams may be auto-cleaned." checked=team.is_temporary %}
        </div>

        {# ── Recruiting Toggle ── #}
        <div class="mt-4">
            {% include "organizations/team/manage_hq/partials/_toggle.html" with field="is_recruiting" label="Recruiting" desc="When enabled, players can discover and apply to join your team. Turn off to stop accepting new applications." checked=team.is_recruiting %}
        </div>
    </div>

    {# ── Team Identity & Platform ── #}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h2 class="text-base font-bold mb-1 flex items-center gap-2">
            <i data-lucide="gamepad-2" class="w-4 h-4 text-sky-400"></i>
            Team Identity &amp; Platform
        </h2>
        <p class="text-xs text-white/40 mb-5">Define your team's competitive platform and play identity tags shown on the public profile.</p>

        <div class="space-y-4">
            {# Platform Select #}
            <div class="flex flex-col gap-1.5">
                <label class="text-xs font-bold text-white/60 uppercase tracking-wider">Platform</label>
                <select id="hq-field-platform" class="w-full rounded-xl bg-white/5 border border-white/10 text-white text-sm px-4 py-2.5 outline-none focus:border-sky-500/50 transition">
                    {% for val, label in platform_choices %}
                    <option value="{{ val }}" {% if team.platform == val %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            {# Playstyle #}
            <div class="flex flex-col gap-1.5">
                <label class="text-xs font-bold text-white/60 uppercase tracking-wider">Play Style</label>
                <select id="hq-field-playstyle" class="w-full rounded-xl bg-white/5 border border-white/10 text-white text-sm px-4 py-2.5 outline-none focus:border-sky-500/50 transition">
                    <option value="">— Select Play Style —</option>
                </select>
                <p class="text-[10px] text-white/30">Describes your team's approach — shown as an identity tag</p>
            </div>

            {# Playpace #}
            <div class="flex flex-col gap-1.5">
                <label class="text-xs font-bold text-white/60 uppercase tracking-wider">Play Pace</label>
                <select id="hq-field-playpace" class="w-full rounded-xl bg-white/5 border border-white/10 text-white text-sm px-4 py-2.5 outline-none focus:border-sky-500/50 transition">
                    <option value="">— Select Play Pace —</option>
                </select>
                <p class="text-[10px] text-white/30">Your tempo and how you approach rounds</p>
            </div>

            {# Playfocus #}
            <div class="flex flex-col gap-1.5">
                <label class="text-xs font-bold text-white/60 uppercase tracking-wider">Play Focus</label>
                <select id="hq-field-playfocus" class="w-full rounded-xl bg-white/5 border border-white/10 text-white text-sm px-4 py-2.5 outline-none focus:border-sky-500/50 transition">
                    <option value="">— Select Play Focus —</option>
                </select>
                <p class="text-[10px] text-white/30">Your primary strategic focus area</p>
            </div>

            {# Save Button #}
            <div class="flex items-center justify-between pt-2">
                <span id="identity-save-status" class="text-[10px] text-white/30"></span>
                <button onclick="ManageHQ.saveIdentity()" id="identity-save-btn"
                    class="px-6 py-2.5 rounded-xl bg-sky-500 hover:bg-sky-400 text-white text-xs font-bold uppercase tracking-widest transition shadow-[0_0_20px_rgba(14,165,233,0.15)]">
                    <i data-lucide="save" class="w-3.5 h-3.5 inline -mt-0.5 mr-1"></i>
                    Save Changes
                </button>
            </div>
        </div>
    </div>

    {# ── Play Identity Dropdown Config (game-based) ── #}
    <script>
    (function() {
        // Game-specific play identity options for all 11 DeltaCrown games
        const PLAY_IDENTITY = {
            // FPS Games
            'valorant': {
                style: ['Aggressive', 'Defensive', 'Methodical', 'Adaptive', 'Tactical', 'Hybrid'],
                pace:  ['Fast Execute', 'Slow Default', 'Mixed Tempo', 'Aggressive Rush', 'Methodical', 'Adaptive'],
                focus: ['Aim-Heavy', 'Utility-Rich', 'Strategy-First', 'Map Control', 'Retake', 'Picks', 'Site Execute'],
            },
            'cs2': {
                style: ['Aggressive', 'Defensive', 'Methodical', 'Tactical', 'Hybrid', 'Adaptive'],
                pace:  ['Fast Execute', 'Slow Default', 'Mixed Tempo', 'Rush Heavy', 'Methodical', 'Adaptive'],
                focus: ['Aim-Heavy', 'Utility-Rich', 'Strategy-First', 'Map Control', 'Economy Play', 'Picks', 'Trade-Focused'],
            },
            'r6siege': {
                style: ['Aggressive', 'Defensive', 'Methodical', 'Intel-Driven', 'Hybrid', 'Adaptive'],
                pace:  ['Fast Push', 'Slow & Calculated', 'Mixed Tempo', 'Roam Heavy', 'Anchor', 'Adaptive'],
                focus: ['Intel Denial', 'Hard Breach', 'Roam Control', 'Vertical Play', 'Utility Clear', 'Anchor Defense'],
            },
            'codm': {
                style: ['Aggressive', 'Defensive', 'Balanced', 'Objective-First', 'Slayer', 'Hybrid'],
                pace:  ['Fast Paced', 'Methodical', 'Mixed', 'Rush', 'Defensive', 'Adaptive'],
                focus: ['Slaying', 'Objective Control', 'Map Control', 'Spawns', 'Rotations', 'Hardpoint'],
            },
            // MOBA Games
            'dota2': {
                style: ['Aggressive', 'Defensive', 'Split-Push', 'Team-Fight', 'Pick-Off', 'Adaptive'],
                pace:  ['Early Aggression', 'Mid-Game Spike', 'Late-Game', 'All-In Rush', 'Tempo Control', 'Adaptive'],
                focus: ['Team-Fight', 'Split-Push', 'Pick-Off', 'Objective Control', 'Vision Control', 'High Ground'],
            },
            'mlbb': {
                style: ['Aggressive', 'Defensive', 'Split-Push', 'Team-Fight', 'Pick-Off', 'Adaptive'],
                pace:  ['Early Invade', 'Mid-Game Power', 'Late-Game', 'Fast Push', 'Tempo', 'Adaptive'],
                focus: ['Lord/Turtle Control', 'Team-Fight', 'Split-Push', 'Ganking', 'Tower Push', 'Vision Control'],
            },
            // Battle Royale
            'pubgm': {
                style: ['Aggressive', 'Passive', 'Balanced', 'Edge Zone', 'Hot Drop', 'Adaptive'],
                pace:  ['Hot Drop', 'Safe Loot', 'Mid-Game Fight', 'End Zone', 'Rotate Heavy', 'Adaptive'],
                focus: ['Zone Control', 'Positioning', 'Fragging', 'Vehicle Plays', 'Compound Hold', 'Rotation'],
            },
            'freefire': {
                style: ['Aggressive', 'Passive', 'Balanced', 'Rush', 'Camper', 'Adaptive'],
                pace:  ['Hot Drop', 'Safe Loot', 'Mid-Game', 'End Zone', 'Rush', 'Adaptive'],
                focus: ['Fragging', 'Zone Control', 'Positioning', 'Character Combos', 'Loot Priority', 'Rotation'],
            },
            // Sports
            'ea-fc': {
                style: ['Possession', 'Counter-Attack', 'High Press', 'Tiki-Taka', 'Long Ball', 'Balanced'],
                pace:  ['Fast Build-Up', 'Slow Possession', 'Mixed Tempo', 'Direct', 'Patient', 'Adaptive'],
                focus: ['Wing Play', 'Central Play', 'Set Pieces', 'Crossing', 'Through Balls', 'Skill Moves'],
            },
            'efootball': {
                style: ['Possession', 'Counter-Attack', 'High Press', 'Long Ball', 'Balanced', 'Defensive'],
                pace:  ['Fast Build-Up', 'Slow Possession', 'Mixed', 'Direct', 'Patient', 'Adaptive'],
                focus: ['Wing Play', 'Central Play', 'Set Pieces', 'Crossing', 'Through Balls', 'Dribbling'],
            },
            'rocketleague': {
                style: ['Aggressive', 'Defensive', 'Balanced', 'Mechanical', 'Rotational', 'Adaptive'],
                pace:  ['Fast Aerial', 'Grounded', 'Mixed', 'Boost Starve', 'Possession', 'Adaptive'],
                focus: ['Aerial Play', 'Ground Game', 'Passing', 'Solo Plays', 'Boost Control', 'Demolitions'],
            },
        };

        // Fallback for unknown games
        const FALLBACK = {
            style: ['Aggressive', 'Defensive', 'Balanced', 'Tactical', 'Adaptive', 'Hybrid'],
            pace:  ['Fast', 'Slow', 'Mixed', 'Methodical', 'Rush', 'Adaptive'],
            focus: ['Fragging', 'Strategy', 'Objective', 'Map Control', 'Utility', 'Teamwork'],
        };

        const gameSlug = "{{ team.game|default:''|escapejs }}";
        const config = PLAY_IDENTITY[gameSlug] || FALLBACK;
        const currentVals = {
            playstyle: "{{ team.playstyle|default:''|escapejs }}",
            playpace:  "{{ team.playpace|default:''|escapejs }}",
            playfocus: "{{ team.playfocus|default:''|escapejs }}",
        };

        function populateSelect(id, options, currentVal) {
            const el = document.getElementById(id);
            if (!el) return;
            // Keep the first empty option
            const frag = document.createDocumentFragment();
            options.forEach(opt => {
                const o = document.createElement('option');
                o.value = opt; o.textContent = opt;
                if (opt === currentVal) o.selected = true;
                frag.appendChild(o);
            });
            // If current value exists but isn't in the list, add it
            if (currentVal && !options.includes(currentVal)) {
                const o = document.createElement('option');
                o.value = currentVal; o.textContent = currentVal + ' (custom)';
                o.selected = true;
                frag.appendChild(o);
            }
            el.appendChild(frag);
        }

        populateSelect('hq-field-playstyle', config.style, currentVals.playstyle);
        populateSelect('hq-field-playpace', config.pace, currentVals.playpace);
        populateSelect('hq-field-playfocus', config.focus, currentVals.playfocus);
    })();
    </script>

    {# ── Owner Privacy ── #}
    {% if is_owner %}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h2 class="text-base font-bold mb-1 flex items-center gap-2">
            <i data-lucide="shield-check" class="w-4 h-4 text-violet-400"></i>
            Owner Privacy
        </h2>
        <p class="text-xs text-white/40 mb-5">Control how your ownership status appears on the public team page.</p>

        <div class="flex items-center justify-between p-4 rounded-xl bg-white/5 border border-white/10">
            <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-xl grid place-items-center bg-violet-500/15">
                    <i data-lucide="eye-off" class="w-5 h-5 text-violet-400"></i>
                </div>
                <div>
                    <p class="text-sm font-semibold">Hide Ownership Status</p>
                    <p class="text-xs text-white/40">When enabled, your OWNER badge will be hidden on the public team page and roster cards. You'll appear as a regular member or player.</p>
                </div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer shrink-0 ml-3">
                <input id="hide-ownership-toggle" type="checkbox"
                    {% if user_membership and user_membership.hide_ownership %}checked{% endif %}
                    onchange="ManageHQ.toggleOwnerPrivacy(this.checked)"
                    class="sr-only peer">
                <div class="w-11 h-6 bg-white/15 peer-focus:outline-none rounded-full peer
                    peer-checked:after:translate-x-full peer-checked:after:border-white
                    after:content-[''] after:absolute after:top-[2px] after:start-[2px]
                    after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all
                    peer-checked:bg-violet-500"></div>
            </label>
        </div>
    </div>
    {% endif %}

    {# ── Leave Team (Non-Owners) ── #}
    {% if not is_owner %}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h2 class="text-base font-bold mb-1 flex items-center gap-2">
            <i data-lucide="log-out" class="w-4 h-4 text-amber-400"></i>
            Leave Team
        </h2>
        <p class="text-xs text-white/40 mb-4">You can voluntarily leave this team at any time. This will remove you from the roster.</p>
        <div class="flex items-center justify-between p-4 rounded-xl bg-amber-500/5 border border-amber-500/20">
            <div>
                <p class="text-sm font-medium text-white/80">Leave {{ team.name }}</p>
                <p class="text-xs text-white/40">You will lose access to this team's private content and roster</p>
            </div>
            <button onclick="ManageHQ.leaveTeam()"
                class="px-4 py-2 text-xs rounded-lg border border-amber-500/40 text-amber-400 hover:bg-amber-500/15 transition font-medium">
                <i data-lucide="log-out" class="w-3 h-3 inline mr-1"></i>Leave
            </button>
        </div>
    </div>
    {% endif %}

    {# ── Invite Link ── #}
    {% if can_manage_roster %}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h2 class="text-base font-bold mb-1 flex items-center gap-2">
            <i data-lucide="link" class="w-4 h-4 text-cyan-400"></i>
            Invite Link
        </h2>
        <p class="text-xs text-white/40 mb-4">Generate a shareable link that lets players join your team directly.</p>

        <div class="flex items-center gap-3">
            <div class="flex-1 relative">
                <input id="invite-link-display" type="text" readonly
                    value="{% if team.invite_code %}{{ request.scheme }}://{{ request.get_host }}/teams/join/{{ team.invite_code }}/{% else %}No invite link generated{% endif %}"
                    class="w-full px-3 py-2.5 rounded-xl bg-white/5 border border-white/15 text-sm text-white/60 focus:outline-none cursor-text">
            </div>
            {% if team.invite_code %}
            <button onclick="ManageHQ.copyInviteLink()"
                class="shrink-0 px-3 py-2.5 rounded-xl bg-cyan-500/15 text-cyan-400 border border-cyan-500/20 hover:bg-cyan-500/25 transition text-xs font-medium">
                <i data-lucide="copy" class="w-3.5 h-3.5 inline mr-1"></i>Copy
            </button>
            {% endif %}
            <button onclick="ManageHQ.generateInviteLink({% if team.invite_code %}true{% else %}false{% endif %})"
                class="shrink-0 px-3 py-2.5 rounded-xl bg-white/5 border border-white/15 hover:bg-white/10 transition text-xs font-medium">
                {% if team.invite_code %}<i data-lucide="refresh-cw" class="w-3.5 h-3.5 inline mr-1"></i>Regenerate{% else %}<i data-lucide="plus" class="w-3.5 h-3.5 inline mr-1"></i>Generate{% endif %}
            </button>
        </div>
    </div>
    {% endif %}

    {# ── Notification Preferences ── #}
    <div class="rounded-3xl border border-line bg-card shadow-soft p-5 lg:p-6">
        <h2 class="text-base font-bold mb-1 flex items-center gap-2">
            <i data-lucide="bell" class="w-4 h-4 text-amber-400"></i>
            Notification Preferences
        </h2>
        <p class="text-xs text-white/40 mb-4">Manage which team notifications you receive.</p>

        <div class="space-y-3">
            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10">
                <div class="flex items-center gap-3">
                    <i data-lucide="user-plus" class="w-4 h-4 text-white/40"></i>
                    <div>
                        <p class="text-sm font-medium">Member Joins & Leaves</p>
                        <p class="text-xs text-white/40">Notified when members join or leave the team</p>
                    </div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer shrink-0">
                    <input type="checkbox" checked class="sr-only peer" disabled>
                    <div class="w-9 h-5 bg-white/15 rounded-full peer peer-checked:bg-emerald-500 after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                </label>
            </div>
            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10">
                <div class="flex items-center gap-3">
                    <i data-lucide="trophy" class="w-4 h-4 text-white/40"></i>
                    <div>
                        <p class="text-sm font-medium">Tournament Updates</p>
                        <p class="text-xs text-white/40">Match schedules, bracket updates, check-in reminders</p>
                    </div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer shrink-0">
                    <input type="checkbox" checked class="sr-only peer" disabled>
                    <div class="w-9 h-5 bg-white/15 rounded-full peer peer-checked:bg-emerald-500 after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                </label>
            </div>
            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10">
                <div class="flex items-center gap-3">
                    <i data-lucide="shield" class="w-4 h-4 text-white/40"></i>
                    <div>
                        <p class="text-sm font-medium">Roster Changes</p>
                        <p class="text-xs text-white/40">Roster lock/unlock, role changes, slot swaps</p>
                    </div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer shrink-0">
                    <input type="checkbox" checked class="sr-only peer" disabled>
                    <div class="w-9 h-5 bg-white/15 rounded-full peer peer-checked:bg-emerald-500 after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                </label>
            </div>
        </div>

        <p class="text-[10px] text-white/25 mt-3 flex items-center gap-1">
            <i data-lucide="info" class="w-3 h-3 shrink-0"></i>
            Fine-grained notification controls coming in a future update.
        </p>
    </div>

    {# ── Organization Policies (if org team) ── #}
    {% if team.organization %}
    <div class="rounded-3xl border border-indigo-500/20 bg-gradient-to-br from-indigo-500/5 to-transparent shadow-soft p-5 lg:p-6">
        <h2 class="text-base font-bold mb-1 flex items-center gap-2">
            <i data-lucide="building-2" class="w-4 h-4 text-indigo-400"></i>
            Organization Policies
        </h2>
        <p class="text-xs text-white/40 mb-5">Settings inherited from <b class="text-white/60">{{ team.organization.name }}</b>. These cannot be overridden at team level.</p>

        <div class="space-y-3">
            {# Roster Lock #}
            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10">
                <div class="flex items-center gap-3">
                    <div class="h-9 w-9 rounded-lg grid place-items-center
                        {% if org_policies.roster_locked %}bg-red-500/15 text-red-400{% else %}bg-emerald-500/15 text-emerald-400{% endif %}">
                        <i data-lucide="{% if org_policies.roster_locked %}lock{% else %}unlock{% endif %}" class="w-4 h-4"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium">Roster Lock</p>
                        <p class="text-xs text-white/40">
                            {% if org_policies.roster_locked %}Org has locked roster changes for all teams
                            {% else %}Roster changes allowed by organization{% endif %}
                        </p>
                    </div>
                </div>
                <span class="text-[10px] px-2 py-1 rounded-full font-medium
                    {% if org_policies.roster_locked %}bg-red-500/15 text-red-400{% else %}bg-emerald-500/15 text-emerald-400{% endif %}">
                    {% if org_policies.roster_locked %}Locked{% else %}Open{% endif %}
                </span>
            </div>

            {# Brand Enforcement #}
            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10">
                <div class="flex items-center gap-3">
                    <div class="h-9 w-9 rounded-lg grid place-items-center
                        {% if org_policies.enforce_brand %}bg-amber-500/15 text-amber-400{% else %}bg-emerald-500/15 text-emerald-400{% endif %}">
                        <i data-lucide="{% if org_policies.enforce_brand %}shield{% else %}brush{% endif %}" class="w-4 h-4"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium">Brand Enforcement</p>
                        <p class="text-xs text-white/40">
                            {% if org_policies.enforce_brand %}Team uses organization branding — custom logos disabled
                            {% else %}Team can use custom branding{% endif %}
                        </p>
                    </div>
                </div>
                <span class="text-[10px] px-2 py-1 rounded-full font-medium
                    {% if org_policies.enforce_brand %}bg-amber-500/15 text-amber-400{% else %}bg-emerald-500/15 text-emerald-400{% endif %}">
                    {% if org_policies.enforce_brand %}Enforced{% else %}Custom{% endif %}
                </span>
            </div>

            {# Revenue Split #}
            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10">
                <div class="flex items-center gap-3">
                    <div class="h-9 w-9 rounded-lg grid place-items-center
                        {% if org_policies.revenue_split_config %}bg-blue-500/15 text-blue-400{% else %}bg-white/10 text-white/30{% endif %}">
                        <i data-lucide="split" class="w-4 h-4"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium">Revenue Split</p>
                        <p class="text-xs text-white/40">
                            {% if org_policies.revenue_split_config %}Prize money split active between org and team
                            {% else %}No revenue split configured{% endif %}
                        </p>
                    </div>
                </div>
                <span class="text-[10px] px-2 py-1 rounded-full font-medium
                    {% if org_policies.revenue_split_config %}bg-blue-500/15 text-blue-400{% else %}bg-white/10 text-white/30{% endif %}">
                    {% if org_policies.revenue_split_config %}Active{% else %}None{% endif %}
                </span>
            </div>
        </div>

        {% if org_control_plane_url %}
        <div class="mt-4 text-center">
            <a href="{{ org_control_plane_url }}" class="text-xs text-indigo-400 hover:text-indigo-300 transition font-medium">
                View all policies in Org Control Plane →
            </a>
        </div>
        {% endif %}
    </div>
    {% endif %}

    {# ── Danger Zone (Owner Only) ── #}
    {% if is_owner %}
    <div class="rounded-3xl border border-red-500/25 bg-red-500/5 shadow-soft p-5 lg:p-6">
        <h2 class="text-base font-bold mb-1 flex items-center gap-2 text-red-400">
            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
            Danger Zone
        </h2>
        <p class="text-xs text-white/40 mb-5">Irreversible actions. Proceed with extreme caution.</p>

        <div class="space-y-3">
            {# Transfer Ownership #}
            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10">
                <div>
                    <p class="text-sm font-medium">Transfer Ownership</p>
                    <p class="text-xs text-white/40">Make another member the team owner</p>
                </div>
                <button onclick="ManageHQ.openTransferModal()"
                   class="px-3 py-1.5 text-xs rounded-lg border border-red-500/40 text-red-400 hover:bg-red-500/15 transition font-medium">
                    Transfer
                </button>
            </div>

            {# Delete / Disband Team #}
            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10">
                <div>
                    <p class="text-sm font-medium">Disband Team</p>
                    <p class="text-xs text-white/40">Permanently disband this team and deactivate all members</p>
                </div>
                <button onclick="ManageHQ.openDisbandModal()"
                   class="px-3 py-1.5 text-xs rounded-lg border border-red-500/40 text-red-400 hover:bg-red-500/15 transition font-medium">
                    Disband
                </button>
            </div>

            {% if team.organization %}
            {# Release from Organization #}
            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/10">
                <div>
                    <p class="text-sm font-medium">Release from Organization</p>
                    <p class="text-xs text-white/40">Make this team independent — remove from {{ team.organization.name }}</p>
                </div>
                <button onclick="alert('Release from organization feature coming soon.')"
                   class="px-3 py-1.5 text-xs rounded-lg border border-amber-500/40 text-amber-400 hover:bg-amber-500/15 transition font-medium">
                    Release
                </button>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

</section>

{# Transfer Ownership Modal #}
{% if is_owner %}
<div id="modal-transfer" class="hidden fixed inset-0 z-[900] items-center justify-center bg-black/60 backdrop-blur-sm p-4" onclick="if(event.target===this)ManageHQ.closeModal('modal-transfer')">
    <div class="bg-[#0c0c1c] border border-red-500/25 rounded-3xl shadow-2xl max-w-md w-full p-6" onclick="event.stopPropagation()">
        <h3 class="text-lg font-bold text-red-400 flex items-center gap-2 mb-4">
            <i data-lucide="arrow-right-left" class="w-5 h-5"></i>
            Transfer Ownership
        </h3>
        <p class="text-sm text-white/50 mb-4">
            This will make the selected member the new owner. You will be demoted to Manager. This action cannot be easily undone.
        </p>

        <form id="transfer-form" onsubmit="event.preventDefault();ManageHQ.transferOwnership()">
            <label class="block text-xs text-white/60 mb-1 font-medium">New Owner</label>
            <select id="transfer-member-select" required
                class="w-full px-3 py-2 rounded-xl bg-white/5 border border-white/15 text-sm text-white focus:border-white/30 focus:outline-none mb-3">
                <option value="">Select a member…</option>
                {% for m in active_memberships %}
                    {% if m.user.id != team.created_by_id %}
                    <option value="{{ m.id }}">{{ m.user.username }} ({{ m.get_role_display }})</option>
                    {% endif %}
                {% endfor %}
            </select>

            <label class="flex items-center gap-2 text-sm text-white/60 mb-4 cursor-pointer">
                <input type="checkbox" id="transfer-confirm-cb" required
                    class="rounded border-white/20 bg-white/5 text-red-500 focus:ring-red-500/30">
                I understand this transfer is permanent
            </label>

            <p id="transfer-error" class="hidden text-xs text-red-400 mb-3"></p>

            <div class="flex justify-end gap-2">
                <button type="button" onclick="ManageHQ.closeModal('modal-transfer')"
                    class="px-4 py-2 text-sm rounded-xl border border-white/10 text-white/60 hover:bg-white/5 transition">
                    Cancel
                </button>
                <button type="submit" id="transfer-submit-btn"
                    class="px-4 py-2 text-sm rounded-xl bg-red-600 hover:bg-red-500 text-white font-medium transition">
                    Transfer Ownership
                </button>
            </div>
        </form>
    </div>
</div>

{# Disband Team Modal #}
<div id="modal-disband" class="hidden fixed inset-0 z-[900] items-center justify-center bg-black/60 backdrop-blur-sm p-4" onclick="if(event.target===this)ManageHQ.closeModal('modal-disband')">
    <div class="bg-[#0c0c1c] border border-red-500/25 rounded-3xl shadow-2xl max-w-md w-full p-6" onclick="event.stopPropagation()">
        <h3 class="text-lg font-bold text-red-400 flex items-center gap-2 mb-4">
            <i data-lucide="trash-2" class="w-5 h-5"></i>
            Disband Team
        </h3>
        <p class="text-sm text-white/50 mb-2">
            This will permanently disband <strong class="text-white">{{ team.name }}</strong> and deactivate all memberships.
        </p>
        <p class="text-xs text-red-400/80 mb-4">This action is irreversible.</p>

        <form id="disband-form" onsubmit="event.preventDefault();ManageHQ.disbandTeam()">
            <label class="block text-xs text-white/60 mb-1 font-medium">
                Type <strong class="text-white">"{{ team.name }}"</strong> to confirm
            </label>
            <input type="text" id="disband-confirm-input" autocomplete="off" required
                class="w-full px-3 py-2 rounded-xl bg-white/5 border border-white/15 text-sm text-white placeholder-white/30 focus:border-red-500/50 focus:outline-none mb-3"
                placeholder="{{ team.name }}">

            <p id="disband-error" class="hidden text-xs text-red-400 mb-3"></p>

            <div class="flex justify-end gap-2">
                <button type="button" onclick="ManageHQ.closeModal('modal-disband')"
                    class="px-4 py-2 text-sm rounded-xl border border-white/10 text-white/60 hover:bg-white/5 transition">
                    Cancel
                </button>
                <button type="submit" id="disband-submit-btn"
                    class="px-4 py-2 text-sm rounded-xl bg-red-600 hover:bg-red-500 text-white font-medium transition">
                    Disband Forever
                </button>
            </div>
        </form>
    </div>
</div>
{% endif %}
