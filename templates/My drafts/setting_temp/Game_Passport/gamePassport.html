<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Game Passports | DeltaCrown</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                    },
                    colors: {
                        'z-bg': '#030014',
                        'z-card': '#0b0e14',
                        'z-cyan': '#00F0FF',
                        'z-purple': '#7B2CBF',
                        'z-gold': '#FFD60A',
                        'z-red': '#FF007A',
                        'z-green': '#10B981',
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(0, 240, 255, 0.15)',
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background-color: #030014; 
            color: #f8fafc; 
            background-image: radial-gradient(circle at 50% 0%, #1a103c 0%, #030014 60%);
            min-height: 100vh;
        }

        /* High Contrast Glass */
        .glass-card {
            background: rgba(11, 14, 20, 0.7);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
        }

        /* Inputs - High Readability */
        .z-input {
            width: 100%;
            background: #050505;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 12px 16px;
            color: white;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .z-input:focus {
            outline: none;
            border-color: #00F0FF;
            box-shadow: 0 0 0 2px rgba(0, 240, 255, 0.1);
            background: #0a0a0a;
        }
        .z-input:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: rgba(255,255,255,0.05);
        }

        .z-label {
            display: block; font-size: 0.75rem; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.05em;
            color: #94a3b8; margin-bottom: 6px;
        }

        /* Game Brand Colors */
        .brand-valorant { color: #ff4655; border-color: #ff4655; }
        .brand-pubg { color: #f2a900; border-color: #f2a900; }
        .brand-efootball { color: #0075c9; border-color: #0075c9; }

        /* Custom Scrollbar */
        .scroller::-webkit-scrollbar { width: 6px; }
        .scroller::-webkit-scrollbar-track { background: #050505; }
        .scroller::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-8 flex justify-center items-start">

    <div class="w-full max-w-6xl animate-fade-in-up">
        
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4 mb-8">
            <div>
                <h1 class="text-3xl font-display font-bold text-white tracking-wide">
                    Game Passports
                </h1>
                <p class="text-gray-400 mt-2 max-w-2xl text-sm leading-relaxed">
                    Link your accounts to compete in tournaments. 
                    <span class="text-z-gold font-bold"><i class="fa-solid fa-lock mr-1"></i> Anti-Smurf Policy:</span> 
                    IDs are locked for 30 days after linking.
                </p>
            </div>
            <button onclick="openLinkModal()" class="w-full md:w-auto bg-z-cyan text-black px-6 py-3 rounded-xl text-xs font-black uppercase tracking-wider hover:bg-white transition shadow-glow flex items-center justify-center gap-2">
                <i class="fa-solid fa-link"></i> Link New Game
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5" id="passport-grid">
            </div>

    </div>

    <div id="modal-overlay" class="fixed inset-0 bg-black/90 z-50 hidden backdrop-blur-sm transition-opacity opacity-0 flex items-center justify-center p-4">
        
        <div id="modal-content" class="bg-[#0F0B1E] border border-white/10 rounded-2xl w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh] transform scale-95 transition-transform">
            
            <div class="p-6 border-b border-white/10 flex justify-between items-center bg-[#080612]">
                <h2 id="modal-title" class="text-xl font-display font-bold text-white">Select Game</h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-white transition w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>
            </div>

            <div id="view-selector" class="p-6 overflow-y-auto scroller">
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                    </div>
            </div>

            <div id="view-form" class="hidden flex-col h-full">
                <div class="px-6 py-4 bg-white/5 flex items-center gap-4 border-b border-white/5">
                    <div id="form-icon" class="w-12 h-12 rounded-xl flex items-center justify-center text-2xl shadow-lg bg-black/50"></div>
                    <div>
                        <h3 id="form-game-name" class="font-bold text-white text-lg leading-tight">Game Name</h3>
                        <button onclick="backToSelector()" class="text-xs text-gray-400 hover:text-z-cyan flex items-center gap-1 mt-1">
                            <i class="fa-solid fa-arrow-left"></i> Change Game
                        </button>
                    </div>
                </div>

                <div class="p-6 overflow-y-auto scroller flex-1">
                    <form id="game-form" class="space-y-6">
                        <div id="dynamic-fields" class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            </div>

                        <div class="bg-black/30 border border-white/10 rounded-xl p-4">
                            <div class="flex gap-3">
                                <div class="mt-0.5 text-z-gold"><i class="fa-solid fa-shield-halved"></i></div>
                                <div>
                                    <h4 class="text-sm font-bold text-white">Verification Protocol</h4>
                                    <ul class="text-xs text-gray-400 mt-2 space-y-1 list-disc pl-4">
                                        <li>I verify this account belongs to me.</li>
                                        <li>I understand this ID cannot be changed for <strong>30 days</strong>.</li>
                                        <li>False data will result in tournament disqualification.</li>
                                    </ul>
                                </div>
                            </div>
                            <label class="flex items-center gap-3 mt-4 pt-3 border-t border-white/10 cursor-pointer group">
                                <input type="checkbox" id="terms-check" class="accent-z-cyan w-4 h-4">
                                <span class="text-xs font-bold text-gray-300 group-hover:text-white transition">I Agree & Confirm</span>
                            </label>
                        </div>
                    </form>
                </div>

                <div class="p-5 border-t border-white/10 bg-[#080612] flex justify-end gap-3">
                    <button onclick="closeModal()" class="px-6 py-2.5 rounded-lg text-xs font-bold text-gray-400 hover:text-white hover:bg-white/5 uppercase transition">Cancel</button>
                    <button id="save-btn" onclick="saveData()" disabled class="px-8 py-2.5 rounded-lg text-xs font-bold bg-gray-700 text-gray-400 uppercase cursor-not-allowed transition flex items-center gap-2">
                        <i class="fa-solid fa-check"></i> Save Passport
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- 1. DATA: 11 GAMES CONFIGURATION ---
        const gamesDB = {
            'valorant': { 
                name: 'Valorant', color: '#ff4655', icon: '<i class="fa-solid fa-v"></i>',
                fields: [
                    { id: 'riot_id', label: 'Riot ID', type: 'text', placeholder: 'Viper', width: 'half', immutable: true },
                    { id: 'tag', label: 'Tagline', type: 'text', placeholder: '#NA1', width: 'half', immutable: true },
                    { id: 'region', label: 'Region', type: 'select', options: ['North America', 'Europe', 'Asia Pacific', 'Korea', 'Brazil', 'LATAM'], width: 'half' },
                    { id: 'rank', label: 'Current Rank', type: 'select', options: ['Unranked', 'Iron', 'Bronze', 'Silver', 'Gold', 'Platinum', 'Diamond', 'Ascendant', 'Immortal', 'Radiant'], width: 'half' },
                    { id: 'peak', label: 'Peak Rank', type: 'select', options: ['Immortal 1', 'Immortal 2', 'Immortal 3', 'Radiant'], width: 'half' },
                    { id: 'agent', label: 'Main Agent', type: 'select', options: ['Jett', 'Reyna', 'Omen', 'Sova', 'Cypher'], width: 'half' }
                ]
            },
            'pubg': { 
                name: 'PUBG Mobile', color: '#f2a900', icon: 'P', 
                fields: [
                    { id: 'uid', label: 'Character ID (UID)', type: 'number', placeholder: '5123456789', width: 'half', immutable: true },
                    { id: 'ign', label: 'In-Game Name', type: 'text', placeholder: 'Mortal', width: 'half' },
                    { id: 'server', label: 'Server', type: 'select', options: ['Asia', 'KRJP', 'North America', 'South America', 'Europe'], width: 'half' },
                    { id: 'tier', label: 'Current Tier', type: 'select', options: ['Bronze', 'Silver', 'Gold', 'Platinum', 'Diamond', 'Crown', 'Ace', 'Conqueror'], width: 'half' }
                ]
            },
            'efootball': { 
                name: 'eFootballâ„¢', color: '#0075c9', icon: 'EF',
                fields: [
                    { id: 'owner_id', label: 'Owner ID (9-Digit)', type: 'number', placeholder: '123-456-789', width: 'full', immutable: true },
                    { id: 'team', label: 'Team Name', type: 'text', placeholder: 'Delta FC', width: 'half' },
                    { id: 'platform', label: 'Platform', type: 'select', options: ['Mobile', 'PlayStation', 'Xbox', 'PC'], width: 'half', immutable: true }
                ]
            },
            'cs2': { name: 'CS2', color: '#de9b35', icon: '<i class="fa-solid fa-gun"></i>', fields: [{ id: 'steam', label: 'Steam URL', type: 'text', width: 'full', immutable: true }, { id: 'rating', label: 'Premier Rating', type: 'number', width: 'half' }] },
            'mlbb': { name: 'Mobile Legends', color: '#8c6dfd', icon: 'ML', fields: [{ id: 'uid', label: 'User ID', type: 'number', width: 'half', immutable: true }, { id: 'zone', label: 'Zone ID', type: 'number', width: 'half', immutable: true }] },
            'freefire': { name: 'Free Fire', color: '#ffa500', icon: 'FF', fields: [{ id: 'uid', label: 'Player UID', type: 'number', width: 'full', immutable: true }, { id: 'lvl', label: 'Level', type: 'number', width: 'half' }] },
            'codm': { name: 'Call of Duty: Mobile', color: '#a3a3a3', icon: '<i class="fa-solid fa-skull"></i>', fields: [{ id: 'uid', label: 'UID', type: 'text', width: 'full', immutable: true }] },
            'eafc': { name: 'EA FC 24', color: '#22c55e', icon: 'FC', fields: [{ id: 'eaid', label: 'EA ID', type: 'text', width: 'full', immutable: true }] },
            'apex': { name: 'Apex Legends', color: '#ef4444', icon: 'A', fields: [{ id: 'eaid', label: 'EA ID', type: 'text', width: 'full', immutable: true }] },
            'dota2': { name: 'Dota 2', color: '#b91c1c', icon: 'D2', fields: [{ id: 'fid', label: 'Friend ID', type: 'number', width: 'full', immutable: true }] },
            'coc': { name: 'Clash of Clans', color: '#fcd34d', icon: 'CC', fields: [{ id: 'tag', label: 'Player Tag', type: 'text', width: 'full', immutable: true }] }
        };

        // --- 2. RENDER EXISTING PASSPORTS (MOCK) ---
        // This simulates data coming from the backend
        const userPassports = [
            { gameId: 'valorant', data: { riot_id: 'Viper', tag: '#NA1', region: 'North America', rank: 'Immortal 3' }, verified: true },
            { gameId: 'pubg', data: { uid: '5512345678', ign: 'Mortal', server: 'Asia', tier: 'Ace' }, verified: false, locked: true, daysLeft: 24 }
        ];

        function renderGrid() {
            const container = document.getElementById('passport-grid');
            container.innerHTML = '';

            userPassports.forEach(p => {
                const game = gamesDB[p.gameId];
                const isTextIcon = !game.icon.includes('<');
                
                // Card HTML
                container.innerHTML += `
                <div class="glass-card rounded-2xl relative group overflow-hidden hover:translate-y-[-4px] transition duration-300">
                    <div class="absolute top-0 left-0 w-1.5 h-full" style="background-color: ${game.color}"></div>
                    
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-5">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-xl flex items-center justify-center text-xl shadow-lg font-black" style="background-color: ${game.color}; color: ${['#f2a900','#fcd34d','#ffa500'].includes(game.color) ? 'black' : 'white'}">
                                    ${game.icon}
                                </div>
                                <div>
                                    <h3 class="font-bold text-white text-lg">${game.name}</h3>
                                    <div class="text-xs text-gray-400 mt-0.5">${p.data.region || p.data.server || 'Global'}</div>
                                </div>
                            </div>
                            <button onclick="editPassport('${p.gameId}')" class="w-8 h-8 rounded-lg bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-400 hover:text-white transition">
                                <i class="fa-solid fa-pen"></i>
                            </button>
                        </div>

                        <div class="bg-black/40 rounded-xl p-3 border border-white/5 flex justify-between items-center mb-4">
                            <div>
                                <div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">Game ID</div>
                                <div class="text-white font-mono text-sm">${p.data.riot_id || p.data.uid || p.data.owner_id} <span class="text-gray-500">${p.data.tag || ''}</span></div>
                            </div>
                            <i class="fa-regular fa-copy text-gray-600 hover:text-white cursor-pointer transition"></i>
                        </div>

                        <div class="flex items-center justify-between border-t border-white/5 pt-3">
                            <div>
                                <div class="text-[10px] text-gray-500 uppercase font-bold">Rank / Tier</div>
                                <div class="font-bold text-sm" style="color: ${game.color}">${p.data.rank || p.data.tier || 'N/A'}</div>
                            </div>
                            ${p.locked ? 
                                `<div class="text-xs text-z-red font-bold flex items-center gap-1 bg-z-red/10 px-2 py-1 rounded"><i class="fa-solid fa-lock"></i> Locked (${p.daysLeft}d)</div>` : 
                                `<div class="text-xs text-z-green font-bold flex items-center gap-1 bg-z-green/10 px-2 py-1 rounded"><i class="fa-solid fa-check-circle"></i> Verified</div>`
                            }
                        </div>
                    </div>
                </div>`;
            });
        }

        // --- 3. MODAL LOGIC ---
        const modalOverlay = document.getElementById('modal-overlay');
        const modalContent = document.getElementById('modal-content');
        const viewSelector = document.getElementById('view-selector');
        const viewForm = document.getElementById('view-form');
        let isEditMode = false;
        let currentGameId = null;

        function openLinkModal() {
            isEditMode = false;
            currentGameId = null;
            resetForm();
            showView('selector');
            showModal();
        }

        function editPassport(gameId) {
            isEditMode = true;
            currentGameId = gameId;
            const passport = userPassports.find(p => p.gameId === gameId);
            loadForm(gameId, passport.data);
            showView('form');
            showModal();
        }

        function showModal() {
            modalOverlay.classList.remove('hidden');
            setTimeout(() => {
                modalOverlay.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
                modalContent.classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            modalOverlay.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                modalOverlay.classList.add('hidden');
            }, 300);
        }

        function showView(viewName) {
            if(viewName === 'selector') {
                document.getElementById('modal-title').innerText = "Select Game";
                viewSelector.classList.remove('hidden');
                viewForm.classList.add('hidden');
                renderGameSelector();
            } else {
                document.getElementById('modal-title').innerText = isEditMode ? "Edit Passport" : "Link New Game";
                viewSelector.classList.add('hidden');
                viewForm.classList.remove('hidden');
                viewForm.classList.add('flex');
            }
        }

        function backToSelector() {
            if(isEditMode) return; // Cannot change game in edit mode
            showView('selector');
        }

        // --- 4. RENDERERS ---
        function renderGameSelector() {
            const container = viewSelector.querySelector('.grid');
            container.innerHTML = '';
            
            for (const [key, game] of Object.entries(gamesDB)) {
                // Check if already linked
                const isLinked = userPassports.some(p => p.gameId === key);
                const opacityClass = isLinked ? 'opacity-50 cursor-not-allowed grayscale' : 'hover:bg-white/10 cursor-pointer';
                const clickAction = isLinked ? '' : `onclick="loadForm('${key}')"`;
                
                const isTextIcon = !game.icon.includes('<');
                const iconHtml = isTextIcon 
                    ? `<div class="w-10 h-10 rounded-lg flex items-center justify-center font-black text-lg bg-white/10" style="color:${game.color}">${game.icon}</div>` 
                    : `<div class="w-10 h-10 rounded-lg flex items-center justify-center text-lg bg-white/10" style="color:${game.color}">${game.icon}</div>`;

                container.innerHTML += `
                    <div ${clickAction} class="bg-white/5 border border-white/5 rounded-xl p-4 flex flex-col items-center justify-center gap-3 transition ${opacityClass}">
                        ${iconHtml}
                        <span class="text-xs font-bold text-gray-300">${game.name}</span>
                        ${isLinked ? '<span class="text-[10px] text-z-green font-bold">Linked</span>' : ''}
                    </div>
                `;
            }
        }

        function loadForm(gameId, existingData = null) {
            const game = gamesDB[gameId];
            showView('form');
            
            // Header
            document.getElementById('form-game-name').innerText = game.name;
            const iconDiv = document.getElementById('form-icon');
            iconDiv.innerHTML = !game.icon.includes('<') ? game.icon : game.icon;
            iconDiv.style.color = game.color;
            iconDiv.style.boxShadow = `0 0 20px ${game.color}40`;

            // Fields
            const container = document.getElementById('dynamic-fields');
            container.innerHTML = '';

            game.fields.forEach(f => {
                const width = f.width === 'half' ? 'md:col-span-1' : 'md:col-span-2';
                let inputHtml = '';
                const val = existingData ? existingData[f.id] : '';
                const disabled = isEditMode && f.immutable ? 'disabled' : '';
                const lockIcon = disabled ? '<i class="fa-solid fa-lock text-[10px] ml-1 text-z-red"></i>' : '';

                if(f.type === 'select') {
                    const opts = f.options.map(o => `<option ${o === val ? 'selected' : ''}>${o}</option>`).join('');
                    inputHtml = `
                        <div class="relative">
                            <select class="z-input appearance-none bg-[#0a0a0a]" ${disabled}>${opts}</select>
                            <i class="fa-solid fa-chevron-down absolute right-4 top-4 text-gray-500 text-xs pointer-events-none"></i>
                        </div>`;
                } else {
                    inputHtml = `<input type="${f.type}" value="${val}" placeholder="${f.placeholder}" class="z-input" ${disabled}>`;
                }

                container.innerHTML += `
                    <div class="${width} animate-fade-in">
                        <label class="z-label flex items-center">${f.label} ${lockIcon}</label>
                        ${inputHtml}
                    </div>
                `;
            });

            // Terms Checkbox Reset
            const check = document.getElementById('terms-check');
            const btn = document.getElementById('save-btn');
            check.checked = false;
            
            if(isEditMode) {
                // In edit mode, no need to re-agree to lock terms, just save
                check.parentElement.parentElement.style.display = 'none'; // Hide terms box
                btn.disabled = false;
                btn.className = "px-8 py-2.5 rounded-lg text-xs font-bold bg-z-cyan text-black hover:bg-white transition uppercase shadow-glow flex items-center gap-2";
                btn.innerHTML = '<i class="fa-solid fa-floppy-disk"></i> Update Passport';
            } else {
                check.parentElement.parentElement.style.display = 'block';
                btn.disabled = true;
                btn.className = "px-8 py-2.5 rounded-lg text-xs font-bold bg-gray-700 text-gray-400 uppercase cursor-not-allowed transition flex items-center gap-2";
                btn.innerHTML = '<i class="fa-solid fa-check"></i> Save Passport';
            }
        }

        function resetForm() {
            document.getElementById('game-form').reset();
        }

        // Terms Logic
        document.getElementById('terms-check').addEventListener('change', function() {
            const btn = document.getElementById('save-btn');
            if(this.checked) {
                btn.disabled = false;
                btn.className = "px-8 py-2.5 rounded-lg text-xs font-bold bg-z-cyan text-black hover:bg-white transition uppercase shadow-glow flex items-center gap-2";
            } else {
                btn.disabled = true;
                btn.className = "px-8 py-2.5 rounded-lg text-xs font-bold bg-gray-700 text-gray-400 uppercase cursor-not-allowed transition flex items-center gap-2";
            }
        });

        // Mock Save
        function saveData() {
            const btn = document.getElementById('save-btn');
            const ogText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Saving...';
            setTimeout(() => {
                closeModal();
                btn.innerHTML = ogText;
                // In real app, reload grid here
            }, 800);
        }

        // Init
        renderGrid();

    </script>
</body>
</html>